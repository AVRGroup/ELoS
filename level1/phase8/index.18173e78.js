function e(e,t,i,n){Object.defineProperty(e,t,{get:i,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},n={},r=t.parcelRequiredf3e;null==r&&((r=function(e){if(e in i)return i[e].exports;if(e in n){var t=n[e];delete n[e];var r={id:e,exports:{}};return i[e]=r,t.call(r.exports,r,r.exports),r.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){n[e]=t},t.parcelRequiredf3e=r),r.register("4xklQ",(function(t,i){e(t.exports,"REVISION",(()=>n)),e(t.exports,"MOUSE",(()=>r)),e(t.exports,"TOUCH",(()=>s)),e(t.exports,"FrontSide",(()=>o)),e(t.exports,"DoubleSide",(()=>a)),e(t.exports,"AdditiveBlending",(()=>l)),e(t.exports,"LinearToneMapping",(()=>c)),e(t.exports,"RepeatWrapping",(()=>g)),e(t.exports,"ClampToEdgeWrapping",(()=>v)),e(t.exports,"MirroredRepeatWrapping",(()=>x)),e(t.exports,"NearestFilter",(()=>y)),e(t.exports,"NearestMipmapNearestFilter",(()=>b)),e(t.exports,"NearestMipmapLinearFilter",(()=>w)),e(t.exports,"LinearFilter",(()=>M)),e(t.exports,"LinearMipmapNearestFilter",(()=>S)),e(t.exports,"LinearMipmapLinearFilter",(()=>_)),e(t.exports,"UnsignedByteType",(()=>T)),e(t.exports,"RGBAFormat",(()=>L)),e(t.exports,"InterpolateDiscrete",(()=>z)),e(t.exports,"InterpolateLinear",(()=>F)),e(t.exports,"TriangleStripDrawMode",(()=>G)),e(t.exports,"TriangleFanDrawMode",(()=>W)),e(t.exports,"LinearEncoding",(()=>j)),e(t.exports,"sRGBEncoding",(()=>X)),e(t.exports,"TangentSpaceNormalMap",(()=>q)),e(t.exports,"ObjectSpaceNormalMap",(()=>J)),e(t.exports,"EventDispatcher",(()=>te)),e(t.exports,"MathUtils",(()=>me)),e(t.exports,"Vector2",(()=>ge)),e(t.exports,"Matrix3",(()=>ve)),e(t.exports,"Color",(()=>Pe)),e(t.exports,"Texture",(()=>Fe)),e(t.exports,"Vector4",(()=>Be)),e(t.exports,"Quaternion",(()=>Ge)),e(t.exports,"Vector3",(()=>We)),e(t.exports,"Box3",(()=>qe)),e(t.exports,"Sphere",(()=>ut)),e(t.exports,"Matrix4",(()=>bt)),e(t.exports,"Object3D",(()=>jt)),e(t.exports,"Material",(()=>ri)),e(t.exports,"MeshBasicMaterial",(()=>si)),e(t.exports,"BufferAttribute",(()=>li)),e(t.exports,"Float32BufferAttribute",(()=>ui)),e(t.exports,"BufferGeometry",(()=>yi)),e(t.exports,"Mesh",(()=>zi)),e(t.exports,"BoxGeometry",(()=>Bi)),e(t.exports,"UniformsUtils",(()=>Hi)),e(t.exports,"ShaderMaterial",(()=>Gi)),e(t.exports,"PerspectiveCamera",(()=>ji)),e(t.exports,"PlaneGeometry",(()=>on)),e(t.exports,"ShaderChunk",(()=>an)),e(t.exports,"UniformsLib",(()=>ln)),e(t.exports,"ShaderLib",(()=>hn)),e(t.exports,"OrthographicCamera",(()=>gn)),e(t.exports,"Group",(()=>Cs)),e(t.exports,"WebGLRenderer",(()=>Os)),e(t.exports,"Scene",(()=>Fs)),e(t.exports,"InterleavedBuffer",(()=>Bs)),e(t.exports,"InterleavedBufferAttribute",(()=>Us)),e(t.exports,"SpriteMaterial",(()=>Hs)),e(t.exports,"SkinnedMesh",(()=>fo)),e(t.exports,"Bone",(()=>po)),e(t.exports,"Skeleton",(()=>xo)),e(t.exports,"InstancedBufferAttribute",(()=>yo)),e(t.exports,"InstancedMesh",(()=>To)),e(t.exports,"LineBasicMaterial",(()=>Ao)),e(t.exports,"Line",(()=>Po)),e(t.exports,"LineSegments",(()=>Oo)),e(t.exports,"LineLoop",(()=>ko)),e(t.exports,"PointsMaterial",(()=>zo)),e(t.exports,"Points",(()=>Ho)),e(t.exports,"ConeGeometry",(()=>da)),e(t.exports,"SphereGeometry",(()=>el)),e(t.exports,"MeshStandardMaterial",(()=>hl)),e(t.exports,"MeshPhysicalMaterial",(()=>cl)),e(t.exports,"MeshPhongMaterial",(()=>ul)),e(t.exports,"MeshLambertMaterial",(()=>pl)),e(t.exports,"Interpolant",(()=>Sl)),e(t.exports,"NumberKeyframeTrack",(()=>Ll)),e(t.exports,"QuaternionKeyframeTrack",(()=>Pl)),e(t.exports,"VectorKeyframeTrack",(()=>Il)),e(t.exports,"AnimationClip",(()=>Ol)),e(t.exports,"Loader",(()=>Vl)),e(t.exports,"FileLoader",(()=>Gl)),e(t.exports,"TextureLoader",(()=>jl)),e(t.exports,"HemisphereLight",(()=>ql)),e(t.exports,"SpotLight",(()=>Ql)),e(t.exports,"PointLight",(()=>rh)),e(t.exports,"DirectionalLight",(()=>oh)),e(t.exports,"MaterialLoader",(()=>uh)),e(t.exports,"LoaderUtils",(()=>dh)),e(t.exports,"ObjectLoader",(()=>mh)),e(t.exports,"ImageBitmapLoader",(()=>yh)),e(t.exports,"Clock",(()=>bh)),e(t.exports,"PropertyBinding",(()=>Ch)),e(t.exports,"Spherical",(()=>Nh)),e(t.exports,"GridHelper",(()=>Lh));
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const n="146",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},s={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=2,l=2,h=100,c=1,u=301,d=302,f=303,p=304,m=306,g=1e3,v=1001,x=1002,y=1003,b=1004,w=1005,M=1006,S=1007,_=1008,T=1009,A=1014,E=1015,C=1016,N=1020,L=1023,R=1026,P=1027,D=33776,I=33777,O=33778,k=33779,z=2300,F=2301,B=2302,V=2400,U=2401,H=2402,G=1,W=2,j=3e3,X=3001,q=0,J=1,K="srgb",Y="srgb-linear",Z=7680,$=35044,Q="300 es",ee=1035;class te{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}const ie=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ne=1234567;const re=Math.PI/180,se=180/Math.PI;function oe(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(ie[255&e]+ie[e>>8&255]+ie[e>>16&255]+ie[e>>24&255]+"-"+ie[255&t]+ie[t>>8&255]+"-"+ie[t>>16&15|64]+ie[t>>24&255]+"-"+ie[63&i|128]+ie[i>>8&255]+"-"+ie[i>>16&255]+ie[i>>24&255]+ie[255&n]+ie[n>>8&255]+ie[n>>16&255]+ie[n>>24&255]).toLowerCase()}function ae(e,t,i){return Math.max(t,Math.min(i,e))}function le(e,t){return(e%t+t)%t}function he(e,t,i){return(1-i)*e+i*t}function ce(e){return 0==(e&e-1)&&0!==e}function ue(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function de(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function fe(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function pe(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var me=Object.freeze({__proto__:null,DEG2RAD:re,RAD2DEG:se,generateUUID:oe,clamp:ae,euclideanModulo:le,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:he,damp:function(e,t,i,n){return he(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(le(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(ne=e);let t=ne+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*re},radToDeg:function(e){return e*se},isPowerOfTwo:ce,ceilPowerOfTwo:ue,floorPowerOfTwo:de,setQuaternionFromProperEuler:function(e,t,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),h=s((t+n)/2),c=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),f=s((n-t)/2),p=o((n-t)/2);switch(r){case"XYX":e.set(a*c,l*u,l*d,a*h);break;case"YZY":e.set(l*d,a*c,l*u,a*h);break;case"ZXZ":e.set(l*u,l*d,a*c,a*h);break;case"XZX":e.set(a*c,l*p,l*f,a*h);break;case"YXY":e.set(l*f,a*c,l*p,a*h);break;case"ZYZ":e.set(l*p,l*f,a*c,a*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:pe,denormalize:fe});class ge{constructor(e=0,t=0){ge.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,s=this.y-e.y;return this.x=r*i-s*n+e.x,this.y=r*n+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ve{constructor(){ve.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,s,o,a,l){const h=this.elements;return h[0]=e,h[1]=n,h[2]=o,h[3]=t,h[4]=r,h[5]=a,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],f=i[8],p=n[0],m=n[3],g=n[6],v=n[1],x=n[4],y=n[7],b=n[2],w=n[5],M=n[8];return r[0]=s*p+o*v+a*b,r[3]=s*m+o*x+a*w,r[6]=s*g+o*y+a*M,r[1]=l*p+h*v+c*b,r[4]=l*m+h*x+c*w,r[7]=l*g+h*y+c*M,r[2]=u*p+d*v+f*b,r[5]=u*m+d*x+f*w,r[8]=u*g+d*y+f*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],h=e[8];return t*s*h-t*o*l-i*r*h+i*o*a+n*r*l-n*s*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],h=e[8],c=h*s-o*l,u=o*a-h*r,d=l*r-s*a,f=t*c+i*u+n*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=c*p,e[1]=(n*l-h*i)*p,e[2]=(o*i-n*s)*p,e[3]=u*p,e[4]=(h*t-n*a)*p,e[5]=(n*r-o*t)*p,e[6]=d*p,e[7]=(i*a-l*t)*p,e[8]=(s*t-i*r)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+e,-n*l,n*a,-n*(-l*s+a*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],h=n[7];return n[0]=t*r+i*a,n[3]=t*s+i*l,n[6]=t*o+i*h,n[1]=-i*r+t*a,n[4]=-i*s+t*l,n[7]=-i*o+t*h,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function xe(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const ye={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function be(e,t){return new ye[e](t)}function we(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Me(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Se(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const _e={[K]:{[Y]:Me},[Y]:{[K]:Se}},Te={legacyMode:!0,get workingColorSpace(){return Y},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(_e[t]&&void 0!==_e[t][i]){const n=_e[t][i];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Ae={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ee={r:0,g:0,b:0},Ce={h:0,s:0,l:0},Ne={h:0,s:0,l:0};function Le(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function Re(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}class Pe{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Te.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n="srgb-linear"){return this.r=e,this.g=t,this.b=i,Te.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n="srgb-linear"){if(e=le(e,1),t=ae(t,0,1),i=ae(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=Le(r,n,e+1/3),this.g=Le(r,n,e),this.b=Le(r,n,e-1/3)}return Te.toWorkingColorSpace(this,n),this}setStyle(e,t="srgb"){function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Te.toWorkingColorSpace(this,t),i(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Te.toWorkingColorSpace(this,t),i(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(e[1])/360,r=parseFloat(e[2])/100,s=parseFloat(e[3])/100;return i(e[4]),this.setHSL(n,r,s,t)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Te.toWorkingColorSpace(this,t),this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Te.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const i=Ae[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Me(e.r),this.g=Me(e.g),this.b=Me(e.b),this}copyLinearToSRGB(e){return this.r=Se(e.r),this.g=Se(e.g),this.b=Se(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Te.fromWorkingColorSpace(Re(this,Ee),e),ae(255*Ee.r,0,255)<<16^ae(255*Ee.g,0,255)<<8^ae(255*Ee.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){Te.fromWorkingColorSpace(Re(this,Ee),t);const i=Ee.r,n=Ee.g,r=Ee.b,s=Math.max(i,n,r),o=Math.min(i,n,r);let a,l;const h=(o+s)/2;if(o===s)a=0,l=0;else{const e=s-o;switch(l=h<=.5?e/(s+o):e/(2-s-o),s){case i:a=(n-r)/e+(n<r?6:0);break;case n:a=(r-i)/e+2;break;case r:a=(i-n)/e+4}a/=6}return e.h=a,e.s=l,e.l=h,e}getRGB(e,t="srgb-linear"){return Te.fromWorkingColorSpace(Re(this,Ee),t),e.r=Ee.r,e.g=Ee.g,e.b=Ee.b,e}getStyle(e="srgb"){return Te.fromWorkingColorSpace(Re(this,Ee),e),e!==K?`color(${e} ${Ee.r} ${Ee.g} ${Ee.b})`:`rgb(${255*Ee.r|0},${255*Ee.g|0},${255*Ee.b|0})`}offsetHSL(e,t,i){return this.getHSL(Ce),Ce.h+=e,Ce.s+=t,Ce.l+=i,this.setHSL(Ce.h,Ce.s,Ce.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Ce),e.getHSL(Ne);const i=he(Ce.h,Ne.h,t),n=he(Ce.s,Ne.s,t),r=he(Ce.l,Ne.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let De;Pe.NAMES=Ae;class Ie{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===De&&(De=we("canvas")),De.width=e.width,De.height=e.height;const i=De.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=De}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=we("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*Me(r[e]/255);return i.putImageData(n,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Me(t[e]/255)):t[e]=Me(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Oe{constructor(e=null){this.isSource=!0,this.uuid=oe(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(ke(n[t].image)):e.push(ke(n[t]))}else e=ke(n);i.url=e}return t||(e.images[this.uuid]=i),i}}function ke(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ie.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ze=0;class Fe extends te{constructor(e=Fe.DEFAULT_IMAGE,t=Fe.DEFAULT_MAPPING,i=v,n=v,r=M,s=_,o=L,a=T,l=1,h=j){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ze++}),this.uuid=oe(),this.name="",this.source=new Oe(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new ge(0,0),this.repeat=new ge(1,1),this.center=new ge(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ve,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case g:e.x=e.x-Math.floor(e.x);break;case v:e.x=e.x<0?0:1;break;case x:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case g:e.y=e.y-Math.floor(e.y);break;case v:e.y=e.y<0?0:1;break;case x:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Fe.DEFAULT_IMAGE=null,Fe.DEFAULT_MAPPING=300;class Be{constructor(e=0,t=0,i=0,n=1){Be.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*t+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*t+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*t+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;const s=.01,o=.1,a=e.elements,l=a[0],h=a[4],c=a[8],u=a[1],d=a[5],f=a[9],p=a[2],m=a[6],g=a[10];if(Math.abs(h-u)<s&&Math.abs(c-p)<s&&Math.abs(f-m)<s){if(Math.abs(h+u)<o&&Math.abs(c+p)<o&&Math.abs(f+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,v=(g+1)/2,x=(h+u)/4,y=(c+p)/4,b=(f+m)/4;return e>a&&e>v?e<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=x/i,r=y/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=x/n,r=b/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=y/r,n=b/r),this.set(i,n,r,t),this}let v=Math.sqrt((m-f)*(m-f)+(c-p)*(c-p)+(u-h)*(u-h));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(c-p)/v,this.z=(u-h)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ve extends te{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Be(0,0,e,t),this.scissorTest=!1,this.viewport=new Be(0,0,e,t);const n={width:e,height:t,depth:1};this.texture=new Fe(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:M,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Oe(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ue extends Fe{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=y,this.minFilter=y,this.wrapR=v,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class He extends Fe{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=y,this.minFilter=y,this.wrapR=v,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ge{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,s,o){let a=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=r[s+0],d=r[s+1],f=r[s+2],p=r[s+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=h,void(e[t+3]=c);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(c!==p||a!==u||l!==d||h!==f){let e=1-o;const t=a*u+l*d+h*f+c*p,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,t*i);e=Math.sin(e*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*e+u*r,l=l*e+d*r,h=h*e+f*r,c=c*e+p*r,e===1-o){const e=1/Math.sqrt(a*a+l*l+h*h+c*c);a*=e,l*=e,h*=e,c*=e}}e[t]=a,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],h=i[n+3],c=r[s],u=r[s+1],d=r[s+2],f=r[s+3];return e[t]=o*f+h*c+a*d-l*u,e[t+1]=a*f+h*u+l*c-o*d,e[t+2]=l*f+h*d+o*u-a*c,e[t+3]=h*f-o*c-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,n=e._y,r=e._z,s=e._order,o=Math.cos,a=Math.sin,l=o(i/2),h=o(n/2),c=o(r/2),u=a(i/2),d=a(n/2),f=a(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*f,this._y=l*d*c-u*h*f,this._z=l*h*f+u*d*c,this._w=l*h*c-u*d*f;break;case"YXZ":this._x=u*h*c+l*d*f,this._y=l*d*c-u*h*f,this._z=l*h*f-u*d*c,this._w=l*h*c+u*d*f;break;case"ZXY":this._x=u*h*c-l*d*f,this._y=l*d*c+u*h*f,this._z=l*h*f+u*d*c,this._w=l*h*c-u*d*f;break;case"ZYX":this._x=u*h*c-l*d*f,this._y=l*d*c+u*h*f,this._z=l*h*f-u*d*c,this._w=l*h*c+u*d*f;break;case"YZX":this._x=u*h*c+l*d*f,this._y=l*d*c+u*h*f,this._z=l*h*f-u*d*c,this._w=l*h*c-u*d*f;break;case"XZY":this._x=u*h*c-l*d*f,this._y=l*d*c-u*h*f,this._z=l*h*f+u*d*c,this._w=l*h*c+u*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],r=t[8],s=t[1],o=t[5],a=t[9],l=t[2],h=t[6],c=t[10],u=i+o+c;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(h-a)*e,this._y=(r-l)*e,this._z=(s-n)*e}else if(i>o&&i>c){const e=2*Math.sqrt(1+i-o-c);this._w=(h-a)/e,this._x=.25*e,this._y=(n+s)/e,this._z=(r+l)/e}else if(o>c){const e=2*Math.sqrt(1+o-i-c);this._w=(r-l)/e,this._x=(n+s)/e,this._y=.25*e,this._z=(a+h)/e}else{const e=2*Math.sqrt(1+c-i-o);this._w=(s-n)/e,this._x=(r+l)/e,this._y=(a+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ae(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,r=e._z,s=e._w,o=t._x,a=t._y,l=t._z,h=t._w;return this._x=i*h+s*o+n*l-r*a,this._y=n*h+s*a+r*o-i*l,this._z=r*h+s*l+i*a-n*o,this._w=s*h-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*e._w+i*e._x+n*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),h=Math.atan2(l,o),c=Math.sin((1-t)*h)/l,u=Math.sin(t*h)/l;return this._w=s*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class We{constructor(e=0,t=0,i=0){We.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Xe.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Xe.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,r=e.elements,s=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,s=e.y,o=e.z,a=e.w,l=a*t+s*n-o*i,h=a*i+o*t-r*n,c=a*n+r*i-s*t,u=-r*t-s*i-o*n;return this.x=l*a+u*-r+h*-o-c*-s,this.y=h*a+u*-s+c*-r-l*-o,this.z=c*a+u*-o+l*-s-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,r=e.z,s=t.x,o=t.y,a=t.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return je.copy(this).projectOnVector(e),this.sub(je)}reflect(e){return this.sub(je.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ae(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const je=new We,Xe=new Ge;class qe{constructor(e=new We(1/0,1/0,1/0),t=new We(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],h=e[a+1],c=e[a+2];l<t&&(t=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>o&&(o=c)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),h=e.getY(a),c=e.getZ(a);l<t&&(t=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>o&&(o=c)}return this.min.set(t,i,n),this.max.set(r,s,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ke.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const t=i.attributes.position;for(let i=0,n=t.count;i<n;i++)Ke.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(Ke)}else null===i.boundingBox&&i.computeBoundingBox(),Ye.copy(i.boundingBox),Ye.applyMatrix4(e.matrixWorld),this.union(Ye);const n=e.children;for(let e=0,i=n.length;e<i;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ke),Ke.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(nt),rt.subVectors(this.max,nt),Ze.subVectors(e.a,nt),$e.subVectors(e.b,nt),Qe.subVectors(e.c,nt),et.subVectors($e,Ze),tt.subVectors(Qe,$e),it.subVectors(Ze,Qe);let t=[0,-et.z,et.y,0,-tt.z,tt.y,0,-it.z,it.y,et.z,0,-et.x,tt.z,0,-tt.x,it.z,0,-it.x,-et.y,et.x,0,-tt.y,tt.x,0,-it.y,it.x,0];return!!at(t,Ze,$e,Qe,rt)&&(t=[1,0,0,0,1,0,0,0,1],!!at(t,Ze,$e,Qe,rt)&&(st.crossVectors(et,tt),t=[st.x,st.y,st.z],at(t,Ze,$e,Qe,rt)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ke.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Ke).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Je[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Je[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Je[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Je[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Je[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Je[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Je[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Je[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Je)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Je=[new We,new We,new We,new We,new We,new We,new We,new We],Ke=new We,Ye=new qe,Ze=new We,$e=new We,Qe=new We,et=new We,tt=new We,it=new We,nt=new We,rt=new We,st=new We,ot=new We;function at(e,t,i,n,r){for(let s=0,o=e.length-3;s<=o;s+=3){ot.fromArray(e,s);const o=r.x*Math.abs(ot.x)+r.y*Math.abs(ot.y)+r.z*Math.abs(ot.z),a=t.dot(ot),l=i.dot(ot),h=n.dot(ot);if(Math.max(-Math.max(a,l,h),Math.min(a,l,h))>o)return!1}return!0}const lt=new qe,ht=new We,ct=new We;class ut{constructor(e=new We,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):lt.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ht.subVectors(e,this.center);const t=ht.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.addScaledVector(ht,i/e),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(ct.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ht.copy(e.center).add(ct)),this.expandByPoint(ht.copy(e.center).sub(ct))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const dt=new We,ft=new We,pt=new We,mt=new We,gt=new We,vt=new We,xt=new We;class yt{constructor(e=new We,t=new We(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,dt)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=dt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(dt.copy(this.direction).multiplyScalar(t).add(this.origin),dt.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){ft.copy(e).add(t).multiplyScalar(.5),pt.copy(t).sub(e).normalize(),mt.copy(this.origin).sub(ft);const r=.5*e.distanceTo(t),s=-this.direction.dot(pt),o=mt.dot(this.direction),a=-mt.dot(pt),l=mt.lengthSq(),h=Math.abs(1-s*s);let c,u,d,f;if(h>0)if(c=s*a-o,u=s*o-a,f=r*h,c>=0)if(u>=-f)if(u<=f){const e=1/h;c*=e,u*=e,d=c*(c+s*u+2*o)+u*(s*c+u+2*a)+l}else u=r,c=Math.max(0,-(s*u+o)),d=-c*c+u*(u+2*a)+l;else u=-r,c=Math.max(0,-(s*u+o)),d=-c*c+u*(u+2*a)+l;else u<=-f?(c=Math.max(0,-(-s*r+o)),u=c>0?-r:Math.min(Math.max(-r,-a),r),d=-c*c+u*(u+2*a)+l):u<=f?(c=0,u=Math.min(Math.max(-r,-a),r),d=u*(u+2*a)+l):(c=Math.max(0,-(s*r+o)),u=c>0?r:Math.min(Math.max(-r,-a),r),d=-c*c+u*(u+2*a)+l);else u=s>0?-r:r,c=Math.max(0,-(s*u+o)),d=-c*c+u*(u+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(pt).multiplyScalar(u).add(ft),d}intersectSphere(e,t){dt.subVectors(e.center,this.origin);const i=dt.dot(this.direction),n=dt.dot(dt)-i*i,r=e.radius*e.radius;if(n>r)return null;const s=Math.sqrt(r-n),o=i-s,a=i+s;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,s,o,a;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),h>=0?(r=(e.min.y-u.y)*h,s=(e.max.y-u.y)*h):(r=(e.max.y-u.y)*h,s=(e.min.y-u.y)*h),i>s||r>n?null:((r>i||isNaN(i))&&(i=r),(s<n||isNaN(n))&&(n=s),c>=0?(o=(e.min.z-u.z)*c,a=(e.max.z-u.z)*c):(o=(e.max.z-u.z)*c,a=(e.min.z-u.z)*c),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,dt)}intersectTriangle(e,t,i,n,r){gt.subVectors(t,e),vt.subVectors(i,e),xt.crossVectors(gt,vt);let s,o=this.direction.dot(xt);if(o>0){if(n)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}mt.subVectors(this.origin,e);const a=s*this.direction.dot(vt.crossVectors(mt,vt));if(a<0)return null;const l=s*this.direction.dot(gt.cross(mt));if(l<0)return null;if(a+l>o)return null;const h=-s*mt.dot(xt);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class bt{constructor(){bt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,s,o,a,l,h,c,u,d,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bt).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/wt.setFromMatrixColumn(e,0).length(),r=1/wt.setFromMatrixColumn(e,1).length(),s=1/wt.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,r=e.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){const e=s*h,i=s*c,n=o*h,r=o*c;t[0]=a*h,t[4]=-a*c,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-o*a,t[2]=r-e*l,t[6]=n+i*l,t[10]=s*a}else if("YXZ"===e.order){const e=a*h,i=a*c,n=l*h,r=l*c;t[0]=e+r*o,t[4]=n*o-i,t[8]=s*l,t[1]=s*c,t[5]=s*h,t[9]=-o,t[2]=i*o-n,t[6]=r+e*o,t[10]=s*a}else if("ZXY"===e.order){const e=a*h,i=a*c,n=l*h,r=l*c;t[0]=e-r*o,t[4]=-s*c,t[8]=n+i*o,t[1]=i+n*o,t[5]=s*h,t[9]=r-e*o,t[2]=-s*l,t[6]=o,t[10]=s*a}else if("ZYX"===e.order){const e=s*h,i=s*c,n=o*h,r=o*c;t[0]=a*h,t[4]=n*l-i,t[8]=e*l+r,t[1]=a*c,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=s*a}else if("YZX"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*h,t[4]=r-e*c,t[8]=n*c+i,t[1]=c,t[5]=s*h,t[9]=-o*h,t[2]=-l*h,t[6]=i*c+n,t[10]=e-r*c}else if("XZY"===e.order){const e=s*a,i=s*l,n=o*a,r=o*l;t[0]=a*h,t[4]=-c,t[8]=l*h,t[1]=e*c+r,t[5]=s*h,t[9]=i*c-n,t[2]=n*c-i,t[6]=o*h,t[10]=r*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(St,e,_t)}lookAt(e,t,i){const n=this.elements;return Et.subVectors(e,t),0===Et.lengthSq()&&(Et.z=1),Et.normalize(),Tt.crossVectors(i,Et),0===Tt.lengthSq()&&(1===Math.abs(i.z)?Et.x+=1e-4:Et.z+=1e-4,Et.normalize(),Tt.crossVectors(i,Et)),Tt.normalize(),At.crossVectors(Et,Tt),n[0]=Tt.x,n[4]=At.x,n[8]=Et.x,n[1]=Tt.y,n[5]=At.y,n[9]=Et.y,n[2]=Tt.z,n[6]=At.z,n[10]=Et.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],f=i[2],p=i[6],m=i[10],g=i[14],v=i[3],x=i[7],y=i[11],b=i[15],w=n[0],M=n[4],S=n[8],_=n[12],T=n[1],A=n[5],E=n[9],C=n[13],N=n[2],L=n[6],R=n[10],P=n[14],D=n[3],I=n[7],O=n[11],k=n[15];return r[0]=s*w+o*T+a*N+l*D,r[4]=s*M+o*A+a*L+l*I,r[8]=s*S+o*E+a*R+l*O,r[12]=s*_+o*C+a*P+l*k,r[1]=h*w+c*T+u*N+d*D,r[5]=h*M+c*A+u*L+d*I,r[9]=h*S+c*E+u*R+d*O,r[13]=h*_+c*C+u*P+d*k,r[2]=f*w+p*T+m*N+g*D,r[6]=f*M+p*A+m*L+g*I,r[10]=f*S+p*E+m*R+g*O,r[14]=f*_+p*C+m*P+g*k,r[3]=v*w+x*T+y*N+b*D,r[7]=v*M+x*A+y*L+b*I,r[11]=v*S+x*E+y*R+b*O,r[15]=v*_+x*C+y*P+b*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],s=e[1],o=e[5],a=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14];return e[3]*(+r*a*c-n*l*c-r*o*u+i*l*u+n*o*d-i*a*d)+e[7]*(+t*a*d-t*l*u+r*s*u-n*s*d+n*l*h-r*a*h)+e[11]*(+t*l*c-t*o*d-r*s*c+i*s*d+r*o*h-i*l*h)+e[15]*(-n*o*h-t*a*c+t*o*u+n*s*c-i*s*u+i*a*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=c*m*l-p*u*l+p*a*d-o*m*d-c*a*g+o*u*g,x=f*u*l-h*m*l-f*a*d+s*m*d+h*a*g-s*u*g,y=h*p*l-f*c*l+f*o*d-s*p*d-h*o*g+s*c*g,b=f*c*a-h*p*a-f*o*u+s*p*u+h*o*m-s*c*m,w=t*v+i*x+n*y+r*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=v*M,e[1]=(p*u*r-c*m*r-p*n*d+i*m*d+c*n*g-i*u*g)*M,e[2]=(o*m*r-p*a*r+p*n*l-i*m*l-o*n*g+i*a*g)*M,e[3]=(c*a*r-o*u*r-c*n*l+i*u*l+o*n*d-i*a*d)*M,e[4]=x*M,e[5]=(h*m*r-f*u*r+f*n*d-t*m*d-h*n*g+t*u*g)*M,e[6]=(f*a*r-s*m*r-f*n*l+t*m*l+s*n*g-t*a*g)*M,e[7]=(s*u*r-h*a*r+h*n*l-t*u*l-s*n*d+t*a*d)*M,e[8]=y*M,e[9]=(f*c*r-h*p*r-f*i*d+t*p*d+h*i*g-t*c*g)*M,e[10]=(s*p*r-f*o*r+f*i*l-t*p*l-s*i*g+t*o*g)*M,e[11]=(h*o*r-s*c*r-h*i*l+t*c*l+s*i*d-t*o*d)*M,e[12]=b*M,e[13]=(h*p*n-f*c*n+f*i*u-t*p*u-h*i*m+t*c*m)*M,e[14]=(f*o*n-s*p*n-f*i*a+t*p*a+s*i*m-t*o*m)*M,e[15]=(s*c*n-h*o*n+h*i*a-t*c*a-s*i*u+t*o*u)*M,this}scale(e){const t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),r=1-i,s=e.x,o=e.y,a=e.z,l=r*s,h=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,h*o+i,h*a-n*s,0,l*a-n*o,h*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,s){return this.set(1,i,r,0,e,1,s,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,r=t._x,s=t._y,o=t._z,a=t._w,l=r+r,h=s+s,c=o+o,u=r*l,d=r*h,f=r*c,p=s*h,m=s*c,g=o*c,v=a*l,x=a*h,y=a*c,b=i.x,w=i.y,M=i.z;return n[0]=(1-(p+g))*b,n[1]=(d+y)*b,n[2]=(f-x)*b,n[3]=0,n[4]=(d-y)*w,n[5]=(1-(u+g))*w,n[6]=(m+v)*w,n[7]=0,n[8]=(f+x)*M,n[9]=(m-v)*M,n[10]=(1-(u+p))*M,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=wt.set(n[0],n[1],n[2]).length();const s=wt.set(n[4],n[5],n[6]).length(),o=wt.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],Mt.copy(this);const a=1/r,l=1/s,h=1/o;return Mt.elements[0]*=a,Mt.elements[1]*=a,Mt.elements[2]*=a,Mt.elements[4]*=l,Mt.elements[5]*=l,Mt.elements[6]*=l,Mt.elements[8]*=h,Mt.elements[9]*=h,Mt.elements[10]*=h,t.setFromRotationMatrix(Mt),i.x=r,i.y=s,i.z=o,this}makePerspective(e,t,i,n,r,s){const o=this.elements,a=2*r/(t-e),l=2*r/(i-n),h=(t+e)/(t-e),c=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,r,s){const o=this.elements,a=1/(t-e),l=1/(i-n),h=1/(s-r),c=(t+e)*a,u=(i+n)*l,d=(s+r)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const wt=new We,Mt=new bt,St=new We(0,0,0),_t=new We(1,1,1),Tt=new We,At=new We,Et=new We,Ct=new bt,Nt=new Ge;class Lt{constructor(e=0,t=0,i=0,n=Lt.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,r=n[0],s=n[4],o=n[8],a=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(ae(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ae(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(ae(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-ae(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ae(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-ae(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Ct.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ct,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Nt.setFromEuler(this),this.setFromQuaternion(Nt,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Lt.DefaultOrder="XYZ",Lt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Rt{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Pt=0;const Dt=new We,It=new Ge,Ot=new bt,kt=new We,zt=new We,Ft=new We,Bt=new Ge,Vt=new We(1,0,0),Ut=new We(0,1,0),Ht=new We(0,0,1),Gt={type:"added"},Wt={type:"removed"};class jt extends te{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Pt++}),this.uuid=oe(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=jt.DefaultUp.clone();const e=new We,t=new Lt,i=new Ge,n=new We(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new bt},normalMatrix:{value:new ve}}),this.matrix=new bt,this.matrixWorld=new bt,this.matrixAutoUpdate=jt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=jt.DefaultMatrixWorldAutoUpdate,this.layers=new Rt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return It.setFromAxisAngle(e,t),this.quaternion.multiply(It),this}rotateOnWorldAxis(e,t){return It.setFromAxisAngle(e,t),this.quaternion.premultiply(It),this}rotateX(e){return this.rotateOnAxis(Vt,e)}rotateY(e){return this.rotateOnAxis(Ut,e)}rotateZ(e){return this.rotateOnAxis(Ht,e)}translateOnAxis(e,t){return Dt.copy(e).applyQuaternion(this.quaternion),this.position.add(Dt.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Vt,e)}translateY(e){return this.translateOnAxis(Ut,e)}translateZ(e){return this.translateOnAxis(Ht,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ot.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?kt.copy(e):kt.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),zt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ot.lookAt(zt,kt,this.up):Ot.lookAt(kt,zt,this.up),this.quaternion.setFromRotationMatrix(Ot),n&&(Ot.extractRotation(n.matrixWorld),It.setFromRotationMatrix(Ot),this.quaternion.premultiply(It.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Gt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Wt)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Wt)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ot.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ot.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ot),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zt,e,Ft),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zt,Bt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){const n=t[i];!0!==n.matrixWorldAutoUpdate&&!0!==e||n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++){const i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){const t=s(e.geometries),n=s(e.materials),r=s(e.textures),o=s(e.images),a=s(e.shapes),l=s(e.skeletons),h=s(e.animations),c=s(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=n,i;function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}jt.DefaultUp=new We(0,1,0),jt.DefaultMatrixAutoUpdate=!0,jt.DefaultMatrixWorldAutoUpdate=!0;const Xt=new We,qt=new We,Jt=new We,Kt=new We,Yt=new We,Zt=new We,$t=new We,Qt=new We,ei=new We,ti=new We;class ii{constructor(e=new We,t=new We,i=new We){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),Xt.subVectors(e,t),n.cross(Xt);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){Xt.subVectors(n,t),qt.subVectors(i,t),Jt.subVectors(e,t);const s=Xt.dot(Xt),o=Xt.dot(qt),a=Xt.dot(Jt),l=qt.dot(qt),h=qt.dot(Jt),c=s*l-o*o;if(0===c)return r.set(-2,-1,-1);const u=1/c,d=(l*a-o*h)*u,f=(s*h-o*a)*u;return r.set(1-d-f,f,d)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Kt),Kt.x>=0&&Kt.y>=0&&Kt.x+Kt.y<=1}static getUV(e,t,i,n,r,s,o,a){return this.getBarycoord(e,t,i,n,Kt),a.set(0,0),a.addScaledVector(r,Kt.x),a.addScaledVector(s,Kt.y),a.addScaledVector(o,Kt.z),a}static isFrontFacing(e,t,i,n){return Xt.subVectors(i,t),qt.subVectors(e,t),Xt.cross(qt).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Xt.subVectors(this.c,this.b),qt.subVectors(this.a,this.b),.5*Xt.cross(qt).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ii.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ii.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return ii.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return ii.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ii.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,r=this.c;let s,o;Yt.subVectors(n,i),Zt.subVectors(r,i),Qt.subVectors(e,i);const a=Yt.dot(Qt),l=Zt.dot(Qt);if(a<=0&&l<=0)return t.copy(i);ei.subVectors(e,n);const h=Yt.dot(ei),c=Zt.dot(ei);if(h>=0&&c<=h)return t.copy(n);const u=a*c-h*l;if(u<=0&&a>=0&&h<=0)return s=a/(a-h),t.copy(i).addScaledVector(Yt,s);ti.subVectors(e,r);const d=Yt.dot(ti),f=Zt.dot(ti);if(f>=0&&d<=f)return t.copy(r);const p=d*l-a*f;if(p<=0&&l>=0&&f<=0)return o=l/(l-f),t.copy(i).addScaledVector(Zt,o);const m=h*f-d*c;if(m<=0&&c-h>=0&&d-f>=0)return $t.subVectors(r,n),o=(c-h)/(c-h+(d-f)),t.copy(n).addScaledVector($t,o);const g=1/(m+p+u);return s=p*g,o=u*g,t.copy(i).addScaledVector(Yt,s).addScaledVector(Zt,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let ni=0;class ri extends te{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ni++}),this.uuid=oe(),this.name="",this.type="Material",this.blending=1,this.side=o,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=h,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Z,this.stencilZFail=Z,this.stencilZPass=Z,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),this.side!==o&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class si extends ri{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Pe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const oi=new We,ai=new ge;class li{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=$,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)ai.fromBufferAttribute(this,t),ai.applyMatrix3(e),this.setXY(t,ai.x,ai.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)oi.fromBufferAttribute(this,t),oi.applyMatrix3(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)oi.fromBufferAttribute(this,t),oi.applyMatrix4(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)oi.fromBufferAttribute(this,t),oi.applyNormalMatrix(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)oi.fromBufferAttribute(this,t),oi.transformDirection(e),this.setXYZ(t,oi.x,oi.y,oi.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=fe(t,this.array)),t}setX(e,t){return this.normalized&&(t=pe(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=fe(t,this.array)),t}setY(e,t){return this.normalized&&(t=pe(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=fe(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pe(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=fe(t,this.array)),t}setW(e,t){return this.normalized&&(t=pe(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=pe(t,this.array),i=pe(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=pe(t,this.array),i=pe(i,this.array),n=pe(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=pe(t,this.array),i=pe(i,this.array),n=pe(n,this.array),r=pe(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==$&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class hi extends li{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class ci extends li{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class ui extends li{constructor(e,t,i){super(new Float32Array(e),t,i)}}let di=0;const fi=new bt,pi=new jt,mi=new We,gi=new qe,vi=new qe,xi=new We;class yi extends te{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:di++}),this.uuid=oe(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(xe(e)?ci:hi)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new ve).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return fi.makeRotationFromQuaternion(e),this.applyMatrix4(fi),this}rotateX(e){return fi.makeRotationX(e),this.applyMatrix4(fi),this}rotateY(e){return fi.makeRotationY(e),this.applyMatrix4(fi),this}rotateZ(e){return fi.makeRotationZ(e),this.applyMatrix4(fi),this}translate(e,t,i){return fi.makeTranslation(e,t,i),this.applyMatrix4(fi),this}scale(e,t,i){return fi.makeScale(e,t,i),this.applyMatrix4(fi),this}lookAt(e){return pi.lookAt(e),pi.updateMatrix(),this.applyMatrix4(pi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mi).negate(),this.translate(mi.x,mi.y,mi.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new ui(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qe);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new We(-1/0,-1/0,-1/0),new We(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];gi.setFromBufferAttribute(i),this.morphTargetsRelative?(xi.addVectors(this.boundingBox.min,gi.min),this.boundingBox.expandByPoint(xi),xi.addVectors(this.boundingBox.max,gi.max),this.boundingBox.expandByPoint(xi)):(this.boundingBox.expandByPoint(gi.min),this.boundingBox.expandByPoint(gi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ut);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new We,1/0);if(e){const i=this.boundingSphere.center;if(gi.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];vi.setFromBufferAttribute(i),this.morphTargetsRelative?(xi.addVectors(gi.min,vi.min),gi.expandByPoint(xi),xi.addVectors(gi.max,vi.max),gi.expandByPoint(xi)):(gi.expandByPoint(vi.min),gi.expandByPoint(vi.max))}gi.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)xi.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(xi));if(t)for(let r=0,s=t.length;r<s;r++){const s=t[r],o=this.morphTargetsRelative;for(let t=0,r=s.count;t<r;t++)xi.fromBufferAttribute(s,t),o&&(mi.fromBufferAttribute(e,t),xi.add(mi)),n=Math.max(n,i.distanceToSquared(xi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,n=t.position.array,r=t.normal.array,s=t.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new li(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,l=[],h=[];for(let e=0;e<o;e++)l[e]=new We,h[e]=new We;const c=new We,u=new We,d=new We,f=new ge,p=new ge,m=new ge,g=new We,v=new We;function x(e,t,i){c.fromArray(n,3*e),u.fromArray(n,3*t),d.fromArray(n,3*i),f.fromArray(s,2*e),p.fromArray(s,2*t),m.fromArray(s,2*i),u.sub(c),d.sub(c),p.sub(f),m.sub(f);const r=1/(p.x*m.y-m.x*p.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-p.y).multiplyScalar(r),v.copy(d).multiplyScalar(p.x).addScaledVector(u,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),h[e].add(v),h[t].add(v),h[i].add(v))}let y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)x(i[e+0],i[e+1],i[e+2])}const b=new We,w=new We,M=new We,S=new We;function _(e){M.fromArray(r,3*e),S.copy(M);const t=l[e];b.copy(t),b.sub(M.multiplyScalar(M.dot(t))).normalize(),w.crossVectors(S,t);const i=w.dot(h[e])<0?-1:1;a[4*e]=b.x,a[4*e+1]=b.y,a[4*e+2]=b.z,a[4*e+3]=i}for(let e=0,t=y.length;e<t;++e){const t=y[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)_(i[e+0]),_(i[e+1]),_(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new li(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new We,r=new We,s=new We,o=new We,a=new We,l=new We,h=new We,c=new We;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),f=e.getX(u+1),p=e.getX(u+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,f),s.fromBufferAttribute(t,p),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,p),o.add(h),a.add(h),l.add(h),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),i.setXYZ(e+0,h.x,h.y,h.z),i.setXYZ(e+1,h.x,h.y,h.z),i.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)xi.fromBufferAttribute(e,t),xi.normalize(),e.setXYZ(t,xi.x,xi.y,xi.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,r=e.normalized,s=new i.constructor(t.length*n);let o=0,a=0;for(let r=0,l=t.length;r<l;r++){o=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*n;for(let e=0;e<n;e++)s[a++]=i[o++]}return new li(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new yi,i=this.index.array,n=this.attributes;for(const r in n){const s=e(n[r],i);t.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],o=r[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);s.push(n)}t.morphAttributes[n]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,i=s.length;e<i;e++){const i=s[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let r=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],s=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];s.push(n.toJSON(e.data))}s.length>0&&(n[t]=s,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const r=e.morphAttributes;for(const e in r){const i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const bi=new bt,wi=new yt,Mi=new ut,Si=new We,_i=new We,Ti=new We,Ai=new We,Ei=new We,Ci=new We,Ni=new We,Li=new We,Ri=new We,Pi=new ge,Di=new ge,Ii=new ge,Oi=new We,ki=new We;class zi extends jt{constructor(e=new yi,t=new si){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}raycast(e,t){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Mi.copy(i.boundingSphere),Mi.applyMatrix4(r),!1===e.ray.intersectsSphere(Mi))return;if(bi.copy(r).invert(),wi.copy(e.ray).applyMatrix4(bi),null!==i.boundingBox&&!1===wi.intersectsBox(i.boundingBox))return;let s;const o=i.index,a=i.attributes.position,l=i.morphAttributes.position,h=i.morphTargetsRelative,c=i.attributes.uv,u=i.attributes.uv2,d=i.groups,f=i.drawRange;if(null!==o)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],p=n[r.materialIndex];for(let i=Math.max(r.start,f.start),n=Math.min(o.count,Math.min(r.start+r.count,f.start+f.count));i<n;i+=3){const n=o.getX(i),d=o.getX(i+1),f=o.getX(i+2);s=Fi(this,p,e,wi,a,l,h,c,u,n,d,f),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}}else{for(let i=Math.max(0,f.start),r=Math.min(o.count,f.start+f.count);i<r;i+=3){const r=o.getX(i),d=o.getX(i+1),f=o.getX(i+2);s=Fi(this,n,e,wi,a,l,h,c,u,r,d,f),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}else if(void 0!==a)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],o=n[r.materialIndex];for(let i=Math.max(r.start,f.start),n=Math.min(a.count,Math.min(r.start+r.count,f.start+f.count));i<n;i+=3){s=Fi(this,o,e,wi,a,l,h,c,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,t.push(s))}}else{for(let i=Math.max(0,f.start),r=Math.min(a.count,f.start+f.count);i<r;i+=3){s=Fi(this,n,e,wi,a,l,h,c,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),t.push(s))}}}}function Fi(e,t,i,n,r,s,o,l,h,c,u,d){Si.fromBufferAttribute(r,c),_i.fromBufferAttribute(r,u),Ti.fromBufferAttribute(r,d);const f=e.morphTargetInfluences;if(s&&f){Ni.set(0,0,0),Li.set(0,0,0),Ri.set(0,0,0);for(let e=0,t=s.length;e<t;e++){const t=f[e],i=s[e];0!==t&&(Ai.fromBufferAttribute(i,c),Ei.fromBufferAttribute(i,u),Ci.fromBufferAttribute(i,d),o?(Ni.addScaledVector(Ai,t),Li.addScaledVector(Ei,t),Ri.addScaledVector(Ci,t)):(Ni.addScaledVector(Ai.sub(Si),t),Li.addScaledVector(Ei.sub(_i),t),Ri.addScaledVector(Ci.sub(Ti),t)))}Si.add(Ni),_i.add(Li),Ti.add(Ri)}e.isSkinnedMesh&&(e.boneTransform(c,Si),e.boneTransform(u,_i),e.boneTransform(d,Ti));const p=function(e,t,i,n,r,s,o,l){let h;if(h=1===t.side?n.intersectTriangle(o,s,r,!0,l):n.intersectTriangle(r,s,o,t.side!==a,l),null===h)return null;ki.copy(l),ki.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(ki);return c<i.near||c>i.far?null:{distance:c,point:ki.clone(),object:e}}(e,t,i,n,Si,_i,Ti,Oi);if(p){l&&(Pi.fromBufferAttribute(l,c),Di.fromBufferAttribute(l,u),Ii.fromBufferAttribute(l,d),p.uv=ii.getUV(Oi,Si,_i,Ti,Pi,Di,Ii,new ge)),h&&(Pi.fromBufferAttribute(h,c),Di.fromBufferAttribute(h,u),Ii.fromBufferAttribute(h,d),p.uv2=ii.getUV(Oi,Si,_i,Ti,Pi,Di,Ii,new ge));const e={a:c,b:u,c:d,normal:new We,materialIndex:0};ii.getNormal(Si,_i,Ti,e.normal),p.face=e}return p}class Bi extends yi{constructor(e=1,t=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const o=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const a=[],l=[],h=[],c=[];let u=0,d=0;function f(e,t,i,n,r,s,f,p,m,g,v){const x=s/m,y=f/g,b=s/2,w=f/2,M=p/2,S=m+1,_=g+1;let T=0,A=0;const E=new We;for(let s=0;s<_;s++){const o=s*y-w;for(let a=0;a<S;a++){const u=a*x-b;E[e]=u*n,E[t]=o*r,E[i]=M,l.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[i]=p>0?1:-1,h.push(E.x,E.y,E.z),c.push(a/m),c.push(1-s/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const i=u+t+S*e,n=u+t+S*(e+1),r=u+(t+1)+S*(e+1),s=u+(t+1)+S*e;a.push(i,n,s),a.push(n,r,s),A+=6}o.addGroup(d,A,v),d+=A,u+=T}f("z","y","x",-1,-1,i,t,e,s,r,0),f("z","y","x",1,-1,i,t,-e,s,r,1),f("x","z","y",1,1,e,i,t,n,s,2),f("x","z","y",1,-1,e,i,-t,n,s,3),f("x","y","z",1,-1,e,t,i,n,r,4),f("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(a),this.setAttribute("position",new ui(l,3)),this.setAttribute("normal",new ui(h,3)),this.setAttribute("uv",new ui(c,2))}static fromJSON(e){return new Bi(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Vi(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function Ui(e){const t={};for(let i=0;i<e.length;i++){const n=Vi(e[i]);for(const e in n)t[e]=n[e]}return t}const Hi={clone:Vi,merge:Ui};class Gi extends ri{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vi(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Wi extends jt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bt,this.projectionMatrix=new bt,this.projectionMatrixInverse=new bt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class ji extends Wi{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*se*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*re*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*se*Math.atan(Math.tan(.5*re*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*re*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,o=s.fullHeight;r+=s.offsetX*n/e,t-=s.offsetY*i/o,n*=s.width/e,i*=s.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Xi=90;class qi extends jt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const n=new ji(Xi,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new We(1,0,0)),this.add(n);const r=new ji(Xi,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new We(-1,0,0)),this.add(r);const s=new ji(Xi,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new We(0,1,0)),this.add(s);const o=new ji(Xi,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new We(0,-1,0)),this.add(o);const a=new ji(Xi,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new We(0,0,1)),this.add(a);const l=new ji(Xi,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new We(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,o,a,l]=this.children,h=e.getRenderTarget(),c=e.toneMapping,u=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.toneMapping=c,e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class Ji extends Fe{constructor(e,t,i,n,r,s,o,a,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:u,i,n,r,s,o,a,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ki extends Ve{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new Ji(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:M}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Bi(5,5,5),r=new Gi({name:"CubemapFromEquirect",uniforms:Vi(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const s=new zi(n,r),o=t.minFilter;t.minFilter===_&&(t.minFilter=M);return new qi(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,n){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}const Yi=new We,Zi=new We,$i=new ve;class Qi{constructor(e=new We(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Yi.subVectors(i,t).cross(Zi.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(Yi),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||$i.getNormalMatrix(e),n=this.coplanarPoint(Yi).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const en=new ut,tn=new We;class nn{constructor(e=new Qi,t=new Qi,i=new Qi,n=new Qi,r=new Qi,s=new Qi){this.planes=[e,t,i,n,r,s]}set(e,t,i,n,r,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(s),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],f=i[10],p=i[11],m=i[12],g=i[13],v=i[14],x=i[15];return t[0].setComponents(o-n,c-a,p-u,x-m).normalize(),t[1].setComponents(o+n,c+a,p+u,x+m).normalize(),t[2].setComponents(o+r,c+l,p+d,x+g).normalize(),t[3].setComponents(o-r,c-l,p-d,x-g).normalize(),t[4].setComponents(o-s,c-h,p-f,x-v).normalize(),t[5].setComponents(o+s,c+h,p+f,x+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),en.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(en)}intersectsSprite(e){return en.center.set(0,0,0),en.radius=.7071067811865476,en.applyMatrix4(e.matrixWorld),this.intersectsSphere(en)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(tn.x=n.normal.x>0?e.max.x:e.min.x,tn.y=n.normal.y>0?e.max.y:e.min.y,tn.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(tn)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function rn(){let e=null,t=!1,i=null,n=null;function r(t,s){i(t,s),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function sn(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=n.get(t);void 0===s?n.set(t,function(t,n){const r=t.array,s=t.usage,o=e.createBuffer();let a;if(e.bindBuffer(n,o),e.bufferData(n,r,s),t.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):s.version<t.version&&(!function(t,n,r){const s=n.array,o=n.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,s):(i?e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):e.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,t,r),s.version=t.version)}}}class on extends yi{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const r=e/2,s=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,h=a+1,c=e/o,u=t/a,d=[],f=[],p=[],m=[];for(let e=0;e<h;e++){const t=e*u-s;for(let i=0;i<l;i++){const n=i*c-r;f.push(n,-t,0),p.push(0,0,1),m.push(i/o),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const i=t+l*e,n=t+l*(e+1),r=t+1+l*(e+1),s=t+1+l*e;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new ui(f,3)),this.setAttribute("normal",new ui(p,3)),this.setAttribute("uv",new ui(m,2))}static fromJSON(e){return new on(e.width,e.height,e.widthSegments,e.heightSegments)}}const an={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},ln={common:{diffuse:{value:new Pe(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ve},uv2Transform:{value:new ve},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ge(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Pe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Pe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ve}},sprite:{diffuse:{value:new Pe(16777215)},opacity:{value:1},center:{value:new ge(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ve}}},hn={basic:{uniforms:Ui([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.fog]),vertexShader:an.meshbasic_vert,fragmentShader:an.meshbasic_frag},lambert:{uniforms:Ui([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,ln.lights,{emissive:{value:new Pe(0)}}]),vertexShader:an.meshlambert_vert,fragmentShader:an.meshlambert_frag},phong:{uniforms:Ui([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,ln.lights,{emissive:{value:new Pe(0)},specular:{value:new Pe(1118481)},shininess:{value:30}}]),vertexShader:an.meshphong_vert,fragmentShader:an.meshphong_frag},standard:{uniforms:Ui([ln.common,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.roughnessmap,ln.metalnessmap,ln.fog,ln.lights,{emissive:{value:new Pe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:an.meshphysical_vert,fragmentShader:an.meshphysical_frag},toon:{uniforms:Ui([ln.common,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.gradientmap,ln.fog,ln.lights,{emissive:{value:new Pe(0)}}]),vertexShader:an.meshtoon_vert,fragmentShader:an.meshtoon_frag},matcap:{uniforms:Ui([ln.common,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,{matcap:{value:null}}]),vertexShader:an.meshmatcap_vert,fragmentShader:an.meshmatcap_frag},points:{uniforms:Ui([ln.points,ln.fog]),vertexShader:an.points_vert,fragmentShader:an.points_frag},dashed:{uniforms:Ui([ln.common,ln.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:an.linedashed_vert,fragmentShader:an.linedashed_frag},depth:{uniforms:Ui([ln.common,ln.displacementmap]),vertexShader:an.depth_vert,fragmentShader:an.depth_frag},normal:{uniforms:Ui([ln.common,ln.bumpmap,ln.normalmap,ln.displacementmap,{opacity:{value:1}}]),vertexShader:an.meshnormal_vert,fragmentShader:an.meshnormal_frag},sprite:{uniforms:Ui([ln.sprite,ln.fog]),vertexShader:an.sprite_vert,fragmentShader:an.sprite_frag},background:{uniforms:{uvTransform:{value:new ve},t2D:{value:null}},vertexShader:an.background_vert,fragmentShader:an.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0}},vertexShader:an.backgroundCube_vert,fragmentShader:an.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:an.cube_vert,fragmentShader:an.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:an.equirect_vert,fragmentShader:an.equirect_frag},distanceRGBA:{uniforms:Ui([ln.common,ln.displacementmap,{referencePosition:{value:new We},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:an.distanceRGBA_vert,fragmentShader:an.distanceRGBA_frag},shadow:{uniforms:Ui([ln.lights,ln.fog,{color:{value:new Pe(0)},opacity:{value:1}}]),vertexShader:an.shadow_vert,fragmentShader:an.shadow_frag}};function cn(e,t,i,n,r,s,a){const l=new Pe(0);let h,c,u=!0===s?0:1,d=null,f=0,p=null;function g(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,a)}return{getClearColor:function(){return l},setClearColor:function(e,t=1){l.set(e),u=t,g(l,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,g(l,u)},render:function(n,s){let a=!1,v=!0===s.isScene?s.background:null;if(v&&v.isTexture){v=(s.backgroundBlurriness>0?i:t).get(v)}const x=e.xr,y=x.getSession&&x.getSession();y&&"additive"===y.environmentBlendMode&&(v=null),null===v?g(l,u):v&&v.isColor&&(g(v,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===m)?(void 0===c&&(c=new zi(new Bi(1,1,1),new Gi({name:"BackgroundCubeMaterial",uniforms:Vi(hn.backgroundCube.uniforms),vertexShader:hn.backgroundCube.vertexShader,fragmentShader:hn.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=v,c.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=s.backgroundBlurriness,d===v&&f===v.version&&p===e.toneMapping||(c.material.needsUpdate=!0,d=v,f=v.version,p=e.toneMapping),c.layers.enableAll(),n.unshift(c,c.geometry,c.material,0,0,null)):v&&v.isTexture&&(void 0===h&&(h=new zi(new on(2,2),new Gi({name:"BackgroundMaterial",uniforms:Vi(hn.background.uniforms),vertexShader:hn.background.vertexShader,fragmentShader:hn.background.fragmentShader,side:o,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(h)),h.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),h.material.uniforms.uvTransform.value.copy(v.matrix),d===v&&f===v.version&&p===e.toneMapping||(h.material.needsUpdate=!0,d=v,f=v.version,p=e.toneMapping),h.layers.enableAll(),n.unshift(h,h.geometry,h.material,0,0,null))}}}function un(e,t,i,n){const r=e.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==s,a={},l=f(null);let h=l,c=!1;function u(t){return n.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return n.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function f(e){const t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=h.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,r){const s=h.newAttributes,o=h.enabledAttributes,a=h.attributeDivisors;if(s[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==r){(n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),a[i]=r}}function v(){const t=h.newAttributes,i=h.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function x(t,i,r,s,o,a){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,s,o,a):e.vertexAttribIPointer(t,i,r,o,a)}function y(){b(),c=!0,h!==l&&(h=l,u(h.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,y,b){let w=!1;if(o){const t=function(t,i,r){const o=!0===r.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[o];void 0===c&&(c=f(n.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),h[o]=c);return c}(y,d,l);h!==t&&(h=t,u(h.object)),w=function(e,t,i,n){const r=h.attributes,s=t.attributes;let o=0;const a=i.getAttributes();for(const t in a){if(a[t].location>=0){const i=r[t];let n=s[t];if(void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;o++}}return h.attributesNum!==o||h.index!==n}(r,y,d,b),w&&function(e,t,i,n){const r={},s=t.attributes;let o=0;const a=i.getAttributes();for(const t in a){if(a[t].location>=0){let i=s[t];void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[t]=n,o++}}h.attributes=r,h.attributesNum=o,h.index=n}(r,y,d,b)}else{const e=!0===l.wireframe;h.geometry===y.id&&h.program===d.id&&h.wireframe===e||(h.geometry=y.id,h.program=d.id,h.wireframe=e,w=!0)}null!==b&&i.update(b,34963),(w||c)&&(c=!1,function(r,s,o,a){if(!1===n.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,h=o.getAttributes(),c=s.defaultAttributeValues;for(const t in h){const n=h[t];if(n.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const t=s.normalized,o=s.itemSize,l=i.get(s);if(void 0===l)continue;const h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)g(n.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,h);for(let e=0;e<n.locationSize;e++)x(n.location+e,o/n.locationSize,c,t,l*u,(d+o/n.locationSize*e)*u)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)g(n.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,h);for(let e=0;e<n.locationSize;e++)x(n.location+e,o/n.locationSize,c,t,o*u,o/n.locationSize*e*u)}}else if(void 0!==c){const i=c[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n.location,i);break;case 3:e.vertexAttrib3fv(n.location,i);break;case 4:e.vertexAttrib4fv(n.location,i);break;default:e.vertexAttrib1fv(n.location,i)}}}}v()}(r,l,d,y),null!==b&&e.bindBuffer(34963,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)d(n[e].object),delete n[e];delete i[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:v}}function dn(e,t,i,n){const r=n.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,n){e.drawArrays(s,t,n),i.update(n,s,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,h;if(r)l=e,h="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,n,o,a),i.update(o,s,a)}}function fn(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=s||t.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),f=e.getParameter(34076),p=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),x=u>0,y=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:x,floatFragmentTextures:y,floatVertexTextures:x&&y,maxSamples:s?e.getParameter(36183):0}}function pn(e){const t=this;let i=null,n=0,r=!1,s=!1;const o=new Qi,a=new ve,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function c(e,i,n,r){const s=null!==e?e.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const t=n+4*s,r=i.matrixWorldInverse;a.getNormalMatrix(r),(null===h||h.length<t)&&(h=new Float32Array(t));for(let t=0,i=n;t!==s;++t,i+=4)o.copy(e[t]).applyMatrix4(r,a),o.normal.toArray(h,i),h[i+3]=o.constant}l.value=h,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,s){const o=0!==e.length||t||0!==n||r;return r=t,i=c(e,s,0),n=e.length,o},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(t,o,a){const u=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!r||null===u||0===u.length||s&&!f)s?c(null):h();else{const e=s?0:n,t=4*e;let r=p.clippingState||null;l.value=r,r=c(u,o,t,a);for(let e=0;e!==t;++e)r[e]=i[e];p.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function mn(e){let t=new WeakMap;function i(e,t){return t===f?e.mapping=u:t===p&&(e.mapping=d),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===f||s===p){if(t.has(r)){return i(t.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new Ki(s.height/2);return o.fromEquirectangularTexture(e,r),t.set(r,o),r.addEventListener("dispose",n),i(o.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}hn.physical={uniforms:Ui([hn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ge(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Pe(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ge},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Pe(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Pe(1,1,1)},specularColorMap:{value:null}}]),vertexShader:an.meshphysical_vert,fragmentShader:an.meshphysical_frag};class gn extends Wi{constructor(e=-1,t=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-e,s=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,s=r+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const vn=[.125,.215,.35,.446,.526,.582],xn=20,yn=new gn,bn=new Pe;let wn=null;const Mn=(1+Math.sqrt(5))/2,Sn=1/Mn,_n=[new We(1,1,1),new We(-1,1,1),new We(1,1,-1),new We(-1,1,-1),new We(0,Mn,Sn),new We(0,Mn,-Sn),new We(Sn,0,Mn),new We(-Sn,0,Mn),new We(Mn,Sn,0),new We(-Mn,Sn,0)];class Tn{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){wn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Nn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Cn(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(wn),e.scissorTest=!1,En(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===u||e.mapping===d?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),wn=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:M,minFilter:M,generateMipmaps:!1,type:C,format:L,encoding:j,depthBuffer:!1},n=An(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=An(e,t,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],i=[],n=[];let r=e;const s=e-4+1+vn.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);i.push(s);let a=1/s;o>e-4?a=vn[o-e+4-1]:0===o&&(a=0),n.push(a);const l=1/(s-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,f=6,p=3,m=2,g=1,v=new Float32Array(p*f*d),x=new Float32Array(m*f*d),y=new Float32Array(g*f*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];v.set(n,p*f*e),x.set(u,m*f*e);const r=[e,e,e,e,e,e];y.set(r,g*f*e)}const b=new yi;b.setAttribute("position",new li(v,p)),b.setAttribute("uv",new li(x,m)),b.setAttribute("faceIndex",new li(y,g)),t.push(b),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(e,t,i){const n=new Float32Array(xn),r=new We(0,1,0);return new Gi({name:"SphericalGaussianBlur",defines:{n:xn,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Ln(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,e,t)}return n}_compileMaterial(e){const t=new zi(this._lodPlanes[0],e);this._renderer.compile(t,yn)}_sceneToCubeUV(e,t,i,n){const r=new ji(90,1,t,i),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,h=a.toneMapping;a.getClearColor(bn),a.toneMapping=0,a.autoClear=!1;const c=new si({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new zi(new Bi,c);let d=!1;const f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,d=!0):(c.color.copy(bn),d=!0);for(let t=0;t<6;t++){const i=t%3;0===i?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1===i?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t]));const l=this._cubeSize;En(n,i*l,t>2?l:0,l,l),a.setRenderTarget(n),d&&a.render(u,r),a.render(e,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=h,a.autoClear=l,e.background=f}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===u||e.mapping===d;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Nn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Cn());const r=n?this._cubemapMaterial:this._equirectMaterial,s=new zi(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const o=this._cubeSize;En(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,yn)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const i=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),n=_n[(t-1)%_n.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,n,"latitudinal",r),this._halfBlur(s,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,s,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new zi(this._lodPlanes[n],l),c=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,f=r/d,p=isFinite(r)?1+Math.floor(3*f):xn;p>xn&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<xn;++e){const t=e/f,i=Math.exp(-t*t/2);m.push(i),0===e?g+=i:e<p&&(g+=2*i)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=m,c.latitudinal.value="latitudinal"===s,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-i;const x=this._sizeLods[n];En(t,3*x*(n>v-4?n-v+4:0),4*(this._cubeSize-x),3*x,2*x),a.setRenderTarget(t),a.render(h,yn)}}function An(e,t,i){const n=new Ve(e,t,i);return n.texture.mapping=m,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function En(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function Cn(){return new Gi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Ln(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Nn(){return new Gi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Ln(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ln(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Rn(e){let t=new WeakMap,i=null;function n(e){const i=e.target;i.removeEventListener("dispose",n);const r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,o=s===f||s===p,a=s===u||s===d;if(o||a){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=t.get(r);return null===i&&(i=new Tn(e)),n=o?i.fromEquirectangular(r,n):i.fromCubemap(r,n),t.set(r,n),n.texture}if(t.has(r))return t.get(r).texture;{const s=r.image;if(o&&s&&s.height>0||a&&s&&function(e){let t=0;const i=6;for(let n=0;n<i;n++)void 0!==e[n]&&t++;return t===i}(s)){null===i&&(i=new Tn(e));const s=o?i.fromEquirectangular(r):i.fromCubemap(r);return t.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Pn(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Dn(e,t,i,n){const r={},s=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete r[a.id];const l=s.get(a);l&&(t.remove(l),s.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,r=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],r=e[t+1],s=e[t+2];i.push(n,r,r,s,s,n)}}else{const e=r.array;o=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}const a=new(xe(i)?ci:hi)(i,1);a.version=o;const l=s.get(e);l&&t.remove(l),s.set(e,a)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return s.get(e)}}}function In(e,t,i,n){const r=n.isWebGL2;let s,o,a;this.setMode=function(e){s=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(s,n,o,t*a),i.update(n,s,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,u;if(r)c=e,u="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](s,l,o,n*a,h),i.update(l,s,h)}}function On(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function kn(e,t){return e[0]-t[0]}function zn(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Fn(e,t,i){const n={},r=new Float32Array(8),s=new WeakMap,o=new Be,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(l,h,c,u){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const n=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,r=void 0!==n?n.length:0;let a=s.get(h);if(void 0===a||a.count!==r){void 0!==a&&a.texture.dispose();const e=void 0!==h.morphAttributes.position,i=void 0!==h.morphAttributes.normal,n=void 0!==h.morphAttributes.color,l=h.morphAttributes.position||[],c=h.morphAttributes.normal||[],u=h.morphAttributes.color||[];let d=0;!0===e&&(d=1),!0===i&&(d=2),!0===n&&(d=3);let f=h.attributes.position.count*d,p=1;f>t.maxTextureSize&&(p=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);const m=new Float32Array(f*p*4*r),g=new Ue(m,f,p,r);g.type=E,g.needsUpdate=!0;const v=4*d;for(let t=0;t<r;t++){const r=l[t],s=c[t],a=u[t],h=f*p*4*t;for(let t=0;t<r.count;t++){const l=t*v;!0===e&&(o.fromBufferAttribute(r,t),m[h+l+0]=o.x,m[h+l+1]=o.y,m[h+l+2]=o.z,m[h+l+3]=0),!0===i&&(o.fromBufferAttribute(s,t),m[h+l+4]=o.x,m[h+l+5]=o.y,m[h+l+6]=o.z,m[h+l+7]=0),!0===n&&(o.fromBufferAttribute(a,t),m[h+l+8]=o.x,m[h+l+9]=o.y,m[h+l+10]=o.z,m[h+l+11]=4===a.itemSize?o.w:1)}}a={count:r,texture:g,size:new ge(f,p)},s.set(h,a),h.addEventListener("dispose",(function e(){g.dispose(),s.delete(h),h.removeEventListener("dispose",e)}))}let l=0;for(let e=0;e<d.length;e++)l+=d[e];const c=h.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",c),u.getUniforms().setValue(e,"morphTargetInfluences",d),u.getUniforms().setValue(e,"morphTargetsTexture",a.texture,i),u.getUniforms().setValue(e,"morphTargetsTextureSize",a.size)}else{const t=void 0===d?0:d.length;let i=n[h.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];n[h.id]=i}for(let e=0;e<t;e++){const t=i[e];t[0]=e,t[1]=d[e]}i.sort(zn);for(let e=0;e<8;e++)e<t&&i[e][1]?(a[e][0]=i[e][0],a[e][1]=i[e][1]):(a[e][0]=Number.MAX_SAFE_INTEGER,a[e][1]=0);a.sort(kn);const s=h.morphAttributes.position,o=h.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=a[e],i=t[0],n=t[1];i!==Number.MAX_SAFE_INTEGER&&n?(s&&h.getAttribute("morphTarget"+e)!==s[i]&&h.setAttribute("morphTarget"+e,s[i]),o&&h.getAttribute("morphNormal"+e)!==o[i]&&h.setAttribute("morphNormal"+e,o[i]),r[e]=n,l+=n):(s&&!0===h.hasAttribute("morphTarget"+e)&&h.deleteAttribute("morphTarget"+e),o&&!0===h.hasAttribute("morphNormal"+e)&&h.deleteAttribute("morphNormal"+e),r[e]=0)}const c=h.morphTargetsRelative?1:1-l;u.getUniforms().setValue(e,"morphTargetBaseInfluence",c),u.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Bn(e,t,i,n){let r=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=n.render.frame,a=e.geometry,l=t.get(e,a);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",s)&&e.addEventListener("dispose",s),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const Vn=new Fe,Un=new Ue,Hn=new He,Gn=new Ji,Wn=[],jn=[],Xn=new Float32Array(16),qn=new Float32Array(9),Jn=new Float32Array(4);function Kn(e,t,i){const n=e[0];if(n<=0||n>0)return e;const r=t*i;let s=Wn[r];if(void 0===s&&(s=new Float32Array(r),Wn[r]=s),0!==t){n.toArray(s,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(s,r)}return s}function Yn(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Zn(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function $n(e,t){let i=jn[t];void 0===i&&(i=new Int32Array(t),jn[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Qn(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function er(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Yn(i,t))return;e.uniform2fv(this.addr,t),Zn(i,t)}}function tr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Yn(i,t))return;e.uniform3fv(this.addr,t),Zn(i,t)}}function ir(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Yn(i,t))return;e.uniform4fv(this.addr,t),Zn(i,t)}}function nr(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(Yn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Zn(i,t)}else{if(Yn(i,n))return;Jn.set(n),e.uniformMatrix2fv(this.addr,!1,Jn),Zn(i,n)}}function rr(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(Yn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Zn(i,t)}else{if(Yn(i,n))return;qn.set(n),e.uniformMatrix3fv(this.addr,!1,qn),Zn(i,n)}}function sr(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(Yn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Zn(i,t)}else{if(Yn(i,n))return;Xn.set(n),e.uniformMatrix4fv(this.addr,!1,Xn),Zn(i,n)}}function or(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function ar(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Yn(i,t))return;e.uniform2iv(this.addr,t),Zn(i,t)}}function lr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Yn(i,t))return;e.uniform3iv(this.addr,t),Zn(i,t)}}function hr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Yn(i,t))return;e.uniform4iv(this.addr,t),Zn(i,t)}}function cr(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function ur(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Yn(i,t))return;e.uniform2uiv(this.addr,t),Zn(i,t)}}function dr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Yn(i,t))return;e.uniform3uiv(this.addr,t),Zn(i,t)}}function fr(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Yn(i,t))return;e.uniform4uiv(this.addr,t),Zn(i,t)}}function pr(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||Vn,r)}function mr(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||Hn,r)}function gr(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||Gn,r)}function vr(e,t,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||Un,r)}function xr(e,t){e.uniform1fv(this.addr,t)}function yr(e,t){const i=Kn(t,this.size,2);e.uniform2fv(this.addr,i)}function br(e,t){const i=Kn(t,this.size,3);e.uniform3fv(this.addr,i)}function wr(e,t){const i=Kn(t,this.size,4);e.uniform4fv(this.addr,i)}function Mr(e,t){const i=Kn(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Sr(e,t){const i=Kn(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function _r(e,t){const i=Kn(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Tr(e,t){e.uniform1iv(this.addr,t)}function Ar(e,t){e.uniform2iv(this.addr,t)}function Er(e,t){e.uniform3iv(this.addr,t)}function Cr(e,t){e.uniform4iv(this.addr,t)}function Nr(e,t){e.uniform1uiv(this.addr,t)}function Lr(e,t){e.uniform2uiv(this.addr,t)}function Rr(e,t){e.uniform3uiv(this.addr,t)}function Pr(e,t){e.uniform4uiv(this.addr,t)}function Dr(e,t,i){const n=this.cache,r=t.length,s=$n(i,r);Yn(n,s)||(e.uniform1iv(this.addr,s),Zn(n,s));for(let e=0;e!==r;++e)i.setTexture2D(t[e]||Vn,s[e])}function Ir(e,t,i){const n=this.cache,r=t.length,s=$n(i,r);Yn(n,s)||(e.uniform1iv(this.addr,s),Zn(n,s));for(let e=0;e!==r;++e)i.setTexture3D(t[e]||Hn,s[e])}function Or(e,t,i){const n=this.cache,r=t.length,s=$n(i,r);Yn(n,s)||(e.uniform1iv(this.addr,s),Zn(n,s));for(let e=0;e!==r;++e)i.setTextureCube(t[e]||Gn,s[e])}function kr(e,t,i){const n=this.cache,r=t.length,s=$n(i,r);Yn(n,s)||(e.uniform1iv(this.addr,s),Zn(n,s));for(let e=0;e!==r;++e)i.setTexture2DArray(t[e]||Un,s[e])}class zr{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Qn;case 35664:return er;case 35665:return tr;case 35666:return ir;case 35674:return nr;case 35675:return rr;case 35676:return sr;case 5124:case 35670:return or;case 35667:case 35671:return ar;case 35668:case 35672:return lr;case 35669:case 35673:return hr;case 5125:return cr;case 36294:return ur;case 36295:return dr;case 36296:return fr;case 35678:case 36198:case 36298:case 36306:case 35682:return pr;case 35679:case 36299:case 36307:return mr;case 35680:case 36300:case 36308:case 36293:return gr;case 36289:case 36303:case 36311:case 36292:return vr}}(t.type)}}class Fr{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return xr;case 35664:return yr;case 35665:return br;case 35666:return wr;case 35674:return Mr;case 35675:return Sr;case 35676:return _r;case 5124:case 35670:return Tr;case 35667:case 35671:return Ar;case 35668:case 35672:return Er;case 35669:case 35673:return Cr;case 5125:return Nr;case 36294:return Lr;case 36295:return Rr;case 36296:return Pr;case 35678:case 36198:case 36298:case 36306:case 35682:return Dr;case 35679:case 36299:case 36307:return Ir;case 35680:case 36300:case 36308:case 36293:return Or;case 36289:case 36303:case 36311:case 36292:return kr}}(t.type)}}class Br{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(e,t[s.id],i)}}}const Vr=/(\w+)(\])?(\[|\.)?/g;function Ur(e,t){e.seq.push(t),e.map[t.id]=t}function Hr(e,t,i){const n=e.name,r=n.length;for(Vr.lastIndex=0;;){const s=Vr.exec(n),o=Vr.lastIndex;let a=s[1];const l="]"===s[2],h=s[3];if(l&&(a|=0),void 0===h||"["===h&&o+2===r){Ur(i,void 0===h?new zr(a,e,t):new Fr(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new Br(a),Ur(i,e)),i=e}}}class Gr{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);Hr(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,i,n){const r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,s=t.length;r!==s;++r){const s=t[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(e,o.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,r=e.length;n!==r;++n){const r=e[n];r.id in t&&i.push(r)}return i}}function Wr(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}let jr=0;function Xr(e,t,i){const n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const i=e.split("\n"),n=[],r=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let e=r;e<s;e++){const r=e+1;n.push(`${r===t?">":" "} ${r}: ${i[e]}`)}return n.join("\n")}(e.getShaderSource(t),n)}return r}function qr(e,t){const i=function(e){switch(e){case j:return["Linear","( value )"];case X:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Jr(e,t){let i;switch(t){case c:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Kr(e){return""!==e}function Yr(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Zr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const $r=/^[ \t]*#include +<([\w\d./]+)>/gm;function Qr(e){return e.replace($r,es)}function es(e,t){const i=an[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Qr(i)}const ts=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function is(e){return e.replace(ts,ns)}function ns(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function rs(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ss(e,t,i,n){const r=e.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(i),h=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case u:case d:t="ENVMAP_TYPE_CUBE";break;case m:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),c=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===d&&(t="ENVMAP_MODE_REFRACTION");return t}(i),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),p=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),g=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Kr).join("\n")}(i),v=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(s),x=r.createProgram();let y,b,w=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(y=[v].filter(Kr).join("\n"),y.length>0&&(y+="\n"),b=[g,v].filter(Kr).join("\n"),b.length>0&&(b+="\n")):(y=[rs(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Kr).join("\n"),b=[g,rs(i),"#define SHADER_NAME "+i.shaderName,v,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+c:"",i.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?an.tonemapping_pars_fragment:"",0!==i.toneMapping?Jr("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",an.encodings_pars_fragment,qr("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Kr).join("\n")),o=Qr(o),o=Yr(o,i),o=Zr(o,i),a=Qr(a),a=Yr(a,i),a=Zr(a,i),o=is(o),a=is(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(w="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,b=["#define varying in",i.glslVersion===Q?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Q?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const M=w+b+a,S=Wr(r,35633,w+y+o),_=Wr(r,35632,M);if(r.attachShader(x,S),r.attachShader(x,_),void 0!==i.index0AttributeName?r.bindAttribLocation(x,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(x).trim(),t=r.getShaderInfoLog(S).trim(),i=r.getShaderInfoLog(_).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(x,35714)){n=!1;const t=Xr(r,S,"vertex"),i=Xr(r,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(x,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:y},fragmentShader:{log:i,prefix:b}})}let T,A;return r.deleteShader(S),r.deleteShader(_),this.getUniforms=function(){return void 0===T&&(T=new Gr(r,x)),T},this.getAttributes=function(){return void 0===A&&(A=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const n=e.getActiveAttrib(t,r),s=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),i[s]={type:n.type,location:e.getAttribLocation(t,s),locationSize:o}}return i}(r,x)),A},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.name=i.shaderName,this.id=jr++,this.cacheKey=t,this.usedTimes=1,this.program=x,this.vertexShader=S,this.fragmentShader=_,this}let os=0;class as{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new ls(e),t.set(e,i)),i}}class ls{constructor(e){this.id=os++,this.code=e,this.usedTimes=0}}function hs(e,t,i,n,r,s,o){const l=new Rt,h=new as,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,f=r.vertexTextures;let p=r.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,l,c,v,x){const y=v.fog,b=x.geometry,w=s.isMeshStandardMaterial?v.environment:null,M=(s.isMeshStandardMaterial?i:t).get(s.envMap||w),S=M&&M.mapping===m?M.image.height:null,_=g[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const T=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,A=void 0!==T?T.length:0;let E,C,N,L,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),_){const e=hn[_];E=e.vertexShader,C=e.fragmentShader}else E=s.vertexShader,C=s.fragmentShader,h.update(s),N=h.getVertexShaderID(s),L=h.getFragmentShaderID(s);const P=e.getRenderTarget(),D=s.alphaTest>0,I=s.clearcoat>0,O=s.iridescence>0;return{isWebGL2:u,shaderID:_,shaderName:s.type,vertexShader:E,fragmentShader:C,defines:s.defines,customVertexShaderID:N,customFragmentShaderID:L,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:f,outputEncoding:null===P?e.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:j,map:!!s.map,matcap:!!s.matcap,envMap:!!M,envMapMode:M&&M.mapping,envMapCubeUVHeight:S,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===J,tangentSpaceNormalMap:s.normalMapType===q,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===X,clearcoat:I,clearcoatMap:I&&!!s.clearcoatMap,clearcoatRoughnessMap:I&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:I&&!!s.clearcoatNormalMap,iridescence:O,iridescenceMap:O&&!!s.iridescenceMap,iridescenceThicknessMap:O&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:D,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!b.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!y,useFog:!0===s.fog,fogExp2:y&&y.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:A,morphTextureStride:R,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===a,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(i,t),function(e,t){l.disableAll(),t.isWebGL2&&l.enable(0);t.supportsVertexTextures&&l.enable(1);t.instancing&&l.enable(2);t.instancingColor&&l.enable(3);t.map&&l.enable(4);t.matcap&&l.enable(5);t.envMap&&l.enable(6);t.lightMap&&l.enable(7);t.aoMap&&l.enable(8);t.emissiveMap&&l.enable(9);t.bumpMap&&l.enable(10);t.normalMap&&l.enable(11);t.objectSpaceNormalMap&&l.enable(12);t.tangentSpaceNormalMap&&l.enable(13);t.clearcoat&&l.enable(14);t.clearcoatMap&&l.enable(15);t.clearcoatRoughnessMap&&l.enable(16);t.clearcoatNormalMap&&l.enable(17);t.iridescence&&l.enable(18);t.iridescenceMap&&l.enable(19);t.iridescenceThicknessMap&&l.enable(20);t.displacementMap&&l.enable(21);t.specularMap&&l.enable(22);t.roughnessMap&&l.enable(23);t.metalnessMap&&l.enable(24);t.gradientMap&&l.enable(25);t.alphaMap&&l.enable(26);t.alphaTest&&l.enable(27);t.vertexColors&&l.enable(28);t.vertexAlphas&&l.enable(29);t.vertexUvs&&l.enable(30);t.vertexTangents&&l.enable(31);t.uvsVertexOnly&&l.enable(32);e.push(l.mask),l.disableAll(),t.fog&&l.enable(0);t.useFog&&l.enable(1);t.flatShading&&l.enable(2);t.logarithmicDepthBuffer&&l.enable(3);t.skinning&&l.enable(4);t.morphTargets&&l.enable(5);t.morphNormals&&l.enable(6);t.morphColors&&l.enable(7);t.premultipliedAlpha&&l.enable(8);t.shadowMapEnabled&&l.enable(9);t.physicallyCorrectLights&&l.enable(10);t.doubleSided&&l.enable(11);t.flipSided&&l.enable(12);t.useDepthPacking&&l.enable(13);t.dithering&&l.enable(14);t.specularIntensityMap&&l.enable(15);t.specularColorMap&&l.enable(16);t.transmission&&l.enable(17);t.transmissionMap&&l.enable(18);t.thicknessMap&&l.enable(19);t.sheen&&l.enable(20);t.sheenColorMap&&l.enable(21);t.sheenRoughnessMap&&l.enable(22);t.decodeVideoTexture&&l.enable(23);t.opaque&&l.enable(24);e.push(l.mask)}(i,t),i.push(e.outputEncoding)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=g[e.type];let i;if(t){const e=hn[t];i=Hi.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new ss(e,i,t,s),c.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){h.remove(e)},programs:c,dispose:function(){h.dispose()}}}function cs(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function us(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ds(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function fs(){const e=[];let t=0;const i=[],n=[],r=[];function s(i,n,r,s,o,a){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:o,group:a},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=o,l.group=a),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,o,a,l,h){const c=s(e,t,o,a,l,h);o.transmission>0?n.push(c):!0===o.transparent?r.push(c):i.push(c)},unshift:function(e,t,o,a,l,h){const c=s(e,t,o,a,l,h);o.transmission>0?n.unshift(c):!0===o.transparent?r.unshift(c):i.unshift(c)},finish:function(){for(let i=t,n=e.length;i<n;i++){const t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||us),n.length>1&&n.sort(t||ds),r.length>1&&r.sort(t||ds)}}}function ps(){let e=new WeakMap;return{get:function(t,i){const n=e.get(t);let r;return void 0===n?(r=new fs,e.set(t,[r])):i>=n.length?(r=new fs,n.push(r)):r=n[i],r},dispose:function(){e=new WeakMap}}}function ms(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new We,color:new Pe};break;case"SpotLight":i={position:new We,direction:new We,color:new Pe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new We,color:new Pe,distance:0,decay:0};break;case"HemisphereLight":i={direction:new We,skyColor:new Pe,groundColor:new Pe};break;case"RectAreaLight":i={color:new Pe,position:new We,halfWidth:new We,halfHeight:new We}}return e[t.id]=i,i}}}let gs=0;function vs(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function xs(e,t){const i=new ms,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ge};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ge,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let e=0;e<9;e++)r.probe.push(new We);const s=new We,o=new bt,a=new bt;return{setup:function(s,o){let a=0,l=0,h=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,u=0,d=0,f=0,p=0,m=0,g=0,v=0,x=0,y=0;s.sort(vs);const b=!0!==o?Math.PI:1;for(let e=0,t=s.length;e<t;e++){const t=s[e],o=t.color,w=t.intensity,M=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*w*b,l+=o.g*w*b,h+=o.b*w*b;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],w);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=S,r.directionalShadowMatrix[c]=t.shadow.matrix,m++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(w*b),e.distance=M,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;const s=t.shadow;if(t.map&&(r.spotLightMap[x]=t.map,x++,s.updateMatrices(t),t.castShadow&&y++),r.spotLightMatrix[d]=s.matrix,t.castShadow){const e=n.get(t);e.shadowBias=s.bias,e.shadowNormalBias=s.normalBias,e.shadowRadius=s.radius,e.shadowMapSize=s.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=S,v++}d++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(o).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[f]=e,f++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=S,r.pointShadowMatrix[u]=t.shadow.matrix,g++}r.point[u]=e,u++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(w*b),e.groundColor.copy(t.groundColor).multiplyScalar(w*b),r.hemi[p]=e,p++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ln.LTC_FLOAT_1,r.rectAreaLTC2=ln.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=ln.LTC_HALF_1,r.rectAreaLTC2=ln.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=l,r.ambient[2]=h;const w=r.hash;w.directionalLength===c&&w.pointLength===u&&w.spotLength===d&&w.rectAreaLength===f&&w.hemiLength===p&&w.numDirectionalShadows===m&&w.numPointShadows===g&&w.numSpotShadows===v&&w.numSpotMaps===x||(r.directional.length=c,r.spot.length=d,r.rectArea.length=f,r.point.length=u,r.hemi.length=p,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+x-y,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=y,w.directionalLength=c,w.pointLength=u,w.spotLength=d,w.rectAreaLength=f,w.hemiLength=p,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=x,r.version=gs++)},setupView:function(e,t){let i=0,n=0,l=0,h=0,c=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),i++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(s),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=r.rectArea[h];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),h++}else if(d.isPointLight){const e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const e=r.hemi[c];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),c++}}},state:r}}function ys(e,t){const i=new xs(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function bs(e,t){let i=new WeakMap;return{get:function(n,r=0){const s=i.get(n);let o;return void 0===s?(o=new ys(e,t),i.set(n,[o])):r>=s.length?(o=new ys(e,t),s.push(o)):o=s[r],o},dispose:function(){i=new WeakMap}}}class ws extends ri{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Ms extends ri{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new We,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Ss(e,t,i){let n=new nn;const r=new ge,s=new ge,l=new Be,h=new ws({depthPacking:3201}),c=new Ms,u={},d=i.maxTextureSize,f={0:1,1:o,2:a},p=new Gi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ge},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const g=new yi;g.setAttribute("position",new li(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new zi(g,p),x=this;function b(i,n){const s=t.update(v);p.defines.VSM_SAMPLES!==i.blurSamples&&(p.defines.VSM_SAMPLES=i.blurSamples,m.defines.VSM_SAMPLES=i.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Ve(r.x,r.y)),p.uniforms.shadow_pass.value=i.map.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,s,p,v,null),m.uniforms.shadow_pass.value=i.mapPass.texture,m.uniforms.resolution.value=i.mapSize,m.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,s,m,v,null)}function w(t,i,n,r,s,o){let a=null;const l=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(a=void 0!==l?l:!0===n.isPointLight?c:h,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const e=a.uuid,t=i.uuid;let n=u[e];void 0===n&&(n={},u[e]=n);let r=n[t];void 0===r&&(r=a.clone(),n[t]=r),a=r}return a.visible=i.visible,a.wireframe=i.wireframe,a.side=3===o?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:f[i.side],a.alphaMap=i.alphaMap,a.alphaTest=i.alphaTest,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.clipIntersection=i.clipIntersection,a.displacementMap=i.displacementMap,a.displacementScale=i.displacementScale,a.displacementBias=i.displacementBias,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,!0===n.isPointLight&&!0===a.isMeshDistanceMaterial&&(a.referencePosition.setFromMatrixPosition(n.matrixWorld),a.nearDistance=r,a.farDistance=s),a}function M(i,r,s,o,a){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===a)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=t.update(i),r=i.material;if(Array.isArray(r)){const t=n.groups;for(let l=0,h=t.length;l<h;l++){const h=t[l],c=r[h.materialIndex];if(c&&c.visible){const t=w(i,c,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,h)}}}else if(r.visible){const t=w(i,r,o,s.near,s.far,a);e.renderBufferDirect(s,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)M(l[e],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,i,o){if(!1===x.enabled)return;if(!1===x.autoUpdate&&!1===x.needsUpdate)return;if(0===t.length)return;const a=e.getRenderTarget(),h=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),u=e.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let a=0,h=t.length;a<h;a++){const h=t[a],c=h.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const f=c.getFrameExtents();if(r.multiply(f),s.copy(c.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(s.x=Math.floor(d/f.x),r.x=s.x*f.x,c.mapSize.x=s.x),r.y>d&&(s.y=Math.floor(d/f.y),r.y=s.y*f.y,c.mapSize.y=s.y)),null===c.map){const e=3!==this.type?{minFilter:y,magFilter:y}:{};c.map=new Ve(r.x,r.y,e),c.map.texture.name=h.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const p=c.getViewportCount();for(let e=0;e<p;e++){const t=c.getViewport(e);l.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),u.viewport(l),c.updateMatrices(h,e),n=c.getFrustum(),M(i,o,c.camera,h,this.type)}!0!==c.isPointLightShadow&&3===this.type&&b(c,o),c.needsUpdate=!1}x.needsUpdate=!1,e.setRenderTarget(a,h,c)}}function _s(e,t,i){const n=i.isWebGL2;const r=new function(){let t=!1;const i=new Be;let n=null;const r=new Be(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,s,o,a){!0===a&&(t*=o,n*=o,s*=o),i.set(t,n,s,o),!1===r.equals(i)&&(e.clearColor(t,n,s,o),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},s=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?G(2929):W(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},o=new function(){let t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,h=null;return{setTest:function(e){t||(e?G(2960):W(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&r===i&&s===o||(e.stencilFunc(t,i,o),n=t,r=i,s=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,i=null,n=null,r=null,s=null,o=null,a=null,l=null,h=null}}},c=new WeakMap,u=new WeakMap;let d={},f={},p=new WeakMap,m=[],g=null,v=!1,x=null,y=null,b=null,w=null,M=null,S=null,_=null,T=!1,A=null,E=null,C=null,N=null,L=null;const R=e.getParameter(35661);let P=!1,D=0;const I=e.getParameter(7938);-1!==I.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(I)[1]),P=D>=1):-1!==I.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),P=D>=2);let O=null,k={};const z=e.getParameter(3088),F=e.getParameter(2978),B=(new Be).fromArray(z),V=(new Be).fromArray(F);function U(t,i,n){const r=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,r);return s}const H={};function G(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function W(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}H[3553]=U(3553,3553,1),H[34067]=U(34067,34069,6),r.setClear(0,0,0,1),s.setClear(1),o.setClear(0),G(2929),s.setFunc(3),J(!1),K(1),G(2884),q(0);const j={[h]:32774,101:32778,102:32779};if(n)j[103]=32775,j[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(j[103]=e.MIN_EXT,j[104]=e.MAX_EXT)}const X={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function q(t,i,n,r,s,o,a,c){if(0!==t){if(!1===v&&(G(3042),v=!0),5===t)s=s||i,o=o||n,a=a||r,i===y&&s===M||(e.blendEquationSeparate(j[i],j[s]),y=i,M=s),n===b&&r===w&&o===S&&a===_||(e.blendFuncSeparate(X[n],X[r],X[o],X[a]),b=n,w=r,S=o,_=a),x=t,T=null;else if(t!==x||c!==T){if(y===h&&M===h||(e.blendEquation(32774),y=h,M=h),c)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case l:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case l:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}b=null,w=null,S=null,_=null,x=t,T=c}}else!0===v&&(W(3042),v=!1)}function J(t){A!==t&&(t?e.frontFace(2304):e.frontFace(2305),A=t)}function K(t){0!==t?(G(2884),t!==E&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):W(2884),E=t}function Y(t,i,n){t?(G(32823),N===i&&L===n||(e.polygonOffset(i,n),N=i,L=n)):W(32823)}return{buffers:{color:r,depth:s,stencil:o},enable:G,disable:W,bindFramebuffer:function(t,i){return f[t]!==i&&(e.bindFramebuffer(t,i),f[t]=i,n&&(36009===t&&(f[36160]=i),36160===t&&(f[36009]=i)),!0)},drawBuffers:function(n,r){let s=m,o=!1;if(n)if(s=p.get(r),void 0===s&&(s=[],p.set(r,s)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(s.length!==e.length||36064!==s[0]){for(let t=0,i=e.length;t<i;t++)s[t]=36064+t;s.length=e.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(i.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return g!==t&&(e.useProgram(t),g=t,!0)},setBlending:q,setMaterial:function(e,t){e.side===a?W(2884):G(2884);let i=1===e.side;t&&(i=!i),J(i),1===e.blending&&!1===e.transparent?q(0):q(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),r.setMask(e.colorWrite);const n=e.stencilWrite;o.setTest(n),n&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Y(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?G(32926):W(32926)},setFlipSided:J,setCullFace:K,setLineWidth:function(t){t!==C&&(P&&e.lineWidth(t),C=t)},setPolygonOffset:Y,setScissorTest:function(e){e?G(3089):W(3089)},activeTexture:function(t){void 0===t&&(t=33984+R-1),O!==t&&(e.activeTexture(t),O=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===O?33984+R-1:O);let r=k[n];void 0===r&&(r={type:void 0,texture:void 0},k[n]=r),r.type===t&&r.texture===i||(O!==n&&(e.activeTexture(n),O=n),e.bindTexture(t,i||H[t]),r.type=t,r.texture=i)},unbindTexture:function(){const t=k[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,i){let n=u.get(i);void 0===n&&(n=new WeakMap,u.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){const n=u.get(i).get(t);c.get(t)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),c.set(t,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===B.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===V.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),V.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},O=null,k={},f={},p=new WeakMap,m=[],g=null,v=!1,x=null,y=null,b=null,w=null,M=null,S=null,_=null,T=!1,A=null,E=null,C=null,N=null,L=null,B.set(0,0,e.canvas.width,e.canvas.height),V.set(0,0,e.canvas.width,e.canvas.height),r.reset(),s.reset(),o.reset()}}}function Ts(e,t,i,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,c=r.maxTextureSize,u=r.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test("undefined"==typeof navigator?"":navigator.userAgent),p=new WeakMap;let m;const D=new WeakMap;let I=!1;try{I="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function O(e,t){return I?new OffscreenCanvas(e,t):we("canvas")}function k(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?de:Math.floor,s=n(r*e.width),o=n(r*e.height);void 0===m&&(m=O(s,o));const a=i?O(s,o):m;a.width=s,a.height=o;return a.getContext("2d").drawImage(e,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function z(e){return ce(e.width)&&ce(e.height)}function F(e,t){return e.generateMipmaps&&t&&e.minFilter!==y&&e.minFilter!==M}function B(t){e.generateMipmap(t)}function V(i,n,r,s,o=!1){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return 6403===n&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===n&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===n&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===X&&!1===o?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||t.get("EXT_color_buffer_float"),l}function U(e,t,i){return!0===F(e,i)||e.isFramebufferTexture&&e.minFilter!==y&&e.minFilter!==M?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function H(e){return e===y||e===b||e===w?9728:9729}function G(e){const t=e.target;t.removeEventListener("dispose",G),function(e){const t=n.get(e);if(void 0===t.__webglInit)return;const i=e.source,r=D.get(i);if(r){const n=r[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&q(e),0===Object.keys(r).length&&D.delete(i)}n.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function W(t){const i=t.target;i.removeEventListener("dispose",W),function(t){const i=t.texture,r=n.get(t),s=n.get(i);void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}(i)}function q(t){const i=n.get(t);e.deleteTexture(i.__webglTexture);const r=t.source;delete D.get(r)[i.__cacheKey],o.memory.textures--}let J=0;function K(e,t){const r=n.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void te(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(3553,r.__webglTexture,33984+t)}const Y={[g]:10497,[v]:33071,[x]:33648},Z={[y]:9728,[b]:9984,[w]:9986,[M]:9729,[S]:9985,[_]:9987};function $(i,s,o){if(o?(e.texParameteri(i,10242,Y[s.wrapS]),e.texParameteri(i,10243,Y[s.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,Y[s.wrapR]),e.texParameteri(i,10240,Z[s.magFilter]),e.texParameteri(i,10241,Z[s.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),s.wrapS===v&&s.wrapT===v||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,H(s.magFilter)),e.texParameteri(i,10241,H(s.minFilter)),s.minFilter!==y&&s.minFilter!==M&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(s.type===E&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&s.type===C&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function Q(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",G));const r=i.source;let s=D.get(r);void 0===s&&(s={},D.set(r,s));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(i);if(a!==t.__cacheKey){void 0===s[a]&&(s[a]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,n=!0),s[a].usedTimes++;const r=s[t.__cacheKey];void 0!==r&&(s[t.__cacheKey].usedTimes--,0===r.usedTimes&&q(i)),t.__cacheKey=a,t.__webglTexture=s[a].texture}return n}function te(t,r,o){let l=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(l=35866),r.isData3DTexture&&(l=32879);const h=Q(t,r),u=r.source;i.bindTexture(l,t.__webglTexture,33984+o);const d=n.get(u);if(u.version!==d.__version||!0===h){i.activeTexture(33984+o),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const t=function(e){return!a&&(e.wrapS!==v||e.wrapT!==v||e.minFilter!==y&&e.minFilter!==M)}(r)&&!1===z(r.image);let n=k(r.image,t,!1,c);n=ae(r,n);const f=z(n)||a,p=s.convert(r.format,r.encoding);let m,g=s.convert(r.type),x=V(r.internalFormat,p,g,r.encoding,r.isVideoTexture);$(l,r,f);const b=r.mipmaps,w=a&&!0!==r.isVideoTexture,S=void 0===d.__version||!0===h,_=U(r,n,f);if(r.isDepthTexture)x=6402,a?x=r.type===E?36012:r.type===A?33190:r.type===N?35056:33189:r.type===E&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===R&&6402===x&&1012!==r.type&&r.type!==A&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=A,g=s.convert(r.type)),r.format===P&&6402===x&&(x=34041,r.type!==N&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=N,g=s.convert(r.type))),S&&(w?i.texStorage2D(3553,1,x,n.width,n.height):i.texImage2D(3553,0,x,n.width,n.height,0,p,g,null));else if(r.isDataTexture)if(b.length>0&&f){w&&S&&i.texStorage2D(3553,_,x,b[0].width,b[0].height);for(let e=0,t=b.length;e<t;e++)m=b[e],w?i.texSubImage2D(3553,e,0,0,m.width,m.height,p,g,m.data):i.texImage2D(3553,e,x,m.width,m.height,0,p,g,m.data);r.generateMipmaps=!1}else w?(S&&i.texStorage2D(3553,_,x,n.width,n.height),i.texSubImage2D(3553,0,0,0,n.width,n.height,p,g,n.data)):i.texImage2D(3553,0,x,n.width,n.height,0,p,g,n.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){w&&S&&i.texStorage3D(35866,_,x,b[0].width,b[0].height,n.depth);for(let e=0,t=b.length;e<t;e++)m=b[e],r.format!==L?null!==p?w?i.compressedTexSubImage3D(35866,e,0,0,0,m.width,m.height,n.depth,p,m.data,0,0):i.compressedTexImage3D(35866,e,x,m.width,m.height,n.depth,0,m.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?i.texSubImage3D(35866,e,0,0,0,m.width,m.height,n.depth,p,g,m.data):i.texImage3D(35866,e,x,m.width,m.height,n.depth,0,p,g,m.data)}else{w&&S&&i.texStorage2D(3553,_,x,b[0].width,b[0].height);for(let e=0,t=b.length;e<t;e++)m=b[e],r.format!==L?null!==p?w?i.compressedTexSubImage2D(3553,e,0,0,m.width,m.height,p,m.data):i.compressedTexImage2D(3553,e,x,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?i.texSubImage2D(3553,e,0,0,m.width,m.height,p,g,m.data):i.texImage2D(3553,e,x,m.width,m.height,0,p,g,m.data)}else if(r.isDataArrayTexture)w?(S&&i.texStorage3D(35866,_,x,n.width,n.height,n.depth),i.texSubImage3D(35866,0,0,0,0,n.width,n.height,n.depth,p,g,n.data)):i.texImage3D(35866,0,x,n.width,n.height,n.depth,0,p,g,n.data);else if(r.isData3DTexture)w?(S&&i.texStorage3D(32879,_,x,n.width,n.height,n.depth),i.texSubImage3D(32879,0,0,0,0,n.width,n.height,n.depth,p,g,n.data)):i.texImage3D(32879,0,x,n.width,n.height,n.depth,0,p,g,n.data);else if(r.isFramebufferTexture){if(S)if(w)i.texStorage2D(3553,_,x,n.width,n.height);else{let e=n.width,t=n.height;for(let n=0;n<_;n++)i.texImage2D(3553,n,x,e,t,0,p,g,null),e>>=1,t>>=1}}else if(b.length>0&&f){w&&S&&i.texStorage2D(3553,_,x,b[0].width,b[0].height);for(let e=0,t=b.length;e<t;e++)m=b[e],w?i.texSubImage2D(3553,e,0,0,p,g,m):i.texImage2D(3553,e,x,p,g,m);r.generateMipmaps=!1}else w?(S&&i.texStorage2D(3553,_,x,n.width,n.height),i.texSubImage2D(3553,0,0,0,p,g,n)):i.texImage2D(3553,0,x,p,g,n);F(r,f)&&B(l),d.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function ie(t,r,o,a,l){const h=s.convert(o.format,o.encoding),c=s.convert(o.type),u=V(o.internalFormat,h,c,o.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,h,c,null):i.texImage2D(l,0,u,r.width,r.height,0,h,c,null)),i.bindFramebuffer(36160,t),oe(r)?d.framebufferTexture2DMultisampleEXT(36160,a,l,n.get(o).__webglTexture,0,se(r)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function ne(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||oe(i)){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===E?r=36012:t.type===A&&(r=33190));const n=se(i);oe(i)?d.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){const r=se(i);n&&!1===oe(i)?e.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):oe(i)?d.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<t.length;r++){const o=t[r],a=s.convert(o.format,o.encoding),l=s.convert(o.type),h=V(o.internalFormat,a,l,o.encoding),c=se(i);n&&!1===oe(i)?e.renderbufferStorageMultisample(36161,c,h,i.width,i.height):oe(i)?d.renderbufferStorageMultisampleEXT(36161,c,h,i.width,i.height):e.renderbufferStorage(36161,h,i.width,i.height)}}e.bindRenderbuffer(36161,null)}function re(t){const r=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),K(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,o=se(r);if(r.depthTexture.format===R)oe(r)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):e.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==P)throw new Error("Unknown depthTexture format");oe(r)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):e.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,t)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),ne(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),ne(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function se(e){return Math.min(u,e.samples)}function oe(e){const i=n.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function ae(e,i){const n=e.encoding,r=e.format,s=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===ee||n!==j&&(n===X?!1===a?!0===t.has("EXT_sRGB")&&r===L?(e.format=ee,e.minFilter=M,e.generateMipmaps=!1):i=Ie.sRGBToLinear(i):r===L&&s===T||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const e=J;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),J+=1,e},this.resetTextureUnits=function(){J=0},this.setTexture2D=K,this.setTexture2DArray=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?te(r,e,t):i.bindTexture(35866,r.__webglTexture,33984+t)},this.setTexture3D=function(e,t){const r=n.get(e);e.version>0&&r.__version!==e.version?te(r,e,t):i.bindTexture(32879,r.__webglTexture,33984+t)},this.setTextureCube=function(t,r){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,r,o){if(6!==r.image.length)return;const l=Q(t,r),c=r.source;i.bindTexture(34067,t.__webglTexture,33984+o);const u=n.get(c);if(c.version!==u.__version||!0===l){i.activeTexture(33984+o),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const t=r.isCompressedTexture||r.image[0].isCompressedTexture,n=r.image[0]&&r.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=t||n?n?r.image[e].image:r.image[e]:k(r.image[e],!1,!0,h),d[e]=ae(r,d[e]);const f=d[0],p=z(f)||a,m=s.convert(r.format,r.encoding),g=s.convert(r.type),v=V(r.internalFormat,m,g,r.encoding),x=a&&!0!==r.isVideoTexture,y=void 0===u.__version||!0===l;let b,w=U(r,f,p);if($(34067,r,p),t){x&&y&&i.texStorage2D(34067,w,v,f.width,f.height);for(let e=0;e<6;e++){b=d[e].mipmaps;for(let t=0;t<b.length;t++){const n=b[t];r.format!==L?null!==m?x?i.compressedTexSubImage2D(34069+e,t,0,0,n.width,n.height,m,n.data):i.compressedTexImage2D(34069+e,t,v,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):x?i.texSubImage2D(34069+e,t,0,0,n.width,n.height,m,g,n.data):i.texImage2D(34069+e,t,v,n.width,n.height,0,m,g,n.data)}}}else{b=r.mipmaps,x&&y&&(b.length>0&&w++,i.texStorage2D(34067,w,v,d[0].width,d[0].height));for(let e=0;e<6;e++)if(n){x?i.texSubImage2D(34069+e,0,0,0,d[e].width,d[e].height,m,g,d[e].data):i.texImage2D(34069+e,0,v,d[e].width,d[e].height,0,m,g,d[e].data);for(let t=0;t<b.length;t++){const n=b[t].image[e].image;x?i.texSubImage2D(34069+e,t+1,0,0,n.width,n.height,m,g,n.data):i.texImage2D(34069+e,t+1,v,n.width,n.height,0,m,g,n.data)}}else{x?i.texSubImage2D(34069+e,0,0,0,m,g,d[e]):i.texImage2D(34069+e,0,v,m,g,d[e]);for(let t=0;t<b.length;t++){const n=b[t];x?i.texSubImage2D(34069+e,t+1,0,0,m,g,n.image[e]):i.texImage2D(34069+e,t+1,v,m,g,n.image[e])}}}F(r,p)&&B(34067),u.__version=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,r):i.bindTexture(34067,o.__webglTexture,33984+r)},this.rebindTextures=function(e,t,i){const r=n.get(e);void 0!==t&&ie(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==i&&re(e)},this.setupRenderTarget=function(t){const l=t.texture,h=n.get(t),c=n.get(l);t.addEventListener("dispose",W),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=l.version,o.memory.textures++);const u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=z(t)||a;if(u){h.__webglFramebuffer=[];for(let t=0;t<6;t++)h.__webglFramebuffer[t]=e.createFramebuffer()}else{if(h.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const i=t.texture;for(let t=0,r=i.length;t<r;t++){const r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===oe(t)){const n=d?l:[l];h.__webglMultisampledFramebuffer=e.createFramebuffer(),h.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){const r=n[i];h.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(36161,h.__webglColorRenderbuffer[i]);const o=s.convert(r.format,r.encoding),a=s.convert(r.type),l=V(r.internalFormat,o,a,r.encoding,!0===t.isXRRenderTarget),c=se(t);e.renderbufferStorageMultisample(36161,c,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+i,36161,h.__webglColorRenderbuffer[i])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(h.__webglDepthRenderbuffer=e.createRenderbuffer(),ne(h.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}}if(u){i.bindTexture(34067,c.__webglTexture),$(34067,l,f);for(let e=0;e<6;e++)ie(h.__webglFramebuffer[e],t,l,36064,34069+e);F(l,f)&&B(34067),i.unbindTexture()}else if(d){const e=t.texture;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=n.get(s);i.bindTexture(3553,o.__webglTexture),$(3553,s,f),ie(h.__webglFramebuffer,t,s,36064+r,3553),F(s,f)&&B(3553)}i.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(e,c.__webglTexture),$(e,l,f),ie(h.__webglFramebuffer,t,l,36064,e),F(l,f)&&B(e),i.unbindTexture()}t.depthBuffer&&re(t)},this.updateRenderTargetMipmap=function(e){const t=z(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(F(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(o).__webglTexture;i.bindTexture(t,r),B(t),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===oe(t)){const r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,o=t.height;let a=16384;const l=[],h=t.stencilBuffer?33306:36096,c=n.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<r.length;t++)i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),i.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);i.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,c.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(36064+i),t.depthBuffer&&l.push(h);const d=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024)),u&&e.framebufferRenderbuffer(36008,36064,36161,c.__webglColorRenderbuffer[i]),!0===d&&(e.invalidateFramebuffer(36008,[h]),e.invalidateFramebuffer(36009,[h])),u){const t=n.get(r[i]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,s,o,0,0,s,o,a,9728),f&&e.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),u)for(let t=0;t<r.length;t++){i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,c.__webglColorRenderbuffer[t]);const s=n.get(r[t]).__webglTexture;i.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,s,0)}i.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=re,this.setupFrameBufferTexture=ie,this.useMultisampledRTT=oe}function As(e,t,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===T)return 5121;if(1017===i)return 32819;if(1018===i)return 32820;if(1010===i)return 5120;if(1011===i)return 5122;if(1012===i)return 5123;if(1013===i)return 5124;if(i===A)return 5125;if(i===E)return 5126;if(i===C)return n?5131:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return 6406;if(i===L)return 6408;if(1024===i)return 6409;if(1025===i)return 6410;if(i===R)return 6402;if(i===P)return 34041;if(1028===i)return 6403;if(1022===i)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(i===ee)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return 36244;if(1030===i)return 33319;if(1031===i)return 33320;if(1033===i)return 36249;if(i===D||i===I||i===O||i===k)if(r===X){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===D)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===I)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===O)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===k)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===D)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===I)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===O)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===k)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===i)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===i)return r===X?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return r===X?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===i){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(36492===i)return r===X?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===N?n?34042:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[i]?e[i]:null}}}class Es extends ji{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Cs extends jt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ns={type:"move"};class Ls{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Cs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Cs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new We,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new We),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Cs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new We,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new We),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const e=new Cs;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}const r=l.joints[n.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=n.position.distanceTo(r.position),a=.02,h=.005;l.inputState.pinching&&o>a+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ns)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Rs extends Fe{constructor(e,t,i,n,r,s,o,a,l,h){if((h=void 0!==h?h:R)!==R&&h!==P)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===R&&(i=A),void 0===i&&h===P&&(i=N),super(null,n,r,s,o,a,h,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==o?o:y,this.minFilter=void 0!==a?a:y,this.flipY=!1,this.generateMipmaps=!1}}class Ps extends te{constructor(e,t){super();const i=this;let n=null,r=1,s=null,o="local-floor",a=null,l=null,h=null,c=null,u=null,d=null;const f=t.getContextAttributes();let p=null,m=null;const g=[],v=[],x=new ji;x.layers.enable(1),x.viewport=new Be;const y=new ji;y.layers.enable(2),y.viewport=new Be;const b=[x,y],w=new Es;w.layers.enable(1),w.layers.enable(2);let M=null,S=null;function _(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const i=g[t];void 0!==i&&i.dispatchEvent({type:e.type,data:e.inputSource})}function E(){n.removeEventListener("select",_),n.removeEventListener("selectstart",_),n.removeEventListener("selectend",_),n.removeEventListener("squeeze",_),n.removeEventListener("squeezestart",_),n.removeEventListener("squeezeend",_),n.removeEventListener("end",E),n.removeEventListener("inputsourceschange",C);for(let e=0;e<g.length;e++){const t=v[e];null!==t&&(v[e]=null,g[e].disconnect(t))}M=null,S=null,e.setRenderTarget(p),u=null,c=null,h=null,n=null,m=null,z.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function C(e){for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=v.indexOf(i);n>=0&&(v[n]=null,g[n].dispatchEvent({type:"disconnected",data:i}))}for(let t=0;t<e.added.length;t++){const i=e.added[t];let n=v.indexOf(i);if(-1===n){for(let e=0;e<g.length;e++){if(e>=v.length){v.push(i),n=e;break}if(null===v[e]){v[e]=i,n=e;break}}if(-1===n)break}const r=g[n];r&&r.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=g[e];return void 0===t&&(t=new Ls,g[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=g[e];return void 0===t&&(t=new Ls,g[e]=t),t.getGripSpace()},this.getHand=function(e){let t=g[e];return void 0===t&&(t=new Ls,g[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||s},this.setReferenceSpace=function(e){a=e},this.getBaseLayer=function(){return null!==c?c:u},this.getBinding=function(){return h},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(p=e.getRenderTarget(),n.addEventListener("select",_),n.addEventListener("selectstart",_),n.addEventListener("selectend",_),n.addEventListener("squeeze",_),n.addEventListener("squeezestart",_),n.addEventListener("squeezeend",_),n.addEventListener("end",E),n.addEventListener("inputsourceschange",C),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:u}),m=new Ve(u.framebufferWidth,u.framebufferHeight,{format:L,type:T,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let i=null,s=null,o=null;f.depth&&(o=f.stencil?35056:33190,i=f.stencil?P:R,s=f.stencil?N:A);const a={colorFormat:32856,depthFormat:o,scaleFactor:r};h=new XRWebGLBinding(n,t),c=h.createProjectionLayer(a),n.updateRenderState({layers:[c]}),m=new Ve(c.textureWidth,c.textureHeight,{format:L,type:T,depthTexture:new Rs(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});e.properties.get(m).__ignoreDepthValues=c.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),a=null,s=await n.requestReferenceSpace(o),z.setContext(n),z.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new We,I=new We;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;w.near=y.near=x.near=e.near,w.far=y.far=x.far=e.far,M===w.near&&S===w.far||(n.updateRenderState({depthNear:w.near,depthFar:w.far}),M=w.near,S=w.far);const t=e.parent,i=w.cameras;O(w,t);for(let e=0;e<i.length;e++)O(i[e],t);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),e.matrix.copy(w.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===i.length?function(e,t,i){D.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(I),r=t.projectionMatrix.elements,s=i.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=o*c,f=o*u,p=n/(-c+u),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+p,v=a+p,x=d-m,y=f+(n-m),b=l*a/v*g,w=h*a/v*g;e.projectionMatrix.makePerspective(x,y,b,w,g,v)}(w,x,y):w.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(e){null!==c&&(c.fixedFoveation=e),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=e)};let k=null;const z=new rn;z.setAnimationLoop((function(t,i){if(l=i.getViewerPose(a||s),d=i,null!==l){const t=l.views;null!==u&&(e.setRenderTargetFramebuffer(m,u.framebuffer),e.setRenderTarget(m));let i=!1;t.length!==w.cameras.length&&(w.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let s=null;if(null!==u)s=u.getViewport(r);else{const t=h.getViewSubImage(c,r);s=t.viewport,0===n&&(e.setRenderTargetTextures(m,t.colorTexture,c.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(m))}let o=b[n];void 0===o&&(o=new ji,o.layers.enable(n),o.viewport=new Be,b[n]=o),o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===n&&w.matrix.copy(o.matrix),!0===i&&w.cameras.push(o)}}for(let e=0;e<g.length;e++){const t=v[e],n=g[e];null!==t&&void 0!==n&&n.update(t,i,a||s)}k&&k(t,i),d=null})),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function Ds(e,t){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,1===n.side&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),1===n.side&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);const r=t.get(n).envMap;if(r&&(i.envMap.value=r,i.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;const t=!0!==e.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*t}let s,o;n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.roughnessMap?s=n.roughnessMap:n.metalnessMap?s=n.metalnessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap?s=n.emissiveMap:n.clearcoatMap?s=n.clearcoatMap:n.clearcoatNormalMap?s=n.clearcoatNormalMap:n.clearcoatRoughnessMap?s=n.clearcoatRoughnessMap:n.iridescenceMap?s=n.iridescenceMap:n.iridescenceThicknessMap?s=n.iridescenceThicknessMap:n.specularIntensityMap?s=n.specularIntensityMap:n.specularColorMap?s=n.specularColorMap:n.transmissionMap?s=n.transmissionMap:n.thicknessMap?s=n.thicknessMap:n.sheenColorMap?s=n.sheenColorMap:n.sheenRoughnessMap&&(s=n.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),i.uvTransform.value.copy(s.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),i.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,r,s,o){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(e,n):n.isMeshToonMaterial?(i(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,n)):n.isMeshPhongMaterial?(i(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,n)):n.isMeshStandardMaterial?(i(e,n),function(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap);i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap);t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,n),n.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,n,o)):n.isMeshMatcapMaterial?(i(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,n)):n.isMeshDepthMaterial?i(e,n):n.isMeshDistanceMaterial?(i(e,n),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?i(e,n):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,n,r,s):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Is(e,t,i,n){let r={},s={},o=[];const a=i.isWebGL2?e.getParameter(35375):0;function l(e,t,i){const n=e.value;if(void 0===i[t])return i[t]="number"==typeof n?n:n.clone(),!0;if("number"==typeof n){if(i[t]!==n)return i[t]=n,!0}else{const e=i[t];if(!1===e.equals(n))return e.copy(n),!0}return!1}function h(e){const t=e.value,i={boundary:0,storage:0};return"number"==typeof t?(i.boundary=4,i.storage=4):t.isVector2?(i.boundary=8,i.storage=8):t.isVector3||t.isColor?(i.boundary=16,i.storage=12):t.isVector4?(i.boundary=16,i.storage=16):t.isMatrix3?(i.boundary=48,i.storage=48):t.isMatrix4?(i.boundary=64,i.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),i}function c(t){const i=t.target;i.removeEventListener("dispose",c);const n=o.indexOf(i.__bindingPointIndex);o.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(e,t){const i=t.program;n.uniformBlockBinding(e,i)},update:function(i,u){let d=r[i.id];void 0===d&&(!function(e){const t=e.uniforms;let i=0;const n=16;let r=0;for(let e=0,s=t.length;e<s;e++){const s=t[e],o=h(s);if(s.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=i,e>0){r=i%n;const e=n-r;0!==r&&e-o.boundary<0&&(i+=n-r,s.__offset=i)}i+=o.storage}r=i%n,r>0&&(i+=n-r);e.__size=i,e.__cache={}}(i),d=function(t){const i=function(){for(let e=0;e<a;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;const n=e.createBuffer(),r=t.__size,s=t.usage;return e.bindBuffer(35345,n),e.bufferData(35345,r,s),e.bindBuffer(35345,null),e.bindBufferBase(35345,i,n),n}(i),r[i.id]=d,i.addEventListener("dispose",c));const f=u.program;n.updateUBOMapping(i,f);const p=t.render.frame;s[i.id]!==p&&(!function(t){const i=r[t.id],n=t.uniforms,s=t.__cache;e.bindBuffer(35345,i);for(let t=0,i=n.length;t<i;t++){const i=n[t];if(!0===l(i,t,s)){const t=i.value,n=i.__offset;"number"==typeof t?(i.__data[0]=t,e.bufferSubData(35345,n,i.__data)):(i.value.isMatrix3?(i.__data[0]=i.value.elements[0],i.__data[1]=i.value.elements[1],i.__data[2]=i.value.elements[2],i.__data[3]=i.value.elements[0],i.__data[4]=i.value.elements[3],i.__data[5]=i.value.elements[4],i.__data[6]=i.value.elements[5],i.__data[7]=i.value.elements[0],i.__data[8]=i.value.elements[6],i.__data[9]=i.value.elements[7],i.__data[10]=i.value.elements[8],i.__data[11]=i.value.elements[0]):t.toArray(i.__data),e.bufferSubData(35345,n,i.__data))}}e.bindBuffer(35345,null)}(i),s[i.id]=p)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);o=[],r={},s={}}}}function Os(e={}){this.isWebGLRenderer=!0;const t=void 0!==e.canvas?e.canvas:function(){const e=we("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,h=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",d=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let f;f=null!==i?i.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let p=null,m=null;const g=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=j,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const x=this;let y=!1,b=0,w=0,M=null,S=-1,A=null;const N=new Be,R=new Be;let P=null,D=t.width,I=t.height,O=1,k=null,z=null;const F=new Be(0,0,D,I),B=new Be(0,0,D,I);let V=!1;const U=new nn;let H=!1,G=!1,W=null;const X=new bt,q=new ge,J=new We,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Y(){return null===M?O:1}let Z,$,Q,ee,te,ie,ne,re,se,oe,ae,le,he,ce,ue,fe,pe,me,ve,xe,ye,be,Me,Se,_e=i;function Te(e,i){for(let n=0;n<e.length;n++){const r=e[n],s=t.getContext(r,i);if(null!==s)return s}return null}try{const e={alpha:!0,depth:r,stencil:s,antialias:l,premultipliedAlpha:h,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${n}`),t.addEventListener("webglcontextlost",Ce,!1),t.addEventListener("webglcontextrestored",Ne,!1),t.addEventListener("webglcontextcreationerror",Le,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&t.shift(),_e=Te(t,e),null===_e)throw Te(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Ae(){Z=new Pn(_e),$=new fn(_e,Z,e),Z.init($),be=new As(_e,Z,$),Q=new _s(_e,Z,$),ee=new On,te=new cs,ie=new Ts(_e,Z,Q,te,$,be,ee),ne=new mn(x),re=new Rn(x),se=new sn(_e,$),Me=new un(_e,Z,se,$),oe=new Dn(_e,se,ee,Me),ae=new Bn(_e,oe,se,ee),ve=new Fn(_e,$,ie),fe=new pn(te),le=new hs(x,ne,re,Z,$,Me,fe),he=new Ds(x,te),ce=new ps,ue=new bs(Z,$),me=new cn(x,ne,re,Q,ae,f,h),pe=new Ss(x,ae,$),Se=new Is(_e,ee,$,Q),xe=new dn(_e,Z,ee,$),ye=new In(_e,Z,ee,$),ee.programs=le.programs,x.capabilities=$,x.extensions=Z,x.properties=te,x.renderLists=ce,x.shadowMap=pe,x.state=Q,x.info=ee}Ae();const Ee=new Ps(x,_e);function Ce(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function Ne(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const e=ee.autoReset,t=pe.enabled,i=pe.autoUpdate,n=pe.needsUpdate,r=pe.type;Ae(),ee.autoReset=e,pe.enabled=t,pe.autoUpdate=i,pe.needsUpdate=n,pe.type=r}function Le(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Re(e){const t=e.target;t.removeEventListener("dispose",Re),function(e){(function(e){const t=te.get(e).programs;void 0!==t&&(t.forEach((function(e){le.releaseProgram(e)})),e.isShaderMaterial&&le.releaseShaderCache(e))})(e),te.remove(e)}(t)}this.xr=Ee,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=Z.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Z.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(D,I,!1))},this.getSize=function(e){return e.set(D,I)},this.setSize=function(e,i,n){Ee.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=e,I=i,t.width=Math.floor(e*O),t.height=Math.floor(i*O),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(D*O,I*O).floor()},this.setDrawingBufferSize=function(e,i,n){D=e,I=i,O=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(N)},this.getViewport=function(e){return e.copy(F)},this.setViewport=function(e,t,i,n){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,i,n),Q.viewport(N.copy(F).multiplyScalar(O).floor())},this.getScissor=function(e){return e.copy(B)},this.setScissor=function(e,t,i,n){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,i,n),Q.scissor(R.copy(B).multiplyScalar(O).floor())},this.getScissorTest=function(){return V},this.setScissorTest=function(e){Q.setScissorTest(V=e)},this.setOpaqueSort=function(e){k=e},this.setTransparentSort=function(e){z=e},this.getClearColor=function(e){return e.copy(me.getClearColor())},this.setClearColor=function(){me.setClearColor.apply(me,arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha.apply(me,arguments)},this.clear=function(e=!0,t=!0,i=!0){let n=0;e&&(n|=16384),t&&(n|=256),i&&(n|=1024),_e.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ce,!1),t.removeEventListener("webglcontextrestored",Ne,!1),t.removeEventListener("webglcontextcreationerror",Le,!1),ce.dispose(),ue.dispose(),te.dispose(),ne.dispose(),re.dispose(),ae.dispose(),Me.dispose(),Se.dispose(),le.dispose(),Ee.dispose(),Ee.removeEventListener("sessionstart",De),Ee.removeEventListener("sessionend",Ie),W&&(W.dispose(),W=null),Oe.stop()},this.renderBufferDirect=function(e,t,i,n,r,s){null===t&&(t=K);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(e,t,i,n,r){!0!==t.isScene&&(t=K);ie.resetTextureUnits();const s=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===M?x.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:j,l=(n.isMeshStandardMaterial?re:ne).get(n.envMap||o),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,p=n.toneMapped?x.toneMapping:0,g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==g?g.length:0,y=te.get(n),b=m.state.lights;if(!0===H&&(!0===G||e!==A)){const t=e===A&&n.id===S;fe.setState(n,e,t)}let w=!1;n.version===y.__version?y.needsLights&&y.lightsStateVersion!==b.state.version||y.outputEncoding!==a||r.isInstancedMesh&&!1===y.instancing?w=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?w=!0:r.isSkinnedMesh||!0!==y.skinning?y.envMap!==l||!0===n.fog&&y.fog!==s?w=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===fe.numPlanes&&y.numIntersection===fe.numIntersection?(y.vertexAlphas!==h||y.vertexTangents!==c||y.morphTargets!==u||y.morphNormals!==d||y.morphColors!==f||y.toneMapping!==p||!0===$.isWebGL2&&y.morphTargetsCount!==v)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,y.__version=n.version);let _=y.currentProgram;!0===w&&(_=He(n,t,r));let T=!1,E=!1,C=!1;const N=_.getUniforms(),L=y.uniforms;Q.useProgram(_.program)&&(T=!0,E=!0,C=!0);n.id!==S&&(S=n.id,E=!0);if(T||A!==e){if(N.setValue(_e,"projectionMatrix",e.projectionMatrix),$.logarithmicDepthBuffer&&N.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),A!==e&&(A=e,E=!0,C=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=N.map.cameraPosition;void 0!==t&&t.setValue(_e,J.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&N.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&N.setValue(_e,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){N.setOptional(_e,r,"bindMatrix"),N.setOptional(_e,r,"bindMatrixInverse");const e=r.skeleton;e&&($.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),N.setValue(_e,"boneTexture",e.boneTexture,ie),N.setValue(_e,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const R=i.morphAttributes;(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===$.isWebGL2)&&ve.update(r,i,n,_);(E||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,N.setValue(_e,"receiveShadow",r.receiveShadow));n.isMeshGouraudMaterial&&null!==n.envMap&&(L.envMap.value=l,L.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);E&&(N.setValue(_e,"toneMappingExposure",x.toneMappingExposure),y.needsLights&&(D=C,(P=L).ambientLightColor.needsUpdate=D,P.lightProbe.needsUpdate=D,P.directionalLights.needsUpdate=D,P.directionalLightShadows.needsUpdate=D,P.pointLights.needsUpdate=D,P.pointLightShadows.needsUpdate=D,P.spotLights.needsUpdate=D,P.spotLightShadows.needsUpdate=D,P.rectAreaLights.needsUpdate=D,P.hemisphereLights.needsUpdate=D),s&&!0===n.fog&&he.refreshFogUniforms(L,s),he.refreshMaterialUniforms(L,n,O,I,W),Gr.upload(_e,y.uniformsList,L,ie));var P,D;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Gr.upload(_e,y.uniformsList,L,ie),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&N.setValue(_e,"center",r.center);if(N.setValue(_e,"modelViewMatrix",r.modelViewMatrix),N.setValue(_e,"normalMatrix",r.normalMatrix),N.setValue(_e,"modelMatrix",r.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const e=n.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if($.isWebGL2){const i=e[t];Se.update(i,_),Se.bind(i,_)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return _}(e,t,i,n,r);Q.setMaterial(n,o);let l=i.index;const h=i.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===n.wireframe&&(l=oe.getWireframeAttribute(i),u=2),Me.setup(r,n,a,i,l);let d=xe;null!==l&&(c=se.get(l),d=ye,d.setIndex(c));const f=null!==l?l.count:h.count,p=i.drawRange.start*u,g=i.drawRange.count*u,v=null!==s?s.start*u:0,y=null!==s?s.count*u:1/0,b=Math.max(p,v),w=Math.min(f,p+g,v+y)-1,_=Math.max(0,w-b+1);if(0!==_){if(r.isMesh)!0===n.wireframe?(Q.setLineWidth(n.wireframeLinewidth*Y()),d.setMode(1)):d.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),Q.setLineWidth(e*Y()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(b,_,r.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(b,_,e)}else d.render(b,_)}},this.compile=function(e,t){function i(e,t,i){!0===e.transparent&&e.side===a?(e.side=1,e.needsUpdate=!0,He(e,t,i),e.side=o,e.needsUpdate=!0,He(e,t,i),e.side=a):He(e,t,i)}m=ue.get(e),m.init(),v.push(m),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(x.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){i(n[r],e,t)}else i(n,e,t)})),v.pop(),m=null};let Pe=null;function De(){Oe.stop()}function Ie(){Oe.start()}const Oe=new rn;function ke(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){n&&J.setFromMatrixPosition(e.matrixWorld).applyMatrix4(X);const t=ae.update(e),r=e.material;r.visible&&p.push(e,t,r,i,J.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==ee.render.frame&&(e.skeleton.update(),e.skeleton.frame=ee.render.frame),!e.frustumCulled||U.intersectsObject(e))){n&&J.setFromMatrixPosition(e.matrixWorld).applyMatrix4(X);const t=ae.update(e),r=e.material;if(Array.isArray(r)){const n=t.groups;for(let s=0,o=n.length;s<o;s++){const o=n[s],a=r[o.materialIndex];a&&a.visible&&p.push(e,t,a,i,J.z,o)}}else r.visible&&p.push(e,t,r,i,J.z,null)}const r=e.children;for(let e=0,s=r.length;e<s;e++)ke(r[e],t,i,n)}function ze(e,t,i,n){const r=e.opaque,s=e.transmissive,o=e.transparent;m.setupLightsView(i),s.length>0&&function(e,t,i){const n=$.isWebGL2;null===W&&(W=new Ve(1,1,{generateMipmaps:!0,type:Z.has("EXT_color_buffer_half_float")?C:T,minFilter:_,samples:n&&!0===l?4:0}));x.getDrawingBufferSize(q),n?W.setSize(q.x,q.y):W.setSize(de(q.x),de(q.y));const r=x.getRenderTarget();x.setRenderTarget(W),x.clear();const s=x.toneMapping;x.toneMapping=0,Fe(e,t,i),x.toneMapping=s,ie.updateMultisampleRenderTarget(W),ie.updateRenderTargetMipmap(W),x.setRenderTarget(r)}(r,t,i),n&&Q.viewport(N.copy(n)),r.length>0&&Fe(r,t,i),s.length>0&&Fe(s,t,i),o.length>0&&Fe(o,t,i),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function Fe(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,s=e.length;r<s;r++){const s=e[r],o=s.object,a=s.geometry,l=null===n?s.material:n,h=s.group;o.layers.test(i.layers)&&Ue(o,t,i,a,l,h)}}function Ue(e,t,i,n,r,s){e.onBeforeRender(x,t,i,n,r,s),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(x,t,i,n,e,s),!0===r.transparent&&r.side===a?(r.side=1,r.needsUpdate=!0,x.renderBufferDirect(i,t,n,r,e,s),r.side=o,r.needsUpdate=!0,x.renderBufferDirect(i,t,n,r,e,s),r.side=a):x.renderBufferDirect(i,t,n,r,e,s),e.onAfterRender(x,t,i,n,r,s)}function He(e,t,i){!0!==t.isScene&&(t=K);const n=te.get(e),r=m.state.lights,s=m.state.shadowsArray,o=r.state.version,a=le.getParameters(e,r.state,s,t,i),l=le.getProgramCacheKey(a);let h=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?re:ne).get(e.envMap||n.environment),void 0===h&&(e.addEventListener("dispose",Re),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===o)return Ge(e,a),c}else a.uniforms=le.getUniforms(e),e.onBuild(i,a,x),e.onBeforeCompile(a,x),c=le.acquireProgram(a,l),h.set(l,c),n.uniforms=a.uniforms;const u=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=fe.uniform),Ge(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=c.getUniforms(),f=Gr.seqWithValue(d.seq,u);return n.currentProgram=c,n.uniformsList=f,c}function Ge(e,t){const i=te.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}Oe.setAnimationLoop((function(e){Pe&&Pe(e)})),"undefined"!=typeof self&&Oe.setContext(self),this.setAnimationLoop=function(e){Pe=e,Ee.setAnimationLoop(e),null===e?Oe.stop():Oe.start()},Ee.addEventListener("sessionstart",De),Ee.addEventListener("sessionend",Ie),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===y)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ee.enabled&&!0===Ee.isPresenting&&(!0===Ee.cameraAutoUpdate&&Ee.updateCamera(t),t=Ee.getCamera()),!0===e.isScene&&e.onBeforeRender(x,e,t,M),m=ue.get(e,v.length),m.init(),v.push(m),X.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(X),G=this.localClippingEnabled,H=fe.init(this.clippingPlanes,G,t),p=ce.get(e,g.length),p.init(),g.push(p),ke(e,t,0,x.sortObjects),p.finish(),!0===x.sortObjects&&p.sort(k,z),!0===H&&fe.beginShadows();const i=m.state.shadowsArray;if(pe.render(i,e,t),!0===H&&fe.endShadows(),!0===this.info.autoReset&&this.info.reset(),me.render(p,e),m.setupLights(x.physicallyCorrectLights),t.isArrayCamera){const i=t.cameras;for(let t=0,n=i.length;t<n;t++){const n=i[t];ze(p,e,n,n.viewport)}}else ze(p,e,t);null!==M&&(ie.updateMultisampleRenderTarget(M),ie.updateRenderTargetMipmap(M)),!0===e.isScene&&e.onAfterRender(x,e,t),Me.resetDefaultState(),S=-1,A=null,v.pop(),m=v.length>0?v[v.length-1]:null,g.pop(),p=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(e,t,i){te.get(e.texture).__webglTexture=t,te.get(e.depthTexture).__webglTexture=i;const n=te.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===Z.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const i=te.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){M=e,b=t,w=i;let n=!0,r=null,s=!1,o=!1;if(e){const i=te.get(e);void 0!==i.__useDefaultFramebuffer?(Q.bindFramebuffer(36160,null),n=!1):void 0===i.__webglFramebuffer?ie.setupRenderTarget(e):i.__hasExternalTextures&&ie.rebindTextures(e,te.get(e.texture).__webglTexture,te.get(e.depthTexture).__webglTexture);const a=e.texture;(a.isData3DTexture||a.isDataArrayTexture||a.isCompressedArrayTexture)&&(o=!0);const l=te.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],s=!0):r=$.isWebGL2&&e.samples>0&&!1===ie.useMultisampledRTT(e)?te.get(e).__webglMultisampledFramebuffer:l,N.copy(e.viewport),R.copy(e.scissor),P=e.scissorTest}else N.copy(F).multiplyScalar(O).floor(),R.copy(B).multiplyScalar(O).floor(),P=V;if(Q.bindFramebuffer(36160,r)&&$.drawBuffers&&n&&Q.drawBuffers(e,r),Q.viewport(N),Q.scissor(R),Q.setScissorTest(P),s){const n=te.get(e.texture);_e.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(o){const n=te.get(e.texture),r=t||0;_e.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}S=-1},this.readRenderTargetPixels=function(e,t,i,n,r,s,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=te.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Q.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==L&&be.convert(a)!==_e.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===C&&(Z.has("EXT_color_buffer_half_float")||$.isWebGL2&&Z.has("EXT_color_buffer_float"));if(!(l===T||be.convert(l)===_e.getParameter(35738)||l===E&&($.isWebGL2||Z.has("OES_texture_float")||Z.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&_e.readPixels(t,i,n,r,be.convert(a),be.convert(l),s)}finally{const e=null!==M?te.get(M).__webglFramebuffer:null;Q.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),r=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);ie.setTexture2D(t,0),_e.copyTexSubImage2D(3553,i,0,0,e.x,e.y,r,s),Q.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const r=t.image.width,s=t.image.height,o=be.convert(i.format),a=be.convert(i.type);ie.setTexture2D(i,0),_e.pixelStorei(37440,i.flipY),_e.pixelStorei(37441,i.premultiplyAlpha),_e.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?_e.texSubImage2D(3553,n,e.x,e.y,r,s,o,a,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):_e.texSubImage2D(3553,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&_e.generateMipmap(3553),Q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,r=0){if(x.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=be.convert(n.format),h=be.convert(n.type);let c;if(n.isData3DTexture)ie.setTexture3D(n,0),c=32879;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ie.setTexture2DArray(n,0),c=35866}_e.pixelStorei(37440,n.flipY),_e.pixelStorei(37441,n.premultiplyAlpha),_e.pixelStorei(3317,n.unpackAlignment);const u=_e.getParameter(3314),d=_e.getParameter(32878),f=_e.getParameter(3316),p=_e.getParameter(3315),m=_e.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;_e.pixelStorei(3314,g.width),_e.pixelStorei(32878,g.height),_e.pixelStorei(3316,e.min.x),_e.pixelStorei(3315,e.min.y),_e.pixelStorei(32877,e.min.z),i.isDataTexture||i.isData3DTexture?_e.texSubImage3D(c,r,t.x,t.y,t.z,s,o,a,l,h,g.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(c,r,t.x,t.y,t.z,s,o,a,l,g.data)):_e.texSubImage3D(c,r,t.x,t.y,t.z,s,o,a,l,h,g),_e.pixelStorei(3314,u),_e.pixelStorei(32878,d),_e.pixelStorei(3316,f),_e.pixelStorei(3315,p),_e.pixelStorei(32877,m),0===r&&n.generateMipmaps&&_e.generateMipmap(c),Q.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?ie.setTextureCube(e,0):e.isData3DTexture?ie.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ie.setTexture2DArray(e,0):ie.setTexture2D(e,0),Q.unbindTexture()},this.resetState=function(){b=0,w=0,M=null,Q.reset(),Me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends Os{}).prototype.isWebGL1Renderer=!0;class ks{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Pe(e),this.density=t}clone(){return new ks(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class zs{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Pe(e),this.near=t,this.far=i}clone(){return new zs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Fs extends jt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class Bs{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=$,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=oe()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=oe()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=oe()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Vs=new We;class Us{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Vs.fromBufferAttribute(this,t),Vs.applyMatrix4(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Vs.fromBufferAttribute(this,t),Vs.applyNormalMatrix(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Vs.fromBufferAttribute(this,t),Vs.transformDirection(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}setX(e,t){return this.normalized&&(t=pe(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=pe(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=pe(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=pe(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=fe(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=fe(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=fe(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=fe(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=pe(t,this.array),i=pe(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=pe(t,this.array),i=pe(i,this.array),n=pe(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=pe(t,this.array),i=pe(i,this.array),n=pe(n,this.array),r=pe(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new li(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Us(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Hs extends ri{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Pe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Gs;const Ws=new We,js=new We,Xs=new We,qs=new ge,Js=new ge,Ks=new bt,Ys=new We,Zs=new We,$s=new We,Qs=new ge,eo=new ge,to=new ge;class io extends jt{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Gs){Gs=new yi;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Bs(e,5);Gs.setIndex([0,1,2,0,2,3]),Gs.setAttribute("position",new Us(t,3,0,!1)),Gs.setAttribute("uv",new Us(t,2,3,!1))}this.geometry=Gs,this.material=void 0!==e?e:new Hs,this.center=new ge(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),js.setFromMatrixScale(this.matrixWorld),Ks.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Xs.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&js.multiplyScalar(-Xs.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;no(Ys.set(-.5,-.5,0),Xs,s,js,n,r),no(Zs.set(.5,-.5,0),Xs,s,js,n,r),no($s.set(.5,.5,0),Xs,s,js,n,r),Qs.set(0,0),eo.set(1,0),to.set(1,1);let o=e.ray.intersectTriangle(Ys,Zs,$s,!1,Ws);if(null===o&&(no(Zs.set(-.5,.5,0),Xs,s,js,n,r),eo.set(0,1),o=e.ray.intersectTriangle(Ys,$s,Zs,!1,Ws),null===o))return;const a=e.ray.origin.distanceTo(Ws);a<e.near||a>e.far||t.push({distance:a,point:Ws.clone(),uv:ii.getUV(Ws,Ys,Zs,$s,Qs,eo,to,new ge),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function no(e,t,i,n,r,s){qs.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(Js.x=s*qs.x-r*qs.y,Js.y=r*qs.x+s*qs.y):Js.copy(qs),e.copy(t),e.x+=Js.x,e.y+=Js.y,e.applyMatrix4(Ks)}const ro=new We,so=new We;class oo extends jt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){ro.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(ro);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ro.setFromMatrixPosition(e.matrixWorld),so.setFromMatrixPosition(this.matrixWorld);const i=ro.distanceTo(so)/e.zoom;let n,r;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,n=i.length;e<n;e++){const n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}const ao=new We,lo=new Be,ho=new Be,co=new We,uo=new bt;class fo extends zi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new bt,this.bindMatrixInverse=new bt}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Be,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,n=this.geometry;lo.fromBufferAttribute(n.attributes.skinIndex,e),ho.fromBufferAttribute(n.attributes.skinWeight,e),ao.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=ho.getComponent(e);if(0!==n){const r=lo.getComponent(e);uo.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(co.copy(ao).applyMatrix4(uo),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}class po extends jt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class mo extends Fe{constructor(e=null,t=1,i=1,n,r,s,o,a,l=y,h=y,c,u){super(null,s,o,a,l,h,n,r,c,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const go=new bt,vo=new bt;class xo{constructor(e=[],t=[]){this.uuid=oe(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new bt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new bt;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=e.length;n<r;n++){const r=e[n]?e[n].matrixWorld:vo;go.multiplyMatrices(r,t[n]),go.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new xo(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=ue(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new mo(t,e,e,L,E);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new po),this.bones.push(r),this.boneInverses.push((new bt).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){const r=t[n];e.bones.push(r.uuid);const s=i[n];e.boneInverses.push(s.toArray())}return e}}class yo extends li{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const bo=new bt,wo=new bt,Mo=[],So=new bt,_o=new zi;class To extends zi{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new yo(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let e=0;e<i;e++)this.setMatrixAt(e,So)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(_o.geometry=this.geometry,_o.material=this.material,void 0!==_o.material)for(let r=0;r<n;r++){this.getMatrixAt(r,bo),wo.multiplyMatrices(i,bo),_o.matrixWorld=wo,_o.raycast(e,Mo);for(let e=0,i=Mo.length;e<i;e++){const i=Mo[e];i.instanceId=r,i.object=this,t.push(i)}Mo.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new yo(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ao extends ri{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Pe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Eo=new We,Co=new We,No=new bt,Lo=new yt,Ro=new ut;class Po extends jt{constructor(e=new yi,t=new Ao){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Eo.fromBufferAttribute(t,e-1),Co.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Eo.distanceTo(Co);e.setAttribute("lineDistance",new ui(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ro.copy(i.boundingSphere),Ro.applyMatrix4(n),Ro.radius+=r,!1===e.ray.intersectsSphere(Ro))return;No.copy(n).invert(),Lo.copy(e.ray).applyMatrix4(No);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new We,h=new We,c=new We,u=new We,d=this.isLineSegments?2:1,f=i.index,p=i.attributes.position;if(null!==f){for(let i=Math.max(0,s.start),n=Math.min(f.count,s.start+s.count)-1;i<n;i+=d){const n=f.getX(i),r=f.getX(i+1);l.fromBufferAttribute(p,n),h.fromBufferAttribute(p,r);if(Lo.distanceSqToSegment(l,h,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(u);s<e.near||s>e.far||t.push({distance:s,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(p.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(p,i),h.fromBufferAttribute(p,i+1);if(Lo.distanceSqToSegment(l,h,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(u);n<e.near||n>e.far||t.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const Do=new We,Io=new We;class Oo extends Po{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)Do.fromBufferAttribute(t,e),Io.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+Do.distanceTo(Io);e.setAttribute("lineDistance",new ui(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ko extends Po{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class zo extends ri{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Pe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Fo=new bt,Bo=new yt,Vo=new ut,Uo=new We;class Ho extends jt{constructor(e=new yi,t=new zo){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Vo.copy(i.boundingSphere),Vo.applyMatrix4(n),Vo.radius+=r,!1===e.ray.intersectsSphere(Vo))return;Fo.copy(n).invert(),Bo.copy(e.ray).applyMatrix4(Fo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=i.index,h=i.attributes.position;if(null!==l){for(let i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);i<r;i++){const r=l.getX(i);Uo.fromBufferAttribute(h,r),Go(Uo,r,a,n,e,t,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(h.count,s.start+s.count);i<r;i++)Uo.fromBufferAttribute(h,i),Go(Uo,i,a,n,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){const t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Go(e,t,i,n,r,s,o){const a=Bo.distanceSqToPoint(e);if(a<i){const i=new We;Bo.closestPointToPoint(e,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:o})}}class Wo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),r=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),r+=i.distanceTo(n),t.push(r),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const r=i.length;let s;s=t||e*i[r-1];let o,a=0,l=r-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-s,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const h=i[n];return(n+(s-h)/(i[n+1]-h))/(r-1)}getTangent(e,t){const i=1e-4;let n=e-i,r=e+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),o=this.getPoint(r),a=t||(s.isVector2?new ge:new We);return a.copy(o).sub(s).normalize(),a}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new We,n=[],r=[],s=[],o=new We,a=new bt;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new We)}r[0]=new We,s[0]=new We;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],o),s[0].crossVectors(n[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(n[t-1],n[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(ae(n[t-1].dot(n[t]),-1,1));r[t].applyMatrix4(a.makeRotationAxis(o,e))}s[t].crossVectors(n[t],r[t])}if(!0===t){let t=Math.acos(ae(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class jo extends Wo{constructor(e=0,t=0,i=1,n=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new ge,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const o=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function Xo(){let e=0,t=0,i=0,n=0;function r(r,s,o,a){e=r,t=o,i=-3*r+3*s-2*o-a,n=2*r-2*s+o+a}return{initCatmullRom:function(e,t,i,n,s){r(t,i,s*(i-e),s*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,s,o,a){let l=(t-e)/s-(i-e)/(s+o)+(i-t)/o,h=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,h*=o,r(t,i,l,h)},calc:function(r){const s=r*r;return e+t*r+i*s+n*(s*r)}}}const qo=new We,Jo=new Xo,Ko=new Xo,Yo=new Xo;function Zo(e,t,i,n,r){const s=.5*(n-t),o=.5*(r-i),a=e*e;return(2*i-2*n+s+o)*(e*a)+(-3*i+3*n-2*s-o)*a+s*e+i}function $o(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function Qo(e,t,i,n,r){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}class ea extends Wo{constructor(e=new ge,t=new ge,i=new ge,n=new ge){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new ge){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(Qo(e,n.x,r.x,s.x,o.x),Qo(e,n.y,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ta extends Wo{constructor(e=new ge,t=new ge){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ge){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new ge;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ia extends Wo{constructor(e=new ge,t=new ge,i=new ge){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ge){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set($o(e,n.x,r.x,s.x),$o(e,n.y,r.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class na extends Wo{constructor(e=new We,t=new We,i=new We){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new We){const i=t,n=this.v0,r=this.v1,s=this.v2;return i.set($o(e,n.x,r.x,s.x),$o(e,n.y,r.y,s.y),$o(e,n.z,r.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ra extends Wo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ge){const i=t,n=this.points,r=(n.length-1)*e,s=Math.floor(r),o=r-s,a=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],c=n[s>n.length-3?n.length-1:s+2];return i.set(Zo(o,a.x,l.x,h.x,c.x),Zo(o,a.y,l.y,h.y,c.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new ge).fromArray(i))}return this}}var sa=Object.freeze({__proto__:null,ArcCurve:class extends jo{constructor(e,t,i,n,r,s){super(e,t,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Wo{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new We){const i=t,n=this.points,r=n.length,s=(r-(this.closed?0:1))*e;let o,a,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?o=n[(l-1)%r]:(qo.subVectors(n[0],n[1]).add(n[0]),o=qo);const c=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?a=n[(l+2)%r]:(qo.subVectors(n[r-1],n[r-2]).add(n[r-1]),a=qo),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),i=Math.pow(c.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),Jo.initNonuniformCatmullRom(o.x,c.x,u.x,a.x,t,i,n),Ko.initNonuniformCatmullRom(o.y,c.y,u.y,a.y,t,i,n),Yo.initNonuniformCatmullRom(o.z,c.z,u.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(Jo.initCatmullRom(o.x,c.x,u.x,a.x,this.tension),Ko.initCatmullRom(o.y,c.y,u.y,a.y,this.tension),Yo.initCatmullRom(o.z,c.z,u.z,a.z,this.tension));return i.set(Jo.calc(h),Ko.calc(h),Yo.calc(h)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new We).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:ea,CubicBezierCurve3:class extends Wo{constructor(e=new We,t=new We,i=new We,n=new We){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new We){const i=t,n=this.v0,r=this.v1,s=this.v2,o=this.v3;return i.set(Qo(e,n.x,r.x,s.x,o.x),Qo(e,n.y,r.y,s.y,o.y),Qo(e,n.z,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:jo,LineCurve:ta,LineCurve3:class extends Wo{constructor(e=new We,t=new We){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new We){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:ia,QuadraticBezierCurve3:na,SplineCurve:ra});class oa extends Wo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ta(t,e))}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const e=n[r]-i,s=this.curves[r],o=s.getLength(),a=0===o?0:1-e/o;return s.getPointAt(a,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],o=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,a=s.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new sa[i.type]).fromJSON(i))}return this}}class aa extends oa{constructor(e){super(),this.type="Path",this.currentPoint=new ge,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new ta(this.currentPoint.clone(),new ge(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const r=new ia(this.currentPoint.clone(),new ge(e,t),new ge(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,s){const o=new ea(this.currentPoint.clone(),new ge(e,t),new ge(i,n),new ge(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new ra(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,r,s),this}absarc(e,t,i,n,r,s){return this.absellipse(e,t,i,i,n,r,s),this}ellipse(e,t,i,n,r,s,o,a){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,i,n,r,s,o,a),this}absellipse(e,t,i,n,r,s,o,a){const l=new jo(e,t,i,n,r,s,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class la extends yi{constructor(e=[new ge(0,-.5),new ge(.5,0),new ge(0,.5)],t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=ae(n,0,2*Math.PI);const r=[],s=[],o=[],a=[],l=[],h=1/t,c=new We,u=new ge,d=new We,f=new We,p=new We;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.normalize(),a.push(d.x,d.y,d.z);break;case e.length-1:a.push(p.x,p.y,p.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),a.push(d.x,d.y,d.z),p.copy(f)}for(let r=0;r<=t;r++){const d=i+r*h*n,f=Math.sin(d),p=Math.cos(d);for(let i=0;i<=e.length-1;i++){c.x=e[i].x*f,c.y=e[i].y,c.z=e[i].x*p,s.push(c.x,c.y,c.z),u.x=r/t,u.y=i/(e.length-1),o.push(u.x,u.y);const n=a[3*i+0]*f,h=a[3*i+1],d=a[3*i+0]*p;l.push(n,h,d)}}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const n=t+i*e.length,s=n,o=n+e.length,a=n+e.length+1,l=n+1;r.push(s,o,l),r.push(a,l,o)}this.setIndex(r),this.setAttribute("position",new ui(s,3)),this.setAttribute("uv",new ui(o,2)),this.setAttribute("normal",new ui(l,3))}static fromJSON(e){return new la(e.points,e.segments,e.phiStart,e.phiLength)}}class ha extends la{constructor(e=1,t=1,i=4,n=8){const r=new aa;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new ha(e.radius,e.length,e.capSegments,e.radialSegments)}}class ca extends yi{constructor(e=1,t=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const r=[],s=[],o=[],a=[],l=new We,h=new ge;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,c=3;r<=t;r++,c+=3){const u=i+r/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),s.push(l.x,l.y,l.z),o.push(0,0,1),h.x=(s[c]/e+1)/2,h.y=(s[c+1]/e+1)/2,a.push(h.x,h.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new ui(s,3)),this.setAttribute("normal",new ui(o,3)),this.setAttribute("uv",new ui(a,2))}static fromJSON(e){return new ca(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ua extends yi{constructor(e=1,t=1,i=1,n=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),r=Math.floor(r);const h=[],c=[],u=[],d=[];let f=0;const p=[],m=i/2;let g=0;function v(i){const r=f,s=new ge,p=new We;let v=0;const x=!0===i?e:t,y=!0===i?1:-1;for(let e=1;e<=n;e++)c.push(0,m*y,0),u.push(0,y,0),d.push(.5,.5),f++;const b=f;for(let e=0;e<=n;e++){const t=e/n*a+o,i=Math.cos(t),r=Math.sin(t);p.x=x*r,p.y=m*y,p.z=x*i,c.push(p.x,p.y,p.z),u.push(0,y,0),s.x=.5*i+.5,s.y=.5*r*y+.5,d.push(s.x,s.y),f++}for(let e=0;e<n;e++){const t=r+e,n=b+e;!0===i?h.push(n,n+1,t):h.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new We,v=new We;let x=0;const y=(t-e)/i;for(let l=0;l<=r;l++){const h=[],g=l/r,x=g*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,r=t*a+o,l=Math.sin(r),p=Math.cos(r);v.x=x*l,v.y=-g*i+m,v.z=x*p,c.push(v.x,v.y,v.z),s.set(l,y,p).normalize(),u.push(s.x,s.y,s.z),d.push(t,1-g),h.push(f++)}p.push(h)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){const i=p[t][e],n=p[t+1][e],r=p[t+1][e+1],s=p[t][e+1];h.push(i,n,s),h.push(n,r,s),x+=6}l.addGroup(g,x,0),g+=x}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new ui(c,3)),this.setAttribute("normal",new ui(u,3)),this.setAttribute("uv",new ui(d,2))}static fromJSON(e){return new ua(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class da extends ua{constructor(e=1,t=1,i=8,n=1,r=!1,s=0,o=2*Math.PI){super(0,e,t,i,n,r,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(e){return new da(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class fa extends yi{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const r=[],s=[];function o(e,t,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const o=e.clone().lerp(i,n/r),a=t.clone().lerp(i,n/r),l=r-n;for(let e=0;e<=l;e++)s[n][e]=0===e&&n===r?o:o.clone().lerp(a,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const i=Math.floor(t/2);t%2==0?(a(s[e][i+1]),a(s[e+1][i]),a(s[e][i])):(a(s[e][i+1]),a(s[e+1][i+1]),a(s[e+1][i]))}}function a(e){r.push(e.x,e.y,e.z)}function l(t,i){const n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function h(e,t,i,n){n<0&&1===e.x&&(s[t]=e.x-1),0===i.x&&0===i.z&&(s[t]=n/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){const i=new We,n=new We,r=new We;for(let s=0;s<t.length;s+=3)l(t[s+0],i),l(t[s+1],n),l(t[s+2],r),o(i,n,r,e)}(n),function(e){const t=new We;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){const e=new We;for(let i=0;i<r.length;i+=3){e.x=r[i+0],e.y=r[i+1],e.z=r[i+2];const n=c(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);s.push(n,1-o)}var t;(function(){const e=new We,t=new We,i=new We,n=new We,o=new ge,a=new ge,l=new ge;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),o.set(s[d+0],s[d+1]),a.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(e).add(t).add(i).divideScalar(3);const f=c(n);h(o,d+0,e,f),h(a,d+2,t,f),h(l,d+4,i,f)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],i=s[e+2],n=s[e+4],r=Math.max(t,i,n),o=Math.min(t,i,n);r>.9&&o<.1&&(t<.2&&(s[e+0]+=1),i<.2&&(s[e+2]+=1),n<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new ui(r,3)),this.setAttribute("normal",new ui(r.slice(),3)),this.setAttribute("uv",new ui(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new fa(e.vertices,e.indices,e.radius,e.details)}}class pa extends fa{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pa(e.radius,e.detail)}}const ma=new We,ga=new We,va=new We,xa=new ii;class ya extends aa{constructor(e){super(e),this.uuid=oe(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new aa).fromJSON(i))}return this}}const ba=function(e,t,i=2){const n=t&&t.length,r=n?t[0]*i:e.length;let s=wa(e,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,h,c,u,d,f;if(n&&(s=function(e,t,i,n){const r=[];let s,o,a,l,h;for(s=0,o=t.length;s<o;s++)a=t[s]*n,l=s<o-1?t[s+1]*n:e.length,h=wa(e,a,l,n,!1),h===h.next&&(h.steiner=!0),r.push(Pa(h));for(r.sort(Ca),s=0;s<r.length;s++)i=Na(r[s],i);return i}(e,t,s,i)),e.length>80*i){a=h=e[0],l=c=e[1];for(let t=i;t<r;t+=i)u=e[t],d=e[t+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);f=Math.max(h-a,c-l),f=0!==f?32767/f:0}return Sa(s,o,i,a,l,f,0),o};function wa(e,t,i,n,r){let s,o;if(r===function(e,t,i,n){let r=0;for(let s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}(e,t,i,n)>0)for(s=t;s<i;s+=n)o=Ha(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=Ha(s,e[s],e[s+1],o);return o&&ka(o,o.next)&&(Ga(o),o=o.next),o}function Ma(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!ka(n,n.next)&&0!==Oa(n.prev,n,n.next))n=n.next;else{if(Ga(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function Sa(e,t,i,n,r,s,o){if(!e)return;!o&&s&&function(e,t,i,n){let r=e;do{0===r.z&&(r.z=Ra(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,s,o,a,l,h=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<h&&(a++,n=n.nextZ,n);t++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(o>1)}(r)}(e,n,r,s);let a,l,h=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,s?Ta(e,n,r,s):_a(e))t.push(a.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Ga(e),e=l.next,h=l.next;else if((e=l)===h){o?1===o?Sa(e=Aa(Ma(e),t,i),t,i,n,r,s,2):2===o&&Ea(e,t,i,n,r,s):Sa(Ma(e),t,i,n,r,s,1);break}}function _a(e){const t=e.prev,i=e,n=e.next;if(Oa(t,i,n)>=0)return!1;const r=t.x,s=i.x,o=n.x,a=t.y,l=i.y,h=n.y,c=r<s?r<o?r:o:s<o?s:o,u=a<l?a<h?a:h:l<h?l:h,d=r>s?r>o?r:o:s>o?s:o,f=a>l?a>h?a:h:l>h?l:h;let p=n.next;for(;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Da(r,a,s,l,o,h,p.x,p.y)&&Oa(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Ta(e,t,i,n){const r=e.prev,s=e,o=e.next;if(Oa(r,s,o)>=0)return!1;const a=r.x,l=s.x,h=o.x,c=r.y,u=s.y,d=o.y,f=a<l?a<h?a:h:l<h?l:h,p=c<u?c<d?c:d:u<d?u:d,m=a>l?a>h?a:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,v=Ra(f,p,t,i,n),x=Ra(m,g,t,i,n);let y=e.prevZ,b=e.nextZ;for(;y&&y.z>=v&&b&&b.z<=x;){if(y.x>=f&&y.x<=m&&y.y>=p&&y.y<=g&&y!==r&&y!==o&&Da(a,c,l,u,h,d,y.x,y.y)&&Oa(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==r&&b!==o&&Da(a,c,l,u,h,d,b.x,b.y)&&Oa(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;y&&y.z>=v;){if(y.x>=f&&y.x<=m&&y.y>=p&&y.y<=g&&y!==r&&y!==o&&Da(a,c,l,u,h,d,y.x,y.y)&&Oa(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=x;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==r&&b!==o&&Da(a,c,l,u,h,d,b.x,b.y)&&Oa(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Aa(e,t,i){let n=e;do{const r=n.prev,s=n.next.next;!ka(r,s)&&za(r,n,n.next,s)&&Va(r,s)&&Va(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),Ga(n),Ga(n.next),n=e=s),n=n.next}while(n!==e);return Ma(n)}function Ea(e,t,i,n,r,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Ia(o,e)){let a=Ua(o,e);return o=Ma(o,o.next),a=Ma(a,a.next),Sa(o,t,i,n,r,s,0),void Sa(a,t,i,n,r,s,0)}e=e.next}o=o.next}while(o!==e)}function Ca(e,t){return e.x-t.x}function Na(e,t){const i=function(e,t){let i,n=t,r=-1/0;const s=e.x,o=e.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=s&&e>r&&(r=e,i=n.x<n.next.x?n:n.next,e===s))return i}n=n.next}while(n!==t);if(!i)return null;const a=i,l=i.x,h=i.y;let c,u=1/0;n=i;do{s>=n.x&&n.x>=l&&s!==n.x&&Da(o<h?s:r,o,l,h,o<h?r:s,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(s-n.x),Va(n,e)&&(c<u||c===u&&(n.x>i.x||n.x===i.x&&La(i,n)))&&(i=n,u=c)),n=n.next}while(n!==a);return i}(e,t);if(!i)return t;const n=Ua(i,e);return Ma(n,n.next),Ma(i,i.next)}function La(e,t){return Oa(e.prev,e,t.prev)<0&&Oa(t.next,e,e.next)<0}function Ra(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Pa(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Da(e,t,i,n,r,s,o,a){return(r-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(i-o)*(t-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function Ia(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&za(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Va(e,t)&&Va(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Oa(e.prev,e,t.prev)||Oa(e,t.prev,t))||ka(e,t)&&Oa(e.prev,e,e.next)>0&&Oa(t.prev,t,t.next)>0)}function Oa(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ka(e,t){return e.x===t.x&&e.y===t.y}function za(e,t,i,n){const r=Ba(Oa(e,t,i)),s=Ba(Oa(e,t,n)),o=Ba(Oa(i,n,e)),a=Ba(Oa(i,n,t));return r!==s&&o!==a||(!(0!==r||!Fa(e,i,t))||(!(0!==s||!Fa(e,n,t))||(!(0!==o||!Fa(i,e,n))||!(0!==a||!Fa(i,t,n)))))}function Fa(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Ba(e){return e>0?1:e<0?-1:0}function Va(e,t){return Oa(e.prev,e,e.next)<0?Oa(e,t,e.next)>=0&&Oa(e,e.prev,t)>=0:Oa(e,t,e.prev)<0||Oa(e,e.next,t)<0}function Ua(e,t){const i=new Wa(e.i,e.x,e.y),n=new Wa(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function Ha(e,t,i,n){const r=new Wa(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Ga(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Wa(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ja{static area(e){const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return ja.area(e)<0}static triangulateShape(e,t){const i=[],n=[],r=[];Xa(e),qa(i,e);let s=e.length;t.forEach(Xa);for(let e=0;e<t.length;e++)n.push(s),s+=t[e].length,qa(i,t[e]);const o=ba(i,n);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function Xa(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function qa(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class Ja extends yi{constructor(e=new ya([new ge(.5,.5),new ge(-.5,.5),new ge(-.5,-.5),new ge(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],r=[];for(let t=0,i=e.length;t<i;t++){s(e[t])}function s(e){const s=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let h=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:.2,u=void 0!==t.bevelSize?t.bevelSize:c-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Ka;let g,v,x,y,b,w=!1;p&&(g=p.getSpacedPoints(a),w=!0,h=!1,v=p.computeFrenetFrames(a,!1),x=new We,y=new We,b=new We),h||(f=0,c=0,u=0,d=0);const M=e.extractPoints(o);let S=M.shape;const _=M.holes;if(!ja.isClockWise(S)){S=S.reverse();for(let e=0,t=_.length;e<t;e++){const t=_[e];ja.isClockWise(t)&&(_[e]=t.reverse())}}const T=ja.triangulateShape(S,_),A=S;for(let e=0,t=_.length;e<t;e++){const t=_[e];S=S.concat(t)}function E(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const C=S.length,N=T.length;function L(e,t,i){let n,r,s;const o=e.x-t.x,a=e.y-t.y,l=i.x-e.x,h=i.y-e.y,c=o*o+a*a,u=o*h-a*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),f=t.x-a/u,p=t.y+o/u,m=((i.x-h/d-f)*h-(i.y+l/d-p)*l)/(o*h-a*l);n=f+o*m-e.x,r=p+a*m-e.y;const g=n*n+r*r;if(g<=2)return new ge(n,r);s=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(h)&&(e=!0),e?(n=-a,r=o,s=Math.sqrt(c)):(n=o,r=a,s=Math.sqrt(c/2))}return new ge(n/s,r/s)}const R=[];for(let e=0,t=A.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),R[e]=L(A[e],A[i],A[n]);const P=[];let D,I=R.concat();for(let e=0,t=_.length;e<t;e++){const t=_[e];D=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[e]=L(t[e],t[n],t[r]);P.push(D),I=I.concat(D)}for(let e=0;e<f;e++){const t=e/f,i=c*Math.cos(t*Math.PI/2),n=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=A.length;e<t;e++){const t=E(A[e],R[e],n);z(t.x,t.y,-i)}for(let e=0,t=_.length;e<t;e++){const t=_[e];D=P[e];for(let e=0,r=t.length;e<r;e++){const r=E(t[e],D[e],n);z(r.x,r.y,-i)}}}const O=u+d;for(let e=0;e<C;e++){const t=h?E(S[e],I[e],O):S[e];w?(y.copy(v.normals[0]).multiplyScalar(t.x),x.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(y).add(x),z(b.x,b.y,b.z)):z(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<C;t++){const i=h?E(S[t],I[t],O):S[t];w?(y.copy(v.normals[e]).multiplyScalar(i.x),x.copy(v.binormals[e]).multiplyScalar(i.y),b.copy(g[e]).add(y).add(x),z(b.x,b.y,b.z)):z(i.x,i.y,l/a*e)}for(let e=f-1;e>=0;e--){const t=e/f,i=c*Math.cos(t*Math.PI/2),n=u*Math.sin(t*Math.PI/2)+d;for(let e=0,t=A.length;e<t;e++){const t=E(A[e],R[e],n);z(t.x,t.y,l+i)}for(let e=0,t=_.length;e<t;e++){const t=_[e];D=P[e];for(let e=0,r=t.length;e<r;e++){const r=E(t[e],D[e],n);w?z(r.x,r.y+g[a-1].y,g[a-1].x+i):z(r.x,r.y,l+i)}}}function k(e,t){let i=e.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=e.length-1);for(let e=0,i=a+2*f;e<i;e++){const i=C*e,s=C*(e+1);B(t+n+i,t+r+i,t+r+s,t+n+s)}}}function z(e,t,i){s.push(e),s.push(t),s.push(i)}function F(e,t,r){V(e),V(t),V(r);const s=n.length/3,o=m.generateTopUV(i,n,s-3,s-2,s-1);U(o[0]),U(o[1]),U(o[2])}function B(e,t,r,s){V(e),V(t),V(s),V(t),V(r),V(s);const o=n.length/3,a=m.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);U(a[0]),U(a[1]),U(a[3]),U(a[1]),U(a[2]),U(a[3])}function V(e){n.push(s[3*e+0]),n.push(s[3*e+1]),n.push(s[3*e+2])}function U(e){r.push(e.x),r.push(e.y)}!function(){const e=n.length/3;if(h){let e=0,t=C*e;for(let e=0;e<N;e++){const i=T[e];F(i[2]+t,i[1]+t,i[0]+t)}e=a+2*f,t=C*e;for(let e=0;e<N;e++){const i=T[e];F(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<N;e++){const t=T[e];F(t[2],t[1],t[0])}for(let e=0;e<N;e++){const t=T[e];F(t[0]+C*a,t[1]+C*a,t[2]+C*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;k(A,t),t+=A.length;for(let e=0,i=_.length;e<i;e++){const i=_[e];k(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new ui(n,3)),this.setAttribute("uv",new ui(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);i.options=Object.assign({},t),void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const r=t[e.shapes[n]];i.push(r)}const n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=(new sa[n.type]).fromJSON(n)),new Ja(i,e.options)}}const Ka={generateTopUV:function(e,t,i,n,r){const s=t[3*i],o=t[3*i+1],a=t[3*n],l=t[3*n+1],h=t[3*r],c=t[3*r+1];return[new ge(s,o),new ge(a,l),new ge(h,c)]},generateSideWallUV:function(e,t,i,n,r,s){const o=t[3*i],a=t[3*i+1],l=t[3*i+2],h=t[3*n],c=t[3*n+1],u=t[3*n+2],d=t[3*r],f=t[3*r+1],p=t[3*r+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(a-c)<Math.abs(o-h)?[new ge(o,1-l),new ge(h,1-u),new ge(d,1-p),new ge(m,1-v)]:[new ge(a,1-l),new ge(c,1-u),new ge(f,1-p),new ge(g,1-v)]}};class Ya extends fa{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ya(e.radius,e.detail)}}class Za extends fa{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Za(e.radius,e.detail)}}class $a extends yi{constructor(e=.5,t=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const o=[],a=[],l=[],h=[];let c=e;const u=(t-e)/(n=Math.max(1,n)),d=new We,f=new ge;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){const n=r+e/i*s;d.x=c*Math.cos(n),d.y=c*Math.sin(n),a.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(d.x/t+1)/2,f.y=(d.y/t+1)/2,h.push(f.x,f.y)}c+=u}for(let e=0;e<n;e++){const t=e*(i+1);for(let e=0;e<i;e++){const n=e+t,r=n,s=n+i+1,a=n+i+2,l=n+1;o.push(r,s,l),o.push(s,a,l)}}this.setIndex(o),this.setAttribute("position",new ui(a,3)),this.setAttribute("normal",new ui(l,3)),this.setAttribute("uv",new ui(h,2))}static fromJSON(e){return new $a(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Qa extends yi{constructor(e=new ya([new ge(0,.5),new ge(-.5,-.5),new ge(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=n.length/3,l=e.extractPoints(t);let h=l.shape;const c=l.holes;!1===ja.isClockWise(h)&&(h=h.reverse());for(let e=0,t=c.length;e<t;e++){const t=c[e];!0===ja.isClockWise(t)&&(c[e]=t.reverse())}const u=ja.triangulateShape(h,c);for(let e=0,t=c.length;e<t;e++){const t=c[e];h=h.concat(t)}for(let e=0,t=h.length;e<t;e++){const t=h[e];n.push(t.x,t.y,0),r.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],n=t[0]+o,r=t[1]+o,s=t[2]+o;i.push(n,r,s),a+=3}}this.setIndex(i),this.setAttribute("position",new ui(n,3)),this.setAttribute("normal",new ui(r,3)),this.setAttribute("uv",new ui(s,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let n=0,r=e.shapes.length;n<r;n++){const r=t[e.shapes[n]];i.push(r)}return new Qa(i,e.curveSegments)}}class el extends yi{constructor(e=1,t=32,i=16,n=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(s+o,Math.PI);let l=0;const h=[],c=new We,u=new We,d=[],f=[],p=[],m=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let x=0;0==d&&0==s?x=.5/t:d==i&&a==Math.PI&&(x=-.5/t);for(let i=0;i<=t;i++){const a=i/t;c.x=-e*Math.cos(n+a*r)*Math.sin(s+v*o),c.y=e*Math.cos(s+v*o),c.z=e*Math.sin(n+a*r)*Math.sin(s+v*o),f.push(c.x,c.y,c.z),u.copy(c).normalize(),p.push(u.x,u.y,u.z),m.push(a+x,1-v),g.push(l++)}h.push(g)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=h[e][n+1],r=h[e][n],o=h[e+1][n],l=h[e+1][n+1];(0!==e||s>0)&&d.push(t,r,l),(e!==i-1||a<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new ui(f,3)),this.setAttribute("normal",new ui(p,3)),this.setAttribute("uv",new ui(m,2))}static fromJSON(e){return new el(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class tl extends fa{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new tl(e.radius,e.detail)}}class il extends yi{constructor(e=1,t=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],o=[],a=[],l=[],h=new We,c=new We,u=new We;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const f=d/n*r,p=s/i*Math.PI*2;c.x=(e+t*Math.cos(p))*Math.cos(f),c.y=(e+t*Math.cos(p))*Math.sin(f),c.z=t*Math.sin(p),o.push(c.x,c.y,c.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),u.subVectors(c,h).normalize(),a.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,o=(n+1)*(e-1)+t,a=(n+1)*e+t;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new ui(o,3)),this.setAttribute("normal",new ui(a,3)),this.setAttribute("uv",new ui(l,2))}static fromJSON(e){return new il(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class nl extends yi{constructor(e=1,t=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],h=[],c=new We,u=new We,d=new We,f=new We,p=new We,m=new We,g=new We;for(let o=0;o<=i;++o){const x=o/i*r*Math.PI*2;v(x,r,s,e,d),v(x+.01,r,s,e,f),m.subVectors(f,d),g.addVectors(f,d),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=n;++e){const r=e/n*Math.PI*2,s=-t*Math.cos(r),f=t*Math.sin(r);c.x=d.x+(s*g.x+f*p.x),c.y=d.y+(s*g.y+f*p.y),c.z=d.z+(s*g.z+f*p.z),a.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(o/i),h.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),s=(n+1)*e+t,a=(n+1)*(e-1)+t;o.push(i,r,a),o.push(r,s,a)}function v(e,t,i,n,r){const s=Math.cos(e),o=Math.sin(e),a=i/t*e,l=Math.cos(a);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*o*.5,r.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new ui(a,3)),this.setAttribute("normal",new ui(l,3)),this.setAttribute("uv",new ui(h,2))}static fromJSON(e){return new nl(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class rl extends yi{constructor(e=new na(new We(-1,-1,0),new We(-1,1,0),new We(1,1,0)),t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};const s=e.computeFrenetFrames(t,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new We,a=new We,l=new ge;let h=new We;const c=[],u=[],d=[],f=[];function p(r){h=e.getPointAt(r/t,h);const l=s.normals[r],d=s.binormals[r];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,r=Math.sin(t),s=-Math.cos(t);a.x=s*l.x+r*d.x,a.y=s*l.y+r*d.y,a.z=s*l.z+r*d.z,a.normalize(),u.push(a.x,a.y,a.z),o.x=h.x+i*a.x,o.y=h.y+i*a.y,o.z=h.z+i*a.z,c.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),s=(n+1)*e+t,o=(n+1)*(e-1)+t;f.push(i,r,o),f.push(r,s,o)}}()}(),this.setIndex(f),this.setAttribute("position",new ui(c,3)),this.setAttribute("normal",new ui(u,3)),this.setAttribute("uv",new ui(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new rl((new sa[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}function sl(e,t,i){const n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var ol=Object.freeze({__proto__:null,BoxGeometry:Bi,CapsuleGeometry:ha,CircleGeometry:ca,ConeGeometry:da,CylinderGeometry:ua,DodecahedronGeometry:pa,EdgesGeometry:class extends yi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const i=4,n=Math.pow(10,i),r=Math.cos(re*t),s=e.getIndex(),o=e.getAttribute("position"),a=s?s.count:o.count,l=[0,0,0],h=["a","b","c"],c=new Array(3),u={},d=[];for(let e=0;e<a;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:i,c:a}=xa;if(t.fromBufferAttribute(o,l[0]),i.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),xa.getNormal(va),c[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,c[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,c[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=c[e],n=c[t],s=xa[h[e]],o=xa[h[t]],a=`${i}_${n}`,f=`${n}_${i}`;f in u&&u[f]?(va.dot(u[f].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(o.x,o.y,o.z)),u[f]=null):a in u||(u[a]={index0:l[e],index1:l[t],normal:va.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:i}=u[e];ma.fromBufferAttribute(o,t),ga.fromBufferAttribute(o,i),d.push(ma.x,ma.y,ma.z),d.push(ga.x,ga.y,ga.z)}this.setAttribute("position",new ui(d,3))}}},ExtrudeGeometry:Ja,IcosahedronGeometry:Ya,LatheGeometry:la,OctahedronGeometry:Za,PlaneGeometry:on,PolyhedronGeometry:fa,RingGeometry:$a,ShapeGeometry:Qa,SphereGeometry:el,TetrahedronGeometry:tl,TorusGeometry:il,TorusKnotGeometry:nl,TubeGeometry:rl,WireframeGeometry:class extends yi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,n=new We,r=new We;if(null!==e.index){const s=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],h=l.start;for(let e=h,a=h+l.count;e<a;e+=3)for(let a=0;a<3;a++){const l=o.getX(e+a),h=o.getX(e+(a+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,h),!0===sl(n,r,i)&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}}else{const s=e.attributes.position;for(let e=0,o=s.count/3;e<o;e++)for(let o=0;o<3;o++){const a=3*e+o,l=3*e+(o+1)%3;n.fromBufferAttribute(s,a),r.fromBufferAttribute(s,l),!0===sl(n,r,i)&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new ui(t,3))}}}});class al extends ri{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Pe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class ll extends Gi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hl extends ri{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Pe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=q,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class cl extends hl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ge(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ae(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Pe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Pe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Pe(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class ul extends ri{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Pe(16777215),this.specular=new Pe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=q,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dl extends ri{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Pe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=q,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class fl extends ri{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=q,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class pl extends ri{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Pe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=q,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ml extends ri{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Pe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=q,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class gl extends Ao{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function vl(e,t,i){return yl(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function xl(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function yl(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function bl(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i}function wl(e,t,i){const n=e.length,r=new e.constructor(n);for(let s=0,o=0;o!==n;++s){const n=i[s]*t;for(let i=0;i!==t;++i)r[o++]=e[n+i]}return r}function Ml(e,t,i,n){let r=1,s=e[0];for(;void 0!==s&&void 0===s[n];)s=e[r++];if(void 0===s)return;let o=s[n];if(void 0!==o)if(Array.isArray(o))do{o=s[n],void 0!==o&&(t.push(s.time),i.push.apply(i,o)),s=e[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[n],void 0!==o&&(t.push(s.time),o.toArray(i,i.length)),s=e[r++]}while(void 0!==s);else do{o=s[n],void 0!==o&&(t.push(s.time),i.push(o)),s=e[r++]}while(void 0!==s)}class Sl{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let s;i:{n:if(!(e<n)){for(let s=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=t[++i],e<n)break t}s=t.length;break i}if(e>=r)break e;{const o=t[1];e<o&&(i=2,r=o);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=t[--i-1],e>=r)break t}s=i,i=0}}for(;i<s;){const n=i+s>>>1;e<t[n]?s=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class _l extends Sl{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:V,endingEnd:V}}intervalChanged_(e,t,i){const n=this.parameterPositions;let r=e-2,s=e+1,o=n[r],a=n[s];if(void 0===o)switch(this.getSettings_().endingStart){case U:r=e,o=2*t-i;break;case H:r=n.length-2,o=t+n[r]-n[r+1];break;default:r=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case U:s=e,a=2*i-t;break;case H:s=1,a=i+n[1]-n[0];break;default:s=e-1,a=t}const l=.5*(i-t),h=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,f=(i-t)/(n-t),p=f*f,m=p*f,g=-u*m+2*u*p-u*f,v=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*f+1,x=(-1-d)*m+(1.5+d)*p+.5*f,y=d*m-d*p;for(let e=0;e!==o;++e)r[e]=g*s[h+e]+v*s[l+e]+x*s[a+e]+y*s[c+e];return r}}class Tl extends Sl{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,h=(i-t)/(n-t),c=1-h;for(let e=0;e!==o;++e)r[e]=s[l+e]*c+s[a+e]*h;return r}}class Al extends Sl{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class El{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=xl(t,this.TimeBufferType),this.values=xl(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:xl(e.times,Array),values:xl(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Al(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Tl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new _l(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case z:t=this.InterpolantFactoryMethodDiscrete;break;case F:t=this.InterpolantFactoryMethodLinear;break;case B:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return z;case this.InterpolantFactoryMethodLinear:return F;case this.InterpolantFactoryMethodSmooth:return B}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==s&&i[s]>t;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const e=this.getValueSize();this.times=vl(i,r,s),this.values=vl(this.values,r*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let t=0;t!==r;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,s),e=!1;break}s=n}if(void 0!==n&&yl(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=vl(this.times),t=vl(this.values),i=this.getValueSize(),n=this.getInterpolation()===B,r=e.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(n)r=!0;else{const e=o*i,n=e-i,s=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[n+o]||i!==t[s+o]){r=!0;break}}}if(r){if(o!==s){e[s]=e[o];const n=o*i,r=s*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++s}}if(r>0){e[s]=e[r];for(let e=r*i,n=s*i,o=0;o!==i;++o)t[n+o]=t[e+o];++s}return s!==e.length?(this.times=vl(e,0,s),this.values=vl(t,0,s*i)):(this.times=e,this.values=t),this}clone(){const e=vl(this.times,0),t=vl(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}El.prototype.TimeBufferType=Float32Array,El.prototype.ValueBufferType=Float32Array,El.prototype.DefaultInterpolation=F;class Cl extends El{}Cl.prototype.ValueTypeName="bool",Cl.prototype.ValueBufferType=Array,Cl.prototype.DefaultInterpolation=z,Cl.prototype.InterpolantFactoryMethodLinear=void 0,Cl.prototype.InterpolantFactoryMethodSmooth=void 0;class Nl extends El{}Nl.prototype.ValueTypeName="color";class Ll extends El{}Ll.prototype.ValueTypeName="number";class Rl extends Sl{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)Ge.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Pl extends El{InterpolantFactoryMethodLinear(e){return new Rl(this.times,this.values,this.getValueSize(),e)}}Pl.prototype.ValueTypeName="quaternion",Pl.prototype.DefaultInterpolation=F,Pl.prototype.InterpolantFactoryMethodSmooth=void 0;class Dl extends El{}Dl.prototype.ValueTypeName="string",Dl.prototype.ValueBufferType=Array,Dl.prototype.DefaultInterpolation=z,Dl.prototype.InterpolantFactoryMethodLinear=void 0,Dl.prototype.InterpolantFactoryMethodSmooth=void 0;class Il extends El{}Il.prototype.ValueTypeName="vector";class Ol{constructor(e,t=-1,i,n=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=oe(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push(kl(i[e]).scale(n));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(El.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const r=t.length,s=[];for(let e=0;e<r;e++){let o=[],a=[];o.push((e+r-1)%r,e,(e+1)%r),a.push(0,1,0);const l=bl(o);o=wl(o,1,l),a=wl(a,1,l),n||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new Ll(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.name.match(r);if(s&&s.length>1){const e=s[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const s=[];for(const e in n)s.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,r){if(0!==i.length){const s=[],o=[];Ml(i,s,o,n),0!==s.length&&r.push(new e(t,s,o))}},n=[],r=e.name||"default",s=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let i=0;i<r[t].morphTargets.length;i++)e[r[t].morphTargets[i]]=-1;for(const i in e){const e=[],s=[];for(let n=0;n!==r[t].morphTargets.length;++n){const n=r[t];e.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new Ll(".morphTargetInfluence["+i+"]",e,s))}a=e.length*s}else{const s=".bones["+t[e].name+"]";i(Il,s+".position",r,"pos",n),i(Pl,s+".quaternion",r,"rot",n),i(Il,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,a,n,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function kl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ll;case"vector":case"vector2":case"vector3":case"vector4":return Il;case"color":return Nl;case"quaternion":return Pl;case"bool":case"boolean":return Cl;case"string":return Dl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];Ml(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const zl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Fl{constructor(e,t,i){const n=this;let r,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===s&&void 0!==n.onStart&&n.onStart(e,o,a),s=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const Bl=new Fl;class Vl{constructor(e){this.manager=void 0!==e?e:Bl,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ul={};class Hl extends Error{constructor(e,t){super(e),this.response=t}}class Gl extends Vl{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=zl.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Ul[e])return void Ul[e].push({onLoad:t,onProgress:i,onError:n});Ul[e]=[],Ul[e].push({onLoad:t,onProgress:i,onError:n});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const i=Ul[e],n=t.body.getReader(),r=t.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const l=new ReadableStream({start(e){!function t(){n.read().then((({done:n,value:r})=>{if(n)e.close();else{a+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(r),t()}}))}()}});return new Response(l)}throw new Hl(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,o)));case"json":return e.json();default:if(void 0===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),i=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(i);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{zl.add(e,t);const i=Ul[e];delete Ul[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{const i=Ul[e];if(void 0===i)throw this.manager.itemError(e),t;delete Ul[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Wl extends Vl{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=zl.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o=we("img");function a(){h(),zl.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){h(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class jl extends Vl{constructor(e){super(e)}load(e,t,i,n){const r=new Fe,s=new Wl(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}}class Xl extends jt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Pe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class ql extends Xl{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(jt.DefaultUp),this.updateMatrix(),this.groundColor=new Pe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Jl=new bt,Kl=new We,Yl=new We;class Zl{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ge(512,512),this.map=null,this.mapPass=null,this.matrix=new bt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new nn,this._frameExtents=new ge(1,1),this._viewportCount=1,this._viewports=[new Be(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Kl.setFromMatrixPosition(e.matrixWorld),t.position.copy(Kl),Yl.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Yl),t.updateMatrixWorld(),Jl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jl),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Jl)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class $l extends Zl{constructor(){super(new ji(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*se*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;i===t.fov&&n===t.aspect&&r===t.far||(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Ql extends Xl{constructor(e,t,i=0,n=Math.PI/3,r=0,s=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(jt.DefaultUp),this.updateMatrix(),this.target=new jt,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new $l}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const eh=new bt,th=new We,ih=new We;class nh extends Zl{constructor(){super(new ji(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ge(4,2),this._viewportCount=6,this._viewports=[new Be(2,1,1,1),new Be(0,1,1,1),new Be(3,1,1,1),new Be(1,1,1,1),new Be(3,0,1,1),new Be(1,0,1,1)],this._cubeDirections=[new We(1,0,0),new We(-1,0,0),new We(0,0,1),new We(0,0,-1),new We(0,1,0),new We(0,-1,0)],this._cubeUps=[new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,0,1),new We(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),th.setFromMatrixPosition(e.matrixWorld),i.position.copy(th),ih.copy(i.position),ih.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(ih),i.updateMatrixWorld(),n.makeTranslation(-th.x,-th.y,-th.z),eh.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eh)}}class rh extends Xl{constructor(e,t,i=0,n=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new nh}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class sh extends Zl{constructor(){super(new gn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class oh extends Xl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(jt.DefaultUp),this.updateMatrix(),this.target=new jt,this.shadow=new sh}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class ah extends Xl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class lh extends Xl{constructor(e,t,i=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class hh{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new We)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*n),t.addScaledVector(s[2],.488603*r),t.addScaledVector(s[3],.488603*i),t.addScaledVector(s[4],i*n*1.092548),t.addScaledVector(s[5],n*r*1.092548),t.addScaledVector(s[6],.315392*(3*r*r-1)),t.addScaledVector(s[7],i*r*1.092548),t.addScaledVector(s[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,r=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*n),t.addScaledVector(s[2],1.023328*r),t.addScaledVector(s[3],1.023328*i),t.addScaledVector(s[4],.858086*i*n),t.addScaledVector(s[5],.858086*n*r),t.addScaledVector(s[6],.743125*r*r-.247708),t.addScaledVector(s[7],.858086*i*r),t.addScaledVector(s[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}class ch extends Xl{constructor(e=new hh,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class uh extends Vl{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=this,s=new Gl(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=uh.createMaterialFromType(e.type);if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=e.sheen),void 0!==e.sheenColor&&(n.sheenColor=(new Pe).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(n.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.specularIntensity&&(n.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(n.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(n.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(n.uniforms[t]={},r.type){case"t":n.uniforms[t].value=i(r.value);break;case"c":n.uniforms[t].value=(new Pe).setHex(r.value);break;case"v2":n.uniforms[t].value=(new ge).fromArray(r.value);break;case"v3":n.uniforms[t].value=(new We).fromArray(r.value);break;case"v4":n.uniforms[t].value=(new Be).fromArray(r.value);break;case"m3":n.uniforms[t].value=(new ve).fromArray(r.value);break;case"m4":n.uniforms[t].value=(new bt).fromArray(r.value);break;default:n.uniforms[t].value=r.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(n.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new ge).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(n.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(n.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new ge).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(n.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(n.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=i(e.thicknessMap)),void 0!==e.sheenColorMap&&(n.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(n.sheenRoughnessMap=i(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:al,SpriteMaterial:Hs,RawShaderMaterial:ll,ShaderMaterial:Gi,PointsMaterial:zo,MeshPhysicalMaterial:cl,MeshStandardMaterial:hl,MeshPhongMaterial:ul,MeshToonMaterial:dl,MeshNormalMaterial:fl,MeshLambertMaterial:pl,MeshDepthMaterial:ws,MeshDistanceMaterial:Ms,MeshBasicMaterial:si,MeshMatcapMaterial:ml,LineDashedMaterial:gl,LineBasicMaterial:Ao,Material:ri}[e]}}class dh{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class fh extends yi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class ph extends Vl{constructor(e){super(e)}load(e,t,i,n){const r=this,s=new Gl(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}}),i,n)}parse(e){const t={},i={};function n(e,n){if(void 0!==t[n])return t[n];const r=e.interleavedBuffers[n],s=function(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],r=new Uint32Array(n).buffer;return i[t]=r,r}(e,r.buffer),o=be(r.type,s),a=new Bs(o,r.stride);return a.uuid=r.uuid,t[n]=a,a}const r=e.isInstancedBufferGeometry?new fh:new yi,s=e.data.index;if(void 0!==s){const e=be(s.type,s.array);r.setIndex(new li(e,1))}const o=e.data.attributes;for(const t in o){const i=o[t];let s;if(i.isInterleavedBufferAttribute){const t=n(e.data,i.data);s=new Us(t,i.itemSize,i.offset,i.normalized)}else{const e=be(i.type,i.array);s=new(i.isInstancedBufferAttribute?yo:li)(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(t,s)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],s=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];let o;if(r.isInterleavedBufferAttribute){const t=n(e.data,r.data);o=new Us(t,r.itemSize,r.offset,r.normalized)}else{const e=be(r.type,r.array);o=new li(e,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),s.push(o)}r.morphAttributes[t]=s}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const h=e.data.boundingSphere;if(void 0!==h){const e=new We;void 0!==h.center&&e.fromArray(h.center),r.boundingSphere=new ut(e,h.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class mh extends Vl{constructor(e){super(e)}load(e,t,i,n){const r=this,s=""===this.path?dh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new Gl(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){let s=null;try{s=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)}async loadAsync(e,t){const i=""===this.path?dh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const n=new Gl(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(e,t),s=JSON.parse(r),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,i),h=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,h),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,s),a=this.parseObject(e.object,n,o,s,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){const n=(new ya).fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new xo).fromJSON(e[t],n);i[r.uuid]=r}return i}parseGeometries(e,t){const i={};if(void 0!==e){const n=new ph;for(let r=0,s=e.length;r<s;r++){let s;const o=e[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(o);break;default:o.type in ol?s=ol[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(e,t){const i={},n={};if(void 0!==e){const r=new uh;r.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i],r=Ol.parse(n);t[r.uuid]=r}return t}parseImages(e,t){const i=this,n={};let r;function s(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),r.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:be(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new Fl(t);r=new Wl(i),r.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.url;if(Array.isArray(r)){const e=[];for(let t=0,i=r.length;t<i;t++){const i=s(r[t]);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new mo(i.data,i.width,i.height)))}n[i.uuid]=new Oe(e)}else{const e=s(i.url);n[i.uuid]=new Oe(e)}}}return n}async parseImagesAsync(e){const t=this,i={};let n;async function r(e){if("string"==typeof e){const i=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:t.resourcePath+i;return await n.loadAsync(r)}return e.data?{data:be(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){n=new Wl(this.manager),n.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.url;if(Array.isArray(s)){const e=[];for(let t=0,i=s.length;t<i;t++){const i=s[t],n=await r(i);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new mo(n.data,n.width,n.height)))}i[n.uuid]=new Oe(e)}else{const e=await r(n.url);i[n.uuid]=new Oe(e)}}}return i}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let r=0,s=e.length;r<s;r++){const s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=t[s.image],a=o.data;let l;Array.isArray(a)?(l=new Ji,6===a.length&&(l.needsUpdate=!0)):(l=a&&a.data?new mo:new Fe,a&&(l.needsUpdate=!0)),l.source=o,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,gh)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],vh),l.wrapT=i(s.wrap[1],vh)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,xh)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,xh)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),n[s.uuid]=l}return n}parseObject(e,t,i,n,r){let s,o,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function h(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(i[r])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}function c(e){return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),n[e]}switch(e.type){case"Scene":s=new Fs,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new Pe(e.background):s.background=c(e.background)),void 0!==e.environment&&(s.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new zs(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new ks(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness);break;case"PerspectiveCamera":s=new ji(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new gn(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new ah(e.color,e.intensity);break;case"DirectionalLight":s=new oh(e.color,e.intensity);break;case"PointLight":s=new rh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new lh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Ql(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new ql(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new ch).fromJSON(e);break;case"SkinnedMesh":o=l(e.geometry),a=h(e.material),s=new fo(o,a),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":o=l(e.geometry),a=h(e.material),s=new zi(o,a);break;case"InstancedMesh":o=l(e.geometry),a=h(e.material);const t=e.count,i=e.instanceMatrix,n=e.instanceColor;s=new To(o,a,t),s.instanceMatrix=new yo(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new yo(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new oo;break;case"Line":s=new Po(l(e.geometry),h(e.material));break;case"LineLoop":s=new ko(l(e.geometry),h(e.material));break;case"LineSegments":s=new Oo(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":s=new Ho(l(e.geometry),h(e.material));break;case"Sprite":s=new io(h(e.material));break;case"Group":s=new Cs;break;case"Bone":s=new po;break;default:s=new jt}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)s.add(this.parseObject(o[e],t,i,n,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];s.animations.push(r[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}}const gh={UVMapping:300,CubeReflectionMapping:u,CubeRefractionMapping:d,EquirectangularReflectionMapping:f,EquirectangularRefractionMapping:p,CubeUVReflectionMapping:m},vh={RepeatWrapping:g,ClampToEdgeWrapping:v,MirroredRepeatWrapping:x},xh={NearestFilter:y,NearestMipmapNearestFilter:b,NearestMipmapLinearFilter:w,LinearFilter:M,LinearMipmapNearestFilter:S,LinearMipmapLinearFilter:_};class yh extends Vl{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=zl.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout((function(){t&&t(s),r.manager.itemEnd(e)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){zl.add(e,i),t&&t(i),r.manager.itemEnd(e)})).catch((function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}class bh{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=wh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=wh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function wh(){return("undefined"==typeof performance?Date:performance).now()}const Mh="\\[\\]\\.:\\/",Sh=new RegExp("[\\[\\]\\.:\\/]","g"),_h="[^\\[\\]\\.:\\/]",Th="[^"+Mh.replace("\\.","")+"]",Ah=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",_h)+/(WCOD+)?/.source.replace("WCOD",Th)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_h)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_h)+"$"),Eh=["material","materials","bones","map"];class Ch{constructor(e,t,i){this.path=t,this.parsedPath=i||Ch.parseTrackName(t),this.node=Ch.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Ch.Composite(e,t,i):new Ch(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Sh,"")}static parseTrackName(e){const t=Ah.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==Eh.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const r=e[n];if(r.name===t||r.uuid===t)return r;const s=i(r.children);if(s)return s}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let r=t.propertyIndex;if(e||(e=Ch.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const s=e[n];if(void 0===s){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ch.Composite=class{constructor(e,t,i){const n=i||Ch.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Ch.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ch.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ch.prototype.GetterByBindingType=[Ch.prototype._getValue_direct,Ch.prototype._getValue_array,Ch.prototype._getValue_arrayElement,Ch.prototype._getValue_toArray],Ch.prototype.SetterByBindingTypeAndVersioning=[[Ch.prototype._setValue_direct,Ch.prototype._setValue_direct_setNeedsUpdate,Ch.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ch.prototype._setValue_array,Ch.prototype._setValue_array_setNeedsUpdate,Ch.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ch.prototype._setValue_arrayElement,Ch.prototype._setValue_arrayElement_setNeedsUpdate,Ch.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ch.prototype._setValue_fromArray,Ch.prototype._setValue_fromArray_setNeedsUpdate,Ch.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);class Nh{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ae(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Lh extends Oo{constructor(e=10,t=10,i=4473924,n=8947848){i=new Pe(i),n=new Pe(n);const r=t/2,s=e/t,o=e/2,a=[],l=[];for(let e=0,h=0,c=-o;e<=t;e++,c+=s){a.push(-o,0,c,o,0,c),a.push(c,0,-o,c,0,o);const t=e===r?i:n;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}const h=new yi;h.setAttribute("position",new ui(a,3)),h.setAttribute("color",new ui(l,3));super(h,new Ao({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)})),r.register("6WmIx",(function(t,i){e(t.exports,"OrbitControls",(()=>l));var n=r("4xklQ");const s={type:"change"},o={type:"start"},a={type:"end"};class l extends n.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new(0,n.Vector3),this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.MOUSE.ROTATE,MIDDLE:n.MOUSE.DOLLY,RIGHT:n.MOUSE.PAN},this.touches={ONE:n.TOUCH.ROTATE,TWO:n.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",q),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(s),i.update(),l=r.NONE},this.update=function(){const t=new(0,n.Vector3),o=(new(0,n.Quaternion)).setFromUnitVectors(e.up,new(0,n.Vector3)(0,1,0)),a=o.clone().invert(),m=new(0,n.Vector3),g=new(0,n.Quaternion),v=2*Math.PI;return function(){const e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(o),c.setFromVector3(t),i.autoRotate&&l===r.NONE&&E(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(c.theta+=u.theta*i.dampingFactor,c.phi+=u.phi*i.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let n=i.minAzimuthAngle,x=i.maxAzimuthAngle;return isFinite(n)&&isFinite(x)&&(n<-Math.PI?n+=v:n>Math.PI&&(n-=v),x<-Math.PI?x+=v:x>Math.PI&&(x-=v),c.theta=n<=x?Math.max(n,Math.min(x,c.theta)):c.theta>(n+x)/2?Math.max(n,c.theta):Math.min(x,c.theta)),c.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=d,c.radius=Math.max(i.minDistance,Math.min(i.maxDistance,c.radius)),!0===i.enableDamping?i.target.addScaledVector(f,i.dampingFactor):i.target.add(f),t.setFromSpherical(c),t.applyQuaternion(a),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(u.theta*=1-i.dampingFactor,u.phi*=1-i.dampingFactor,f.multiplyScalar(1-i.dampingFactor)):(u.set(0,0,0),f.set(0,0,0)),d=1,!!(p||m.distanceToSquared(i.object.position)>h||8*(1-g.dot(i.object.quaternion))>h)&&(i.dispatchEvent(s),m.copy(i.object.position),g.copy(i.object.quaternion),p=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",J),i.domElement.removeEventListener("pointerdown",H),i.domElement.removeEventListener("pointercancel",j),i.domElement.removeEventListener("wheel",X),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",W),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",q)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=r.NONE;const h=1e-6,c=new(0,n.Spherical),u=new(0,n.Spherical);let d=1;const f=new(0,n.Vector3);let p=!1;const m=new(0,n.Vector2),g=new(0,n.Vector2),v=new(0,n.Vector2),x=new(0,n.Vector2),y=new(0,n.Vector2),b=new(0,n.Vector2),w=new(0,n.Vector2),M=new(0,n.Vector2),S=new(0,n.Vector2),_=[],T={};function A(){return Math.pow(.95,i.zoomSpeed)}function E(e){u.theta-=e}function C(e){u.phi-=e}const N=function(){const e=new(0,n.Vector3);return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),f.add(e)}}(),L=function(){const e=new(0,n.Vector3);return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),f.add(e)}}(),R=function(){const e=new(0,n.Vector3);return function(t,n){const r=i.domElement;if(i.object.isPerspectiveCamera){const s=i.object.position;e.copy(s).sub(i.target);let o=e.length();o*=Math.tan(i.object.fov/2*Math.PI/180),N(2*t*o/r.clientHeight,i.object.matrix),L(2*n*o/r.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(N(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),L(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function P(e){i.object.isPerspectiveCamera?d/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function D(e){i.object.isPerspectiveCamera?d*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function I(e){m.set(e.clientX,e.clientY)}function O(e){x.set(e.clientX,e.clientY)}function k(){if(1===_.length)m.set(_[0].pageX,_[0].pageY);else{const e=.5*(_[0].pageX+_[1].pageX),t=.5*(_[0].pageY+_[1].pageY);m.set(e,t)}}function z(){if(1===_.length)x.set(_[0].pageX,_[0].pageY);else{const e=.5*(_[0].pageX+_[1].pageX),t=.5*(_[0].pageY+_[1].pageY);x.set(e,t)}}function F(){const e=_[0].pageX-_[1].pageX,t=_[0].pageY-_[1].pageY,i=Math.sqrt(e*e+t*t);w.set(0,i)}function B(e){if(1==_.length)g.set(e.pageX,e.pageY);else{const t=Z(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);g.set(i,n)}v.subVectors(g,m).multiplyScalar(i.rotateSpeed);const t=i.domElement;E(2*Math.PI*v.x/t.clientHeight),C(2*Math.PI*v.y/t.clientHeight),m.copy(g)}function V(e){if(1===_.length)y.set(e.pageX,e.pageY);else{const t=Z(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);y.set(i,n)}b.subVectors(y,x).multiplyScalar(i.panSpeed),R(b.x,b.y),x.copy(y)}function U(e){const t=Z(e),n=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(n*n+r*r);M.set(0,s),S.set(0,Math.pow(M.y/w.y,i.zoomSpeed)),P(S.y),w.copy(M)}function H(e){!1!==i.enabled&&(0===_.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",G),i.domElement.addEventListener("pointerup",W)),function(e){_.push(e)}(e),"touch"===e.pointerType?function(e){switch(Y(e),_.length){case 1:switch(i.touches.ONE){case n.TOUCH.ROTATE:if(!1===i.enableRotate)return;k(),l=r.TOUCH_ROTATE;break;case n.TOUCH.PAN:if(!1===i.enablePan)return;z(),l=r.TOUCH_PAN;break;default:l=r.NONE}break;case 2:switch(i.touches.TWO){case n.TOUCH.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&F(),i.enablePan&&z(),l=r.TOUCH_DOLLY_PAN;break;case n.TOUCH.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&F(),i.enableRotate&&k(),l=r.TOUCH_DOLLY_ROTATE;break;default:l=r.NONE}break;default:l=r.NONE}l!==r.NONE&&i.dispatchEvent(o)}(e):function(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.MOUSE.DOLLY:if(!1===i.enableZoom)return;!function(e){w.set(e.clientX,e.clientY)}(e),l=r.DOLLY;break;case n.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;O(e),l=r.PAN}else{if(!1===i.enableRotate)return;I(e),l=r.ROTATE}break;case n.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;I(e),l=r.ROTATE}else{if(!1===i.enablePan)return;O(e),l=r.PAN}break;default:l=r.NONE}l!==r.NONE&&i.dispatchEvent(o)}(e))}function G(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(Y(e),l){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;B(e),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;V(e),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&U(e),i.enablePan&&V(e)}(e),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&U(e),i.enableRotate&&B(e)}(e),i.update();break;default:l=r.NONE}}(e):function(e){switch(l){case r.ROTATE:if(!1===i.enableRotate)return;!function(e){g.set(e.clientX,e.clientY),v.subVectors(g,m).multiplyScalar(i.rotateSpeed);const t=i.domElement;E(2*Math.PI*v.x/t.clientHeight),C(2*Math.PI*v.y/t.clientHeight),m.copy(g),i.update()}(e);break;case r.DOLLY:if(!1===i.enableZoom)return;!function(e){M.set(e.clientX,e.clientY),S.subVectors(M,w),S.y>0?P(A()):S.y<0&&D(A()),w.copy(M),i.update()}(e);break;case r.PAN:if(!1===i.enablePan)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,x).multiplyScalar(i.panSpeed),R(b.x,b.y),x.copy(y),i.update()}(e)}}(e))}function W(e){K(e),0===_.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",G),i.domElement.removeEventListener("pointerup",W)),i.dispatchEvent(a),l=r.NONE}function j(e){K(e)}function X(e){!1!==i.enabled&&!1!==i.enableZoom&&l===r.NONE&&(e.preventDefault(),i.dispatchEvent(o),function(e){e.deltaY<0?D(A()):e.deltaY>0&&P(A()),i.update()}(e),i.dispatchEvent(a))}function q(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:R(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:R(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:R(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:R(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function J(e){!1!==i.enabled&&e.preventDefault()}function K(e){delete T[e.pointerId];for(let t=0;t<_.length;t++)if(_[t].pointerId==e.pointerId)return void _.splice(t,1)}function Y(e){let t=T[e.pointerId];void 0===t&&(t=new(0,n.Vector2),T[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Z(e){const t=e.pointerId===_[0].pointerId?_[1]:_[0];return T[t.pointerId]}i.domElement.addEventListener("contextmenu",J),i.domElement.addEventListener("pointerdown",H),i.domElement.addEventListener("pointercancel",j),i.domElement.addEventListener("wheel",X,{passive:!1}),this.update()}}})),r.register("9CUYQ",(function(t,i){e(t.exports,"GridMapHelper",(()=>o));var n=r("4xklQ"),s=r("apQQe");class o{constructor(e=10,t="rgb(0,0,0)",i="rgb(200,200,200)"){this.divisions=e,this.divisionsColor=t,this.planeColor=i,this.initialX=-1*(e-1),this.initialZ=-1*(e-1),this.endX=e-1,this.endZ=e-1,this.obstacles=[],this.traps=[],this.holes=[],this.fireHoles=[]}createGridPlane(){let e=new n.PlaneGeometry(this.getMultiplier()*this.divisions,this.getMultiplier()*this.divisions,this.divisions,this.divisions),t=new n.GridHelper(this.getMultiplier()*this.divisions,this.divisions,this.divisionsColor,this.divisionsColor);t.rotateX((0,s.degreeToRadians)(90)),t.translateY(.02);let i=new n.MeshLambertMaterial({color:this.planeColor,side:n.DoubleSide}),r=new n.Mesh(e,i);return r.add(t),r.receiveShadow=!0,r.rotateX((0,s.degreeToRadians)(-90)),r}getGlobalXPositionFromCoord(e){return this.initialX+this.getMultiplier()*e}getGlobalZPositionFromCoord(e){return this.initialZ+this.getMultiplier()*e}getXCoordFromGlobalPosition(e,t=0){let i;return i=1==t?Math.floor((Math.floor(e)-this.initialX)/this.getMultiplier()):2==t?Math.ceil((Math.ceil(e)-this.initialX)/this.getMultiplier()):Math.round((Math.round(e)-this.initialX)/this.getMultiplier()),i}getZCoordFromGlobalPosition(e,t=0){let i;return i=1==t?Math.floor((Math.floor(e)-this.initialZ)/this.getMultiplier()):2==t?Math.ceil((Math.ceil(e)-this.initialZ)/this.getMultiplier()):Math.round((Math.round(e)-this.initialZ)/this.getMultiplier()),i}getMultiplier(){return 2}borderXOfMap(e,t){return!(this.getXCoordFromGlobalPosition(e,t)>=0&&this.getXCoordFromGlobalPosition(e,t)<=this.getXCoordFromGlobalPosition(this.endX))}borderZOfMap(e,t){return!(this.getXCoordFromGlobalPosition(e,t)>=0&&this.getXCoordFromGlobalPosition(e,t)<=this.getXCoordFromGlobalPosition(this.endZ))}borderMapCollision(e,t){let i=e.x>=t.x?1:2,n=e.z>=t.z?1:2;return!(!this.borderXOfMap(e.x,i)&&!this.borderZOfMap(e.z,n))}addObstacle(e,t,i,n){this.obstacles.push({minX:e,maxX:t,minZ:i,maxZ:n})}obstacleCollision(e,t,i){let n,r,s=this.getXCoordFromGlobalPosition(e.x),o=this.getZCoordFromGlobalPosition(e.z),a=this.getXCoordFromGlobalPosition(t.x),l=this.getZCoordFromGlobalPosition(t.z);return n=s<a?s+1:s>a?s-1:s,r=o<l?o+1:o>l?o-1:o,!(n<i.minX||r<i.minZ||n>i.maxX||r>i.maxZ)}addTrap(e,t){this.traps.push({x:e,z:t})}addHole(e,t){let i={id:this.holes.length,x:e,z:t,active:!0};return this.holes.push(i),i.id}addFireHole(e,t){let i={id:this.fireHoles.length,x:e,z:t,active:!0};return this.fireHoles.push(i),i.id}holeCollision(e){let t=this.holes.filter((e=>1==e.active));for(let i=0;i<t.length;i++)if(this.getXCoordFromGlobalPosition(e.x)==t[i].x&&this.getZCoordFromGlobalPosition(e.z)==t[i].z)return(0,s.printOnConsole)("Você caiu no buraco!"),!0;return!1}fireHoleCollision(e){let t=this.fireHoles.filter((e=>1==e.active));for(let i=0;i<t.length;i++)if(this.getXCoordFromGlobalPosition(e.x)==t[i].x&&this.getZCoordFromGlobalPosition(e.z)==t[i].z)return(0,s.printOnConsole)("Robô foi queimado!"),!0;return!1}detectHole(e,t="fire"){if("fire"==t){let t=this.fireHoles.filter((e=>1==e.active));for(let i=0;i<t.length;i++)if(1==Math.abs(this.getXCoordFromGlobalPosition(e.x)-t[i].x)&&this.getZCoordFromGlobalPosition(e.z)==t[i].z||this.getXCoordFromGlobalPosition(e.x)==t[i].x&&1==Math.abs(this.getZCoordFromGlobalPosition(e.z)-t[i].z))return t[i].id;return null}{let t=this.holes.filter((e=>1==e.active));for(let i=0;i<t.length;i++)if(1==Math.abs(this.getXCoordFromGlobalPosition(e.x)-t[i].x)&&this.getZCoordFromGlobalPosition(e.z)==t[i].z||this.getXCoordFromGlobalPosition(e.x)==t[i].x&&1==Math.abs(this.getZCoordFromGlobalPosition(e.z)-t[i].z))return t[i].id;return null}}deactivateHole(e,t="common"){let i=this.detectHole(e,t);if(null!=i){if("common"==t){let e=this.holes.map((e=>e.id)).indexOf(i);return this.holes[e].active=!1,!0}if("fire"==t){let e=this.fireHoles.map((e=>e.id)).indexOf(i);return this.fireHoles[e].active=!1,!0}return console.log("tipo errado"),!1}return(0,s.printOnConsole)("Não posso fazer isso aqui!"),!1}restartHoles(){for(let e=0;e<this.holes.length;e++)this.holes[e].active=!0;for(let e=0;e<this.fireHoles.length;e++)this.fireHoles[e].active=!0}trapCollision(e){for(let t=0;t<this.traps.length;t++)if(this.getXCoordFromGlobalPosition(e.x)==this.traps[t].x&&this.getZCoordFromGlobalPosition(e.z)==this.traps[t].z)return!0;return!1}collisionTests(e,t){if(this.borderMapCollision(e,t)){let i=new n.Vector3(this.getGlobalXPositionFromCoord(this.getXCoordFromGlobalPosition(e.x)),t.y,this.getGlobalZPositionFromCoord(this.getZCoordFromGlobalPosition(e.z)));return(0,s.printOnConsole)("Aviso: Não é possível avançar mais por este caminho, seguindo para o próximo comando."),i}for(let i=0;i<this.obstacles.length;i++)if(this.obstacleCollision(e,t,this.obstacles[i])){let i=new n.Vector3(this.getGlobalXPositionFromCoord(this.getXCoordFromGlobalPosition(e.x)),t.y,this.getGlobalZPositionFromCoord(this.getZCoordFromGlobalPosition(e.z)));return(0,s.printOnConsole)("Aviso: Não é possível avançar mais por este caminho, seguindo para o próximo comando."),i}return t}}})),r.register("apQQe",(function(t,i){e(t.exports,"degreeToRadians",(()=>x)),e(t.exports,"resizeCanvasToDisplaySize",(()=>y)),e(t.exports,"sceneProperties",(()=>b)),e(t.exports,"createFire",(()=>w)),e(t.exports,"translateActorFoward",(()=>S)),e(t.exports,"printOnConsole",(()=>C)),e(t.exports,"translateActorBackward",(()=>_)),e(t.exports,"rotateActorRight",(()=>T)),e(t.exports,"rotateActorLeft",(()=>A)),e(t.exports,"rotateActorUTurn",(()=>E)),e(t.exports,"printErrorOnConsole",(()=>N)),e(t.exports,"loadGLBFile",(()=>R)),e(t.exports,"loadOBJFile",(()=>P)),e(t.exports,"checkPhaseContinuity",(()=>D)),e(t.exports,"getTotalTime",(()=>I)),e(t.exports,"setTimeForNextPhase",(()=>O)),e(t.exports,"displayTime",(()=>k));var n=r("4xklQ"),s=r("hu0fb"),o=r("kt6vz");r("e6hrk");var a=r("1dTCL"),l=r("jNF4N"),h=r("d9q8O"),c=r("1qRuO"),u=r("8t2cG"),d=r("6gQ3M"),f=r("9bxft"),p=r("dNuj0"),m=r("8rDMm"),g=r("6JP6R"),v=r("7wZHW");function x(e){return e*(Math.PI/180)}function y(e,t){let i=e.domElement,n=i.clientWidth,r=i.clientHeight;i.width===n&&i.height===r||(e.setSize(n,r,!1),t.aspect=n/r,t.updateProjectionMatrix())}r("9CUYQ");var b={cancelExecution:!1,phaseTimer:new n.Clock(!1)};function w(e){const t=new n.ConeGeometry(1,1,5,5),i=new n.SphereGeometry(1,5,5),r=new n.BufferGeometry,s=[],o=[],x=[],y=t.getAttribute("position"),b=y.count;for(let e=0;e<b;e++)s.push(20+50*Math.random()),o.push(.3*Math.random()),x.push(2+15*Math.random());r.setAttribute("position",y),r.setAttribute("targetPosition",i.getAttribute("position")),r.setAttribute("particleSpeed",new n.Float32BufferAttribute(s,1)),r.setAttribute("particleIntensity",new n.Float32BufferAttribute(o,1)),r.setAttribute("particleSize",new n.Float32BufferAttribute(x,1));const w=(new n.TextureLoader).load(e),M=new a.default("targetPosition","vec3"),S=new a.default("particleSpeed","float"),_=new a.default("particleIntensity","float"),T=new a.default("particleSize","float"),A=new l.default,E=new h.default(new n.Vector2(6,6)),C=new c.default(E,new u.default,new d.default("*",A,S)),N=new f.default(w,C),L=new d.default("*",N,_),R=new p.default(0),P=new m.default(m.default.MIX,new g.default(g.default.LOCAL),M,R),D=new v.default({depthWrite:!1,transparent:!0,sizeAttenuation:!0,blending:n.AdditiveBlending});D.colorNode=L,D.sizeNode=T,D.positionNode=P;return new n.Points(r,D)}function M(e,t=!0,i=1){let r=e.clone();t?r.rotation.set(x(15*i),0,0):r.rotation.set(0,0,0);let s,o=new n.Quaternion;o.setFromEuler(r.rotation),s=requestAnimationFrame((function t(){e.quaternion.equals(o)||b.cancelExecution?cancelAnimationFrame(s):(e.quaternion.slerp(o,.2),s=requestAnimationFrame(t))}))}function S(e,t,i,n){let r=e.clone();r.translateZ(i.getMultiplier()*t);let s,o=r.position,a=.01;return M(e.getObjectByName("eve")),new Promise((function(t){s=requestAnimationFrame((function r(){o=i.collisionTests(e.position,o);let l=i.trapCollision(e.position),h=i.fireHoleCollision(e.position),c=i.holeCollision(e.position);e.position.x.toFixed(2)==o.x.toFixed(2)&&e.position.z.toFixed(2)==o.z.toFixed(2)||n.cancelExecution||l||c||h?(l&&!n.cancelExecution&&(C("Você caiu na armadilha."),n.cancelExecution=!0),M(e.getObjectByName("eve"),!1),cancelAnimationFrame(s),t()):(e.position.lerp(o,a),a+=.001,s=requestAnimationFrame(r))}))}))}function _(e,t,i,n){let r=e.clone();r.translateZ(-i.getMultiplier()*t);let s,o=r.position,a=.01;return M(e.getObjectByName("eve"),!0,-1),new Promise((function(t){s=requestAnimationFrame((function r(){o=i.collisionTests(e.position,o);let l=i.trapCollision(e.position),h=i.fireHoleCollision(e.position),c=i.holeCollision(e.position);e.position.x.toFixed(2)==o.x.toFixed(2)&&e.position.z.toFixed(2)==o.z.toFixed(2)||n.cancelExecution||l||c||h?(l&&!n.cancelExecution&&(C("Você caiu na armadilha."),n.cancelExecution=!0),M(e.getObjectByName("eve"),!1),cancelAnimationFrame(s),t()):(e.position.lerp(o,a),a+=.001,s=requestAnimationFrame(r))}))}))}function T(e,t){let i=e.clone();i.rotateY(x(-90));let r,s=new n.Quaternion;return s.setFromEuler(i.rotation),new Promise((function(i){r=requestAnimationFrame((function n(){e.quaternion.equals(s)||t.cancelExecution?(cancelAnimationFrame(r),i()):(e.quaternion.rotateTowards(s,x(1)),r=requestAnimationFrame(n))}))}))}function A(e,t){let i=e.clone();i.rotateY(x(90));let r,s=new n.Quaternion;return s.setFromEuler(i.rotation.clone()),new Promise((function(i){r=requestAnimationFrame((function n(){e.quaternion.equals(s)||t.cancelExecution?(cancelAnimationFrame(r),i()):(e.quaternion.rotateTowards(s,x(1)),r=requestAnimationFrame(n))}))}))}function E(e,t){let i=e.clone();i.rotateY(x(180));let r,s=new n.Quaternion;return s.setFromEuler(i.rotation),new Promise((function(i){r=requestAnimationFrame((function n(){e.quaternion.equals(s)||t.cancelExecution?(cancelAnimationFrame(r),i()):(e.quaternion.rotateTowards(s,x(1)),r=requestAnimationFrame(n))}))}))}function C(e){document.getElementById("console-printing").innerHTML+=`${e}<br>`}function N(e,t){document.getElementById("console-printing").innerHTML+=`Código Inválido:<br> ${e} linha: ${t}<br>`}function L(e,t){let i=function(e){let t,i=(new n.Box3).setFromObject(e),r=i.min,s=i.max,o=new n.Box3;return o.x=s.x-r.x,o.y=s.y-r.y,o.z=s.z-r.z,t=o.x>=o.y&&o.x>=o.z?o.x:o.y>=o.z?o.y:o.z,t}(e);e.scale.set(1*t/i,1*t/i,1*t/i)}function R(e,t,i,r){(new(0,s.GLTFLoader)).load(t,(function(t){let s=t.scene;s.name=i,s.visible=!0,s.traverse((function(e){e&&(e.castShadow=!0)})),s.traverse((function(e){e.material&&(e.material.side=n.DoubleSide)})),L(s,r),e.add(s)}))}function P(e,t,i,r,s){let a,l=new(0,o.OBJLoader),h=new n.TextureLoader;r&&(a=h.load(r)),l.load(t,(function(t){t.name=i,t.visible=!0,t.traverse((function(e){e&&(e.castShadow=!0)})),t.traverse((function(e){e.material&&(e.material.side=n.DoubleSide,r&&(e.material.map=a))})),L(t,s),e.add(t)}))}function D(e){let t=window.sessionStorage.getItem("phasePath");null!=t?t!=e&&(document.location.href="../.."+t):document.location.href="../../"}function I(e){return parseFloat(window.sessionStorage.getItem("elapsedTime"))+e}function O(e,t,i=!1){i?(window.sessionStorage.setItem("levelTotalTime",t),window.sessionStorage.removeItem("phasePath"),window.sessionStorage.removeItem("elapsedTime")):(window.sessionStorage.setItem("phasePath",e),window.sessionStorage.setItem("elapsedTime",t))}function k(e){let t=document.getElementById("timer"),i=Math.floor(e/3600),n=Math.floor(e/60)%60,r=Math.floor(e%60);t.innerText=`Tempo: ${i<10?"0"+i:i}:${n<10?"0"+n:n}:${r<10?"0"+r:r}`}})),r.register("hu0fb",(function(t,i){e(t.exports,"GLTFLoader",(()=>s));var n=r("4xklQ");class s extends n.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new u(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new y(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new b(e)})),this.register((function(e){return new w(e)}))}load(e,t,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){r?r(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new(0,n.FileLoader)(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(i){try{s.parse(i,o,(function(i){t(i),s.manager.itemEnd(e)}),a)}catch(e){a(e)}}),i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},l={};if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){if(n.LoaderUtils.decodeText(new Uint8Array(e,0,4))===M){try{o[a.KHR_BINARY_GLTF]=new T(e)}catch(e){return void(r&&r(e))}s=JSON.parse(o[a.KHR_BINARY_GLTF].content)}else s=JSON.parse(n.LoaderUtils.decodeText(new Uint8Array(e)))}else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new Z(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](c);l[t.name]=t,o[t.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){const t=s.extensionsUsed[e],i=s.extensionsRequired||[];switch(t){case a.KHR_MATERIALS_UNLIT:o[t]=new h;break;case a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[t]=new N;break;case a.KHR_DRACO_MESH_COMPRESSION:o[t]=new A(s,this.dracoLoader);break;case a.KHR_TEXTURE_TRANSFORM:o[t]=new E;break;case a.KHR_MESH_QUANTIZATION:o[t]=new L;break;default:i.indexOf(t)>=0&&void 0===l[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(o),c.setPlugins(l),c.parse(i,r)}parseAsync(e,t){const i=this;return new Promise((function(n,r){i.parse(e,t,n,r)}))}}function o(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class l{constructor(e){this.parser=e,this.name=a.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const n=t[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const l=new(0,n.Color)(16777215);void 0!==o.color&&l.fromArray(o.color);const h=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new(0,n.DirectionalLight)(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new(0,n.PointLight)(l),a.distance=h;break;case"spot":a=new(0,n.SpotLight)(l),a.distance=h,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(a),t.cache.add(i,r),r}createNodeAttachment(e){const t=this,i=this.parser,n=i.json.nodes[e],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return i._getNodeRef(t.cache,r,e)}))}}class h{constructor(){this.name=a.KHR_MATERIALS_UNLIT}getMaterialType(){return n.MeshBasicMaterial}extendParams(e,t,i){const r=[];e.color=new(0,n.Color)(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(e,"map",s.baseColorTexture,n.sRGBEncoding))}return Promise.all(r)}}class c{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class u{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new(0,n.Vector2)(e,e)}return Promise.all(s)}}class d{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&r.push(i.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&r.push(i.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(r)}}class f{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new(0,n.Color)(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,n.sRGBEncoding)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class p{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class m{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new(0,n.Color)(a[0],a[1],a[2]),Promise.all(s)}}class g{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new(0,n.Color)(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,n.sRGBEncoding)),Promise.all(s)}}class x{constructor(e){this.parser=e,this.name=a.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const r=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,s)}}class y{constructor(e){this.parser=e,this.name=a.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;const s=r.extensions[t],o=n.images[s.source];let a=i.textureLoader;if(o.uri){const e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(r){if(r)return i.loadTextureImage(e,s.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class b{constructor(e){this.name=a.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const e=i.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const i=e.byteOffset||0,n=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,i,n);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then((function(e){return e.buffer})):r.ready.then((function(){const t=new ArrayBuffer(s*o);return r.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t}))}))}return null}}class w{constructor(e){this.name=a.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const r=t.meshes[i.mesh];for(const e of r.primitives)if(e.mode!==I.TRIANGLES&&e.mode!==I.TRIANGLE_STRIP&&e.mode!==I.TRIANGLE_FAN&&void 0!==e.mode)return null;const s=i.extensions[this.name].attributes,o=[],a={};for(const e in s)o.push(this.parser.getDependency("accessor",s[e]).then((t=>(a[e]=t,a[e]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then((e=>{const t=e.pop(),i=t.isGroup?t.children:[t],r=e[0].count,s=[];for(const e of i){const t=new(0,n.Matrix4),i=new(0,n.Vector3),o=new(0,n.Quaternion),l=new(0,n.Vector3)(1,1,1),h=new(0,n.InstancedMesh)(e.geometry,e.material,r);for(let e=0;e<r;e++)a.TRANSLATION&&i.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,e),a.SCALE&&l.fromBufferAttribute(a.SCALE,e),h.setMatrixAt(e,t.compose(i,o,l));for(const t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);n.Object3D.prototype.copy.call(h,e),h.frustumCulled=!1,this.parser.assignFinalMaterial(h),s.push(h)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]})))}}const M="glTF",S=1313821514,_=5130562;class T{constructor(e){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:n.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==M)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,r=new DataView(e,12);let s=0;for(;s<i;){const t=r.getUint32(s,!0);s+=4;const i=r.getUint32(s,!0);if(s+=4,i===S){const i=new Uint8Array(e,12+s,t);this.content=n.LoaderUtils.decodeText(i)}else if(i===_){const i=12+s;this.body=e.slice(i,i+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class A{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},a={},l={};for(const e in s){const t=B[e]||e.toLowerCase();o[t]=s[e]}for(const t in e.attributes){const n=B[t]||t.toLowerCase();if(void 0!==s[t]){const r=i.accessors[e.attributes[t]],s=O[r.componentType];l[n]=s.name,a[n]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const i=e.attributes[t],n=a[t];void 0!==n&&(i.normalized=n)}t(e)}),o,l)}))}))}}class E{constructor(){this.name=a.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class C extends n.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new(0,n.Color)).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class N{constructor(){this.name=a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return C}extendParams(e,t,i){const r=t.extensions[this.name];e.color=new(0,n.Color)(1,1,1),e.opacity=1;const s=[];if(Array.isArray(r.diffuseFactor)){const t=r.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==r.diffuseTexture&&s.push(i.assignTexture(e,"map",r.diffuseTexture,n.sRGBEncoding)),e.emissive=new(0,n.Color)(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new(0,n.Color)(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){const t=r.specularGlossinessTexture;s.push(i.assignTexture(e,"glossinessMap",t)),s.push(i.assignTexture(e,"specularMap",t,n.sRGBEncoding))}return Promise.all(s)}createMaterial(e){const t=new C(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=n.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t}}class L{constructor(){this.name=a.KHR_MESH_QUANTIZATION}}class R extends n.Interpolant{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let e=0;e!==n;e++)t[e]=i[r+e];return t}interpolate_(e,t,i,n){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,h=n-t,c=(i-t)/h,u=c*c,d=u*c,f=e*l,p=f-l,m=-2*d+3*u,g=d-u,v=1-m,x=g-u+c;for(let e=0;e!==o;e++){const t=s[p+e+o],i=s[p+e+a]*h,n=s[f+e+o],l=s[f+e]*h;r[e]=v*t+x*i+m*n+g*l}return r}}const P=new(0,n.Quaternion);class D extends R{interpolate_(e,t,i,n){const r=super.interpolate_(e,t,i,n);return P.fromArray(r).normalize().toArray(r),r}}const I={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},k={9728:n.NearestFilter,9729:n.LinearFilter,9984:n.NearestMipmapNearestFilter,9985:n.LinearMipmapNearestFilter,9986:n.NearestMipmapLinearFilter,9987:n.LinearMipmapLinearFilter},z={33071:n.ClampToEdgeWrapping,33648:n.MirroredRepeatWrapping,10497:n.RepeatWrapping},F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},B={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},V={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},U={CUBICSPLINE:void 0,LINEAR:n.InterpolateLinear,STEP:n.InterpolateDiscrete},H="OPAQUE",G="MASK",W="BLEND";function j(e,t,i){for(const n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function X(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function q(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,n=i.length;t<n;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function J(e){const t=e.extensions&&e.extensions[a.KHR_DRACO_MESH_COMPRESSION];let i;return i=t?"draco:"+t.bufferView+":"+t.indices+":"+K(t.attributes):e.indices+":"+K(e.attributes)+":"+e.mode,i}function K(e){let t="";const i=Object.keys(e).sort();for(let n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function Y(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Z{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new o,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||i||r&&s<98?this.textureLoader=new(0,n.TextureLoader)(this.options.manager):this.textureLoader=new(0,n.ImageBitmapLoader)(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new(0,n.FileLoader)(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(t){const s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};j(r,s,n),X(s,n),Promise.all(i._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),r=(e,t)=>{const i=this.associations.get(e);null!=i&&this.associations.set(t,i);for(const[i,n]of e.children.entries())r(n,t.children[i])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return i.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,s){i.load(n.LoaderUtils.resolveURL(t.uri,r.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)}))}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);const s=[];return void 0!==r.bufferView?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],o=F[r.type],a=O[r.componentType],l=a.BYTES_PER_ELEMENT,h=l*o,c=r.byteOffset||0,u=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;let f,p;if(u&&u!==h){const e=Math.floor(c/u),i="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let h=t.cache.get(i);h||(f=new a(s,e*u,r.count*u/l),h=new(0,n.InterleavedBuffer)(f,u/l),t.cache.add(i,h)),p=new(0,n.InterleavedBufferAttribute)(h,o,c%u/l,d)}else f=null===s?new a(r.count*o):new a(s,c,r.count*o),p=new(0,n.BufferAttribute)(f,o,d);if(void 0!==r.sparse){const t=F.SCALAR,i=O[r.sparse.indices.componentType],l=r.sparse.indices.byteOffset||0,h=r.sparse.values.byteOffset||0,c=new i(e[1],l,r.sparse.count*t),u=new a(e[2],h,r.sparse.count*o);null!==s&&(p=new(0,n.BufferAttribute)(p.array.slice(),p.itemSize,p.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(p.setX(t,u[e*o]),o>=2&&p.setY(t,u[e*o+1]),o>=3&&p.setZ(t,u[e*o+2]),o>=4&&p.setW(t,u[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e].source,r=t.images[n];let s=this.textureLoader;if(r.uri){const e=i.manager.getHandler(r.uri);null!==e&&(s=e)}return this.loadTextureImage(e,n,s)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const h=this.loadImageSource(t,i).then((function(t){t.flipY=!1,t.name=o.name||a.name||"";const i=(s.samplers||{})[o.sampler]||{};return t.magFilter=k[i.magFilter]||n.LinearFilter,t.minFilter=k[i.minFilter]||n.LinearMipmapLinearFilter,t.wrapS=z[i.wrapS]||n.RepeatWrapping,t.wrapT=z[i.wrapT]||n.RepeatWrapping,r.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=h,h}loadImageSource(e,t){const i=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const s=i.images[e],o=self.URL||self.webkitURL;let a=s.uri||"",l=!1;if(void 0!==s.bufferView)a=this.getDependency("bufferView",s.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:s.mimeType});return a=o.createObjectURL(t),a}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then((function(e){return new Promise((function(i,s){let o=i;!0===t.isImageBitmapLoader&&(o=function(e){const t=new(0,n.Texture)(e);t.needsUpdate=!0,i(t)}),t.load(n.LoaderUtils.resolveURL(e,r.path),o,void 0,s)}))})).then((function(e){var t;return!0===l&&o.revokeObjectURL(a),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const r=this;return this.getDependency("texture",i.index).then((function(s){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),r.extensions[a.KHR_TEXTURE_TRANSFORM]){const e=void 0!==i.extensions?i.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(s);s=r.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),r.associations.set(s,t)}}return void 0!==n&&(s.encoding=n),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new(0,n.PointsMaterial),n.Material.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){const e="LineBasicMaterial:"+i.uuid;let t=this.cache.get(e);t||(t=new(0,n.LineBasicMaterial),n.Material.prototype.copy.call(t,i),t.color.copy(i.color),this.cache.add(e,t)),i=t}if(r||s||o){let e="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),r&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),s&&(t.vertexColors=!0),o&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return n.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let o;const l={},h=s.extensions||{},c=[];if(h[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),c.push(e.extendParams(l,s,t))}else if(h[a.KHR_MATERIALS_UNLIT]){const e=r[a.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),c.push(e.extendParams(l,s,t))}else{const i=s.pbrMetallicRoughness||{};if(l.color=new(0,n.Color)(1,1,1),l.opacity=1,Array.isArray(i.baseColorFactor)){const e=i.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==i.baseColorTexture&&c.push(t.assignTexture(l,"map",i.baseColorTexture,n.sRGBEncoding)),l.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,l.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(c.push(t.assignTexture(l,"metalnessMap",i.metallicRoughnessTexture)),c.push(t.assignTexture(l,"roughnessMap",i.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===s.doubleSided&&(l.side=n.DoubleSide);const u=s.alphaMode||H;if(u===W?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,u===G&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==n.MeshBasicMaterial&&(c.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new(0,n.Vector2)(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;l.normalScale.set(e,e)}return void 0!==s.occlusionTexture&&o!==n.MeshBasicMaterial&&(c.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==n.MeshBasicMaterial&&(l.emissive=(new(0,n.Color)).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==n.MeshBasicMaterial&&c.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture,n.sRGBEncoding)),Promise.all(c).then((function(){let i;return i=o===C?r[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new o(l),s.name&&(i.name=s.name),X(i,s),t.associations.set(i,{materials:e}),s.extensions&&j(r,i,s),i}))}createUniqueName(e){const t=n.PropertyBinding.sanitizeNodeName(e||"");let i=t;for(let e=1;this.nodeNamesUsed[i];++e)i=t+"_"+e;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(e){return i[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(i){return Q(i,e,t)}))}const o=[];for(let i=0,l=e.length;i<l;i++){const l=e[i],h=J(l),c=r[h];if(c)o.push(c.promise);else{let e;e=l.extensions&&l.extensions[a.KHR_DRACO_MESH_COMPRESSION]?s(l):Q(new(0,n.BufferGeometry),l,t),r[h]={primitive:l,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let e=0,t=o.length;e<t;e++){const t=void 0===o[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new(0,n.MeshStandardMaterial)({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.FrontSide})),l.DefaultMaterial):this.getDependency("material",o[e].material);a.push(t)}var l;return a.push(t.loadGeometries(o)),Promise.all(a).then((function(i){const a=i.slice(0,i.length-1),l=i[i.length-1],h=[];for(let i=0,c=l.length;i<c;i++){const c=l[i],u=o[i];let d;const f=a[i];if(u.mode===I.TRIANGLES||u.mode===I.TRIANGLE_STRIP||u.mode===I.TRIANGLE_FAN||void 0===u.mode)d=!0===s.isSkinnedMesh?new(0,n.SkinnedMesh)(c,f):new(0,n.Mesh)(c,f),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),u.mode===I.TRIANGLE_STRIP?d.geometry=ee(d.geometry,n.TriangleStripDrawMode):u.mode===I.TRIANGLE_FAN&&(d.geometry=ee(d.geometry,n.TriangleFanDrawMode));else if(u.mode===I.LINES)d=new(0,n.LineSegments)(c,f);else if(u.mode===I.LINE_STRIP)d=new(0,n.Line)(c,f);else if(u.mode===I.LINE_LOOP)d=new(0,n.LineLoop)(c,f);else{if(u.mode!==I.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new(0,n.Points)(c,f)}Object.keys(d.geometry.morphAttributes).length>0&&q(d,s),d.name=t.createUniqueName(s.name||"mesh_"+e),X(d,s),u.extensions&&j(r,d,u),t.assignFinalMaterial(d),h.push(d)}for(let i=0,n=h.length;i<n;i++)t.associations.set(h[i],{meshes:e,primitives:i});if(1===h.length)return h[0];const c=new(0,n.Group);t.associations.set(c,{meshes:e});for(let e=0,t=h.length;e<t;e++)c.add(h[e]);return c}))}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new(0,n.PerspectiveCamera)(n.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new(0,n.OrthographicCamera)(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),X(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return i.inverseBindMatrices=e,i}))}loadAnimation(e){const t=this.json.animations[e],i=[],r=[],s=[],o=[],a=[];for(let e=0,n=t.channels.length;e<n;e++){const n=t.channels[e],l=t.samplers[n.sampler],h=n.target,c=h.node,u=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;i.push(this.getDependency("node",c)),r.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",d)),o.push(l),a.push(h)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a)]).then((function(i){const r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],h=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],i=s[e],c=o[e],u=a[e],d=l[e];if(void 0===t)continue;let f;switch(t.updateMatrix(),V[d.path]){case V.weights:f=n.NumberKeyframeTrack;break;case V.rotation:f=n.QuaternionKeyframeTrack;break;default:f=n.VectorKeyframeTrack}const p=t.name?t.name:t.uuid,m=void 0!==u.interpolation?U[u.interpolation]:n.InterpolateLinear,g=[];V[d.path]===V.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(p);let v=c.array;if(c.normalized){const e=Y(v.constructor),t=new Float32Array(v.length);for(let i=0,n=v.length;i<n;i++)t[i]=v[i]*e;v=t}for(let e=0,t=g.length;e<t;e++){const t=new f(g[e]+"."+V[d.path],i.array,v,m);"CUBICSPLINE"===u.interpolation&&(t.createInterpolant=function(e){return new(this instanceof n.QuaternionKeyframeTrack?D:R)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(t)}}const c=t.name?t.name:"animation_"+e;return new(0,n.AnimationClip)(c,void 0,h)}))}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(e){const t=i._getNodeRef(i.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this.json,i=this.extensions,r=this,s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"";return function(){const t=[],i=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return i&&t.push(i),void 0!==s.camera&&t.push(r.getDependency("camera",s.camera).then((function(e){return r._getNodeRef(r.cameraCache,s.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let a;if(a=!0===s.isBone?new(0,n.Bone):t.length>1?new(0,n.Group):1===t.length?t[0]:new(0,n.Object3D),a!==t[0])for(let e=0,i=t.length;e<i;e++)a.add(t[e]);if(s.name&&(a.userData.name=s.name,a.name=o),X(a,s),s.extensions&&j(i,a,s),void 0!==s.matrix){const e=new(0,n.Matrix4);e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return r.associations.has(a)||r.associations.set(a,{}),r.associations.get(a).nodes=e,a}))}loadScene(e){const t=this.json,i=this.extensions,r=this.json.scenes[e],s=this,o=new(0,n.Group);r.name&&(o.name=s.createUniqueName(r.name)),X(o,r),r.extensions&&j(i,o,r);const a=r.nodes||[],l=[];for(let e=0,i=a.length;e<i;e++)l.push($(a[e],o,t,s));return Promise.all(l).then((function(){return s.associations=(e=>{const t=new Map;for(const[e,i]of s.associations)(e instanceof n.Material||e instanceof n.Texture)&&t.set(e,i);return e.traverse((e=>{const i=s.associations.get(e);null!=i&&t.set(e,i)})),t})(o),o}))}}function $(e,t,i,r){const s=i.nodes[e];return r.getDependency("node",e).then((function(e){if(void 0===s.skin)return e;let t;return r.getDependency("skin",s.skin).then((function(e){t=e;const i=[];for(let e=0,n=t.joints.length;e<n;e++)i.push(r.getDependency("node",t.joints[e]));return Promise.all(i)})).then((function(i){return e.traverse((function(e){if(!e.isMesh)return;const r=[],s=[];for(let e=0,o=i.length;e<o;e++){const o=i[e];if(o){r.push(o);const i=new(0,n.Matrix4);void 0!==t.inverseBindMatrices&&i.fromArray(t.inverseBindMatrices.array,16*e),s.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new(0,n.Skeleton)(r,s),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const n=[];if(s.children){const t=s.children;for(let s=0,o=t.length;s<o;s++){const o=t[s];n.push($(o,e,i,r))}}return Promise.all(n)}))}function Q(e,t,i){const r=t.attributes,s=[];function o(t,n){return i.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in r){const i=B[t]||t.toLowerCase();i in e.attributes||s.push(o(r[t],i))}if(void 0!==t.indices&&!e.index){const n=i.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(n)}return X(e,t),function(e,t,i){const r=t.attributes,s=new(0,n.Box3);if(void 0===r.POSITION)return;{const e=i.json.accessors[r.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new(0,n.Vector3)(t[0],t[1],t[2]),new(0,n.Vector3)(o[0],o[1],o[2])),e.normalized){const t=Y(O[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new(0,n.Vector3),t=new(0,n.Vector3);for(let n=0,r=o.length;n<r;n++){const r=o[n];if(void 0!==r.POSITION){const n=i.json.accessors[r.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){const e=Y(O[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new(0,n.Sphere);s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,t,i),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,i){let n=!1,r=!1,s=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(r=!0),void 0!==i.COLOR_0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let h=0,c=t.length;h<c;h++){const c=t[h];if(n){const t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;o.push(t)}if(r){const t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const i=t[0],o=t[1],a=t[2];return n&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,i):e}))}function ee(e,t){let i=e.getIndex();if(null===i){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}const r=i.count-2,s=[];if(t===n.TriangleFanDrawMode)for(let e=1;e<=r;e++)s.push(i.getX(0)),s.push(i.getX(e)),s.push(i.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(s.push(i.getX(e)),s.push(i.getX(e+1)),s.push(i.getX(e+2))):(s.push(i.getX(e+2)),s.push(i.getX(e+1)),s.push(i.getX(e)));s.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(s),o}})),r.register("kt6vz",(function(t,i){e(t.exports,"OBJLoader",(()=>v));var n=r("4xklQ");const s=/^[og]\s*(.+)?/,o=/^mtllib /,a=/^usemtl /,l=/^usemap /,h=/\s+/,c=new(0,n.Vector3),u=new(0,n.Vector3),d=new(0,n.Vector3),f=new(0,n.Vector3),p=new(0,n.Vector3),m=new(0,n.Color);function g(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);const n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){const e=i.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){const i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){const n=this.vertices,r=this.object.geometry.vertices;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const n=this.normals,r=this.object.geometry.normals;r.push(n[e+0],n[e+1],n[e+2]),r.push(n[t+0],n[t+1],n[t+2]),r.push(n[i+0],n[i+1],n[i+2])},addFaceNormal:function(e,t,i){const n=this.vertices,r=this.object.geometry.normals;c.fromArray(n,e),u.fromArray(n,t),d.fromArray(n,i),p.subVectors(d,u),f.subVectors(c,u),p.cross(f),p.normalize(),r.push(p.x,p.y,p.z),r.push(p.x,p.y,p.z),r.push(p.x,p.y,p.z)},addColor:function(e,t,i){const n=this.colors,r=this.object.geometry.colors;void 0!==n[e]&&r.push(n[e+0],n[e+1],n[e+2]),void 0!==n[t]&&r.push(n[t+0],n[t+1],n[t+2]),void 0!==n[i]&&r.push(n[i+0],n[i+1],n[i+2])},addUV:function(e,t,i){const n=this.uvs,r=this.object.geometry.uvs;r.push(n[e+0],n[e+1]),r.push(n[t+0],n[t+1]),r.push(n[i+0],n[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,n,r,s,o,a,l){const h=this.vertices.length;let c=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),d=this.parseVertexIndex(i,h);if(this.addVertex(c,u,d),this.addColor(c,u,d),void 0!==o&&""!==o){const e=this.normals.length;c=this.parseNormalIndex(o,e),u=this.parseNormalIndex(a,e),d=this.parseNormalIndex(l,e),this.addNormal(c,u,d)}else this.addFaceNormal(c,u,d);if(void 0!==n&&""!==n){const e=this.uvs.length;c=this.parseUVIndex(n,e),u=this.parseUVIndex(r,e),d=this.parseUVIndex(s,e),this.addUV(c,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,n=e.length;i<n;i++){const n=this.parseVertexIndex(e[i],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,n=this.uvs.length;for(let t=0,n=e.length;t<n;t++)this.addVertexLine(this.parseVertexIndex(e[t],i));for(let e=0,i=t.length;e<i;e++)this.addUVLine(this.parseUVIndex(t[e],n))}};return e.startObject("",!1),e}class v extends n.Loader{constructor(e){super(e),this.materials=null}load(e,t,i,r){const s=this,o=new(0,n.FileLoader)(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){try{t(s.parse(i))}catch(t){r?r(t):console.error(t),s.manager.itemError(e)}}),i,r)}setMaterials(e){return this.materials=e,this}parse(e){const t=new g;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const i=e.split("\n");let r=[];for(let e=0,n=i.length;e<n;e++){const n=i[e].trimStart();if(0===n.length)continue;const c=n.charAt(0);if("#"!==c)if("v"===c){const e=n.split(h);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?(m.setRGB(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])).convertSRGBToLinear(),t.colors.push(m.r,m.g,m.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===c){const e=n.slice(1).trim().split(h),i=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];if(n.length>0){const e=n.split("/");i.push(e)}}const r=i[0];for(let e=1,n=i.length-1;e<n;e++){const n=i[e],s=i[e+1];t.addFace(r[0],n[0],s[0],r[1],n[1],s[1],r[2],n[2],s[2])}}else if("l"===c){const e=n.substring(1).trim().split(" ");let i=[];const r=[];if(-1===n.indexOf("/"))i=e;else for(let t=0,n=e.length;t<n;t++){const n=e[t].split("/");""!==n[0]&&i.push(n[0]),""!==n[1]&&r.push(n[1])}t.addLineGeometry(i,r)}else if("p"===c){const e=n.slice(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(r=s.exec(n))){const e=(" "+r[0].slice(1).trim()).slice(1);t.startObject(e)}else if(a.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(o.test(n))t.materialLibraries.push(n.substring(7).trim());else if(l.test(n))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if(r=n.split(" "),r.length>1){const e=r[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===n)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}}t.finalize();const c=new(0,n.Group);c.materialLibraries=[].concat(t.materialLibraries);if(!0===!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let e=0,i=t.objects.length;e<i;e++){const i=t.objects[e],r=i.geometry,s=i.materials,o="Line"===r.type,a="Points"===r.type;let l=!1;if(0===r.vertices.length)continue;const h=new(0,n.BufferGeometry);h.setAttribute("position",new(0,n.Float32BufferAttribute)(r.vertices,3)),r.normals.length>0&&h.setAttribute("normal",new(0,n.Float32BufferAttribute)(r.normals,3)),r.colors.length>0&&(l=!0,h.setAttribute("color",new(0,n.Float32BufferAttribute)(r.colors,3))),!0===r.hasUVIndices&&h.setAttribute("uv",new(0,n.Float32BufferAttribute)(r.uvs,2));const u=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],r=i.name+"_"+i.smooth+"_"+l;let h=t.materials[r];if(null!==this.materials)if(h=this.materials.create(i.name),!o||!h||h instanceof n.LineBasicMaterial){if(a&&h&&!(h instanceof n.PointsMaterial)){const e=new(0,n.PointsMaterial)({size:10,sizeAttenuation:!1});n.Material.prototype.copy.call(e,h),e.color.copy(h.color),e.map=h.map,h=e}}else{const e=new(0,n.LineBasicMaterial);n.Material.prototype.copy.call(e,h),e.color.copy(h.color),h=e}void 0===h&&(h=o?new(0,n.LineBasicMaterial):a?new(0,n.PointsMaterial)({size:1,sizeAttenuation:!1}):new(0,n.MeshPhongMaterial),h.name=i.name,h.flatShading=!i.smooth,h.vertexColors=l,t.materials[r]=h),u.push(h)}let d;if(u.length>1){for(let e=0,t=s.length;e<t;e++){const t=s[e];h.addGroup(t.groupStart,t.groupCount,e)}d=o?new(0,n.LineSegments)(h,u):a?new(0,n.Points)(h,u):new(0,n.Mesh)(h,u)}else d=o?new(0,n.LineSegments)(h,u[0]):a?new(0,n.Points)(h,u[0]):new(0,n.Mesh)(h,u[0]);d.name=i.name,c.add(d)}else if(t.vertices.length>0){const e=new(0,n.PointsMaterial)({size:1,sizeAttenuation:!1}),i=new(0,n.BufferGeometry);i.setAttribute("position",new(0,n.Float32BufferAttribute)(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(i.setAttribute("color",new(0,n.Float32BufferAttribute)(t.colors,3)),e.vertexColors=!0);const r=new(0,n.Points)(i,e);c.add(r)}return c}}})),r.register("e6hrk",(function(t,i){e(t.exports,"fromType",(()=>ze)),e(t.exports,"defaultShaderStages",(()=>r("5dCoe").defaultShaderStages)),e(t.exports,"AttributeNode",(()=>r("1dTCL").default)),e(t.exports,"ConstNode",(()=>r("d9q8O").default)),e(t.exports,"Node",(()=>r("27z08").default)),e(t.exports,"NodeBuilder",(()=>r("5dCoe").default)),e(t.exports,"NodeFrame",(()=>r("2aXgX").default)),e(t.exports,"UniformNode",(()=>r("dNuj0").default)),e(t.exports,"PointUVNode",(()=>r("8t2cG").default)),e(t.exports,"PositionNode",(()=>r("6JP6R").default)),e(t.exports,"TextureNode",(()=>r("9bxft").default)),e(t.exports,"MathNode",(()=>r("8rDMm").default)),e(t.exports,"OperatorNode",(()=>r("6gQ3M").default)),e(t.exports,"SpriteSheetUVNode",(()=>r("1qRuO").default)),e(t.exports,"TimerNode",(()=>r("jNF4N").default)),e(t.exports,"GLSLNodeParser",(()=>r("1GkDb").default)),e(t.exports,"PointsNodeMaterial",(()=>r("7wZHW").default));var n=r("k8Bbh"),s=r("1dTCL"),o=r("c9JOK"),a=r("fqIAV"),l=r("d9q8O"),h=r("hReqz"),c=r("h7xaO"),u=r("img9u"),d=r("4aZT1"),f=r("8NRGC"),p=r("27z08"),m=r("fLZ3c"),g=r("5dCoe"),v=r("8xsuj"),x=r("2aXgX"),y=r("aZLFR"),b=r("l68w5"),w=r("2Kb86"),M=r("3wPa9"),S=r("imFM3"),_=r("9bhx3"),T=r("9XdoA"),A=r("dNuj0"),E=r("9GPae"),C=r("jp81s"),N=r("fGeIR"),L=r("lBKnU"),R=r("2As8W"),P=r("5ZPpQ"),D=r("cj5MD"),I=r("hNou2"),O=r("4T3xN"),k=r("ayxWo"),z=r("acP67"),F=r("1XSFF"),B=r("iXGFp"),V=r("8t2cG"),U=r("6JP6R"),H=r("gGs2B"),G=r("keBeo"),W=r("7uPAK"),j=r("b7aXd"),X=r("9bxft"),q=r("1wpLw"),J=r("aQaYp"),K=r("11NBw"),Y=r("lmKpo"),Z=r("gioHs"),$=r("aBHmb"),Q=r("grWGA"),ee=r("zOQaT"),te=r("kz9ky"),ie=r("kEYIm"),ne=r("Q6D6b"),re=r("8rDMm"),se=r("6gQ3M"),oe=r("axHTC"),ae=r("cHZZJ"),le=r("ibxJj"),he=r("kM6Ih"),ce=r("bi8Ru"),ue=r("aTRJp"),de=r("8F6bd"),fe=r("cOplQ"),pe=r("8ZXQy"),me=r("cjUTR"),ge=r("79kKg"),ve=r("6DN49"),xe=r("dRmZ4"),ye=r("5kSJa"),be=r("2Jf5Y"),we=r("fbYb2"),Me=r("9ZhNV"),Se=r("4kAkA"),_e=r("bxuK0"),Te=r("1qRuO"),Ae=r("jNF4N"),Ee=r("3GDng"),Ce=r("dK3bQ"),Ne=r("8buyk"),Le=r("cRde3"),Re=r("hayQ1"),Pe=r("1GkDb"),De=r("ehKYv"),Ie=r("iHl8L"),Oe=r("drYRh");r("btkQ5");g=r("5dCoe");const ke={ArrayUniformNode:n.default,AttributeNode:s.default,BypassNode:o.default,CodeNode:a.default,ContextNode:h.default,ConstNode:l.default,ExpressionNode:c.default,FunctionCallNode:u.default,FunctionNode:d.default,InstanceIndexNode:f.default,Node:p.default,NodeAttribute:m.default,NodeBuilder:g.default,NodeCode:v.default,NodeFrame:x.default,NodeFunctionInput:y.default,NodeKeywords:b.default,NodeUniform:w.default,NodeVar:M.default,NodeVarying:S.default,PropertyNode:_.default,TempNode:T.default,UniformNode:A.default,VarNode:E.default,VaryingNode:C.default,RangeNode:K.default,ComputeNode:Y.default,BitangentNode:N.default,BufferNode:L.default,CameraNode:R.default,CubeTextureNode:P.default,InstanceNode:D.default,MaterialNode:I.default,MaterialReferenceNode:O.default,ModelNode:k.default,ModelViewProjectionNode:z.default,NormalNode:F.default,Object3DNode:B.default,PointUVNode:V.default,PositionNode:U.default,ReferenceNode:H.default,ReflectVectorNode:G.default,SkinningNode:W.default,TangentNode:j.default,TextureNode:X.default,UVNode:q.default,UserDataNode:J.default,BlendModeNode:Z.default,ColorAdjustmentNode:$.default,ColorSpaceNode:Q.default,FrontFacingNode:ee.default,NormalMapNode:te.default,PosterizeNode:ie.default,ToneMappingNode:ne.default,MathNode:re.default,OperatorNode:se.default,CondNode:oe.default,PunctualLightNode:ae.default,LightsNode:le.default,LightingNode:he.default,LightingContextNode:ce.default,HemisphereLightNode:ue.default,EnvironmentNode:de.default,AONode:fe.default,AnalyticLightNode:pe.default,ArrayElementNode:me.default,ConvertNode:ge.default,EquirectUVNode:ve.default,JoinNode:xe.default,MatcapUVNode:ye.default,MaxMipLevelNode:be.default,OscNode:we.default,RemapNode:Me.default,RotateUVNode:Se.default,SplitNode:_e.default,SpriteSheetUVNode:Te.default,TimerNode:Ae.default,TriplanarTexturesNode:Ee.default,CheckerNode:De.default,FogNode:Ie.default,FogRangeNode:Oe.default,NodeLoader:Ce.default,NodeObjectLoader:Ne.default,NodeMaterialLoader:Le.default,WGSLNodeParser:Re.default,GLSLNodeParser:Pe.default},ze=e=>new ke[e]})),r.register("k8Bbh",(function(t,i){e(t.exports,"default",(()=>o));var n=r("dNuj0");class s extends n.default{constructor(e=[]){super(),this.isArrayUniformNode=!0,this.nodes=e}getNodeType(e){return this.nodes[0].getNodeType(e)}}var o=s})),r.register("dNuj0",(function(t,i){e(t.exports,"default",(()=>o));var n=r("eIc1e");class s extends n.default{constructor(e,t=null){super(e,t),this.isUniformNode=!0}getUniformHash(e){return this.getHash(e)}generate(e,t){const i=this.getNodeType(e),n=this.getUniformHash(e);let r=e.getNodeFromHash(n);void 0===r&&(e.setHashNode(this,n),r=this);const s=r.getInputType(e),o=e.getUniformFromNode(r,e.shaderStage,s),a=e.getPropertyName(o);return e.format(a,i,t)}}var o=s})),r.register("eIc1e",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("5NcGx");class o extends n.default{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e}getNodeType(){return null===this.nodeType?(0,s.getValueType)(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}serialize(e){super.serialize(e),e.value=this.value?.toArray?.()||this.value,e.valueType=(0,s.getValueType)(this.value),e.nodeType=this.nodeType}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=(0,s.getValueFromType)(e.valueType),this.value=this.value?.fromArray?.(e.value)||e.value}generate(){console.warn("Abstract function.")}}var a=o})),r.register("27z08",(function(t,i){e(t.exports,"default",(()=>l));var n=r("2KMsh"),s=r("5NcGx"),o=r("4xklQ");let a=0;var l=class{constructor(e=null){this.isNode=!0,this.nodeType=e,this.updateType=n.NodeUpdateType.NONE,this.uuid=o.MathUtils.generateUUID(),Object.defineProperty(this,"id",{value:a++})}get type(){return this.constructor.name}getChildren(){const e=[];for(const t in this){const i=this[t];if(!0===Array.isArray(i))for(const t of i)!0===t?.isNode&&e.push(t);else!0===i?.isNode&&e.push(i)}return e}getCacheKey(){return(0,s.getCacheKey)(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getNodeType(){return this.nodeType}getConstructHash(){return this.uuid}getReference(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}construct(e){const t=e.getNodeProperties(this);for(const e of this.getChildren())t["_node"+e.id]=e;return null}analyze(e){const t=e.getDataFromNode(this);if(t.dependenciesCount=void 0===t.dependenciesCount?1:t.dependenciesCount+1,1===t.dependenciesCount){const t=e.getNodeProperties(this);for(const i of Object.values(t))!0===i?.isNode&&i.build(e)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(!0===i?.isNode)return i.build(e,t)}update(){console.warn("Abstract function.")}build(e,t=null){const i=this.getReference(e);if(this!==i)return i.build(e,t);e.addNode(this),e.addStack(this);let n=null;const r=e.getBuildStage();if("construct"===r){const t=e.getNodeProperties(this);if(!0!==t.initialized||!1===e.context.tempRead){t.initialized=!0,t.outputNode=this.construct(e);for(const i of Object.values(t))!0===i?.isNode&&i.build(e)}}else if("analyze"===r)this.analyze(e);else if("generate"===r){if(1===this.generate.length){const i=this.getNodeType(e),r=e.getDataFromNode(this);n=r.snippet,void 0===n&&(n=this.generate(e)||"",r.snippet=n),n=e.format(n,i,t)}else n=this.generate(e,t)||""}return e.removeStack(this),n}serialize(e){const t=(0,s.getNodesKeys)(this);if(t.length>0){const i={};for(const n of t)i[n]=this[n].toJSON(e.meta).uuid;e.inputNodes=i}}deserialize(e){if(void 0!==e.inputNodes){const t=e.meta.nodes;for(const i in e.inputNodes){const n=e.inputNodes[i];this[i]=t[n]}}}toJSON(e){const{uuid:t,type:i}=this,n=void 0===e||"string"==typeof e;n&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];function s(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(void 0===r&&(r={uuid:t,type:i,meta:e,metadata:{version:4.5,type:"Node",generator:"Node.toJSON"}},e.nodes[r.uuid]=r,this.serialize(r),delete r.meta),n){const t=s(e.textures),i=s(e.images),n=s(e.nodes);t.length>0&&(r.textures=t),i.length>0&&(r.images=i),n.length>0&&(r.nodes=n)}return r}}})),r.register("2KMsh",(function(t,i){e(t.exports,"NodeShaderStage",(()=>n)),e(t.exports,"NodeUpdateType",(()=>r));const n={VERTEX:"vertex",FRAGMENT:"fragment"},r={NONE:"none",FRAME:"frame",OBJECT:"object"}})),r.register("5NcGx",(function(t,i){e(t.exports,"getCacheKey",(()=>s)),e(t.exports,"getNodesKeys",(()=>o)),e(t.exports,"getValueType",(()=>a)),e(t.exports,"getValueFromType",(()=>l));var n=r("4xklQ");const s=e=>{let t="{";!0===e.isNode&&(t+=`uuid:"${e.uuid}",`);for(const i of o(e))t+=`${i}:${e[i].getCacheKey()},`;return t+="}",t},o=e=>{const t=[];for(const i in e){const n=e[i];n&&!0===n.isNode&&t.push(i)}return t},a=e=>"number"==typeof e?"float":"boolean"==typeof e?"bool":!0===e?.isVector2?"vec2":!0===e?.isVector3?"vec3":!0===e?.isVector4?"vec4":!0===e?.isMatrix3?"mat3":!0===e?.isMatrix4?"mat4":!0===e?.isColor?"color":null,l=(e,...t)=>{const i=e?.slice(-4);return"color"===e?new(0,n.Color)(...t):"vec2"===i?new(0,n.Vector2)(...t):"vec3"===i?new(0,n.Vector3)(...t):"vec4"===i?new(0,n.Vector4)(...t):"mat3"===i?new(0,n.Matrix3)(...t):"mat4"===i?new(0,n.Matrix4)(...t):"bool"!==e&&("float"===e||"int"===e||"uint"===e?0:null)}})),r.register("1dTCL",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("jp81s");class o extends n.default{constructor(e,t=null){super(t),this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){const t=this.getAttributeName(e);let i=super.getNodeType(e);if(null===i)if(e.hasGeometryAttribute(t)){const n=e.geometry.getAttribute(t);i=e.getTypeFromLength(n.itemSize)}else i="float";return i}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),i=this.getNodeType(e);if(!0===e.hasGeometryAttribute(t)){const n=e.getAttribute(t,i);if(e.isShaderStage("vertex"))return n.name;return new(0,s.default)(this).build(e,n.type)}return console.warn(`Attribute "${t}" not found.`),e.getConst(i)}}var a=o})),r.register("jp81s",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("2KMsh");class o extends n.default{constructor(e,t=null){super(),this.node=e,this.name=t}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{name:t,node:i}=this,n=this.getNodeType(e),r=e.getVaryingFromNode(this,n);r.needsInterpolation||="fragment"===e.shaderStage,null!==t&&(r.name=t);const o=e.getPropertyName(r,s.NodeShaderStage.VERTEX);return e.flowNodeFromShaderStage(s.NodeShaderStage.VERTEX,i,n,o),e.getPropertyName(r)}}var a=o})),r.register("c9JOK",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e,t){const i=this.callNode.build(e,"void");return""!==i&&e.addFlowCode(i),this.outputNode.build(e,t)}}var o=s})),r.register("fqIAV",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e="",t=[]){super("code"),this.isCodeNode=!0,this.code=e,this._includes=t}setIncludes(e){return this._includes=e,this}getIncludes(){return this._includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const i=e.getCodeFromNode(this,this.getNodeType(e));return i.code=this.code,i.code}}var o=s})),r.register("d9q8O",(function(t,i){e(t.exports,"default",(()=>o));var n=r("eIc1e");class s extends n.default{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.getConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return e.format(this.generateConst(e),i,t)}}var o=s})),r.register("hReqz",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}construct(e){const t=e.getContext();e.setContext({...e.context,...this.context});const i=this.node.build(e);return e.setContext(t),i}generate(e,t){const i=e.getContext();e.setContext({...e.context,...this.context});const n=this.node.build(e,t);return e.setContext(i),n}}var o=s})),r.register("h7xaO",(function(t,i){e(t.exports,"default",(()=>o));var n=r("9XdoA");class s extends n.default{constructor(e="",t="void"){super(t),this.snipped=e}generate(e){const t=this.getNodeType(e),i=this.snipped;if("void"!==t)return`( ${i} )`;e.addFlowCode(i)}}var o=s})),r.register("9XdoA",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e){super(e),this.isTempNode=!0}build(e,t){if("generate"===e.getBuildStage()){const i=e.getVectorType(this.getNodeType(e,t)),n=e.getDataFromNode(this);if(!1!==e.context.tempRead&&void 0!==n.propertyName)return e.format(n.propertyName,i,t);if(!1!==e.context.tempWrite&&"void "!==i&&"void"!==t&&n.dependenciesCount>1){const r=super.build(e,i),s=e.getVarFromNode(this,i),o=e.getPropertyName(s);return e.addFlowCode(`${o} = ${r}`),n.snippet=r,n.propertyName=o,e.format(n.propertyName,i,t)}}return super.build(e,t)}}var o=s})),r.register("img9u",(function(t,i){e(t.exports,"default",(()=>o));var n=r("9XdoA");class s extends n.default{constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],i=this.functionNode,n=i.getInputs(e),r=this.parameters;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=n[i],o=r[i];t.push(o.build(e,s.type))}else for(const i of n){const n=r[i.name];if(void 0===n)throw new Error(`FunctionCallNode: Input '${i.name}' not found in FunctionNode.`);t.push(n.build(e,i.type))}return`${i.build(e,"property")}( ${t.join(", ")} )`}}var o=s})),r.register("4aZT1",(function(t,i){e(t.exports,"default",(()=>a));var n=r("fqIAV"),s=r("img9u");class o extends n.default{constructor(e="",t=[]){super(e,t),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let i=t.nodeFunction;return void 0===i&&(i=e.parser.parseFunction(this.code),t.nodeFunction=i),i}call(e={}){return new(0,s.default)(this,e)}generate(e,t){super.generate(e);const i=this.getNodeFunction(e),n=i.name,r=i.type,s=e.getCodeFromNode(this,r);""!==n&&(s.name=n);const o=e.getPropertyName(s);let a=this.getNodeFunction(e).getCode(o);const l=this.keywords,h=Object.keys(l);if(h.length>0)for(const t of h){const i=new RegExp(`\\b${t}\\b`,"g"),n=l[t].build(e,"property");a=a.replace(i,n)}return s.code=a,"property"===t?o:e.format(`${o}()`,r,t)}}var a=o})),r.register("8NRGC",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(){super("uint"),this.isInstanceIndexNode=!0}generate(e){return e.getInstanceIndex()}}var o=s})),r.register("fLZ3c",(function(t,i){e(t.exports,"default",(()=>n));var n=class{constructor(e,t){this.isNodeAttribute=!0,this.name=e,this.type=t}}})),r.register("5dCoe",(function(t,i){e(t.exports,"defaultShaderStages",(()=>d)),e(t.exports,"vector",(()=>p)),e(t.exports,"default",(()=>v));var n=r("2Kb86"),s=r("fLZ3c"),o=r("imFM3"),a=r("3wPa9"),l=r("8xsuj"),h=r("l68w5"),c=r("2KMsh"),u=r("4xklQ");const d=["fragment","vertex"],f=[...d,"compute"],p=["x","y","z","w"],m=new Map;m.set(1,"float"),m.set(2,"vec2"),m.set(3,"vec3"),m.set(4,"vec4"),m.set(9,"mat3"),m.set(16,"mat4");const g=e=>(e=Number(e))+(e%1?"":".0");var v=class{constructor(e,t,i){this.object=e,this.material=e.material||null,this.geometry=e.geometry||null,this.renderer=t,this.parser=i,this.nodes=[],this.updateNodes=[],this.hashNodes={},this.scene=null,this.lightsNode=null,this.fogNode=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:[]},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.codes={vertex:[],fragment:[],compute:[]},this.attributes=[],this.varyings=[],this.vars={vertex:[],fragment:[],compute:[]},this.flow={code:""},this.stack=[],this.context={keywords:new(0,h.default),material:e.material},this.nodesData=new WeakMap,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}get node(){return this.stack[this.stack.length-1]}addStack(e){this.stack.push(e)}removeStack(e){if(this.stack.pop()!==e)throw new Error("NodeBuilder: Invalid node stack!")}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){if(-1===this.nodes.indexOf(e)){e.getUpdateType(this)!==c.NodeUpdateType.NONE&&this.updateNodes.push(e),this.nodes.push(e),this.setHashNode(e,e.getHash(this))}}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}isAvailable(){return!1}getInstanceIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getTexture(){console.warn("Abstract function.")}getTextureLevel(){console.warn("Abstract function.")}getCubeTexture(){console.warn("Abstract function.")}getCubeTextureLevel(){console.warn("Abstract function.")}getConst(e,t=null){if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new(0,u.Color):"vec2"===e?t=new(0,u.Vector2):"vec3"===e?t=new(0,u.Vector3):"vec4"===e&&(t=new(0,u.Vector4))),"float"===e)return g(t);if("int"===e)return`${Math.round(t)}`;if("uint"===e)return t>=0?`${Math.round(t)}u`:"0u";if("bool"===e)return t?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${g(t.r)}, ${g(t.g)}, ${g(t.b)} )`;const i=this.getTypeLength(e),n=this.getComponentType(e),r=e=>this.getConst(n,e);if(2===i)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)} )`;if(3===i)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)} )`;if(4===i)return`${this.getType(e)}( ${r(t.x)}, ${r(t.y)}, ${r(t.z)}, ${r(t.w)} )`;if(i>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e}generateMethod(e){return e}hasGeometryAttribute(e){return void 0!==this.geometry?.getAttribute(e)}getAttribute(e,t){const i=this.attributes;for(const t of i)if(t.name===e)return t;const n=new(0,s.default)(e,t);return i.push(n),n}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"texture"===e||"cubeTexture"===e}isShaderStage(e){return this.shaderStage===e}getTextureEncodingFromMap(e){let t;return t=e&&e.isTexture?e.encoding:e&&e.isWebGLRenderTarget?e.texture.encoding:u.LinearEncoding,t}getComponentType(e){e=this.getVectorType(e);const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===t?null:"b"===t[1]?"bool":"i"===t[1]?"int":"u"===t[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e?"vec4":e}getTypeFromLength(e){return m.get(e)}getTypeLength(e){const t=this.getVectorType(e),i=/vec([2-4])/.exec(t);return null!==i?Number(i[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}getDataFromNode(e,t=this.shaderStage){let i=this.nodesData.get(e);return void 0===i&&(i={vertex:{},fragment:{},compute:{}},this.nodesData.set(e,i)),null!==t?i[t]:i}getNodeProperties(e,t=this.shaderStage){const i=this.getDataFromNode(this,t),n=e.getConstructHash(this);return i.properties=i.properties||{},i.properties[n]=i.properties[n]||{outputNode:null},i.properties[n]}getUniformFromNode(e,t,i){const r=this.getDataFromNode(e,t);let s=r.uniform;if(void 0===s){const o=this.uniforms.index++;s=new(0,n.default)("nodeUniform"+o,i,e),this.uniforms[t].push(s),r.uniform=s}return s}getVarFromNode(e,t,i=this.shaderStage){const n=this.getDataFromNode(e,i);let r=n.variable;if(void 0===r){const e=this.vars[i],s=e.length;r=new(0,a.default)("nodeVar"+s,t),e.push(r),n.variable=r}return r}getVaryingFromNode(e,t){const i=this.getDataFromNode(e,null);let n=i.varying;if(void 0===n){const e=this.varyings,r=e.length;n=new(0,o.default)("nodeVarying"+r,t),e.push(n),i.varying=n}return n}getCodeFromNode(e,t,i=this.shaderStage){const n=this.getDataFromNode(e);let r=n.code;if(void 0===r){const e=this.codes[i],s=e.length;r=new(0,l.default)("nodeCode"+s,t),e.push(r),n.code=r}return r}addFlowCode(e){this.flow.code+=e}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),i=this.flowChildNode(e,t);return this.flowsData.set(e,i),i}flowChildNode(e,t=null){const i=this.flow,n={code:""};return this.flow=n,n.result=e.build(this,t),this.flow=i,n}flowNodeFromShaderStage(e,t,i=null,n=null){const r=this.shaderStage;this.setShaderStage(e);const s=this.flowChildNode(t,i);return null!==n&&(s.code+=`${n} = ${s.result};\n\t`),this.flowCode[e]=this.flowCode[e]+s.code,this.setShaderStage(r),s}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVars(e){let t="";const i=this.vars[e];for(const e of i)t+=`${e.type} ${e.name}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let i="";for(const e of t)i+=e.code+"\n";return i}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){this.setBuildStage("construct");for(const e of f){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)e.build(this)}this.setBuildStage("analyze");for(const e of f){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)e.build(this)}this.setBuildStage("generate"),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex),this.setBuildStage("generate");for(const e of f){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)this.flowNode(e)}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this}format(e,t,i){if((t=this.getVectorType(t))===(i=this.getVectorType(i))||null===i||this.isReference(i))return e;const n=this.getTypeLength(t),r=this.getTypeLength(i);return n>4||r>4||0===r?e:n===r?`${this.getType(i)}( ${e} )`:n>r?this.format(`${e}.${"xyz".slice(0,r)}`,this.getTypeFromLength(r),i):4===r?`${this.getType(i)}( ${this.format(e,t,"vec3")}, 1.0 )`:2===n?`${this.getType(i)}( ${this.format(e,t,"vec2")}, 0.0 )`:`${this.getType(i)}( ${e} )`}getSignature(){return`// Three.js r${u.REVISION} - NodeMaterial System\n`}}})),r.register("2Kb86",(function(t,i){e(t.exports,"default",(()=>n));var n=class{constructor(e,t,i,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=i,this.needsUpdate=n}get value(){return this.node.value}set value(e){this.node.value=e}}})),r.register("imFM3",(function(t,i){e(t.exports,"default",(()=>o));var n=r("3wPa9");class s extends n.default{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}var o=s})),r.register("3wPa9",(function(t,i){e(t.exports,"default",(()=>n));var n=class{constructor(e,t){this.isNodeVar=!0,this.name=e,this.type=t}}})),r.register("8xsuj",(function(t,i){e(t.exports,"default",(()=>n));var n=class{constructor(e,t,i=""){this.name=e,this.type=t,this.code=i,Object.defineProperty(this,"isNodeCode",{value:!0})}}})),r.register("l68w5",(function(t,i){e(t.exports,"default",(()=>n));var n=class{constructor(){this.keywords=[],this.nodes=[],this.keywordsCallback={}}getNode(e){let t=this.nodes[e];return void 0===t&&void 0!==this.keywordsCallback[e]&&(t=this.keywordsCallback[e](e),this.nodes[e]=t),t}addKeyword(e,t){return this.keywords.push(e),this.keywordsCallback[e]=t,this}parse(e){const t=this.keywords,i=new RegExp(`\\b${t.join("\\b|\\b")}\\b`,"g"),n=e.match(i),r=[];if(null!==n)for(const e of n){const t=this.getNode(e);void 0!==t&&-1===r.indexOf(t)&&r.push(t)}return r}include(e,t){const i=this.parse(t);for(const t of i)t.build(e)}}})),r.register("2aXgX",(function(t,i){e(t.exports,"default",(()=>s));var n=r("2KMsh");var s=class{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.startTime=null,this.updateMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null}updateNode(e){e.updateType===n.NodeUpdateType.FRAME?this.updateMap.get(e)!==this.frameId&&(this.updateMap.set(e,this.frameId),e.update(this)):e.updateType===n.NodeUpdateType.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}})),r.register("aZLFR",(function(t,i){e(t.exports,"default",(()=>r));class n{constructor(e,t,i=null,n="",r=!1){this.type=e,this.name=t,this.count=i,this.qualifier=n,this.isConst=r}}n.isNodeFunctionInput=!0;var r=n})),r.register("9bhx3",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e=null,t="vec4"){super(t),this.name=e}getHash(e){return this.name||super.getHash(e)}generate(e){const t=e.getVarFromNode(this,this.getNodeType(e)),i=this.name;return null!==i&&(t.name=i),e.getPropertyName(t)}}var o=s})),r.register("9GPae",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("6gQ3M");class o extends n.default{constructor(e,t=null){super(),this.node=e,this.name=t}op(e,...t){return this.node=new(0,s.default)(e,this.node,...t),this}assign(...e){return this.op("=",...e)}add(...e){return this.op("+",...e)}sub(...e){return this.op("-",...e)}mul(...e){return this.op("*",...e)}div(...e){return this.op("/",...e)}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node,i=this.name;if(null===i&&!0===t.isTempNode)return t.build(e);const n=e.getVectorType(this.getNodeType(e)),r=t.build(e,n),s=e.getVarFromNode(this,n);null!==i&&(s.name=i);const o=e.getPropertyName(s);return e.addFlowCode(`${o} = ${r}`),o}}var a=o})),r.register("6gQ3M",(function(t,i){e(t.exports,"default",(()=>o));var n=r("9XdoA");class s extends n.default{constructor(e,t,i,...n){if(super(),this.op=e,n.length>0){let t=i;for(let i=0;i<n.length;i++)t=new s(e,t,n[i]);i=t}this.aNode=t,this.bNode=i}getNodeType(e,t){const i=this.op,n=this.aNode,r=this.bNode,s=n.getNodeType(e),o=r.getNodeType(e);if("void"===s||"void"===o)return"void";if("="===i||"%"===i)return s;if("&"===i||"|"===i||"^"===i||">>"===i||"<<"===i)return"int";if("=="===i||"&&"===i||"||"===i||"^^"===i)return"bool";if("<"===i||">"===i||"<="===i||">="===i){const i=e.getTypeLength(t);return i>1?`bvec${i}`:"bool"}return"float"===s&&e.isMatrix(o)?o:e.isMatrix(s)&&e.isVector(o)?e.getVectorFromMatrix(s):e.isVector(s)&&e.isMatrix(o)?e.getVectorFromMatrix(o):e.getTypeLength(o)>e.getTypeLength(s)?o:s}generate(e,t){const i=this.op,n=this.aNode,r=this.bNode,s=this.getNodeType(e,t);let o=null,a=null;"void"!==s?(o=n.getNodeType(e),a=r.getNodeType(e),"="===i?a=o:"<"===i||">"===i||"<="===i||">="===i?e.isVector(o)?a=o:o=a="float":e.isMatrix(o)&&e.isVector(a)?a=e.getVectorFromMatrix(o):o=e.isVector(o)&&e.isMatrix(a)?e.getVectorFromMatrix(a):a=s):o=a=s;const l=n.build(e,o),h=r.build(e,a),c=e.getTypeLength(t);return"void"!==t?"="===i?(e.addFlowCode(`${l} ${this.op} ${h}`),l):"<"===i&&c>1?e.format(`${e.getMethod("lessThan")}( ${l}, ${h} )`,s,t):"<="===i&&c>1?e.format(`${e.getMethod("lessThanEqual")}( ${l}, ${h} )`,s,t):">"===i&&c>1?e.format(`${e.getMethod("greaterThan")}( ${l}, ${h} )`,s,t):">="===i&&c>1?e.format(`${e.getMethod("greaterThanEqual")}( ${l}, ${h} )`,s,t):e.format(`( ${l} ${this.op} ${h} )`,s,t):"void"!==o?e.format(`${l} ${this.op} ${h}`,s,t):void 0}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}var o=s})),r.register("fGeIR",(function(t,i){e(t.exports,"default",(()=>d));var n=r("27z08"),s=r("jp81s"),o=r("6gQ3M"),a=r("8rDMm"),l=r("bxuK0"),h=r("1XSFF"),c=r("b7aXd");class u extends n.default{static GEOMETRY="geometry";static LOCAL="local";static VIEW="view";static WORLD="world";constructor(e=u.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){const t=this.scope,i=new(0,a.default)(a.default.CROSS,new(0,h.default)(t),new(0,c.default)(t)),n=new(0,l.default)(new(0,c.default)(c.default.GEOMETRY),"w"),r=new(0,l.default)(new(0,o.default)("*",i,n),"xyz");return new(0,a.default)(a.default.NORMALIZE,new(0,s.default)(r)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}var d=u})),r.register("8rDMm",(function(t,i){e(t.exports,"default",(()=>h));var n=r("9XdoA"),s=r("h7xaO"),o=r("bxuK0"),a=r("6gQ3M");class l extends n.default{static RADIANS="radians";static DEGREES="degrees";static EXP="exp";static EXP2="exp2";static LOG="log";static LOG2="log2";static SQRT="sqrt";static INVERSE_SQRT="inversesqrt";static FLOOR="floor";static CEIL="ceil";static NORMALIZE="normalize";static FRACT="fract";static SIN="sin";static COS="cos";static TAN="tan";static ASIN="asin";static ACOS="acos";static ATAN="atan";static ABS="abs";static SIGN="sign";static LENGTH="length";static NEGATE="negate";static INVERT="invert";static DFDX="dFdx";static DFDY="dFdy";static ROUND="round";static RECIPROCAL="reciprocal";static ATAN2="atan2";static MIN="min";static MAX="max";static MOD="mod";static STEP="step";static REFLECT="reflect";static DISTANCE="distance";static DOT="dot";static CROSS="cross";static POW="pow";static TRANSFORM_DIRECTION="transformDirection";static MIX="mix";static CLAMP="clamp";static REFRACT="refract";static SMOOTHSTEP="smoothstep";static FACEFORWARD="faceforward";constructor(e,t,i=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=i,this.cNode=n}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(i)?0:e.getTypeLength(i),o=e.isMatrix(n)?0:e.getTypeLength(n);return r>s&&r>o?t:s>o?i:o>r?n:t}getNodeType(e){const t=this.method;return t===l.LENGTH||t===l.DISTANCE||t===l.DOT?"float":t===l.CROSS?"vec3":this.getInputType(e)}generate(e,t){const i=this.method,n=this.getNodeType(e),r=this.getInputType(e),h=this.aNode,c=this.bNode,u=this.cNode,d=!0===e.renderer.isWebGLRenderer;if(i===l.TRANSFORM_DIRECTION){let t=h,i=c;e.isMatrix(t.getNodeType(e))?i=new(0,s.default)(`${e.getType("vec4")}( ${i.build(e,"vec3")}, 0.0 )`,"vec4"):t=new(0,s.default)(`${e.getType("vec4")}( ${t.build(e,"vec3")}, 0.0 )`,"vec4");const n=new(0,o.default)(new(0,a.default)("*",t,i),"xyz");return new l(l.NORMALIZE,n).build(e)}if(i===l.NEGATE)return e.format("( -"+h.build(e,r)+" )",n,t);if(i===l.INVERT)return e.format("( 1.0 - "+h.build(e,r)+" )",n,t);if(i===l.RECIPROCAL)return e.format("( 1.0 / "+h.build(e,r)+" )",n,t);{const s=[];return i===l.CROSS?s.push(h.build(e,n),c.build(e,n)):i===l.STEP?s.push(h.build(e,1===e.getTypeLength(h.getNodeType(e))?"float":r),c.build(e,r)):d&&(i===l.MIN||i===l.MAX)||i===l.MOD?s.push(h.build(e,r),c.build(e,1===e.getTypeLength(c.getNodeType(e))?"float":r)):i===l.REFRACT?s.push(h.build(e,r),c.build(e,r),u.build(e,"float")):i===l.MIX?s.push(h.build(e,r),c.build(e,r),u.build(e,1===e.getTypeLength(u.getNodeType(e))?"float":r)):(s.push(h.build(e,r)),null!==u?s.push(c.build(e,r),u.build(e,r)):null!==c&&s.push(c.build(e,r))),e.format(`${e.getMethod(i)}( ${s.join(", ")} )`,n,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}var h=l})),r.register("bxuK0",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("5dCoe");class o extends n.default{constructor(e,t="x"){super(),this.node=e,this.components=t}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(s.vector.indexOf(t)+1,e);return e}getNodeType(e){return e.getTypeFromLength(this.components.length)}generate(e,t){const i=this.node,n=e.getTypeLength(i.getNodeType(e));let r=null;if(n>1){let s=null;this.getVectorLength()>=n&&(s=e.getTypeFromLength(this.getVectorLength()));const o=i.build(e,s);r=this.components.length===n&&this.components==="xyzw".slice(0,this.components.length)?e.format(o,s,t):e.format(`${o}.${this.components}`,this.getNodeType(e),t)}else r=i.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}var a=o})),r.register("1XSFF",(function(t,i){e(t.exports,"default",(()=>d));var n=r("27z08"),s=r("1dTCL"),o=r("jp81s"),a=r("ayxWo"),l=r("2As8W"),h=r("6gQ3M"),c=r("8rDMm");class u extends n.default{static GEOMETRY="geometry";static LOCAL="local";static VIEW="view";static WORLD="world";constructor(e=u.LOCAL){super("vec3"),this.scope=e}getHash(){return`normal-${this.scope}`}generate(e){const t=this.scope;let i=null;if(t===u.GEOMETRY)i=new(0,s.default)("normal","vec3");else if(t===u.LOCAL)i=new(0,o.default)(new u(u.GEOMETRY));else if(t===u.VIEW){const e=new(0,h.default)("*",new(0,a.default)(a.default.NORMAL_MATRIX),new u(u.LOCAL));i=new(0,c.default)(c.default.NORMALIZE,new(0,o.default)(e))}else if(t===u.WORLD){const e=new(0,c.default)(c.default.TRANSFORM_DIRECTION,new u(u.VIEW),new(0,l.default)(l.default.VIEW_MATRIX));i=new(0,c.default)(c.default.NORMALIZE,new(0,o.default)(e))}return i.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}var d=u})),r.register("ayxWo",(function(t,i){e(t.exports,"default",(()=>o));var n=r("iXGFp");class s extends n.default{constructor(e=s.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}var o=s})),r.register("iXGFp",(function(t,i){e(t.exports,"default",(()=>h));var n=r("4xklQ"),s=r("27z08"),o=r("dNuj0"),a=r("2KMsh");class l extends s.default{static VIEW_MATRIX="viewMatrix";static NORMAL_MATRIX="normalMatrix";static WORLD_MATRIX="worldMatrix";static POSITION="position";static VIEW_POSITION="viewPosition";constructor(e=l.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=a.NodeUpdateType.OBJECT,this._uniformNode=new(0,o.default)(null)}getNodeType(){const e=this.scope;return e===l.WORLD_MATRIX||e===l.VIEW_MATRIX?"mat4":e===l.NORMAL_MATRIX?"mat3":e===l.POSITION||e===l.VIEW_POSITION?"vec3":void 0}update(e){const t=this.object3d,i=this._uniformNode,r=this.scope;if(r===l.VIEW_MATRIX)i.value=t.modelViewMatrix;else if(r===l.NORMAL_MATRIX)i.value=t.normalMatrix;else if(r===l.WORLD_MATRIX)i.value=t.matrixWorld;else if(r===l.POSITION)i.value.setFromMatrixPosition(t.matrixWorld);else if(r===l.VIEW_POSITION){const r=e.camera;i.value=i.value||new(0,n.Vector3),i.value.setFromMatrixPosition(t.matrixWorld),i.value.applyMatrix4(r.matrixWorldInverse)}}generate(e){const t=this.scope;return t===l.WORLD_MATRIX||t===l.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===l.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":t!==l.POSITION&&t!==l.VIEW_POSITION||(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}var h=l})),r.register("2As8W",(function(t,i){e(t.exports,"default",(()=>o));var n=r("iXGFp");class s extends n.default{static PROJECTION_MATRIX="projectionMatrix";constructor(e=s.POSITION){super(e)}getNodeType(e){return this.scope===s.PROJECTION_MATRIX?"mat4":super.getNodeType(e)}update(e){const t=e.camera,i=this._uniformNode,n=this.scope;n===s.PROJECTION_MATRIX?i.value=t.projectionMatrix:n===s.VIEW_MATRIX?i.value=t.matrixWorldInverse:(this.object3d=t,super.update(e))}generate(e){return this.scope===s.PROJECTION_MATRIX&&(this._uniformNode.nodeType="mat4"),super.generate(e)}}var o=s})),r.register("b7aXd",(function(t,i){e(t.exports,"default",(()=>f));var n=r("27z08"),s=r("1dTCL"),o=r("jp81s"),a=r("ayxWo"),l=r("2As8W"),h=r("6gQ3M"),c=r("8rDMm"),u=r("bxuK0");class d extends n.default{static GEOMETRY="geometry";static LOCAL="local";static VIEW="view";static WORLD="world";constructor(e=d.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===d.GEOMETRY?"vec4":"vec3"}generate(e){const t=this.scope;let i=null;if(t===d.GEOMETRY)i=new(0,s.default)("tangent","vec4");else if(t===d.LOCAL)i=new(0,o.default)(new(0,u.default)(new d(d.GEOMETRY),"xyz"));else if(t===d.VIEW){const e=new(0,u.default)(new(0,h.default)("*",new(0,a.default)(a.default.VIEW_MATRIX),new d(d.LOCAL)),"xyz");i=new(0,c.default)(c.default.NORMALIZE,new(0,o.default)(e))}else if(t===d.WORLD){const e=new(0,c.default)(c.default.TRANSFORM_DIRECTION,new d(d.VIEW),new(0,l.default)(l.default.VIEW_MATRIX));i=new(0,c.default)(c.default.NORMALIZE,new(0,o.default)(e))}return i.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}var f=d})),r.register("lBKnU",(function(t,i){e(t.exports,"default",(()=>o));var n=r("dNuj0");class s extends n.default{constructor(e,t,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=i}getInputType(){return"buffer"}}var o=s})),r.register("5ZPpQ",(function(t,i){e(t.exports,"default",(()=>c));var n=r("9bxft"),s=r("dNuj0"),o=r("keBeo");r("gXpHD");var a=r("eRlxz"),l=r("gXpHD");class h extends n.default{constructor(e,t=null,i=null){super(e,t,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getConstructHash(e){return`${this.uuid} / ${e.context.environmentContext?.uuid||""}`}construct(e){const t=e.getNodeProperties(this),i=this.uvNode||e.context.uvNode||new(0,o.default);let n=this.levelNode||e.context.levelNode;if(!0===n?.isNode){const t=this.value;n=e.context.levelShaderNode?e.context.levelShaderNode.call({texture:t,levelNode:n},e):n}t.uvNode=i,t.levelNode=n}generate(e,t){const{uvNode:i,levelNode:n}=e.getNodeProperties(this),r=this.value;if(!r||!0!==r.isCubeTexture)throw new Error("CubeTextureNode: Need a three.js cube texture.");const o=s.default.prototype.generate.call(this,e,"cubeTexture");if("sampler"===t)return o+"_sampler";if(e.isReference(t))return o;{const r=e.getDataFromNode(this);let s=r.snippet;if(void 0===s||!1===e.context.tempRead){const t=(0,a.nodeObject)(i),h=(0,l.vec3)((0,l.negate)(t.x),t.yz).build(e,"vec3");if(n){const t=n.build(e,"float");s=e.getCubeTextureLevel(o,h,t)}else s=e.getCubeTexture(o,h);r.snippet=s}return e.format(s,"vec4",t)}}}var c=h})),r.register("9bxft",(function(t,i){e(t.exports,"default",(()=>a));var n=r("dNuj0"),s=r("1wpLw");class o extends n.default{constructor(e,t=new(0,s.default),i=null){super(e,"vec4"),this.isTextureNode=!0,this.uvNode=t,this.levelNode=i}getUniformHash(){return this.value.uuid}getInputType(){return"texture"}generate(e,t){const i=this.value;if(!i||!0!==i.isTexture)throw new Error("TextureNode: Need a three.js texture.");const n=super.generate(e,"texture");if("sampler"===t)return n+"_sampler";if(e.isReference(t))return n;{const i=e.getDataFromNode(this);let r=i.snippet;if(void 0===r){const t=this.uvNode.build(e,"vec2"),s=this.levelNode;if(null!==s){const i=s.build(e,"float");r=e.getTextureLevel(n,t,i)}else r=e.getTexture(n,t);i.snippet=r}return e.format(r,"vec4",t)}}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}}var a=o})),r.register("1wpLw",(function(t,i){e(t.exports,"default",(()=>o));var n=r("1dTCL");class s extends n.default{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){const e=this.index;return"uv"+(e>0?e+1:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}var o=s})),r.register("keBeo",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("gXpHD");class o extends n.default{constructor(){super("vec3")}getHash(){return"reflectVector"}construct(){const e=(0,s.reflect)((0,s.negate)(s.positionViewDirection),s.transformedNormalView);return(0,s.transformDirection)(e,s.cameraViewMatrix)}}var a=o})),r.register("gXpHD",(function(t,i){e(t.exports,"float",(()=>D)),e(t.exports,"vec2",(()=>I)),e(t.exports,"vec3",(()=>O)),e(t.exports,"vec4",(()=>k)),e(t.exports,"mat3",(()=>z)),e(t.exports,"mat4",(()=>F)),e(t.exports,"uniform",(()=>B)),e(t.exports,"attribute",(()=>V)),e(t.exports,"bypass",(()=>U)),e(t.exports,"context",(()=>H)),e(t.exports,"instanceIndex",(()=>G)),e(t.exports,"label",(()=>W)),e(t.exports,"temp",(()=>j)),e(t.exports,"EPSILON",(()=>X)),e(t.exports,"cond",(()=>q)),e(t.exports,"add",(()=>J)),e(t.exports,"sub",(()=>K)),e(t.exports,"mul",(()=>Y)),e(t.exports,"div",(()=>Z)),e(t.exports,"equal",(()=>$)),e(t.exports,"assign",(()=>Q)),e(t.exports,"lessThan",(()=>ee)),e(t.exports,"greaterThan",(()=>te)),e(t.exports,"lessThanEqual",(()=>ie)),e(t.exports,"exp2",(()=>ne)),e(t.exports,"log2",(()=>re)),e(t.exports,"sqrt",(()=>se)),e(t.exports,"inversesqrt",(()=>oe)),e(t.exports,"floor",(()=>ae)),e(t.exports,"normalize",(()=>le)),e(t.exports,"fract",(()=>he)),e(t.exports,"sin",(()=>ce)),e(t.exports,"cos",(()=>ue)),e(t.exports,"asin",(()=>de)),e(t.exports,"abs",(()=>fe)),e(t.exports,"sign",(()=>pe)),e(t.exports,"length",(()=>me)),e(t.exports,"negate",(()=>ge)),e(t.exports,"invert",(()=>ve)),e(t.exports,"dFdx",(()=>xe)),e(t.exports,"dFdy",(()=>ye)),e(t.exports,"round",(()=>be)),e(t.exports,"reciprocal",(()=>we)),e(t.exports,"atan2",(()=>Me)),e(t.exports,"min",(()=>Se)),e(t.exports,"max",(()=>_e)),e(t.exports,"mod",(()=>Te)),e(t.exports,"reflect",(()=>Ae)),e(t.exports,"dot",(()=>Ee)),e(t.exports,"cross",(()=>Ce)),e(t.exports,"pow",(()=>Ne)),e(t.exports,"pow2",(()=>Le)),e(t.exports,"pow4",(()=>Re)),e(t.exports,"transformDirection",(()=>Pe)),e(t.exports,"mix",(()=>De)),e(t.exports,"clamp",(()=>Ie)),e(t.exports,"smoothstep",(()=>Oe)),e(t.exports,"buffer",(()=>ke)),e(t.exports,"cameraProjectionMatrix",(()=>ze)),e(t.exports,"cameraViewMatrix",(()=>Fe)),e(t.exports,"materialAlphaTest",(()=>Be)),e(t.exports,"materialColor",(()=>Ve)),e(t.exports,"materialEmissive",(()=>Ue)),e(t.exports,"materialOpacity",(()=>He)),e(t.exports,"materialRoughness",(()=>Ge)),e(t.exports,"materialMetalness",(()=>We)),e(t.exports,"materialRotation",(()=>je)),e(t.exports,"diffuseColor",(()=>Xe)),e(t.exports,"roughness",(()=>qe)),e(t.exports,"specularColor",(()=>Je)),e(t.exports,"modelViewProjection",(()=>Ke)),e(t.exports,"normalGeometry",(()=>Ye)),e(t.exports,"normalLocal",(()=>Ze)),e(t.exports,"normalView",(()=>$e)),e(t.exports,"normalWorld",(()=>Qe)),e(t.exports,"transformedNormalView",(()=>et)),e(t.exports,"transformedNormalWorld",(()=>tt)),e(t.exports,"tangentLocal",(()=>nt)),e(t.exports,"modelViewMatrix",(()=>lt)),e(t.exports,"modelNormalMatrix",(()=>ht)),e(t.exports,"modelWorldMatrix",(()=>ct)),e(t.exports,"positionLocal",(()=>ut)),e(t.exports,"positionWorld",(()=>dt)),e(t.exports,"positionWorldDirection",(()=>ft)),e(t.exports,"positionView",(()=>pt)),e(t.exports,"positionViewDirection",(()=>mt)),e(t.exports,"texture",(()=>gt)),e(t.exports,"uv",(()=>vt)),e(t.exports,"faceDirection",(()=>yt)),e(t.exports,"element",(()=>bt)),e(t.exports,"luminance",(()=>Mt)),e(t.exports,"dotNV",(()=>St)),e(t.exports,"TBNViewMatrix",(()=>_t)),e(t.exports,"ShaderNode",(()=>r("eRlxz").ShaderNode)),e(t.exports,"nodeObject",(()=>r("eRlxz").nodeObject));var n=r("1dTCL"),s=r("c9JOK"),o=r("fqIAV"),a=r("hReqz"),l=r("h7xaO"),h=r("img9u"),c=(r("4aZT1"),r("8NRGC")),u=r("9bhx3"),d=r("dNuj0"),f=r("9GPae"),p=r("jp81s"),m=r("fGeIR"),g=r("lBKnU"),v=r("2As8W"),x=r("hNou2"),y=(r("4T3xN"),r("acP67")),b=r("1XSFF"),w=r("ayxWo"),M=r("8t2cG"),S=r("6JP6R"),_=(r("gGs2B"),r("cXqgv"),r("b7aXd")),T=r("9bxft"),A=(r("aQaYp"),r("1wpLw")),E=r("zOQaT"),C=(r("lmKpo"),r("8rDMm")),N=r("6gQ3M"),L=r("axHTC"),R=r("cjUTR"),P=(r("79kKg"),r("eRlxz"));new(0,P.ConvertType)("color");const D=new(0,P.ConvertType)("float",P.cacheMaps.float),I=(new(0,P.ConvertType)("int",P.cacheMaps.int),new(0,P.ConvertType)("uint",P.cacheMaps.uint),new(0,P.ConvertType)("bool",P.cacheMaps.bool),new(0,P.ConvertType)("vec2")),O=(new(0,P.ConvertType)("ivec2"),new(0,P.ConvertType)("uvec2"),new(0,P.ConvertType)("bvec2"),new(0,P.ConvertType)("vec3")),k=(new(0,P.ConvertType)("ivec3"),new(0,P.ConvertType)("uvec3"),new(0,P.ConvertType)("bvec3"),new(0,P.ConvertType)("vec4")),z=(new(0,P.ConvertType)("ivec4"),new(0,P.ConvertType)("uvec4"),new(0,P.ConvertType)("bvec4"),new(0,P.ConvertType)("mat3")),F=(new(0,P.ConvertType)("imat3"),new(0,P.ConvertType)("umat3"),new(0,P.ConvertType)("bmat3"),new(0,P.ConvertType)("mat4")),B=(new(0,P.ConvertType)("imat4"),new(0,P.ConvertType)("umat4"),new(0,P.ConvertType)("bmat4"),e=>{const t=(0,P.getConstNodeType)(e),i=!0===e.isNode?e.node?.value||e.value:e;return(0,P.nodeObject)(new(0,d.default)(i,t))}),V=(e,t)=>(0,P.nodeObject)(new(0,n.default)(e,t)),U=(0,P.nodeProxy)(s.default),H=((0,P.nodeProxy)(o.default),(0,P.nodeProxy)(a.default)),G=((0,P.nodeProxy)(l.default),(0,P.nodeProxy)(h.default),(0,P.nodeImmutable)(c.default)),W=(0,P.nodeProxy)(f.default),j=W,X=((0,P.nodeProxy)(p.default),D(1e-6)),q=(D(1e6),(0,P.nodeProxy)(L.default)),J=(0,P.nodeProxy)(N.default,"+"),K=(0,P.nodeProxy)(N.default,"-"),Y=(0,P.nodeProxy)(N.default,"*"),Z=(0,P.nodeProxy)(N.default,"/"),$=((0,P.nodeProxy)(N.default,"%"),(0,P.nodeProxy)(N.default,"==")),Q=(0,P.nodeProxy)(N.default,"="),ee=(0,P.nodeProxy)(N.default,"<"),te=(0,P.nodeProxy)(N.default,">"),ie=(0,P.nodeProxy)(N.default,"<="),ne=((0,P.nodeProxy)(N.default,">="),(0,P.nodeProxy)(N.default,"&&"),(0,P.nodeProxy)(N.default,"||"),(0,P.nodeProxy)(N.default,"^^"),(0,P.nodeProxy)(N.default,"&"),(0,P.nodeProxy)(N.default,"|"),(0,P.nodeProxy)(N.default,"^"),(0,P.nodeProxy)(N.default,"<<"),(0,P.nodeProxy)(N.default,">>"),(0,P.nodeProxy)(C.default,C.default.RADIANS),(0,P.nodeProxy)(C.default,C.default.DEGREES),(0,P.nodeProxy)(C.default,C.default.EXP),(0,P.nodeProxy)(C.default,C.default.EXP2)),re=((0,P.nodeProxy)(C.default,C.default.LOG),(0,P.nodeProxy)(C.default,C.default.LOG2)),se=(0,P.nodeProxy)(C.default,C.default.SQRT),oe=(0,P.nodeProxy)(C.default,C.default.INVERSE_SQRT),ae=(0,P.nodeProxy)(C.default,C.default.FLOOR),le=((0,P.nodeProxy)(C.default,C.default.CEIL),(0,P.nodeProxy)(C.default,C.default.NORMALIZE)),he=(0,P.nodeProxy)(C.default,C.default.FRACT),ce=(0,P.nodeProxy)(C.default,C.default.SIN),ue=(0,P.nodeProxy)(C.default,C.default.COS),de=((0,P.nodeProxy)(C.default,C.default.TAN),(0,P.nodeProxy)(C.default,C.default.ASIN)),fe=((0,P.nodeProxy)(C.default,C.default.ACOS),(0,P.nodeProxy)(C.default,C.default.ATAN),(0,P.nodeProxy)(C.default,C.default.ABS)),pe=(0,P.nodeProxy)(C.default,C.default.SIGN),me=(0,P.nodeProxy)(C.default,C.default.LENGTH),ge=(0,P.nodeProxy)(C.default,C.default.NEGATE),ve=(0,P.nodeProxy)(C.default,C.default.INVERT),xe=(0,P.nodeProxy)(C.default,C.default.DFDX),ye=(0,P.nodeProxy)(C.default,C.default.DFDY),be=(0,P.nodeProxy)(C.default,C.default.ROUND),we=(0,P.nodeProxy)(C.default,C.default.RECIPROCAL),Me=(0,P.nodeProxy)(C.default,C.default.ATAN2),Se=(0,P.nodeProxy)(C.default,C.default.MIN),_e=(0,P.nodeProxy)(C.default,C.default.MAX),Te=(0,P.nodeProxy)(C.default,C.default.MOD),Ae=((0,P.nodeProxy)(C.default,C.default.STEP),(0,P.nodeProxy)(C.default,C.default.REFLECT)),Ee=((0,P.nodeProxy)(C.default,C.default.DISTANCE),(0,P.nodeProxy)(C.default,C.default.DOT)),Ce=(0,P.nodeProxy)(C.default,C.default.CROSS),Ne=(0,P.nodeProxy)(C.default,C.default.POW),Le=(0,P.nodeProxy)(C.default,C.default.POW,2),Re=((0,P.nodeProxy)(C.default,C.default.POW,3),(0,P.nodeProxy)(C.default,C.default.POW,4)),Pe=(0,P.nodeProxy)(C.default,C.default.TRANSFORM_DIRECTION),De=(0,P.nodeProxy)(C.default,C.default.MIX),Ie=(e,t=0,i=1)=>(0,P.nodeObject)(new(0,C.default)(C.default.CLAMP,(0,P.nodeObject)(e),(0,P.nodeObject)(t),(0,P.nodeObject)(i))),Oe=((0,P.nodeProxy)(C.default,C.default.REFRACT),(0,P.nodeProxy)(C.default,C.default.SMOOTHSTEP)),ke=((0,P.nodeProxy)(C.default,C.default.FACEFORWARD),(e,t,i)=>(0,P.nodeObject)(new(0,g.default)(e,(0,P.getConstNodeType)(t),i))),ze=(0,P.nodeImmutable)(v.default,v.default.PROJECTION_MATRIX),Fe=(0,P.nodeImmutable)(v.default,v.default.VIEW_MATRIX),Be=((0,P.nodeImmutable)(v.default,v.default.NORMAL_MATRIX),(0,P.nodeImmutable)(v.default,v.default.WORLD_MATRIX),(0,P.nodeImmutable)(v.default,v.default.POSITION),(0,P.nodeImmutable)(x.default,x.default.ALPHA_TEST)),Ve=(0,P.nodeImmutable)(x.default,x.default.COLOR),Ue=(0,P.nodeImmutable)(x.default,x.default.EMISSIVE),He=(0,P.nodeImmutable)(x.default,x.default.OPACITY),Ge=(0,P.nodeImmutable)(x.default,x.default.ROUGHNESS),We=(0,P.nodeImmutable)(x.default,x.default.METALNESS),je=(0,P.nodeImmutable)(x.default,x.default.ROTATION),Xe=(0,P.nodeImmutable)(u.default,"DiffuseColor","vec4"),qe=(0,P.nodeImmutable)(u.default,"Roughness","float"),Je=((0,P.nodeImmutable)(u.default,"Metalness","float"),(0,P.nodeImmutable)(u.default,"AlphaTest","float"),(0,P.nodeImmutable)(u.default,"SpecularColor","color")),Ke=(0,P.nodeProxy)(y.default),Ye=(0,P.nodeImmutable)(b.default,b.default.GEOMETRY),Ze=(0,P.nodeImmutable)(b.default,b.default.LOCAL),$e=(0,P.nodeImmutable)(b.default,b.default.VIEW),Qe=(0,P.nodeImmutable)(b.default,b.default.WORLD),et=(0,P.nodeImmutable)(f.default,$e,"TransformedNormalView"),tt=le(Pe(et,Fe)),it=(0,P.nodeImmutable)(_.default,_.default.GEOMETRY),nt=(0,P.nodeImmutable)(_.default,_.default.LOCAL),rt=(0,P.nodeImmutable)(_.default,_.default.VIEW),st=((0,P.nodeImmutable)(_.default,_.default.WORLD),(0,P.nodeImmutable)(f.default,rt,"TransformedTangentView")),ot=(le(Pe(st,Fe)),(0,P.nodeImmutable)(m.default,m.default.GEOMETRY),(0,P.nodeImmutable)(m.default,m.default.LOCAL),(0,P.nodeImmutable)(m.default,m.default.VIEW)),at=((0,P.nodeImmutable)(m.default,m.default.WORLD),le(Y(Ce(et,st),it.w))),lt=(le(Pe(at,Fe)),(0,P.nodeImmutable)(w.default,w.default.VIEW_MATRIX)),ht=(0,P.nodeImmutable)(w.default,w.default.NORMAL_MATRIX),ct=(0,P.nodeImmutable)(w.default,w.default.WORLD_MATRIX),ut=((0,P.nodeImmutable)(w.default,w.default.POSITION),(0,P.nodeImmutable)(w.default,w.default.VIEW_POSITION),(0,P.nodeImmutable)(S.default,S.default.GEOMETRY),(0,P.nodeImmutable)(S.default,S.default.LOCAL)),dt=(0,P.nodeImmutable)(S.default,S.default.WORLD),ft=(0,P.nodeImmutable)(S.default,S.default.WORLD_DIRECTION),pt=(0,P.nodeImmutable)(S.default,S.default.VIEW),mt=(0,P.nodeImmutable)(S.default,S.default.VIEW_DIRECTION),gt=(0,P.nodeProxy)(T.default),vt=(...e)=>(0,P.nodeObject)(new(0,A.default)(...e)),xt=((0,P.nodeImmutable)(M.default),(0,P.nodeImmutable)(E.default)),yt=K(Y(D(xt),2),1),bt=(0,P.nodeProxy)(R.default),wt=O(.2125,.7154,.0721),Mt=(e,t=wt)=>Ee(e,t),St=Ie(Ee(et,mt)),_t=z(rt,ot,$e)})),r.register("hNou2",(function(t,i){e(t.exports,"default",(()=>c));var n=r("27z08"),s=r("6gQ3M"),o=r("4T3xN"),a=r("9bxft"),l=r("bxuK0");class h extends n.default{static ALPHA_TEST="alphaTest";static COLOR="color";static OPACITY="opacity";static ROUGHNESS="roughness";static METALNESS="metalness";static EMISSIVE="emissive";static ROTATION="rotation";constructor(e=h.COLOR){super(),this.scope=e}getNodeType(e){const t=this.scope,i=e.context.material;return t===h.COLOR?null!==i.map?"vec4":"vec3":t===h.OPACITY||t===h.ROTATION?"float":t===h.EMISSIVE?"vec3":t===h.ROUGHNESS||t===h.METALNESS?"float":void 0}generate(e,t){const i=e.context.material,n=this.scope;let r=null;if(n===h.ALPHA_TEST)r=new(0,o.default)("alphaTest","float");else if(n===h.COLOR){const e=new(0,o.default)("color","color");if(!0===i.map?.isTexture){const t=new(0,a.default)(i.map);r=new(0,s.default)("*",e,t)}else r=e}else if(n===h.OPACITY){const e=new(0,o.default)("opacity","float");r=!0===i.alphaMap?.isTexture?new(0,s.default)("*",e,new(0,o.default)("alphaMap","texture")):e}else if(n===h.ROUGHNESS){const e=new(0,o.default)("roughness","float");r=!0===i.roughnessMap?.isTexture?new(0,s.default)("*",e,new(0,l.default)(new(0,a.default)(i.roughnessMap),"g")):e}else if(n===h.METALNESS){const e=new(0,o.default)("metalness","float");r=!0===i.metalnessMap?.isTexture?new(0,s.default)("*",e,new(0,l.default)(new(0,a.default)(i.metalnessMap),"b")):e}else if(n===h.EMISSIVE){const e=new(0,o.default)("emissive","color");r=!0===i.emissiveMap?.isTexture?new(0,s.default)("*",e,new(0,a.default)(i.emissiveMap)):e}else if(n===h.ROTATION)r=new(0,o.default)("rotation","float");else{const t=this.getNodeType(e);r=new(0,o.default)(n,t)}return r.build(e,t)}}var c=h})),r.register("4T3xN",(function(t,i){e(t.exports,"default",(()=>o));var n=r("gGs2B");class s extends n.default{constructor(e,t,i=null){super(e,t,i),this.material=i}update(e){this.object=null!==this.material?this.material:e.material,super.update(e)}}var o=s})),r.register("gGs2B",(function(t,i){e(t.exports,"default",(()=>l));var n=r("27z08"),s=r("dNuj0"),o=r("2KMsh");class a extends n.default{constructor(e,t,i=null){super(),this.property=e,this.uniformType=t,this.object=i,this.node=null,this.updateType=o.NodeUpdateType.OBJECT,this.setNodeType(t)}setNodeType(e){this.node=new(0,s.default)(null,e),this.nodeType=e,"color"===e?this.nodeType="vec3":"texture"===e&&(this.nodeType="vec4")}getNodeType(){return this.uniformType}update(e){const t=(null!==this.object?this.object:e.object)[this.property];this.node.value=t}generate(e){return this.node.build(e,this.getNodeType(e))}}var l=a})),r.register("acP67",(function(t,i){e(t.exports,"default",(()=>c));var n=r("27z08"),s=r("2As8W"),o=r("ayxWo"),a=r("6gQ3M"),l=r("6JP6R");class h extends n.default{constructor(e=new(0,l.default)){super("vec4"),this.position=e}generate(e){const t=this.position,i=new(0,a.default)("*",new(0,s.default)(s.default.PROJECTION_MATRIX),new(0,o.default)(o.default.VIEW_MATRIX));return new(0,a.default)("*",i,t).build(e)}}var c=h})),r.register("6JP6R",(function(t,i){e(t.exports,"default",(()=>u));var n=r("27z08"),s=r("1dTCL"),o=r("jp81s"),a=r("ayxWo"),l=r("8rDMm"),h=r("6gQ3M");class c extends n.default{static GEOMETRY="geometry";static LOCAL="local";static WORLD="world";static WORLD_DIRECTION="worldDirection";static VIEW="view";static VIEW_DIRECTION="viewDirection";constructor(e=c.LOCAL){super("vec3"),this.scope=e}getHash(){return`position-${this.scope}`}generate(e){const t=this.scope;let i=null;if(t===c.GEOMETRY)i=new(0,s.default)("position","vec3");else if(t===c.LOCAL)i=new(0,o.default)(new c(c.GEOMETRY));else if(t===c.WORLD){const e=new(0,l.default)(l.default.TRANSFORM_DIRECTION,new(0,a.default)(a.default.WORLD_MATRIX),new c(c.LOCAL));i=new(0,o.default)(e)}else if(t===c.VIEW){const e=new(0,h.default)("*",new(0,a.default)(a.default.VIEW_MATRIX),new c(c.LOCAL));i=new(0,o.default)(e)}else if(t===c.VIEW_DIRECTION){const e=new(0,l.default)(l.default.NEGATE,new c(c.VIEW));i=new(0,l.default)(l.default.NORMALIZE,new(0,o.default)(e))}else if(t===c.WORLD_DIRECTION){const e=new(0,l.default)(l.default.NEGATE,new c(c.WORLD));i=new(0,l.default)(l.default.NORMALIZE,new(0,o.default)(e))}return i.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}var u=c})),r.register("8t2cG",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}var o=s})),r.register("cXqgv",(function(t,i){e(t.exports,"default",(()=>o));var n=r("lBKnU");class s extends n.default{constructor(e,t,i=0){super(e,t,i),this.isStorageBufferNode=!0}getInputType(){return"storageBuffer"}}var o=s})),r.register("aQaYp",(function(t,i){e(t.exports,"default",(()=>o));var n=r("gGs2B");class s extends n.default{constructor(e,t,i=null){super(e,t,i),this.userData=i}update(e){this.object=null!==this.userData?this.userData:e.object.userData,super.update(e)}}var o=s})),r.register("zOQaT",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}var o=s})),r.register("lmKpo",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("2KMsh");class o extends n.default{constructor(e,t,i=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=i,this.dispatchCount=0,this.updateType=s.NodeUpdateType.OBJECT,this.updateDispatchCount()}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let i=t[0];for(let e=1;e<t.length;e++)i*=t[e];this.dispatchCount=Math.ceil(e/i)}onInit(){}update({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if("compute"===t){const t=this.computeNode.build(e,"void");""!==t&&e.addFlowCode(t)}}}var a=o})),r.register("axHTC",(function(t,i){e(t.exports,"default",(()=>l));var n=r("27z08"),s=r("9bhx3"),o=r("hReqz");class a extends n.default{constructor(e,t,i){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const t=this.ifNode.getNodeType(e),i=this.elseNode.getNodeType(e);return e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e){const t=this.getNodeType(e),i={tempWrite:!1},n=new(0,s.default)(null,t).build(e),r=new(0,o.default)(this.condNode).build(e,"bool"),a=new(0,o.default)(this.ifNode,i).build(e,t),l=new(0,o.default)(this.elseNode,i).build(e,t);return e.addFlowCode(`if ( ${r} ) {\n\n\t\t${n} = ${a};\n\n\t} else {\n\n\t\t${n} = ${l};\n\n\t}`),n}}var l=a})),r.register("cjUTR",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e,t){super(),this.node=e,this.indexNode=t}getNodeType(e){return this.node.getNodeType(e)}generate(e){return`${this.node.build(e)}[ ${this.indexNode.build(e,"uint")} ]`}}var o=s})),r.register("79kKg",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const n of this.convertTo.split("|"))null!==i&&e.getTypeLength(t)!==e.getTypeLength(n)||(i=n);return i}generate(e,t){const i=this.node,n=this.getNodeType(e),r=i.build(e,n);return e.format(r,n,t)}}var o=s})),r.register("eRlxz",(function(t,i){e(t.exports,"nodeObjects",(()=>x)),e(t.exports,"nodeObject",(()=>v)),e(t.exports,"nodeArray",(()=>y)),e(t.exports,"ShaderNode",(()=>g)),e(t.exports,"nodeProxy",(()=>b)),e(t.exports,"nodeImmutable",(()=>w)),e(t.exports,"cacheMaps",(()=>L)),e(t.exports,"ConvertType",(()=>D)),e(t.exports,"getConstNodeType",(()=>I));var n=r("cjUTR"),s=r("79kKg"),o=r("dRmZ4"),a=r("bxuK0"),l=r("d9q8O"),h=r("5NcGx");const c={construct(e,t){const i=t.shift();return e(x(i),...t)},get:function(e,t){if("string"==typeof t&&void 0===e[t]){if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return t=t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),v(new(0,a.default)(e,t));if(!0===/^\d+$/.test(t))return v(new(0,n.default)(e,new(0,l.default)(Number(t),"uint")))}return e[t]}},u=new WeakMap,d=function(e){for(const t in e)e[t]=v(e[t]);return e},f=function(e){const t=e.length;for(let i=0;i<t;i++)e[i]=v(e[i]);return e},p=function(e,t=null,i=null,n=null){const r=e=>v(null!==n?Object.assign(e,n):e);return null===t?(...t)=>r(new e(...y(t))):null!==i?(i=v(i),(...n)=>r(new e(t,...y(n),i))):(...i)=>r(new e(t,...y(i)))},m=function(e,...t){return v(new e(...y(t)))},g=new Proxy((function(e){const t={build:e=>(t.call({},e),""),call:(t,i)=>(t=x(t),v(e(t,i)))};return t}),c),v=e=>function(e){const t=typeof e;if("number"===t||"boolean"===t)return v(P(e));if("object"===t&&!0===e?.isNode){let t=u.get(e);return void 0===t&&(t=new Proxy(e,c),u.set(e,t),u.set(t,t)),t}return e}(e),x=e=>new d(e),y=e=>new f(e),b=(...e)=>new p(...e),w=(...e)=>new m(...e),M=[!1,!0],S=[0,1,2,3],_=[-1,-2],T=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],A=new Map;for(const e of M)A.set(e,new(0,l.default)(e));const E=new Map;for(const e of S)E.set(e,new(0,l.default)(e,"uint"));const C=new Map([...E].map((e=>new(0,l.default)(e.value,"int"))));for(const e of _)C.set(e,new(0,l.default)(e,"int"));const N=new Map([...C].map((e=>new(0,l.default)(e.value))));for(const e of T)N.set(e,new(0,l.default)(e));for(const e of T)N.set(-e,new(0,l.default)(-e));const L={bool:A,uint:E,ints:C,float:N},R=new Map([...A,...N]),P=e=>R.has(e)?R.get(e):!0===e.isNode?e:new(0,l.default)(e),D=function(e,t=null){return(...i)=>{if(0===i.length)return v(new(0,l.default)((0,h.getValueFromType)(e),e));{if("color"===e&&!0!==i[0].isNode&&(i=[(0,h.getValueFromType)(e,...i)]),1===i.length&&null!==t&&t.has(i[0]))return t.get(i[0]);const n=i.map(P);return 1===n.length?v(n[0].nodeType===e?n[0]:new(0,s.default)(n[0],e)):v(new(0,s.default)(new(0,o.default)(n),e))}}},I=e=>e.nodeType||e.convertTo||("string"==typeof e?e:null)})),r.register("dRmZ4",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(e=[]){super(),this.nodes=e}getNodeType(e){return e.getTypeFromLength(this.nodes.reduce(((t,i)=>t+e.getTypeLength(i.getNodeType(e))),0))}generate(e,t){const i=this.getNodeType(e),n=this.nodes,r=[];for(const t of n){const i=t.build(e);r.push(i)}const s=`${e.getType(i)}( ${r.join(", ")} )`;return e.format(s,i,t)}}var o=s})),r.register("cj5MD",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("gXpHD");class o extends n.default{constructor(e){super("void"),this.instanceMesh=e;const t=(0,s.buffer)(e.instanceMatrix.array,"mat4",e.count);this.instanceMatrixNode=(0,s.temp)((0,s.element)(t,s.instanceIndex))}generate(e){const{instanceMatrixNode:t}=this,i=(0,s.mul)(t,s.positionLocal).xyz,n=(0,s.mat3)(t[0].xyz,t[1].xyz,t[2].xyz),r=(0,s.div)(s.normalLocal,(0,s.vec3)((0,s.dot)(n[0],n[0]),(0,s.dot)(n[1],n[1]),(0,s.dot)(n[2],n[2]))),o=(0,s.mul)(n,r).xyz;(0,s.assign)(s.positionLocal,i).build(e),(0,s.assign)(s.normalLocal,o).build(e)}}var a=o})),r.register("7uPAK",(function(t,i){e(t.exports,"default",(()=>c));var n=r("27z08");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD"),a=r("2KMsh");const l=new(0,s.ShaderNode)(((e,t)=>{const{index:i,weight:n,bindMatrix:r,bindMatrixInverse:s,boneMatrices:a}=e,l=(0,o.element)(a,i.x),h=(0,o.element)(a,i.y),c=(0,o.element)(a,i.z),u=(0,o.element)(a,i.w),d=(0,o.mul)(r,o.positionLocal),f=(0,o.add)((0,o.mul)((0,o.mul)(l,d),n.x),(0,o.mul)((0,o.mul)(h,d),n.y),(0,o.mul)((0,o.mul)(c,d),n.z),(0,o.mul)((0,o.mul)(u,d),n.w)),p=(0,o.mul)(s,f).xyz;let m=(0,o.add)((0,o.mul)(n.x,l),(0,o.mul)(n.y,h),(0,o.mul)(n.z,c),(0,o.mul)(n.w,u));m=(0,o.mul)((0,o.mul)(s,m),r);const g=(0,o.transformDirection)(m,o.normalLocal).xyz;(0,o.assign)(o.positionLocal,p).build(t),(0,o.assign)(o.normalLocal,g).build(t),t.hasGeometryAttribute("tangent")&&(0,o.assign)(o.tangentLocal,g).build(t)}));class h extends n.default{constructor(e){super("void"),this.skinnedMesh=e,this.updateType=a.NodeUpdateType.OBJECT,this.skinIndexNode=(0,o.attribute)("skinIndex","uvec4"),this.skinWeightNode=(0,o.attribute)("skinWeight","vec4"),this.bindMatrixNode=(0,o.uniform)((0,o.mat4)(e.bindMatrix)),this.bindMatrixInverseNode=(0,o.uniform)((0,o.mat4)(e.bindMatrixInverse)),this.boneMatricesNode=(0,o.buffer)(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)}generate(e){l.call({index:this.skinIndexNode,weight:this.skinWeightNode,bindMatrix:this.bindMatrixNode,bindMatrixInverse:this.bindMatrixInverseNode,boneMatrices:this.boneMatricesNode},e)}update(){this.skinnedMesh.skeleton.update()}}var c=h})),r.register("11NBw",(function(t,i){e(t.exports,"default",(()=>l));var n=r("27z08"),s=r("gXpHD"),o=r("4xklQ");class a extends n.default{constructor(e,t){super(),this.min=e,this.max=t}getVectorLength(){const e=this.min;let t=1;return e.isVector2?t=2:e.isVector3?t=3:e.isVector4?t=4:e.isColor&&(t=3),t}getNodeType(e){return!0===e.object.isInstancedMesh?e.getTypeFromLength(this.getVectorLength()):"float"}construct(e){const{min:t,max:i}=this,{object:n,geometry:r}=e;let a=null;if(!0===n.isInstancedMesh){const l=this.getVectorLength(),h="node"+this.id,c=l*n.count,u=new Float32Array(c),d=r.getAttribute(h);if(void 0===d||d.array.length<c){if(1===l)for(let e=0;e<c;e++)u[e]=o.MathUtils.lerp(t,i,Math.random());else if(t.isColor)for(let e=0;e<c;e+=3)u[e]=o.MathUtils.lerp(t.r,i.r,Math.random()),u[e+1]=o.MathUtils.lerp(t.g,i.g,Math.random()),u[e+2]=o.MathUtils.lerp(t.b,i.b,Math.random());else for(let e=0;e<c;e++){const n=e%l,r=t.getComponent(n),s=i.getComponent(n);u[e]=o.MathUtils.lerp(r,s,Math.random())}r.setAttribute(h,new(0,o.InstancedBufferAttribute)(u,l)),r.dispose()}a=(0,s.attribute)(h,e.getTypeFromLength(l))}else a=(0,s.float)(0);return a}}var l=a})),r.register("gioHs",(function(t,i){e(t.exports,"default",(()=>d));var n=r("27z08");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD");const a=new(0,s.ShaderNode)((({base:e,blend:t})=>{const i=i=>(0,o.cond)((0,o.lessThan)(t[i],o.EPSILON),t[i],(0,o.max)((0,o.sub)(1,(0,o.div)((0,o.sub)(1,e[i]),t[i])),0));return(0,o.vec3)(i("x"),i("y"),i("z"))})),l=new(0,s.ShaderNode)((({base:e,blend:t})=>{const i=i=>(0,o.cond)((0,o.equal)(t[i],1),t[i],(0,o.max)((0,o.div)(e[i],(0,o.sub)(1,t[i])),0));return(0,o.vec3)(i("x"),i("y"),i("z"))})),h=new(0,s.ShaderNode)((({base:e,blend:t})=>{const i=i=>(0,o.sub)(1,(0,o.mul)((0,o.sub)(1,e[i]),(0,o.sub)(1,t[i])));return(0,o.vec3)(i("x"),i("y"),i("z"))})),c=new(0,s.ShaderNode)((({base:e,blend:t})=>{const i=i=>(0,o.cond)((0,o.lessThan)(e[i],.5),(0,o.mul)(2,e[i],t[i]),(0,o.sub)(1,(0,o.mul)((0,o.sub)(1,e[i]),(0,o.sub)(1,t[i]))));return(0,o.vec3)(i("x"),i("y"),i("z"))}));class u extends n.default{static BURN="burn";static DODGE="dodge";static SCREEN="screen";static OVERLAY="overlay";constructor(e,t,i){super(),this.blendMode=e,this.baseNode=t,this.blendNode=i}construct(){const{blendMode:e,baseNode:t,blendNode:i}=this,n={base:t,blend:i};let r=null;return e===u.BURN?r=a.call(n):e===u.DODGE?r=l.call(n):e===u.SCREEN?r=h.call(n):e===u.OVERLAY&&(r=c.call(n)),r}}var d=u})),r.register("aBHmb",(function(t,i){e(t.exports,"default",(()=>u));var n=r("9XdoA");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD");const a=new(0,s.ShaderNode)((({color:e,adjustment:t})=>(0,o.mix)((0,o.luminance)(e),e,t))),l=new(0,s.ShaderNode)((({color:e,adjustment:t})=>{const i=(0,o.div)((0,o.add)(e.r,e.g,e.b),3),n=(0,o.max)(e.r,(0,o.max)(e.g,e.b)),r=(0,o.mul)((0,o.sub)(n,i),(0,o.mul)(-3,t));return(0,o.mix)(e.rgb,(0,o.vec3)(n),r)})),h=new(0,s.ShaderNode)((({color:e,adjustment:t})=>{const i=(0,o.mat3)(.299,.587,.114,.595716,-.274453,-.321263,.211456,-.522591,.311135),n=(0,o.mat3)(1,.9563,.621,1,-.2721,-.6474,1,-1.107,1.7046),r=(0,o.mul)(i,e),s=(0,o.add)((0,o.atan2)(r.z,r.y),t),a=(0,o.sqrt)((0,o.add)((0,o.mul)(r.z,r.z),(0,o.mul)(r.y,r.y)));return(0,o.mul)(n,(0,o.vec3)(r.x,(0,o.mul)(a,(0,o.cos)(s)),(0,o.mul)(a,(0,o.sin)(s))))}));class c extends n.default{static SATURATION="saturation";static VIBRANCE="vibrance";static HUE="hue";constructor(e,t,i=(0,o.float)(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=i}construct(){const{method:e,colorNode:t,adjustmentNode:i}=this,n={color:t,adjustment:i};let r=null;return e===c.SATURATION?r=a.call(n):e===c.VIBRANCE?r=l.call(n):e===c.HUE?r=h.call(n):console.error(`${this.type}: Method "${this.method}" not supported!`),r}}var u=c})),r.register("grWGA",(function(t,i){e(t.exports,"default",(()=>c));var n=r("27z08");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD"),a=r("4xklQ");const l={LinearToLinear:new(0,s.ShaderNode)((e=>e.value)),LinearTosRGB:new(0,s.ShaderNode)((e=>{const{value:t}=e,i=t.rgb,n=(0,o.sub)((0,o.mul)((0,o.pow)(t.rgb,(0,o.vec3)(.41666)),1.055),(0,o.vec3)(.055)),r=(0,o.mul)(i,12.92),s=(0,o.vec3)((0,o.lessThanEqual)(i,(0,o.vec3)(.0031308))),a=(0,o.mix)(n,r,s);return(0,o.vec4)(a,t.a)}))};class h extends n.default{static LINEAR_TO_LINEAR="LinearToLinear";static LINEAR_TO_SRGB="LinearTosRGB";constructor(e,t){super("vec4"),this.method=e,this.node=t}fromEncoding(e){let t=null;return e===a.LinearEncoding?t="Linear":e===a.sRGBEncoding&&(t="sRGB"),this.method="LinearTo"+t,this}construct(){const e=this.method,t=this.node;let i=null;if(e!==h.LINEAR_TO_LINEAR){i=l[e].call({value:t})}else i=t;return i}}var c=h})),r.register("kz9ky",(function(t,i){e(t.exports,"default",(()=>c));var n=r("9XdoA");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD"),a=r("4xklQ");const l=new(0,s.ShaderNode)((e=>{const{eye_pos:t,surf_norm:i,mapN:n,uv:r}=e,s=(0,o.dFdx)(t.xyz),a=(0,o.dFdy)(t.xyz),l=(0,o.dFdx)(r.st),h=(0,o.dFdy)(r.st),c=i,u=(0,o.cross)(a,c),d=(0,o.cross)(c,s),f=(0,o.add)((0,o.mul)(u,l.x),(0,o.mul)(d,h.x)),p=(0,o.add)((0,o.mul)(u,l.y),(0,o.mul)(d,h.y)),m=(0,o.max)((0,o.dot)(f,f),(0,o.dot)(p,p)),g=(0,o.mul)(o.faceDirection,(0,o.inversesqrt)(m));return(0,o.normalize)((0,o.add)((0,o.mul)(f,(0,o.mul)(n.x,g)),(0,o.mul)(p,(0,o.mul)(n.y,g)),(0,o.mul)(c,n.z)))}));class h extends n.default{constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=a.TangentSpaceNormalMap}construct(e){const{normalMapType:t,scaleNode:i}=this,n=(0,o.mul)(this.node,2);let r=(0,o.sub)(n,1);if(null!==i){const e=(0,o.mul)(r.xy,i);r=(0,o.vec3)(e,r.z)}let s=null;if(t===a.ObjectSpaceNormalMap)s=(0,o.normalize)((0,o.mul)(o.modelNormalMatrix,r));else if(t===a.TangentSpaceNormalMap){s=!0===e.hasGeometryAttribute("tangent")?(0,o.normalize)((0,o.mul)(o.TBNViewMatrix,r)):l.call({eye_pos:o.positionView,surf_norm:o.normalView,mapN:r,uv:(0,o.uv)()})}return s}}var c=h})),r.register("kEYIm",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("gXpHD");class o extends n.default{constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}construct(){const{sourceNode:e,stepsNode:t}=this;return(0,s.mul)((0,s.floor)((0,s.mul)(e,t)),(0,s.reciprocal)(t))}}var a=o})),r.register("Q6D6b",(function(t,i){e(t.exports,"default",(()=>c));var n=r("27z08");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD"),a=r("4xklQ");const l=new(0,s.ShaderNode)((({color:e,exposure:t})=>(0,o.mul)(e,t)));class h extends n.default{constructor(e,t=(0,o.float)(1),i=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=i}construct(e){const t=this.color||e.context.color,i=this.toneMapping,n={exposure:this.exposureNode,color:t};let r=null;return r=i===a.LinearToneMapping?l.call(n):this.colorNode,r}}var c=h})),r.register("cHZZJ",(function(t,i){e(t.exports,"default",(()=>u));var n=r("8ZXQy"),s=r("ibxJj"),o=r("iXGFp"),a=r("20Fty");r("cgyEO");var l=r("gXpHD"),h=r("4xklQ");class c extends n.default{constructor(e=null){super(e),this.cutoffDistanceNode=(0,l.uniform)(0),this.decayExponentNode=(0,l.uniform)(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}construct(e){const{colorNode:t,cutoffDistanceNode:i,decayExponentNode:n}=this,r=new(0,o.default)(o.default.VIEW_POSITION,this.light),s=(0,l.sub)(r,l.positionView),h=(0,l.normalize)(s),c=(0,l.length)(s),u=a.default.call({lightDistance:c,cutoffDistance:i,decayExponent:n}),d=(0,l.mul)(t,u),f=e.context.lightingModelNode,p=e.context.reflectedLight;f?.direct&&f.direct.call({lightDirection:h,lightColor:d,reflectedLight:p},e)}}s.default.setReference(h.PointLight,c);var u=c})),r.register("8ZXQy",(function(t,i){e(t.exports,"default",(()=>h));var n=r("kM6Ih"),s=r("2KMsh");r("cgyEO");var o=r("gXpHD"),a=r("4xklQ");class l extends n.default{constructor(e=null){super(),this.updateType=s.NodeUpdateType.OBJECT,this.light=e,this.colorNode=(0,o.uniform)(new(0,a.Color))}getHash(){return this.light.uuid}update(){const{light:e}=this;this.colorNode.value.copy(e.color).multiplyScalar(e.intensity)}}var h=l})),r.register("kM6Ih",(function(t,i){e(t.exports,"default",(()=>o));var n=r("27z08");class s extends n.default{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}var o=s})),r.register("cgyEO",(function(t,i){e(t.exports,"instance",(()=>E)),e(t.exports,"skinning",(()=>C)),e(t.exports,"colorSpace",(()=>N)),e(t.exports,"lightingContext",(()=>L)),e(t.exports,"uniform",(()=>r("gXpHD").uniform)),e(t.exports,"sub",(()=>r("gXpHD").sub)),e(t.exports,"positionView",(()=>r("gXpHD").positionView)),e(t.exports,"normalize",(()=>r("gXpHD").normalize)),e(t.exports,"length",(()=>r("gXpHD").length)),e(t.exports,"mul",(()=>r("gXpHD").mul)),e(t.exports,"add",(()=>r("gXpHD").add)),e(t.exports,"float",(()=>r("gXpHD").float)),e(t.exports,"positionWorldDirection",(()=>r("gXpHD").positionWorldDirection)),e(t.exports,"nodeObject",(()=>r("eRlxz").nodeObject)),e(t.exports,"atan2",(()=>r("gXpHD").atan2)),e(t.exports,"asin",(()=>r("gXpHD").asin)),e(t.exports,"clamp",(()=>r("gXpHD").clamp)),e(t.exports,"vec2",(()=>r("gXpHD").vec2)),e(t.exports,"ShaderNode",(()=>r("eRlxz").ShaderNode)),e(t.exports,"div",(()=>r("gXpHD").div)),e(t.exports,"log2",(()=>r("gXpHD").log2)),e(t.exports,"reflect",(()=>r("gXpHD").reflect)),e(t.exports,"negate",(()=>r("gXpHD").negate)),e(t.exports,"positionViewDirection",(()=>r("gXpHD").positionViewDirection)),e(t.exports,"transformedNormalView",(()=>r("gXpHD").transformedNormalView)),e(t.exports,"mix",(()=>r("gXpHD").mix)),e(t.exports,"roughness",(()=>r("gXpHD").roughness)),e(t.exports,"transformDirection",(()=>r("gXpHD").transformDirection)),e(t.exports,"cameraViewMatrix",(()=>r("gXpHD").cameraViewMatrix)),e(t.exports,"transformedNormalWorld",(()=>r("gXpHD").transformedNormalWorld)),e(t.exports,"dot",(()=>r("gXpHD").dot)),e(t.exports,"normalView",(()=>r("gXpHD").normalView)),e(t.exports,"positionLocal",(()=>r("gXpHD").positionLocal)),e(t.exports,"bypass",(()=>r("gXpHD").bypass)),e(t.exports,"assign",(()=>r("gXpHD").assign)),e(t.exports,"modelViewProjection",(()=>r("gXpHD").modelViewProjection)),e(t.exports,"vec4",(()=>r("gXpHD").vec4)),e(t.exports,"materialColor",(()=>r("gXpHD").materialColor)),e(t.exports,"materialOpacity",(()=>r("gXpHD").materialOpacity)),e(t.exports,"label",(()=>r("gXpHD").label)),e(t.exports,"materialAlphaTest",(()=>r("gXpHD").materialAlphaTest)),e(t.exports,"vec3",(()=>r("gXpHD").vec3)),e(t.exports,"specularColor",(()=>r("gXpHD").specularColor)),e(t.exports,"temp",(()=>r("gXpHD").temp)),e(t.exports,"diffuseColor",(()=>r("gXpHD").diffuseColor)),e(t.exports,"dotNV",(()=>r("gXpHD").dotNV)),e(t.exports,"exp2",(()=>r("gXpHD").exp2)),e(t.exports,"pow",(()=>r("gXpHD").pow)),e(t.exports,"min",(()=>r("gXpHD").min)),e(t.exports,"modelViewMatrix",(()=>r("gXpHD").modelViewMatrix)),e(t.exports,"modelWorldMatrix",(()=>r("gXpHD").modelWorldMatrix)),e(t.exports,"materialRotation",(()=>r("gXpHD").materialRotation)),e(t.exports,"cos",(()=>r("gXpHD").cos)),e(t.exports,"sin",(()=>r("gXpHD").sin)),e(t.exports,"cameraProjectionMatrix",(()=>r("gXpHD").cameraProjectionMatrix)),e(t.exports,"texture",(()=>r("gXpHD").texture)),e(t.exports,"materialMetalness",(()=>r("gXpHD").materialMetalness)),e(t.exports,"invert",(()=>r("gXpHD").invert)),e(t.exports,"materialRoughness",(()=>r("gXpHD").materialRoughness)),e(t.exports,"materialEmissive",(()=>r("gXpHD").materialEmissive)),e(t.exports,"context",(()=>r("gXpHD").context));var n=r("5ZPpQ"),s=r("cj5MD"),o=r("keBeo"),a=r("7uPAK"),l=r("gioHs"),h=r("aBHmb"),c=r("grWGA"),u=r("kz9ky"),d=r("kEYIm"),f=(r("Q6D6b"),r("ibxJj"),r("bi8Ru")),p=r("6DN49"),m=r("5kSJa"),g=r("2Jf5Y"),v=r("fbYb2"),x=r("9ZhNV"),y=r("4kAkA"),b=r("1qRuO"),w=r("jNF4N"),M=r("3GDng"),S=(r("11NBw"),r("ehKYv")),_=r("iHl8L"),T=r("drYRh"),A=r("eRlxz");r("gXpHD");(0,A.nodeProxy)(n.default);const E=(0,A.nodeProxy)(s.default),C=((0,A.nodeImmutable)(o.default),(0,A.nodeProxy)(a.default)),N=((0,A.nodeProxy)(l.default,l.default.BURN),(0,A.nodeProxy)(l.default,l.default.DODGE),(0,A.nodeProxy)(l.default,l.default.OVERLAY),(0,A.nodeProxy)(l.default,l.default.SCREEN),(0,A.nodeProxy)(h.default,h.default.SATURATION),(0,A.nodeProxy)(h.default,h.default.VIBRANCE),(0,A.nodeProxy)(h.default,h.default.HUE),(e,t)=>(0,A.nodeObject)(new(0,c.default)(null,(0,A.nodeObject)(e)).fromEncoding(t))),L=((0,A.nodeProxy)(u.default),(0,A.nodeProxy)(d.default),(0,A.nodeProxy)(f.default));(0,A.nodeImmutable)(m.default),(0,A.nodeProxy)(p.default),(0,A.nodeProxy)(g.default),(0,A.nodeProxy)(v.default,v.default.SINE),(0,A.nodeProxy)(v.default,v.default.SQUARE),(0,A.nodeProxy)(v.default,v.default.TRIANGLE),(0,A.nodeProxy)(v.default,v.default.SAWTOOTH),(0,A.nodeProxy)(x.default,null,null,{doClamp:!1}),(0,A.nodeProxy)(x.default),(0,A.nodeProxy)(y.default),(0,A.nodeProxy)(b.default),(0,A.nodeImmutable)(w.default,w.default.FRAME),(0,A.nodeProxy)(M.default),(0,A.nodeProxy)(S.default),(0,A.nodeProxy)(_.default),(0,A.nodeProxy)(T.default)})),r.register("ibxJj",(function(t,i){e(t.exports,"default",(()=>l));var n=r("27z08"),s=r("kM6Ih");const o=new WeakMap;class a extends n.default{constructor(e=[]){super("vec3"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}construct(e){const t=this.lightNodes;for(const i of t)i.build(e)}getHash(e){if(null===this._hash){let t="";const i=this.lightNodes;for(const n of i)t+=n.getHash(e)+" ";this._hash=t}return this._hash}getLightNodeByHash(e){const t=this.lightNodes;for(const i of t)if(i.light.uuid===e)return i;return null}fromLights(e){const t=[];e=(e=>e.sort(((e,t)=>e.id-t.id)))(e);for(const i of e){let e=this.getLightNodeByHash(i.uuid);if(null===e){const t=i.constructor;e=new(o.has(t)?o.get(t):s.default)(i)}t.push(e)}return this.lightNodes=t,this._hash=null,this}static setReference(e,t){o.set(e,t)}}var l=a})),r.register("bi8Ru",(function(t,i){e(t.exports,"default",(()=>a));var n=r("hReqz"),s=r("gXpHD");class o extends n.default{constructor(e,t=null){super(e),this.lightingModelNode=t}getNodeType(){return"vec3"}construct(e){const{lightingModelNode:t}=this,i=this.context={},n=e.getNodeProperties(this),r=(0,s.temp)((0,s.vec3)()),o=(0,s.temp)((0,s.vec3)()),a=(0,s.temp)((0,s.vec3)()),l=(0,s.temp)((0,s.vec3)()),h={directDiffuse:r,directSpecular:o,indirectDiffuse:a,indirectSpecular:l,total:(0,s.add)(r,o,a,l)},c={radiance:(0,s.temp)((0,s.vec3)()),irradiance:(0,s.temp)((0,s.vec3)()),iblIrradiance:(0,s.temp)((0,s.vec3)()),ambientOcclusion:(0,s.temp)((0,s.float)(1))};return Object.assign(n,h,c),Object.assign(i,c),i.reflectedLight=h,i.lightingModelNode=t||i.lightingModelNode,t?.indirectDiffuse&&t.indirectDiffuse.call(i),t?.indirectSpecular&&t.indirectSpecular.call(i),t?.ambientOcclusion&&t.ambientOcclusion.call(i),super.construct(e)}generate(e){const{context:t}=this,i=this.getNodeType(e);return super.generate(e,i),t.reflectedLight.total.build(e,i)}}var a=o})),r.register("6DN49",(function(t,i){e(t.exports,"default",(()=>l));var n=r("9XdoA");r("cgyEO");var s=r("gXpHD"),o=r("eRlxz");class a extends n.default{constructor(e=s.positionWorldDirection){super("vec2"),this.dirNode=e}construct(){const e=(0,o.nodeObject)(this.dirNode),t=(0,s.add)((0,s.mul)((0,s.atan2)(e.z,e.x),1/(2*Math.PI)),.5),i=(0,s.add)((0,s.mul)((0,s.asin)((0,s.clamp)(e.y,-1,1)),1/Math.PI),.5);return(0,s.vec2)(t,i)}}var l=a})),r.register("5kSJa",(function(t,i){e(t.exports,"default",(()=>a));var n=r("9XdoA"),s=r("gXpHD");class o extends n.default{constructor(){super("vec2")}construct(){const e=(0,s.normalize)((0,s.vec3)(s.positionViewDirection.z,0,(0,s.negate)(s.positionViewDirection.x))),t=(0,s.cross)(s.positionViewDirection,e);return(0,s.add)((0,s.mul)((0,s.vec2)((0,s.dot)(e,s.transformedNormalView),(0,s.dot)(t,s.transformedNormalView)),.495),.5)}}var a=o})),r.register("2Jf5Y",(function(t,i){e(t.exports,"default",(()=>a));var n=r("dNuj0"),s=r("2KMsh");class o extends n.default{constructor(e){super(0),this.texture=e,this.updateType=s.NodeUpdateType.FRAME}update(){const e=this.texture.images,t=e&&e.length>0?e[0]?.image||e[0]:this.texture.image;if(void 0!==t?.width){const{width:e,height:i}=t;this.value=Math.log2(Math.max(e,i))}}}var a=o})),r.register("fbYb2",(function(t,i){e(t.exports,"default",(()=>l));var n=r("27z08"),s=r("jNF4N"),o=r("gXpHD");class a extends n.default{static SINE="sine";static SQUARE="square";static TRIANGLE="triangle";static SAWTOOTH="sawtooth";constructor(e=a.SINE,t=new(0,s.default)){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}construct(){const e=this.method,t=this.timeNode;let i=null;return e===a.SINE?i=(0,o.add)((0,o.mul)((0,o.sin)((0,o.mul)((0,o.add)(t,.75),2*Math.PI)),.5),.5):e===a.SQUARE?i=(0,o.round)((0,o.fract)(t)):e===a.TRIANGLE?i=(0,o.abs)((0,o.sub)(1,(0,o.mul)((0,o.fract)((0,o.add)(t,.5)),2))):e===a.SAWTOOTH&&(i=(0,o.fract)(t)),i}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}var l=a})),r.register("jNF4N",(function(t,i){e(t.exports,"default",(()=>a));var n=r("dNuj0"),s=r("2KMsh");class o extends n.default{static LOCAL="local";static GLOBAL="global";static DELTA="delta";static FRAME="frame";constructor(e=o.LOCAL,t=1,i=0){super(i),this.scope=e,this.scale=t,this.updateType=s.NodeUpdateType.FRAME}update(e){const t=this.scope,i=this.scale;t===o.LOCAL?this.value+=e.deltaTime*i:this.value=t===o.DELTA?e.deltaTime*i:t===o.FRAME?e.frameId:e.time*i}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}var a=o})),r.register("9ZhNV",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("gXpHD");class o extends n.default{constructor(e,t,i,n,r){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=n,this.outHighNode=r,this.doClamp=!0}construct(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:n,outHighNode:r,doClamp:o}=this;let a=(0,s.div)((0,s.sub)(e,t),(0,s.sub)(i,t));return!0===o&&(a=(0,s.clamp)(a)),(0,s.add)((0,s.mul)((0,s.sub)(r,n),a),n)}}var a=o})),r.register("4kAkA",(function(t,i){e(t.exports,"default",(()=>a));var n=r("9XdoA"),s=r("gXpHD");class o extends n.default{constructor(e,t,i=(0,s.vec2)(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=i}construct(){const{uvNode:e,rotationNode:t,centerNode:i}=this,n=(0,s.cos)(t),r=(0,s.sin)(t);return(0,s.vec2)((0,s.add)((0,s.add)((0,s.mul)(n,(0,s.sub)(e.x,i.x)),(0,s.mul)(r,(0,s.sub)(e.y,i.y))),i.x),(0,s.add)((0,s.sub)((0,s.mul)(n,(0,s.sub)(e.y,i.y)),(0,s.mul)(r,(0,s.sub)(e.x,i.x))),i.y))}}var a=o})),r.register("1qRuO",(function(t,i){e(t.exports,"default",(()=>d));var n=r("27z08"),s=r("d9q8O"),o=r("1wpLw"),a=r("8rDMm"),l=r("6gQ3M"),h=r("bxuK0"),c=r("dRmZ4");class u extends n.default{constructor(e,t=new(0,o.default),i=new(0,s.default)(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=i}construct(){const{frameNode:e,uvNode:t,countNode:i}=this,n=new(0,s.default)(1),r=new(0,h.default)(i,"x"),o=new(0,h.default)(i,"y"),u=new(0,l.default)("*",r,o),d=new(0,a.default)(a.default.FLOOR,new(0,a.default)(a.default.MOD,e,u)),f=new(0,l.default)("+",d,n),p=new(0,a.default)(a.default.MOD,d,r),m=new(0,a.default)(a.default.CEIL,new(0,l.default)("/",f,r)),g=new(0,l.default)("-",o,m),v=new(0,l.default)("/",n,i),x=new(0,c.default)([new(0,l.default)("*",p,new(0,h.default)(v,"x")),new(0,l.default)("*",g,new(0,h.default)(v,"y"))]),y=new(0,l.default)("*",t,v);return new(0,l.default)("+",y,x)}}var d=u})),r.register("3GDng",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("gXpHD");class o extends n.default{constructor(e,t=null,i=null,n=(0,s.float)(1),r=s.positionWorld,o=s.normalWorld){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=i,this.scaleNode=n,this.positionNode=r,this.normalNode=o}construct(){const{textureXNode:e,textureYNode:t,textureZNode:i,scaleNode:n,positionNode:r,normalNode:o}=this;let a=(0,s.normalize)((0,s.abs)(o));a=(0,s.div)(a,(0,s.dot)(a,(0,s.vec3)(1)));const l=(0,s.mul)(r.yz,n),h=(0,s.mul)(r.zx,n),c=(0,s.mul)(r.xy,n),u=e.value,d=null!==t?t.value:u,f=null!==i?i.value:u,p=(0,s.mul)((0,s.texture)(u,l),a.x),m=(0,s.mul)((0,s.texture)(d,h),a.y),g=(0,s.mul)((0,s.texture)(f,c),a.z);return(0,s.add)(p,m,g)}}var a=o})),r.register("ehKYv",(function(t,i){e(t.exports,"default",(()=>h));var n=r("9XdoA");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD");const a=new(0,s.ShaderNode)((e=>{const t=(0,o.mul)(e.uv,2),i=(0,o.floor)(t.x),n=(0,o.floor)(t.y),r=(0,o.mod)((0,o.add)(i,n),2);return(0,o.sign)(r)}));class l extends n.default{constructor(e=(0,o.uv)()){super("float"),this.uvNode=e}generate(e){return a.call({uv:this.uvNode}).build(e)}}var h=l})),r.register("iHl8L",(function(t,i){e(t.exports,"default",(()=>a));var n=r("27z08"),s=r("8rDMm");class o extends n.default{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}mix(e){return new(0,s.default)(s.default.MIX,e,this.colorNode,this)}generate(e){return this.factorNode.build(e,"float")}}var a=o})),r.register("drYRh",(function(t,i){e(t.exports,"default",(()=>a));var n=r("iHl8L"),s=r("gXpHD");class o extends n.default{constructor(e,t,i){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=i}generate(e){return this.factorNode=(0,s.smoothstep)(this.nearNode,this.farNode,(0,s.negate)(s.positionView.z)),super.generate(e)}}var a=o})),r.register("20Fty",(function(t,i){e(t.exports,"default",(()=>o)),r("gXpHD");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((e=>{const{lightDistance:t,cutoffDistance:i,decayExponent:n}=e,r=(0,s.div)(1,(0,s.max)((0,s.pow)(t,n),.01));return(0,s.cond)((0,s.greaterThan)(i,0),(0,s.mul)(r,(0,s.pow2)((0,s.clamp)((0,s.sub)(1,(0,s.pow4)((0,s.div)(t,i)))))),r)}))})),r.register("aTRJp",(function(t,i){e(t.exports,"default",(()=>c));var n=r("8ZXQy"),s=r("ibxJj"),o=r("iXGFp");r("cgyEO");var a=r("gXpHD"),l=r("4xklQ");class h extends n.default{constructor(e=null){super(e),this.lightPositionNode=new(0,o.default)(o.default.POSITION),this.lightDirectionNode=(0,a.normalize)(this.lightPositionNode),this.groundColorNode=(0,a.uniform)(new(0,l.Color))}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}generate(e){const{colorNode:t,groundColorNode:i,lightDirectionNode:n}=this,r=(0,a.dot)(a.normalView,n),s=(0,a.add)((0,a.mul)(.5,r),.5),o=(0,a.mix)(i,t,s);e.context.irradiance.add(o)}}s.default.setReference(l.HemisphereLight,h);var c=h})),r.register("8F6bd",(function(t,i){e(t.exports,"default",(()=>u));var n=r("kM6Ih"),s=r("hReqz"),o=r("2Jf5Y");r("cgyEO");var a=r("eRlxz"),l=r("gXpHD");const h=new(0,a.ShaderNode)((({texture:e,levelNode:t})=>{const i=new(0,o.default)(e),n=(0,l.div)((0,l.mul)(Math.PI,(0,l.mul)(t,t)),(0,l.add)(1,t)),r=(0,l.add)(i,(0,l.log2)(n));return(0,l.clamp)(r,0,i)}));class c extends n.default{constructor(e=null){super(),this.envNode=e}construct(e){const t=this.envNode,i=e.getNodeProperties(this);let n=(0,l.reflect)((0,l.negate)(l.positionViewDirection),l.transformedNormalView);n=(0,l.normalize)((0,l.mix)(n,l.transformedNormalView,(0,l.mul)(l.roughness,l.roughness))),n=(0,l.transformDirection)(n,l.cameraViewMatrix);const r=new(0,s.default)(t,{tempRead:!1,uvNode:n,levelNode:l.roughness,levelShaderNode:h}),o=new(0,s.default)(t,{tempRead:!1,uvNode:l.transformedNormalWorld,levelNode:(0,l.float)(1),levelShaderNode:h});r.context.environmentContext=r,o.context.environmentContext=o,e.context.radiance.add(r),e.context.iblIrradiance.add((0,l.mul)(Math.PI,o)),i.radianceContext=r,i.irradianceContext=o}}var u=c})),r.register("cOplQ",(function(t,i){e(t.exports,"default",(()=>a));var n=r("kM6Ih");r("cgyEO");var s=r("gXpHD");class o extends n.default{constructor(e=null){super(),this.aoNode=e}construct(e){const t=(0,s.add)((0,s.mul)((0,s.sub)((0,s.float)(this.aoNode),1),1),1);e.context.ambientOcclusion.mul(t)}}var a=o})),r.register("dK3bQ",(function(t,i){e(t.exports,"default",(()=>a));var n=r("e6hrk"),s=r("4xklQ");class o extends s.Loader{constructor(e){super(e),this.textures={}}load(e,t,i,n){const r=new(0,s.FileLoader)(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(i=>{try{t(this.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),this.manager.itemError(e)}}),i,n)}parseNodes(e){const t={};if(void 0!==e){for(const i of e){const{uuid:e,type:r}=i;t[e]=n.fromType(r),t[e].uuid=e}const i={nodes:t,textures:this.textures};for(const n of e){n.meta=i;t[n.uuid].deserialize(n),delete n.meta}}return t}parse(e){const t=n.fromType(e.type);t.uuid=e.uuid;const i={nodes:this.parseNodes(e.inputNodes),textures:this.textures};return e.meta=i,t.deserialize(e),delete e.meta,t}setTextures(e){return this.textures=e,this}}var a=o})),r.register("8buyk",(function(t,i){e(t.exports,"default",(()=>l));var n=r("dK3bQ"),s=r("cRde3"),o=r("4xklQ");class a extends o.ObjectLoader{constructor(e){super(e),this._nodesJSON=null}parse(e,t){this._nodesJSON=e.nodes;const i=super.parse(e,t);return this._nodesJSON=null,i}parseNodes(e,t){if(void 0!==e){const i=new(0,n.default);return i.setTextures(t),i.parseNodes(e)}return{}}parseMaterials(e,t){const i={};if(void 0!==e){const n=this.parseNodes(this._nodesJSON,t),r=new(0,s.default);r.setTextures(t),r.setNodes(n);for(let t=0,n=e.length;t<n;t++){const n=e[t];i[n.uuid]=r.parse(n)}}return i}}var l=a})),r.register("cRde3",(function(t,i){e(t.exports,"default",(()=>p));var n=r("4xklQ");r("btkQ5");var s=r("du8ZI"),o=r("e4JX3"),a=r("61Suc"),l=r("nwUnj"),h=r("fdVpF"),c=r("7wZHW"),u=r("j7xHo");const d=n.MaterialLoader.createMaterialFromType;n.MaterialLoader.createMaterialFromType=function(e){const t={NodeMaterial:s.default,LineBasicNodeMaterial:o.default,MeshBasicNodeMaterial:a.default,MeshStandardNodeMaterial:l.default,MeshPhysicalNodeMaterial:h.default,PointsNodeMaterial:c.default,SpriteNodeMaterial:u.default};return void 0!==t[e]?new t[e]:d.call(this,e)};class f extends n.MaterialLoader{constructor(e){super(e),this.nodes={}}parse(e){const t=super.parse(e),i=this.nodes,n=e.inputNodes;for(const e in n){const r=n[e];t[e]=i[r]}return t}setNodes(e){return this.nodes=e,this}}var p=f})),r.register("btkQ5",(function(t,i){e(t.exports,"NodeMaterial",(()=>r("du8ZI").default)),e(t.exports,"LineBasicNodeMaterial",(()=>r("e4JX3").default)),e(t.exports,"MeshBasicNodeMaterial",(()=>r("61Suc").default)),e(t.exports,"MeshStandardNodeMaterial",(()=>r("nwUnj").default)),e(t.exports,"MeshPhysicalNodeMaterial",(()=>r("fdVpF").default)),e(t.exports,"PointsNodeMaterial",(()=>r("7wZHW").default)),e(t.exports,"SpriteNodeMaterial",(()=>r("j7xHo").default));var n=r("du8ZI"),s=r("e4JX3"),o=r("61Suc"),a=r("nwUnj"),l=r("fdVpF"),h=r("7wZHW"),c=r("j7xHo");n.default.fromMaterial=function(e){const t={NodeMaterial:n.default,LineBasicNodeMaterial:s.default,MeshBasicNodeMaterial:o.default,MeshStandardNodeMaterial:a.default,MeshPhysicalNodeMaterial:l.default,PointsNodeMaterial:h.default,SpriteNodeMaterial:c.default},i=e.type.replace("Material","NodeMaterial");if(void 0===t[i])return e;const r=new t[i](e);for(const t in e)void 0===r[t]&&(r[t]=e[t]);return r}})),r.register("du8ZI",(function(t,i){e(t.exports,"default",(()=>c));var n=r("4xklQ"),s=r("5NcGx"),o=r("h7xaO");r("cgyEO");var a=r("gXpHD"),l=r("cgyEO");class h extends n.ShaderMaterial{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.name,this.lights=!0}build(e){this.generatePosition(e);const{lightsNode:t}=this,{diffuseColorNode:i}=this.generateDiffuseColor(e),n=this.generateLight(e,{diffuseColorNode:i,lightsNode:t});this.generateOutput(e,{diffuseColorNode:i,outgoingLightNode:n})}customProgramCacheKey(){return(0,s.getCacheKey)(this)}generatePosition(e){const t=e.object;let i=a.positionLocal;null!==this.positionNode&&(i=(0,a.bypass)(i,(0,a.assign)(a.positionLocal,this.positionNode))),!0===t.instanceMatrix?.isInstancedBufferAttribute&&!0===e.isAvailable("instance")&&(i=(0,a.bypass)(i,(0,l.instance)(t))),!0===t.isSkinnedMesh&&(i=(0,a.bypass)(i,(0,l.skinning)(t))),e.context.vertex=i,e.addFlow("vertex",(0,a.modelViewProjection)())}generateDiffuseColor(e){let t=(0,a.vec4)(this.colorNode||a.materialColor),i=this.opacityNode?(0,a.float)(this.opacityNode):a.materialOpacity;t=e.addFlow("fragment",(0,a.label)(t,"Color"));const n=e.addFlow("fragment",(0,a.label)(t,"DiffuseColor"));if(i=e.addFlow("fragment",(0,a.label)(i,"OPACITY")),e.addFlow("fragment",(0,a.assign)(n.a,(0,a.mul)(n.a,i))),this.alphaTestNode||this.alphaTest>0){const t=this.alphaTestNode?(0,a.float)(this.alphaTestNode):a.materialAlphaTest;e.addFlow("fragment",(0,a.label)(t,"AlphaTest")),e.addFlow("fragment",new(0,o.default)("if ( DiffuseColor.a <= AlphaTest ) { discard; }"))}return{colorNode:t,diffuseColorNode:n}}generateLight(e,{diffuseColorNode:t,lightingModelNode:i,lightsNode:n=e.lightsNode}){let r=t.xyz;return n&&!1!==n.hasLight&&(r=e.addFlow("fragment",(0,a.label)((0,l.lightingContext)(n,i),"Light"))),r}generateOutput(e,{diffuseColorNode:t,outgoingLightNode:i}){let n=(0,a.vec4)(i,t.a);return n=(0,l.colorSpace)(n,e.renderer.outputEncoding),e.fogNode&&(n=(0,a.vec4)((0,a.vec3)(e.fogNode.mix(n)),n.w)),e.addFlow("fragment",(0,a.label)(n,"Output")),n}setDefaultValues(e){for(const t in e){const i=e[t];void 0===this[t]&&(this[t]=i?.clone?.()||i)}Object.assign(this.defines,e.defines)}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{},nodes:{}});const i=n.Material.prototype.toJSON.call(this,e),r=(0,s.getNodesKeys)(this);i.inputNodes={};for(const t of r)i.inputNodes[t]=this[t].toJSON(e).uuid;function o(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(t){const t=o(e.textures),n=o(e.images),r=o(e.nodes);t.length>0&&(i.textures=t),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}static fromMaterial(){}}var c=h})),r.register("e4JX3",(function(t,i){e(t.exports,"default",(()=>a));var n=r("du8ZI");const s=new(0,r("4xklQ").LineBasicMaterial);class o extends n.default{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.lightNode=null,this.positionNode=null,this.setDefaultValues(s),this.setValues(e)}copy(e){return this.colorNode=e.colorNode,this.opacityNode=e.opacityNode,this.alphaTestNode=e.alphaTestNode,this.lightNode=e.lightNode,this.positionNode=e.positionNode,super.copy(e)}}var a=o})),r.register("61Suc",(function(t,i){e(t.exports,"default",(()=>a));var n=r("du8ZI");const s=new(0,r("4xklQ").MeshBasicMaterial);class o extends n.default{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.lightNode=null,this.positionNode=null,this.setDefaultValues(s),this.setValues(e)}copy(e){return this.colorNode=e.colorNode,this.opacityNode=e.opacityNode,this.alphaTestNode=e.alphaTestNode,this.lightNode=e.lightNode,this.positionNode=e.positionNode,super.copy(e)}}var a=o})),r.register("nwUnj",(function(t,i){e(t.exports,"default",(()=>f));var n=r("du8ZI");r("cgyEO");var s=r("gXpHD"),o=r("ibxJj"),a=r("8F6bd"),l=r("cOplQ"),h=r("3NVsE"),c=r("4ZvgR"),u=r("kz9ky");const d=new(0,r("4xklQ").MeshStandardMaterial);class f extends n.default{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.normalNode=null,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.envNode=null,this.lightsNode=null,this.positionNode=null,this.setDefaultValues(d),this.setValues(e)}build(e){this.generatePosition(e);const t=this.generateDiffuseColor(e),{colorNode:i}=t;let{diffuseColorNode:n}=t;const r=this.envNode||e.scene.environmentNode;n=this.generateStandardMaterial(e,{colorNode:i,diffuseColorNode:n}),this.lightsNode&&(e.lightsNode=this.lightsNode);const h=[];r&&h.push(new(0,a.default)(r)),e.material.aoMap&&h.push(new(0,l.default)((0,s.texture)(e.material.aoMap))),h.length>0&&(e.lightsNode=new(0,o.default)([...e.lightsNode.lightNodes,...h]));const u=this.generateLight(e,{diffuseColorNode:n,lightingModelNode:c.default});this.generateOutput(e,{diffuseColorNode:n,outgoingLightNode:u})}generateStandardMaterial(e,{colorNode:t,diffuseColorNode:i}){const{material:n}=e;let r=this.metalnessNode?(0,s.float)(this.metalnessNode):s.materialMetalness;r=e.addFlow("fragment",(0,s.label)(r,"Metalness")),e.addFlow("fragment",(0,s.assign)(i,(0,s.vec4)((0,s.mul)(i.rgb,(0,s.invert)(r)),i.a)));let o=this.roughnessNode?(0,s.float)(this.roughnessNode):s.materialRoughness;o=h.default.call({roughness:o}),e.addFlow("fragment",(0,s.label)(o,"Roughness"));const a=(0,s.mix)((0,s.vec3)(.04),t.rgb,r);e.addFlow("fragment",(0,s.label)(a,"SpecularColor"));const l=this.normalNode?(0,s.vec3)(this.normalNode):n.normalMap?new(0,u.default)((0,s.texture)(n.normalMap),(0,s.uniform)(n.normalScale)):s.normalView;return e.addFlow("fragment",(0,s.label)(l,"TransformedNormalView")),i}generateLight(e,{diffuseColorNode:t,lightingModelNode:i,lightsNode:n=e.lightsNode}){const r=e.renderer;let o=super.generateLight(e,{diffuseColorNode:t,lightingModelNode:i,lightsNode:n});return o=(0,s.add)((0,s.vec3)(this.emissiveNode||s.materialEmissive),o),r.toneMappingNode&&(o=(0,s.context)(r.toneMappingNode,{color:o})),o}copy(e){return this.colorNode=e.colorNode,this.opacityNode=e.opacityNode,this.alphaTestNode=e.alphaTestNode,this.normalNode=e.normalNode,this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,this.envNode=e.envNode,this.lightsNode=e.lightsNode,this.positionNode=e.positionNode,super.copy(e)}}})),r.register("3NVsE",(function(t,i){e(t.exports,"default",(()=>a));var n=r("13QXd");r("gXpHD");var s=r("eRlxz"),o=r("gXpHD");var a=new(0,s.ShaderNode)((e=>{const{roughness:t}=e,i=n.default.call();let r=(0,o.max)(t,.0525);return r=(0,o.add)(r,i),r=(0,o.min)(r,1),r}))})),r.register("13QXd",(function(t,i){e(t.exports,"default",(()=>o)),r("gXpHD");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((()=>{const e=(0,s.max)((0,s.abs)((0,s.dFdx)(s.normalGeometry)),(0,s.abs)((0,s.dFdy)(s.normalGeometry)));return(0,s.max)((0,s.max)(e.x,e.y),e.z)}))})),r.register("4ZvgR",(function(t,i){e(t.exports,"default",(()=>u));var n=r("kxf9y"),s=r("uVjkd"),o=r("drYRp");r("cgyEO");var a=r("gXpHD"),l=r("eRlxz");const h=new(0,l.ShaderNode)((e=>{const{radiance:t,iblIrradiance:i,reflectedLight:n}=e,r=(0,a.temp)((0,a.vec3)()),s=(0,a.temp)((0,a.vec3)()),l=(0,a.mul)(i,1/Math.PI);((e,t,i=1)=>{const n=o.default.call({roughness:a.roughness}),r=(0,a.add)((0,a.mul)(a.specularColor,n.x),(0,a.mul)(i,n.y)),s=(0,a.add)(n.x,n.y),l=(0,a.sub)(1,s),h=(0,a.add)(a.specularColor,(0,a.mul)((0,a.sub)(1,a.specularColor),.047619)),c=(0,a.div)((0,a.mul)(r,h),(0,a.sub)(1,(0,a.mul)(l,h)));e.add(r),t.add((0,a.mul)(c,l))})(r,s);const h=(0,a.mul)(a.diffuseColor,(0,a.sub)(1,(0,a.add)(r,s)));n.indirectSpecular.add((0,a.mul)(t,r)),n.indirectSpecular.add((0,a.mul)(s,l)),n.indirectDiffuse.add((0,a.mul)(h,l))})),c=new(0,l.ShaderNode)((e=>{const{irradiance:t,reflectedLight:i}=e;i.indirectDiffuse.add((0,a.mul)(t,n.default.call({diffuseColor:a.diffuseColor})))}));var u={direct:new(0,l.ShaderNode)((e=>{const{lightDirection:t,lightColor:i,reflectedLight:r}=e,o=(0,a.clamp)((0,a.dot)(a.transformedNormalView,t)),l=(0,a.mul)(o,i);r.directDiffuse.add((0,a.mul)(l,n.default.call({diffuseColor:a.diffuseColor.rgb}))),r.directSpecular.add((0,a.mul)(l,s.default.call({lightDirection:t,f0:a.specularColor,f90:1,roughness:a.roughness})))})),indirectDiffuse:c,indirectSpecular:h,ambientOcclusion:new(0,l.ShaderNode)((({ambientOcclusion:e,reflectedLight:t})=>{const i=(0,a.add)(a.dotNV,e),n=(0,a.exp2)((0,a.sub)((0,a.mul)(-16,a.roughness),1)),r=(0,a.clamp)((0,a.add)((0,a.sub)((0,a.pow)(i,n),1),e));t.indirectDiffuse.mul(e),t.indirectSpecular.mul(r)}))}})),r.register("kxf9y",(function(t,i){e(t.exports,"default",(()=>o)),r("gXpHD");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((e=>(0,s.mul)(1/Math.PI,e.diffuseColor)))})),r.register("uVjkd",(function(t,i){e(t.exports,"default",(()=>h));var n=r("lEkTf"),s=r("gAVND"),o=r("jKNwf");r("gXpHD");var a=r("eRlxz"),l=r("gXpHD");var h=new(0,a.ShaderNode)((e=>{const{lightDirection:t,f0:i,f90:r,roughness:a}=e,h=(0,l.pow2)(a),c=(0,l.normalize)((0,l.add)(t,l.positionViewDirection)),u=(0,l.clamp)((0,l.dot)(l.transformedNormalView,t)),d=(0,l.clamp)((0,l.dot)(l.transformedNormalView,c)),f=(0,l.clamp)((0,l.dot)(l.positionViewDirection,c)),p=n.default.call({f0:i,f90:r,dotVH:f}),m=s.default.call({alpha:h,dotNL:u,dotNV:l.dotNV}),g=o.default.call({alpha:h,dotNH:d});return(0,l.mul)(p,(0,l.mul)(m,g))}))})),r.register("lEkTf",(function(t,i){e(t.exports,"default",(()=>o)),r("gXpHD");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((e=>{const{f0:t,f90:i,dotVH:n}=e,r=(0,s.exp2)((0,s.mul)((0,s.sub)((0,s.mul)(-5.55473,n),6.98316),n));return(0,s.add)((0,s.mul)(t,(0,s.sub)(1,r)),(0,s.mul)(i,r))}))})),r.register("gAVND",(function(t,i){e(t.exports,"default",(()=>o)),r("gXpHD");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((e=>{const{alpha:t,dotNL:i,dotNV:n}=e,r=(0,s.pow2)(t),o=(0,s.mul)(i,(0,s.sqrt)((0,s.add)(r,(0,s.mul)((0,s.sub)(1,r),(0,s.pow2)(n))))),a=(0,s.mul)(n,(0,s.sqrt)((0,s.add)(r,(0,s.mul)((0,s.sub)(1,r),(0,s.pow2)(i)))));return(0,s.div)(.5,(0,s.max)((0,s.add)(o,a),s.EPSILON))}))})),r.register("jKNwf",(function(t,i){e(t.exports,"default",(()=>o)),r("gXpHD");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((e=>{const{alpha:t,dotNH:i}=e,n=(0,s.pow2)(t),r=(0,s.add)((0,s.mul)((0,s.pow2)(i),(0,s.sub)(n,1)),1);return(0,s.mul)(1/Math.PI,(0,s.div)(n,(0,s.pow2)(r)))}))})),r.register("drYRp",(function(t,i){e(t.exports,"default",(()=>o)),r("cgyEO");var n=r("eRlxz"),s=r("gXpHD");var o=new(0,n.ShaderNode)((e=>{const{roughness:t}=e,i=(0,s.vec4)(-1,-.0275,-.572,.022),n=(0,s.vec4)(1,.0425,1.04,-.04),r=(0,s.add)((0,s.mul)(t,i),n),o=(0,s.add)((0,s.mul)((0,s.min)((0,s.mul)(r.x,r.x),(0,s.exp2)((0,s.mul)(-9.28,s.dotNV))),r.x),r.y);return(0,s.add)((0,s.mul)((0,s.vec2)(-1.04,1.04),o),r.zw)}))})),r.register("fdVpF",(function(t,i){e(t.exports,"default",(()=>o));var n=r("nwUnj");const s=new(0,r("4xklQ").MeshPhysicalMaterial);class o extends n.default{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.sheen=0,this.clearcoat=0,this.iridescence=0,this.transmission=0,this.setDefaultValues(s),this.setValues(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}})),r.register("7wZHW",(function(t,i){e(t.exports,"default",(()=>a));var n=r("du8ZI");const s=new(0,r("4xklQ").PointsMaterial);class o extends n.default{constructor(e){super(),this.isPointsNodeMaterial=!0,this.transparent=!0,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.lightNode=null,this.sizeNode=null,this.positionNode=null,this.setDefaultValues(s),this.setValues(e)}copy(e){return this.colorNode=e.colorNode,this.opacityNode=e.opacityNode,this.alphaTestNode=e.alphaTestNode,this.lightNode=e.lightNode,this.sizeNode=e.sizeNode,this.positionNode=e.positionNode,super.copy(e)}}var a=o})),r.register("j7xHo",(function(t,i){e(t.exports,"default",(()=>h));var n=r("du8ZI"),s=r("4xklQ");r("cgyEO");var o=r("gXpHD");const a=new(0,s.SpriteMaterial);class l extends n.default{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!0,this.colorNode=null,this.opacityNode=null,this.alphaTestNode=null,this.lightNode=null,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(a),this.setValues(e)}generatePosition(e){const{positionNode:t,rotationNode:i,scaleNode:n}=this,r=o.positionLocal;let s=(0,o.mul)(o.modelViewMatrix,t?(0,o.vec4)(t.xyz,1):(0,o.vec4)(0,0,0,1)),a=(0,o.vec2)((0,o.length)((0,o.vec3)(o.modelWorldMatrix[0].x,o.modelWorldMatrix[0].y,o.modelWorldMatrix[0].z)),(0,o.length)((0,o.vec3)(o.modelWorldMatrix[1].x,o.modelWorldMatrix[1].y,o.modelWorldMatrix[1].z)));null!==n&&(a=(0,o.mul)(a,n));let l=r.xy;!0===e.object.center?.isVector2&&(l=(0,o.sub)(l,(0,o.sub)((0,o.uniform)(e.object.center),(0,o.vec2)(.5)))),l=(0,o.mul)(l,a);const h=i||o.materialRotation,c=(0,o.vec2)((0,o.sub)((0,o.mul)((0,o.cos)(h),l.x),(0,o.mul)((0,o.sin)(h),l.y)),(0,o.add)((0,o.mul)((0,o.sin)(h),l.x),(0,o.mul)((0,o.cos)(h),l.y)));s=(0,o.vec4)((0,o.add)(s.xy,c.xy),s.z,s.w);const u=(0,o.mul)(o.cameraProjectionMatrix,s);e.context.vertex=r,e.addFlow("vertex",u)}copy(e){return this.colorNode=e.colorNode,this.opacityNode=e.opacityNode,this.alphaTestNode=e.alphaTestNode,this.lightNode=e.lightNode,this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}var h=l})),r.register("hayQ1",(function(t,i){e(t.exports,"default",(()=>a));var n=r("93E6U"),s=r("4uz1g");class o extends n.default{parseFunction(e){return new(0,s.default)(e)}}var a=o})),r.register("93E6U",(function(t,i){e(t.exports,"default",(()=>n));var n=class{parseFunction(){console.warn("Abstract function.")}}})),r.register("4uz1g",(function(t,i){e(t.exports,"default",(()=>c));var n=r("9vjAD"),s=r("aZLFR");const o=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+)?/i,a=/[a-z_0-9]+/gi,l={f32:"float"};class h extends n.default{constructor(e){const{type:t,inputs:i,name:n,inputsCode:r,blockCode:h}=(e=>{const t=(e=e.trim()).match(o);if(null!==t&&4===t.length){const i=t[2],n=[];let r=null;for(;null!==(r=a.exec(i));)n.push(r);const o=[];let h=0;for(;h<n.length;){const e=n[h++][0];let t=n[h++][0];t=l[t]||t,h<n.length&&!0===/^[fui]\d{2}$/.test(n[h][0])&&h++,o.push(new(0,s.default)(t,e))}const c=e.substring(t[0].length),u=void 0!==t[1]?t[1]:"";return{type:t[3]||"void",inputs:o,name:u,inputsCode:i,blockCode:c}}throw new Error("FunctionNode: Function is not a WGSL code.")})(e);super(t,i,n),this.inputsCode=r,this.blockCode=h}getCode(e=this.name){const t="void"!==this.type?"-> "+this.type:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}var c=h})),r.register("9vjAD",(function(t,i){e(t.exports,"default",(()=>r));class n{constructor(e,t,i="",n=""){this.type=e,this.inputs=t,this.name=i,this.presicion=n}getCode(){console.warn("Abstract function.")}}n.isNodeFunction=!0;var r=n})),r.register("1GkDb",(function(t,i){e(t.exports,"default",(()=>a));var n=r("93E6U"),s=r("8xD1m");class o extends n.default{parseFunction(e){return new(0,s.default)(e)}}var a=o})),r.register("8xD1m",(function(t,i){e(t.exports,"default",(()=>c));var n=r("9vjAD"),s=r("aZLFR");const o=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,a=/[a-z_0-9]+/gi,l="#pragma main";class h extends n.default{constructor(e){const{type:t,inputs:i,name:n,presicion:r,inputsCode:h,blockCode:c,headerCode:u}=(e=>{const t=(e=e.trim()).indexOf(l),i=-1!==t?e.slice(t+l.length):e,n=i.match(o);if(null!==n&&5===n.length){const r=n[4],o=[];let l=null;for(;null!==(l=a.exec(r));)o.push(l);const h=[];let c=0;for(;c<o.length;){const e="const"===o[c][0];!0===e&&c++;let t=o[c][0];"in"===t||"out"===t||"inout"===t?c++:t="";const i=o[c++][0];let n=Number.parseInt(o[c][0]);!1===Number.isNaN(n)?c++:n=null;const r=o[c++][0];h.push(new(0,s.default)(i,r,n,t,e))}const u=i.substring(n[0].length),d=void 0!==n[3]?n[3]:"";return{type:n[2],inputs:h,name:d,presicion:void 0!==n[1]?n[1]:"",inputsCode:r,blockCode:u,headerCode:-1!==t?e.slice(0,t):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(e);super(t,i,n,r),this.inputsCode=h,this.blockCode=c,this.headerCode=u}getCode(e=this.name){let t;const i=this.blockCode;if(""!==i){const{type:n,inputsCode:r,headerCode:s,presicion:o}=this;let a=`${n} ${e} ( ${r.trim()} )`;""!==o&&(a=`${o} ${a}`),t=s+a+i}else t="";return t}}var c=h})),r.register("czjZ1",(function(t,i){e(t.exports,"editor",(()=>c)),e(t.exports,"readOnlyState",(()=>u));var n=r("8aJ3v"),s=r("kLjcS"),o=r("eamNc"),a=r("av1JK"),l=document.getElementById("codeToExecute");const h=s.EditorView.theme({".cm-content, .cm-gutter":{minHeight:"200px"}}),c=new(0,s.EditorView)({extensions:[n.basicSetup,h,s.keymap.of([a.indentWithTab])],parent:l}),u=o.EditorState.create({extensions:[n.basicSetup,s.EditorView.editable.of(!1)]})})),r.register("8aJ3v",(function(t,i){e(t.exports,"basicSetup",(()=>u));var n=r("kLjcS"),s=r("eamNc"),o=r("H1dsR"),a=r("av1JK"),l=r("25IcZ"),h=r("c5pvf"),c=r("38OKk");n=r("kLjcS");const u=(()=>[(0,n.lineNumbers)(),(0,n.highlightActiveLineGutter)(),(0,n.highlightSpecialChars)(),(0,a.history)(),(0,o.foldGutter)(),(0,n.drawSelection)(),(0,n.dropCursor)(),s.EditorState.allowMultipleSelections.of(!0),(0,o.indentOnInput)(),(0,o.syntaxHighlighting)(o.defaultHighlightStyle,{fallback:!0}),(0,o.bracketMatching)(),(0,h.closeBrackets)(),(0,h.autocompletion)(),(0,n.rectangularSelection)(),(0,n.crosshairCursor)(),(0,n.highlightActiveLine)(),(0,l.highlightSelectionMatches)(),n.keymap.of([...h.closeBracketsKeymap,...a.defaultKeymap,...l.searchKeymap,...a.historyKeymap,...o.foldKeymap,...h.completionKeymap,...c.lintKeymap])])()})),r.register("kLjcS",(function(t,i){e(t.exports,"WidgetType",(()=>re)),e(t.exports,"Decoration",(()=>oe)),e(t.exports,"logException",(()=>Ae)),e(t.exports,"ViewPlugin",(()=>Le)),e(t.exports,"Direction",(()=>Ve)),e(t.exports,"EditorView",(()=>Pi)),e(t.exports,"keymap",(()=>Vi)),e(t.exports,"runScopeHandlers",(()=>Gi)),e(t.exports,"drawSelection",(()=>Ji)),e(t.exports,"dropCursor",(()=>an)),e(t.exports,"highlightSpecialChars",(()=>mn)),e(t.exports,"highlightActiveLine",(()=>yn)),e(t.exports,"rectangularSelection",(()=>Tn)),e(t.exports,"crosshairCursor",(()=>Cn)),e(t.exports,"showTooltip",(()=>kn)),e(t.exports,"hoverTooltip",(()=>Un)),e(t.exports,"getTooltip",(()=>Hn)),e(t.exports,"getPanel",(()=>jn)),e(t.exports,"showPanel",(()=>Kn)),e(t.exports,"GutterMarker",(()=>Yn)),e(t.exports,"gutter",(()=>er)),e(t.exports,"lineNumbers",(()=>pr)),e(t.exports,"highlightActiveLineGutter",(()=>xr));var n=r("eamNc"),s=r("iYCHO"),o=r("3ES9b");function a(e){let t;return t=11==e.nodeType?e.getSelection?e:e.ownerDocument:e,t.getSelection()}function l(e,t){return!!t&&(e==t||e.contains(1!=t.nodeType?t.parentNode:t))}function h(e,t){if(!t.anchorNode)return!1;try{return l(e,t.anchorNode)}catch(e){return!1}}function c(e){return 3==e.nodeType?M(e,0,e.nodeValue.length).getClientRects():1==e.nodeType?e.getClientRects():[]}function u(e,t,i,n){return!!i&&(f(e,t,i,n,-1)||f(e,t,i,n,1))}function d(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t}function f(e,t,i,n,r){for(;;){if(e==i&&t==n)return!0;if(t==(r<0?0:p(e))){if("DIV"==e.nodeName)return!1;let i=e.parentNode;if(!i||1!=i.nodeType)return!1;t=d(e)+(r<0?0:1),e=i}else{if(1!=e.nodeType)return!1;if(1==(e=e.childNodes[t+(r<0?-1:0)]).nodeType&&"false"==e.contentEditable)return!1;t=r<0?p(e):0}}}function p(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}const m={left:0,right:0,top:0,bottom:0};function g(e,t){let i=t?e.left:e.right;return{left:i,right:i,top:e.top,bottom:e.bottom}}function v(e){return{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}class x{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,t,i,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=n}}let y,b=null;function w(e){if(e.setActive)return e.setActive();if(b)return e.focus(b);let t=[];for(let i=e;i&&(t.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(e.focus(null==b?{get preventScroll(){return b={preventScroll:!0},!0}}:void 0),!b){b=!1;for(let e=0;e<t.length;){let i=t[e++],n=t[e++],r=t[e++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}function M(e,t,i=t){let n=y||(y=document.createRange());return n.setEnd(e,i),n.setStart(e,t),n}function S(e,t,i){let n={key:t,code:t,keyCode:i,which:i,cancelable:!0},r=new KeyboardEvent("keydown",n);r.synthetic=!0,e.dispatchEvent(r);let s=new KeyboardEvent("keyup",n);return s.synthetic=!0,e.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function _(e){for(;e.attributes.length;)e.removeAttributeNode(e.attributes[0])}class T{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new T(e.parentNode,d(e),t)}static after(e,t){return new T(e.parentNode,d(e)+1,t)}}const A=[];class E{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(2&this.dirty){let t,i=this.dom,n=null;for(let r of this.children){if(r.dirty){if(!r.dom&&(t=n?n.nextSibling:i.firstChild)){let e=E.get(t);e&&(e.parent||e.constructor!=r.constructor)||r.reuseDOM(t)}r.sync(e),r.dirty=0}if(t=n?n.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&t!=r.dom&&(e.written=!0),r.dom.parentNode==i)for(;t&&t!=r.dom;)t=C(t);else i.insertBefore(r.dom,t);n=r.dom}for(t=n?n.nextSibling:i.firstChild,t&&e&&e.node==i&&(e.written=!0);t;)t=C(t)}else if(1&this.dirty)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let n=0==p(e)?0:0==t?-1:1;for(;;){let t=e.parentNode;if(t==this.dom)break;0==n&&t.firstChild!=t.lastChild&&(n=e==t.firstChild?-1:1),e=t}i=n<0?e:e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!E.get(i);)i=i.nextSibling;if(!i)return this.length;for(let e=0,t=0;;e++){let n=this.children[e];if(n.dom==i)return t;t+=n.length+n.breakAfter}}domBoundsAround(e,t,i=0){let n=-1,r=-1,s=-1,o=-1;for(let a=0,l=i,h=i;a<this.children.length;a++){let i=this.children[a],c=l+i.length;if(l<e&&c>t)return i.domBoundsAround(e,t,l);if(c>=e&&-1==n&&(n=a,r=l),l>t&&i.dom.parentNode==this.dom){s=a,o=h;break}h=c,l=c+i.breakAfter}return{from:r,to:o<0?i+this.length:o,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:s<this.children.length&&s>=0?this.children[s].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),1&t.dirty)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=A){this.markDirty();for(let i=e;i<t;i++){let e=this.children[i];e.parent==this&&e.destroy()}this.children.splice(e,t-e,...i);for(let e=0;e<i.length;e++)i[e].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new N(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+("Text"==e?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,i,n,r,s){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}}function C(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}E.prototype.breakAfter=0;class N{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||0==this.i||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function L(e,t,i,n,r,s,o,a,l){let{children:h}=e,c=h.length?h[t]:null,u=s.length?s[s.length-1]:null,d=u?u.breakAfter:o;if(!(t==n&&c&&!o&&!d&&s.length<2&&c.merge(i,r,s.length?u:null,0==i,a,l))){if(n<h.length){let e=h[n];e&&r<e.length?(t==n&&(e=e.split(r),r=0),!d&&u&&e.merge(0,r,u,!0,0,l)?s[s.length-1]=e:(r&&e.merge(0,r,null,!1,0,l),s.push(e))):(null==e?void 0:e.breakAfter)&&(u?u.breakAfter=1:o=1),n++}for(c&&(c.breakAfter=o,i>0&&(!o&&s.length&&c.merge(i,c.length,s[0],!1,a,0)?c.breakAfter=s.shift().breakAfter:(i<c.length||c.children.length&&0==c.children[c.children.length-1].length)&&c.merge(i,c.length,null,!1,a,0),t++));t<n&&s.length;)if(h[n-1].become(s[s.length-1]))n--,s.pop(),l=s.length?0:a;else{if(!h[t].become(s[0]))break;t++,s.shift(),a=s.length?0:l}!s.length&&t&&n<h.length&&!h[t-1].breakAfter&&h[n].merge(0,0,h[t-1],!1,a,l)&&t--,(t<n||s.length)&&e.replaceChildren(t,n,s)}}function R(e,t,i,n,r,s){let o=e.childCursor(),{i:a,off:l}=o.findPos(i,1),{i:h,off:c}=o.findPos(t,-1),u=t-i;for(let e of n)u+=e.length;e.length+=u,L(e,h,c,a,l,n,0,r,s)}let P="undefined"!=typeof navigator?navigator:{userAgent:"",vendor:"",platform:""},D="undefined"!=typeof document?document:{documentElement:{style:{}}};const I=/Edge\/(\d+)/.exec(P.userAgent),O=/MSIE \d/.test(P.userAgent),k=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(P.userAgent),z=!!(O||k||I),F=!z&&/gecko\/(\d+)/i.test(P.userAgent),B=!z&&/Chrome\/(\d+)/.exec(P.userAgent),V="webkitFontSmoothing"in D.documentElement.style,U=!z&&/Apple Computer/.test(P.vendor),H=U&&(/Mobile\/\w+/.test(P.userAgent)||P.maxTouchPoints>2);var G={mac:H||/Mac/.test(P.platform),windows:/Win/.test(P.platform),linux:/Linux|X11/.test(P.platform),ie:z,ie_version:O?D.documentMode||6:k?+k[1]:I?+I[1]:0,gecko:F,gecko_version:F?+(/Firefox\/(\d+)/.exec(P.userAgent)||[0,0])[1]:0,chrome:!!B,chrome_version:B?+B[1]:0,ios:H,android:/Android\b/.test(P.userAgent),webkit:V,safari:U,webkit_version:V?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:null!=D.documentElement.style.tabSize?"tab-size":"-moz-tab-size"};class W extends E{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){3==e.nodeType&&this.createDOM(e)}merge(e,t,i){return(!i||i instanceof W&&!(this.length-(t-e)+i.length>256))&&(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new W(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new T(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return X(this.dom,e,t)}}class j extends E{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let e of t)e.setParent(this)}setAttrs(e){if(_(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?4&this.dirty&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,i,n,r,s){return(!i||!(!(i instanceof j&&i.mark.eq(this.mark))||e&&r<=0||t<this.length&&s<=0))&&(R(this,e,t,i?i.children:[],r-1,s-1),this.markDirty(),!0)}split(e){let t=[],i=0,n=-1,r=0;for(let s of this.children){let o=i+s.length;o>e&&t.push(i<e?s.split(e-i):s),n<0&&i>=e&&(n=r),i=o,r++}let s=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new j(this.mark,t,s)}domAtPos(e){return $(this.dom,this.children,e)}coordsAt(e,t){return ee(this,e,t)}}function X(e,t,i){let n=e.nodeValue.length;t>n&&(t=n);let r=t,s=t,o=0;0==t&&i<0||t==n&&i>=0?G.chrome||G.gecko||(t?(r--,o=1):s<n&&(s++,o=-1)):i<0?r--:s<n&&s++;let a=M(e,r,s).getClientRects();if(!a.length)return m;let l=a[(o?o<0:i>=0)?0:a.length-1];return G.safari&&!o&&0==l.width&&(l=Array.prototype.find.call(a,(e=>e.width))||l),o?g(l,o<0):l||null}class q extends E{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||q)(e,t,i)}split(e){let t=q.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,n,r,s){return!(i&&(!(i instanceof q&&this.widget.compare(i.widget))||e>0&&r<=0||t<this.length&&s<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof q&&e.side==this.side&&this.widget.constructor==e.widget.constructor&&(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(0==this.length)return n.Text.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):n.Text.empty}domAtPos(e){return 0==e?T.before(this.dom):T.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.dom.getClientRects(),n=null;if(!i.length)return m;for(let t=e>0?i.length-1:0;n=i[t],!(e>0?0==t:t==i.length-1||n.top<n.bottom);t+=e>0?-1:1);return 0==e&&t>0||e==this.length&&t<=0?n:g(n,0==e)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class J extends q{domAtPos(e){let{topView:t,text:i}=this.widget;return t?K(e,0,t,i,((e,t)=>e.domAtPos(t)),(e=>new T(i,Math.min(e,i.nodeValue.length)))):new T(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:n}=this.widget;return i?Y(e,t,i,n):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:n}=this.widget;return i?K(e,t,i,n,((e,t,i)=>e.coordsAt(t,i)),((e,t)=>X(n,e,t))):X(n,e,t)}destroy(){var e;super.destroy(),null===(e=this.widget.topView)||void 0===e||e.destroy()}get isEditable(){return!0}}function K(e,t,i,n,r,s){if(i instanceof j){for(let o of i.children){let i=l(o.dom,n),a=i?n.nodeValue.length:o.length;if(e<a||e==a&&o.getSide()<=0)return i?K(e,t,o,n,r,s):r(o,e,t);e-=a}return r(i,i.length,-1)}return i.dom==n?s(e,t):r(i,e,t)}function Y(e,t,i,n){if(i instanceof j)for(let r of i.children){let i=0,s=l(r.dom,n);if(l(r.dom,e))return i+(s?Y(e,t,r,n):r.localPosFromDOM(e,t));i+=s?n.nodeValue.length:r.length}else if(i.dom==n)return Math.min(t,n.nodeValue.length);return i.localPosFromDOM(e,t)}class Z extends E{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Z&&e.side==this.side}split(){return new Z(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return T.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let t=this.dom.getBoundingClientRect(),i=function(e,t){let i=e.parent,n=i?i.children.indexOf(e):-1;for(;i&&n>=0;)if(t<0?n>0:n<i.children.length){let e=i.children[n+t];if(e instanceof W){let i=e.coordsAt(t<0?e.length:0,t);if(i)return i}n+=t}else{if(!(i instanceof j&&i.parent)){let e=i.dom.lastChild;if(e&&"BR"==e.nodeName)return e.getClientRects()[0];break}n=i.parent.children.indexOf(i)+(t<0?0:1),i=i.parent}return}(this,this.side>0?-1:1);return i&&i.top<t.bottom&&i.bottom>t.top?{left:t.left,right:t.right,top:i.top,bottom:i.bottom}:t}get overrideDOMText(){return n.Text.empty}}function $(e,t,i){let n=0;for(let r=0;n<t.length;n++){let s=t[n],o=r+s.length;if(!(o==r&&s.getSide()<=0)){if(i>r&&i<o&&s.dom.parentNode==e)return s.domAtPos(i-r);if(i<=r)break;r=o}}for(;n>0;n--){let i=t[n-1].dom;if(i.parentNode==e)return T.after(i)}return new T(e,0)}function Q(e,t,i){let n,{children:r}=e;i>0&&t instanceof j&&r.length&&(n=r[r.length-1])instanceof j&&n.mark.eq(t.mark)?Q(n,t.children[0],i-1):(r.push(t),t.setParent(e)),e.length+=t.length}function ee(e,t,i){for(let n=0,r=0;r<e.children.length;r++){let s,o=e.children[r],a=n+o.length;if((i<=0||a==e.length||o.getSide()>0?a>=t:a>t)&&(t<a||r+1==e.children.length||(s=e.children[r+1]).length||s.getSide()>0)){let e=0;if(a==n){if(o.getSide()<=0)continue;e=i=-o.getSide()}let r=o.coordsAt(Math.max(0,t-n),i);return e&&r?g(r,i<0):r}n=a}let n=e.dom.lastChild;if(!n)return e.dom.getBoundingClientRect();let r=c(n);return r[r.length-1]||null}function te(e,t){for(let i in e)"class"==i&&t.class?t.class+=" "+e.class:"style"==i&&t.style?t.style+=";"+e.style:t[i]=e[i];return t}function ie(e,t){if(e==t)return!0;if(!e||!t)return!1;let i=Object.keys(e),n=Object.keys(t);if(i.length!=n.length)return!1;for(let r of i)if(-1==n.indexOf(r)||e[r]!==t[r])return!1;return!0}function ne(e,t,i){let n=null;if(t)for(let r in t)i&&r in i||e.removeAttribute(n=r);if(i)for(let r in i)t&&t[r]==i[r]||e.setAttribute(n=r,i[r]);return!!n}W.prototype.children=q.prototype.children=Z.prototype.children=A;class re{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var se=function(e){return e[e.Text=0]="Text",e[e.WidgetBefore=1]="WidgetBefore",e[e.WidgetAfter=2]="WidgetAfter",e[e.WidgetRange=3]="WidgetRange",e}(se||(se={}));class oe extends n.RangeValue{constructor(e,t,i,n){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(e){return new ae(e)}static widget(e){let t=e.side||0,i=!!e.block;return t+=i?t>0?3e8:-4e8:t>0?1e8:-1e8,new he(e,t,t,i,e.widget||null,!1)}static replace(e){let t,i,n=!!e.block;if(e.isBlockGap)t=-5e8,i=4e8;else{let{start:r,end:s}=ce(e,n);t=(r?n?-3e8:-1:5e8)-1,i=1+(s?n?2e8:1:-6e8)}return new he(e,t,i,n,e.widget||null,!0)}static line(e){return new le(e)}static set(e,t=!1){return n.RangeSet.of(e,t)}hasHeight(){return!!this.widget&&this.widget.estimatedHeight>-1}}oe.none=n.RangeSet.empty;class ae extends oe{constructor(e){let{start:t,end:i}=ce(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof ae&&this.tagName==e.tagName&&this.class==e.class&&ie(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}ae.prototype.point=!1;class le extends oe{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof le&&ie(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}le.prototype.mapMode=n.MapMode.TrackBefore,le.prototype.point=!0;class he extends oe{constructor(e,t,i,r,s,o){super(t,i,s,e),this.block=r,this.isReplace=o,this.mapMode=r?t<=0?n.MapMode.TrackBefore:n.MapMode.TrackAfter:n.MapMode.TrackDel}get type(){return this.startSide<this.endSide?se.WidgetRange:this.startSide<=0?se.WidgetBefore:se.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof he&&(t=this.widget,i=e.widget,t==i||!!(t&&i&&t.compare(i)))&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide;var t,i}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}function ce(e,t=!1){let{inclusiveStart:i,inclusiveEnd:n}=e;return null==i&&(i=e.inclusive),null==n&&(n=e.inclusive),{start:null!=i?i:t,end:null!=n?n:t}}function ue(e,t,i,n=0){let r=i.length-1;r>=0&&i[r]+n>=e?i[r]=Math.max(i[r],t):i.push(e,t)}he.prototype.point=!0;class de extends E{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,n,r,s){if(i){if(!(i instanceof de))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),R(this,e,t,i?i.children:[],r,s),!0}split(e){let t=new de;if(t.breakAfter=this.breakAfter,0==this.length)return t;let{i:i,off:n}=this.childPos(e);n&&(t.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let e=i;e<this.children.length;e++)t.append(this.children[e],0);for(;i>0&&0==this.children[i-1].length;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=void 0===this.prevAttrs?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){ie(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Q(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=te(t,this.attrs||{})),i&&(this.attrs=te({class:i},this.attrs||{}))}domAtPos(e){return $(this.dom,this.children,e)}reuseDOM(e){"DIV"==e.nodeName&&(this.setDOM(e),this.dirty|=6)}sync(e){var t;this.dom?4&this.dirty&&(_(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),void 0!==this.prevAttrs&&(ne(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let i=this.dom.lastChild;for(;i&&E.get(i)instanceof j;)i=i.lastChild;if(!(i&&this.length&&("BR"==i.nodeName||0!=(null===(t=E.get(i))||void 0===t?void 0:t.isEditable)||G.ios&&this.children.some((e=>e instanceof W))))){let e=document.createElement("BR");e.cmIgnore=!0,this.dom.appendChild(e)}}measureTextSize(){if(0==this.children.length||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof W))return null;let i=c(t.dom);if(1!=i.length)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return ee(this,e,t)}become(e){return!1}get type(){return se.Text}static find(e,t){for(let i=0,n=0;i<e.children.length;i++){let r=e.children[i],s=n+r.length;if(s>=t){if(r instanceof de)return r;if(s>t)break}n=s+r.breakAfter}return null}}class fe extends E{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,n,r,s){return!(i&&(!(i instanceof fe&&this.widget.compare(i.widget))||e>0&&r<=0||t<this.length&&s<=0))&&(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return 0==e?T.before(this.dom):T.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new fe(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return A}sync(){this.dom&&this.widget.updateDOM(this.dom)||(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):n.Text.empty}domBoundsAround(){return null}become(e){return e instanceof fe&&e.type==this.type&&e.widget.constructor==this.widget.constructor&&(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0)}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class pe{constructor(e,t,i,n){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(0==this.content.length)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof fe&&e.type==se.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new de),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(me(new Z(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:t,lineBreak:i,done:n}=this.cursor.next(this.skip);if(this.skip=0,n)throw new Error("Ran out of text content when drawing inline views");if(i){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}this.text=t,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,i)),this.getLine().append(me(new W(this.text.slice(this.textOff,this.textOff+n)),t),i),this.atCursorPos=!0,this.textOff+=n,e-=n,i=0}}span(e,t,i,n){this.buildText(t-e,i,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,i,n,r,s){if(this.disallowBlockEffectsFor[s]&&i instanceof he){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof he)if(i.block){let{type:e}=i;e!=se.WidgetAfter||this.posCovered()||this.getLine(),this.addBlockWidget(new fe(i.widget||new ge("div"),o,e))}else{let s=q.create(i.widget||new ge("span"),o,i.startSide),a=this.atCursorPos&&!s.isEditable&&r<=n.length&&(e<t||i.startSide>0),l=!s.isEditable&&(e<t||i.startSide<=0),h=this.getLine();2!=this.pendingBuffer||a||(this.pendingBuffer=0),this.flushBuffer(n),a&&(h.append(me(new Z(1),n),r),r=n.length+Math.max(0,r-n.length)),h.append(me(s,n),r),this.atCursorPos=l,this.pendingBuffer=l?e<t?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,i,r,s){let o=new pe(e,t,i,s);return o.openEnd=n.RangeSet.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function me(e,t){for(let i of t)e=new j(i,[e],e.length);return e}class ge extends re{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const ve=n.Facet.define(),xe=n.Facet.define(),ye=n.Facet.define(),be=n.Facet.define(),we=n.Facet.define(),Me=n.Facet.define(),Se=n.Facet.define({combine:e=>e.some((e=>e))});class _e{constructor(e,t="nearest",i="nearest",n=5,r=5){this.range=e,this.y=t,this.x=i,this.yMargin=n,this.xMargin=r}map(e){return e.empty?this:new _e(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const Te=n.StateEffect.define({map:(e,t)=>e.map(t)});function Ae(e,t,i){let n=e.facet(be);n.length?n[0](t):window.onerror?window.onerror(String(t),i,void 0,void 0,t):i?console.error(i+":",t):console.error(t)}const Ee=n.Facet.define({combine:e=>!e.length||e[0]});let Ce=0;const Ne=n.Facet.define();class Le{constructor(e,t,i,n){this.id=e,this.create=t,this.domEventHandlers=i,this.extension=n(this)}static define(e,t){const{eventHandlers:i,provide:n,decorations:r}=t||{};return new Le(Ce++,e,i,(e=>{let t=[Ne.of(e)];return r&&t.push(Ie.of((t=>{let i=t.plugin(e);return i?r(i):oe.none}))),n&&t.push(n(e)),t}))}static fromClass(e,t){return Le.define((t=>new e(t)),t)}}class Re{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(t){if(Ae(e.state,t,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch(e){}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Ae(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(null===(t=this.value)||void 0===t?void 0:t.destroy)try{this.value.destroy()}catch(t){Ae(e.state,t,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Pe=n.Facet.define(),De=n.Facet.define(),Ie=n.Facet.define(),Oe=n.Facet.define(),ke=n.Facet.define(),ze=n.Facet.define();class Fe{constructor(e,t,i,n){this.fromA=e,this.toA=t,this.fromB=i,this.toB=n}join(e){return new Fe(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(0==t.length)return e;let i=[];for(let n=0,r=0,s=0,o=0;;n++){let a=n==e.length?null:e[n],l=s-o,h=a?a.fromB:1e9;for(;r<t.length&&t[r]<h;){let e=t[r],n=t[r+1],s=Math.max(o,e),a=Math.min(h,n);if(s<=a&&new Fe(s+l,a+l,s,a).addToSet(i),n>h)break;r+=2}if(!a)return i;new Fe(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),s=a.toA,o=a.toB}}}class Be{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=n.ChangeSet.empty(this.startState.doc.length);for(let e of i)this.changes=this.changes.compose(e.changes);let r=[];this.changes.iterChangedRanges(((e,t,i,n)=>r.push(new Fe(e,t,i,n)))),this.changedRanges=r;let s=e.hasFocus;s!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=s,this.flags|=1)}static create(e,t,i){return new Be(e,t,i)}get viewportChanged(){return(4&this.flags)>0}get heightChanged(){return(2&this.flags)>0}get geometryChanged(){return this.docChanged||(10&this.flags)>0}get focusChanged(){return(1&this.flags)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some((e=>e.selection))}get empty(){return 0==this.flags&&0==this.transactions.length}}var Ve=function(e){return e[e.LTR=0]="LTR",e[e.RTL=1]="RTL",e}(Ve||(Ve={}));const Ue=Ve.LTR,He=Ve.RTL;function Ge(e){let t=[];for(let i=0;i<e.length;i++)t.push(1<<+e[i]);return t}const We=Ge("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),je=Ge("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Xe=Object.create(null),qe=[];for(let e of["()","[]","{}"]){let t=e.charCodeAt(0),i=e.charCodeAt(1);Xe[t]=i,Xe[i]=-t}const Je=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;class Ke{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?He:Ue}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,n){let r=-1;for(let s=0;s<e.length;s++){let o=e[s];if(o.from<=t&&o.to>=t){if(o.level==i)return s;(r<0||(0!=n?n<0?o.from<t:o.to>t:e[r].level>o.level))&&(r=s)}}if(r<0)throw new RangeError("Index out of range");return r}}const Ye=[];function Ze(e,t){let i=e.length,n=t==Ue?1:2,r=t==Ue?2:1;if(!e||1==n&&!Je.test(e))return $e(i);for(let t=0,r=n,o=n;t<i;t++){let i=(s=e.charCodeAt(t))<=247?We[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?je[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8203||8204==s?256:1;512==i?i=r:8==i&&4==o&&(i=16),Ye[t]=4==i?2:i,7&i&&(o=i),r=i}var s;for(let e=0,t=n,r=n;e<i;e++){let n=Ye[e];if(128==n)e<i-1&&t==Ye[e+1]&&24&t?n=Ye[e]=t:Ye[e]=256;else if(64==n){let n=e+1;for(;n<i&&64==Ye[n];)n++;let s=e&&8==t||n<i&&8==Ye[n]?1==r?1:8:256;for(let t=e;t<n;t++)Ye[t]=s;e=n-1}else 8==n&&1==r&&(Ye[e]=1);t=n,7&n&&(r=n)}for(let t,s,o,a=0,l=0,h=0;a<i;a++)if(s=Xe[t=e.charCodeAt(a)])if(s<0){for(let e=l-3;e>=0;e-=3)if(qe[e+1]==-s){let t=qe[e+2],i=2&t?n:4&t?1&t?r:n:0;i&&(Ye[a]=Ye[qe[e]]=i),l=e;break}}else{if(189==qe.length)break;qe[l++]=a,qe[l++]=t,qe[l++]=h}else if(2==(o=Ye[a])||1==o){let e=o==n;h=e?0:1;for(let t=l-3;t>=0;t-=3){let i=qe[t+2];if(2&i)break;if(e)qe[t+2]|=2;else{if(4&i)break;qe[t+2]|=4}}}for(let e=0;e<i;e++)if(256==Ye[e]){let t=e+1;for(;t<i&&256==Ye[t];)t++;let r=1==(e?Ye[e-1]:n),s=r==(1==(t<i?Ye[t]:n))?r?1:2:n;for(let i=e;i<t;i++)Ye[i]=s;e=t-1}let o=[];if(1==n)for(let e=0;e<i;){let t=e,n=1!=Ye[e++];for(;e<i&&n==(1!=Ye[e]);)e++;if(n)for(let i=e;i>t;){let e=i,n=2!=Ye[--i];for(;i>t&&n==(2!=Ye[i-1]);)i--;o.push(new Ke(i,e,n?2:1))}else o.push(new Ke(t,e,0))}else for(let e=0;e<i;){let t=e,n=2==Ye[e++];for(;e<i&&n==(2==Ye[e]);)e++;o.push(new Ke(t,e,n?1:2))}return o}function $e(e){return[new Ke(0,e,0)]}let Qe="";function et(e,t,i,r,s){var o;let a=r.head-e.from,l=-1;if(0==a){if(!s||!e.length)return null;t[0].level!=i&&(a=t[0].side(!1,i),l=0)}else if(a==e.length){if(s)return null;let e=t[t.length-1];e.level!=i&&(a=e.side(!0,i),l=t.length-1)}l<0&&(l=Ke.find(t,a,null!==(o=r.bidiLevel)&&void 0!==o?o:-1,r.assoc));let h=t[l];a==h.side(s,i)&&(h=t[l+=s?1:-1],a=h.side(!s,i));let c=s==(h.dir==i),u=(0,n.findClusterBreak)(e.text,a,c);if(Qe=e.text.slice(Math.min(a,u),Math.max(a,u)),u!=h.side(s,i))return n.EditorSelection.cursor(u+e.from,c?-1:1,h.level);let d=l==(s?t.length-1:0)?null:t[l+(s?1:-1)];return d||h.level==i?d&&d.level<h.level?n.EditorSelection.cursor(d.side(!s,i)+e.from,s?1:-1,d.level):n.EditorSelection.cursor(u+e.from,s?-1:1,h.level):n.EditorSelection.cursor(s?e.to:e.from,s?-1:1,i)}const tt="￿";class it{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(n.EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=tt}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let n=e;;){this.findPointBefore(i,n),this.readNode(n);let e=n.nextSibling;if(e==t)break;let r=E.get(n),s=E.get(e);(r&&s?r.breakAfter:(r?r.breakAfter:nt(n))||nt(e)&&("BR"!=n.nodeName||n.cmIgnore))&&this.lineBreak(),n=e}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r,s=-1,o=1;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(r=n.exec(t))&&(s=r.index,o=r[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let t of this.points)t.node==e&&t.pos>this.text.length&&(t.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=E.get(e),i=t&&t.overrideDOMText;if(null!=i){this.findPointInside(e,i.length);for(let e=i.iter();!e.next().done;)e.lineBreak?this.lineBreak():this.append(e.value)}else 3==e.nodeType?this.readTextNode(e):"BR"==e.nodeName?e.nextSibling&&this.lineBreak():1==e.nodeType&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(3==e.nodeType?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function nt(e){return 1==e.nodeType&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}class rt{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class st extends E{constructor(e){super(),this.view=e,this.compositionDeco=oe.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new de],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Fe(0,0,0,e.state.doc.length)],0)}get root(){return this.view.root}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every((({fromA:e,toA:t})=>t<this.minWidthFrom||e>this.minWidthTo))?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=oe.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=function(e,t){let i=at(e);if(!i)return oe.none;let{from:n,to:r,node:s,text:o}=i,a=t.mapPos(n,1),l=Math.max(a,t.mapPos(r,-1)),{state:h}=e,c=3==s.nodeType?s.nodeValue:new it([],h).readRange(s.firstChild,null).text;if(l-a<c.length)if(h.doc.sliceString(a,Math.min(h.doc.length,a+c.length),tt)==c)l=a+c.length;else{if(h.doc.sliceString(Math.max(0,l-c.length),l,tt)!=c)return oe.none;a=l-c.length}else if(h.doc.sliceString(a,l,tt)!=c)return oe.none;let u=E.get(s);u instanceof J?u=u.widget.topView:u&&(u.parent=null);return oe.set(oe.replace({widget:new lt(s,o,u),inclusive:!0}).range(a,l))}(this.view,e.changes)),(G.ie||G.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=function(e,t,i){let r=new ct;return n.RangeSet.compare(e,t,i,r),r.changes}(this.decorations,this.updateDeco(),e.changes);return t=Fe.extendWithRanges(t,i),(0!=this.dirty||0!=t.length)&&(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore((()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let e=G.chrome||G.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(e),this.dirty=0,e&&(e.written||i.selectionRange.focusNode!=e.node)&&(this.forceSelection=!0),this.dom.style.height=""}));let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let e of this.children)e instanceof fe&&e.widget instanceof ot&&n.push(e.dom);i.updateGaps(n)}updateChildren(e,t){let i=this.childCursor(t);for(let t=e.length-1;;t--){let n=t>=0?e[t]:null;if(!n)break;let{fromA:r,toA:s,fromB:o,toB:a}=n,{content:l,breakAtStart:h,openStart:c,openEnd:u}=pe.build(this.view.state.doc,o,a,this.decorations,this.dynamicDecorationMap),{i:d,off:f}=i.findPos(s,1),{i:p,off:m}=i.findPos(r,-1);L(this,p,m,d,f,l,h,c,u)}}updateSelection(e=!1,t=!1){if(!e&&this.view.observer.selectionRange.focusNode||this.view.observer.readSelectionRange(),!t&&!this.mayControlSelection()||G.ios&&this.view.inputState.rapidCompositionStart)return;let i=this.forceSelection;this.forceSelection=!1;let n=this.view.state.selection.main,r=this.domAtPos(n.anchor),s=n.empty?r:this.domAtPos(n.head);if(G.gecko&&n.empty&&(1==(o=r).node.nodeType&&o.node.firstChild&&(0==o.offset||"false"==o.node.childNodes[o.offset-1].contentEditable)&&(o.offset==o.node.childNodes.length||"false"==o.node.childNodes[o.offset].contentEditable))){let e=document.createTextNode("");this.view.observer.ignore((()=>r.node.insertBefore(e,r.node.childNodes[r.offset]||null))),r=s=new T(e,0),i=!0}var o;let l=this.view.observer.selectionRange;!i&&l.focusNode&&u(r.node,r.offset,l.anchorNode,l.anchorOffset)&&u(s.node,s.offset,l.focusNode,l.focusOffset)||(this.view.observer.ignore((()=>{G.android&&G.chrome&&this.dom.contains(l.focusNode)&&function(e,t){for(let i=e;i&&i!=t;i=i.assignedSlot||i.parentNode)if(1==i.nodeType&&"false"==i.contentEditable)return!0;return!1}(l.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let e=a(this.root);if(e)if(n.empty){if(G.gecko){let e=(t=r.node,i=r.offset,1!=t.nodeType?0:(i&&"false"==t.childNodes[i-1].contentEditable?1:0)|(i<t.childNodes.length&&"false"==t.childNodes[i].contentEditable?2:0));if(e&&3!=e){let t=ht(r.node,r.offset,1==e?1:-1);t&&(r=new T(t,1==e?0:t.nodeValue.length))}}e.collapse(r.node,r.offset),null!=n.bidiLevel&&null!=l.cursorBidiLevel&&(l.cursorBidiLevel=n.bidiLevel)}else if(e.extend)e.collapse(r.node,r.offset),e.extend(s.node,s.offset);else{let t=document.createRange();n.anchor>n.head&&([r,s]=[s,r]),t.setEnd(s.node,s.offset),t.setStart(r.node,r.offset),e.removeAllRanges(),e.addRange(t)}else;var t,i})),this.view.observer.setSelectionRange(r,s)),this.impreciseAnchor=r.precise?null:new T(l.anchorNode,l.anchorOffset),this.impreciseHead=s.precise?null:new T(l.focusNode,l.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let e=this.view.state.selection.main,t=a(this.root);if(!(t&&e.empty&&e.assoc&&t.modify))return;let i=de.find(this,e.head);if(!i)return;let n=i.posAtStart;if(e.head==n||e.head==n+i.length)return;let r=this.coordsAt(e.head,-1),s=this.coordsAt(e.head,1);if(!r||!s||r.bottom>s.top)return;let o=this.domAtPos(e.head+e.assoc);t.collapse(o.node,o.offset),t.modify("move",e.assoc<0?"forward":"backward","lineboundary")}mayControlSelection(){let e=this.root.activeElement;return e==this.dom||h(this.dom,this.view.observer.selectionRange)&&!(e&&this.dom.contains(e))}nearest(e){for(let t=e;t;){let e=E.get(t);if(e&&e.rootView==this)return e;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let e=this.children[t];if(i<e.length||e instanceof de)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,n=this.children.length-1;;n--){let r=this.children[n],s=i-r.breakAfter-r.length;if(e>s||e==s&&r.type!=se.WidgetBefore&&r.type!=se.WidgetAfter&&(!n||2==t||this.children[n-1].breakAfter||this.children[n-1].type==se.WidgetBefore&&t>-2))return r.coordsAt(e-s,t);i=s}}measureVisibleLineHeights(e){let t=[],{from:i,to:n}=e,r=this.view.contentDOM.clientWidth,s=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,a=this.view.textDirection==Ve.LTR;for(let e=0,l=0;l<this.children.length;l++){let h=this.children[l],u=e+h.length;if(u>n)break;if(e>=i){let i=h.dom.getBoundingClientRect();if(t.push(i.height),s){let t=h.dom.lastChild,n=t?c(t):[];if(n.length){let t=n[n.length-1],s=a?t.right-i.left:i.right-t.left;s>o&&(o=s,this.minWidth=r,this.minWidthFrom=e,this.minWidthTo=u)}}}e=u+h.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return"rtl"==getComputedStyle(this.children[t].dom).direction?Ve.RTL:Ve.LTR}measureTextSize(){for(let e of this.children)if(e instanceof de){let t=e.measureTextSize();if(t)return t}let e,t,i=document.createElement("div");return i.className="cm-line",i.style.width="99999px",i.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore((()=>{this.dom.appendChild(i);let n=c(i.firstChild)[0];e=i.getBoundingClientRect().height,t=n?n.width/27:7,i.remove()})),{lineHeight:e,charWidth:t}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new N(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,n=0;;n++){let r=n==t.viewports.length?null:t.viewports[n],s=r?r.from-1:this.length;if(s>i){let n=t.lineBlockAt(s).bottom-t.lineBlockAt(i).top;e.push(oe.replace({widget:new ot(n),block:!0,inclusive:!0,isBlockGap:!0}).range(i,s))}if(!r)break;i=r.to+1}return oe.set(e)}updateDeco(){let e=this.view.state.facet(Ie).map(((e,t)=>(this.dynamicDecorationMap[t]="function"==typeof e)?e(this.view):e));for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let t,{range:i}=e,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1);if(!n)return;!i.empty&&(t=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,t.left),top:Math.min(n.top,t.top),right:Math.max(n.right,t.right),bottom:Math.max(n.bottom,t.bottom)});let r=0,s=0,o=0,a=0;for(let e of this.view.state.facet(ke).map((e=>e(this.view))))if(e){let{left:t,right:i,top:n,bottom:l}=e;null!=t&&(r=Math.max(r,t)),null!=i&&(s=Math.max(s,i)),null!=n&&(o=Math.max(o,n)),null!=l&&(a=Math.max(a,l))}let l={left:n.left-r,top:n.top-o,right:n.right+s,bottom:n.bottom+a};!function(e,t,i,n,r,s,o,a){let l=e.ownerDocument,h=l.defaultView;for(let c=e;c;)if(1==c.nodeType){let e,u=c==l.body;if(u)e=v(h);else{if(c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.parentNode;continue}let t=c.getBoundingClientRect();e={left:t.left,right:t.left+c.clientWidth,top:t.top,bottom:t.top+c.clientHeight}}let d=0,f=0;if("nearest"==r)t.top<e.top?(f=-(e.top-t.top+o),i>0&&t.bottom>e.bottom+f&&(f=t.bottom-e.bottom+f+o)):t.bottom>e.bottom&&(f=t.bottom-e.bottom+o,i<0&&t.top-f<e.top&&(f=-(e.top+f-t.top+o)));else{let n=t.bottom-t.top,s=e.bottom-e.top;f=("center"==r&&n<=s?t.top+n/2-s/2:"start"==r||"center"==r&&i<0?t.top-o:t.bottom-s+o)-e.top}if("nearest"==n?t.left<e.left?(d=-(e.left-t.left+s),i>0&&t.right>e.right+d&&(d=t.right-e.right+d+s)):t.right>e.right&&(d=t.right-e.right+s,i<0&&t.left<e.left+d&&(d=-(e.left+d-t.left+s))):d=("center"==n?t.left+(t.right-t.left)/2-(e.right-e.left)/2:"start"==n==a?t.left-s:t.right-(e.right-e.left)+s)-e.left,d||f)if(u)h.scrollBy(d,f);else{if(f){let e=c.scrollTop;c.scrollTop+=f,f=c.scrollTop-e}if(d){let e=c.scrollLeft;c.scrollLeft+=d,d=c.scrollLeft-e}t={left:t.left-d,top:t.top-f,right:t.right-d,bottom:t.bottom-f}}if(u)break;c=c.assignedSlot||c.parentNode,n=r="nearest"}else{if(11!=c.nodeType)break;c=c.host}}(this.view.scrollDOM,l,i.head<i.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Ve.LTR)}}class ot extends re{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function at(e){let t=e.observer.selectionRange,i=t.focusNode&&ht(t.focusNode,t.focusOffset,0);if(!i)return null;let n=e.docView.nearest(i);if(!n)return null;if(n instanceof de){let e=i;for(;e.parentNode!=n.dom;)e=e.parentNode;let t=e.previousSibling;for(;t&&!E.get(t);)t=t.previousSibling;let r=t?E.get(t).posAtEnd:n.posAtStart;return{from:r,to:r,node:e,text:i}}{for(;;){let{parent:e}=n;if(!e)return null;if(e instanceof de)break;n=e}let e=n.posAtStart;return{from:e,to:e+n.length,node:n.dom,text:i}}}class lt extends re{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return J}}function ht(e,t,i){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0&&i<=0)t=p(e=e.childNodes[t-1]);else{if(!(1==e.nodeType&&t<e.childNodes.length&&i>=0))return null;e=e.childNodes[t],t=0}}}class ct{constructor(){this.changes=[]}compareRange(e,t){ue(e,t,this.changes)}comparePoint(e,t){ue(e,t,this.changes)}}function ut(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function dt(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function ft(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function pt(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function mt(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function gt(e,t,i){let n,r,s,o,a,l,h,u;for(let d=e.firstChild;d;d=d.nextSibling){let e=c(d);for(let c=0;c<e.length;c++){let f=e[c];r&&ft(r,f)&&(f=pt(mt(f,r.bottom),r.top));let p=ut(t,f),m=dt(i,f);if(0==p&&0==m)return 3==d.nodeType?vt(d,t,i):gt(d,t,i);(!n||o>m||o==m&&s>p)&&(n=d,r=f,s=p,o=m),0==p?i>f.bottom&&(!h||h.bottom<f.bottom)?(a=d,h=f):i<f.top&&(!u||u.top>f.top)&&(l=d,u=f):h&&ft(h,f)?h=mt(h,f.bottom):u&&ft(u,f)&&(u=pt(u,f.top))}}if(h&&h.bottom>=i?(n=a,r=h):u&&u.top<=i&&(n=l,r=u),!n)return{node:e,offset:0};let d=Math.max(r.left,Math.min(r.right,t));return 3==n.nodeType?vt(n,d,i):s||"true"!=n.contentEditable?{node:e,offset:Array.prototype.indexOf.call(e.childNodes,n)+(t>=(r.left+r.right)/2?1:0)}:gt(n,d,i)}function vt(e,t,i){let n=e.nodeValue.length,r=-1,s=1e9,o=0;for(let a=0;a<n;a++){let n=M(e,a,a+1).getClientRects();for(let l=0;l<n.length;l++){let h=n[l];if(h.top==h.bottom)continue;o||(o=t-h.left);let c=(h.top>i?h.top-i:i-h.bottom)-1;if(h.left-1<=t&&h.right+1>=t&&c<s){let i=t>=(h.left+h.right)/2,n=i;if(G.chrome||G.gecko){M(e,a).getBoundingClientRect().left==h.right&&(n=!i)}if(c<=0)return{node:e,offset:a+(n?1:0)};r=a+(n?1:0),s=c}}}return{node:e,offset:r>-1?r:o>0?e.nodeValue.length:0}}function xt(e,{x:t,y:i},n,r=-1){var s;let o,a=e.contentDOM.getBoundingClientRect(),l=a.top+e.viewState.paddingTop,{docHeight:h}=e.viewState,c=i-l;if(c<0)return 0;if(c>h)return e.state.doc.length;for(let t=e.defaultLineHeight/2,i=!1;o=e.elementAtHeight(c),o.type!=se.Text;)for(;c=r>0?o.bottom+t:o.top-t,!(c>=0&&c<=h);){if(i)return n?null:0;i=!0,r=-r}i=l+c;let u=o.from;if(u<e.viewport.from)return 0==e.viewport.from?0:n?null:yt(e,a,o,t,i);if(u>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:n?null:yt(e,a,o,t,i);let d=e.dom.ownerDocument,f=e.root.elementFromPoint?e.root:d,p=f.elementFromPoint(t,i);p&&!e.contentDOM.contains(p)&&(p=null),p||(t=Math.max(a.left+1,Math.min(a.right-1,t)),p=f.elementFromPoint(t,i),p&&!e.contentDOM.contains(p)&&(p=null));let m,g=-1;if(p&&0!=(null===(s=e.docView.nearest(p))||void 0===s?void 0:s.isEditable))if(d.caretPositionFromPoint){let e=d.caretPositionFromPoint(t,i);e&&({offsetNode:m,offset:g}=e)}else if(d.caretRangeFromPoint){let e=d.caretRangeFromPoint(t,i);e&&(({startContainer:m,startOffset:g}=e),G.safari&&function(e,t,i){let n;if(3!=e.nodeType||t!=(n=e.nodeValue.length))return!1;for(let t=e.nextSibling;t;t=t.nextSibling)if(1!=t.nodeType||"BR"!=t.nodeName)return!1;return M(e,n-1,n).getBoundingClientRect().left>i}(m,g,t)&&(m=void 0))}if(!m||!e.docView.dom.contains(m)){let n=de.find(e.docView,u);if(!n)return c>o.top+o.height/2?o.to:o.from;({node:m,offset:g}=gt(n.dom,t,i))}return e.docView.posFromDOM(m,g)}function yt(e,t,i,r,s){let o=Math.round((r-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&i.height>1.5*e.defaultLineHeight){o+=Math.floor((s-i.top)/e.defaultLineHeight)*e.viewState.heightOracle.lineLength}let a=e.state.sliceDoc(i.from,i.to);return i.from+(0,n.findColumn)(a,o,e.state.tabSize)}function bt(e,t,i,r){let s=e.state.doc.lineAt(t.head),o=e.bidiSpans(s),a=e.textDirectionAt(s.from);for(let l=t,h=null;;){let t=et(s,o,a,l,i),c=Qe;if(!t){if(s.number==(i?e.state.doc.lines:1))return l;c="\n",s=e.state.doc.line(s.number+(i?1:-1)),o=e.bidiSpans(s),t=n.EditorSelection.cursor(i?s.from:s.to)}if(h){if(!h(c))return l}else{if(!r)return t;h=r(c)}l=t}}function wt(e,t,i){let r=e.state.facet(Oe).map((t=>t(e)));for(;;){let e=!1;for(let s of r)s.between(i.from-1,i.from+1,((r,s,o)=>{i.from>r&&i.from<s&&(i=t.from>i.from?n.EditorSelection.cursor(r,1):n.EditorSelection.cursor(s,-1),e=!0)}));if(!e)return i}}class Mt{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.rapidCompositionStart=!1,this.mouseSelection=null;for(let t in Et){let i=Et[t];e.contentDOM.addEventListener(t,(n=>{At(e,n)&&!this.ignoreDuringComposition(n)&&("keydown"==t&&this.keydown(e,n)||(this.mustFlushObserver(n)&&e.observer.forceFlush(),this.runCustomHandlers(t,e,n)?n.preventDefault():i(e,n)))})),this.registeredEvents.push(t)}G.chrome&&G.chrome_version>=102&&e.scrollDOM.addEventListener("wheel",(()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout((()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""}),100)}),{passive:!0}),this.notifiedFocused=e.hasFocus,G.safari&&e.contentDOM.addEventListener("input",(()=>null))}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var i;let n;this.customHandlers=[];for(let r of t)if(n=null===(i=r.update(e).spec)||void 0===i?void 0:i.domEventHandlers){this.customHandlers.push({plugin:r.value,handlers:n});for(let t in n)this.registeredEvents.indexOf(t)<0&&"scroll"!=t&&(this.registeredEvents.push(t),e.contentDOM.addEventListener(t,(i=>{At(e,i)&&this.runCustomHandlers(t,e,i)&&i.preventDefault()})))}}runCustomHandlers(e,t,i){for(let n of this.customHandlers){let r=n.handlers[e];if(r)try{if(r.call(n.plugin,i,t)||i.defaultPrevented)return!0}catch(e){Ae(t.state,e)}}return!1}runScrollHandlers(e,t){for(let i of this.customHandlers){let n=i.handlers.scroll;if(n)try{n.call(i.plugin,t,e)}catch(t){Ae(e.state,t)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),9==t.keyCode&&Date.now()<this.lastEscPress+2e3)return!0;if(G.android&&G.chrome&&!t.synthetic&&(13==t.keyCode||8==t.keyCode))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return!(!G.ios||!(i=St.find((e=>e.keyCode==t.keyCode)))||t.ctrlKey||t.altKey||t.metaKey||t.synthetic)&&(this.pendingIOSKey=i,setTimeout((()=>this.flushIOSKey(e)),250),!0)}flushIOSKey(e){let t=this.pendingIOSKey;return!!t&&(this.pendingIOSKey=void 0,S(e.contentDOM,t.key,t.keyCode))}ignoreDuringComposition(e){return!!/^key/.test(e.type)&&(this.composing>0||!!(G.safari&&Date.now()-this.compositionEndedAt<100)&&(this.compositionEndedAt=0,!0))}mustFlushObserver(e){return"keydown"==e.type&&229!=e.keyCode||"compositionend"==e.type&&!G.ios}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const St=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],_t=[16,17,18,20,91,92,224,225];class Tt{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.lastEvent=t;let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(n.EditorState.allowMultipleSelections)&&function(e,t){let i=e.state.facet(ve);return i.length?i[0](t):G.mac?t.metaKey:t.ctrlKey}(e,t),this.dragMove=function(e,t){let i=e.state.facet(xe);return i.length?i[0](t):G.mac?!t.altKey:!t.ctrlKey}(e,t),this.dragging=!(!function(e,t){let{main:i}=e.state.selection;if(i.empty)return!1;let n=a(e.root);if(!n||0==n.rangeCount)return!0;let r=n.getRangeAt(0).getClientRects();for(let e=0;e<r.length;e++){let i=r[e];if(i.left<=t.clientX&&i.right>=t.clientX&&i.top<=t.clientY&&i.bottom>=t.clientY)return!0}return!1}(e,t)||1!=Vt(t))&&null,!1===this.dragging&&(t.preventDefault(),this.select(t))}move(e){if(0==e.buttons)return this.destroy();!1===this.dragging&&this.select(this.lastEvent=e)}up(e){null==this.dragging&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let t=this.style.get(e,this.extend,this.multiple);!this.mustSelect&&t.eq(this.view.state.selection)&&t.main.assoc==this.view.state.selection.main.assoc||this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout((()=>this.select(this.lastEvent)),20)}}function At(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let i,n=t.target;n!=e.contentDOM;n=n.parentNode)if(!n||11==n.nodeType||(i=E.get(n))&&i.ignoreEvent(t))return!1;return!0}const Et=Object.create(null),Ct=G.ie&&G.ie_version<15||G.ios&&G.webkit_version<604;function Nt(e,t){let i,{state:r}=e,s=1,o=r.toText(t),a=o.lines==r.selection.ranges.length;if(null!=Ht&&r.selection.ranges.every((e=>e.empty))&&Ht==o.toString()){let e=-1;i=r.changeByRange((i=>{let l=r.doc.lineAt(i.from);if(l.from==e)return{range:i};e=l.from;let h=r.toText((a?o.line(s++).text:t)+r.lineBreak);return{changes:{from:l.from,insert:h},range:n.EditorSelection.cursor(i.from+h.length)}}))}else i=a?r.changeByRange((e=>{let t=o.line(s++);return{changes:{from:e.from,to:e.to,insert:t.text},range:n.EditorSelection.cursor(e.from+t.length)}})):r.replaceSelection(o);e.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Et.keydown=(e,t)=>{e.inputState.setSelectionOrigin("select"),27==t.keyCode?e.inputState.lastEscPress=Date.now():_t.indexOf(t.keyCode)<0&&(e.inputState.lastEscPress=0)};let Lt=0;function Rt(e,t,i,r){if(1==r)return n.EditorSelection.cursor(t,i);if(2==r)return function(e,t,i=1){let r=e.charCategorizer(t),s=e.doc.lineAt(t),o=t-s.from;if(0==s.length)return n.EditorSelection.cursor(t);0==o?i=1:o==s.length&&(i=-1);let a=o,l=o;i<0?a=(0,n.findClusterBreak)(s.text,o,!1):l=(0,n.findClusterBreak)(s.text,o);let h=r(s.text.slice(a,l));for(;a>0;){let e=(0,n.findClusterBreak)(s.text,a,!1);if(r(s.text.slice(e,a))!=h)break;a=e}for(;l<s.length;){let e=(0,n.findClusterBreak)(s.text,l);if(r(s.text.slice(l,e))!=h)break;l=e}return n.EditorSelection.range(a+s.from,l+s.from)}(e.state,t,i);{let i=de.find(e.docView,t),r=e.state.doc.lineAt(i?i.posAtEnd:t),s=i?i.posAtStart:r.from,o=i?i.posAtEnd:r.to;return o<e.state.doc.length&&o==r.to&&o++,n.EditorSelection.range(s,o)}}Et.touchstart=(e,t)=>{Lt=Date.now(),e.inputState.setSelectionOrigin("select.pointer")},Et.touchmove=e=>{e.inputState.setSelectionOrigin("select.pointer")},Et.mousedown=(e,t)=>{if(e.observer.flush(),Lt>Date.now()-2e3&&1==Vt(t))return;let i=null;for(let n of e.state.facet(ye))if(i=n(e,t),i)break;if(i||0!=t.button||(i=function(e,t){let i=Ot(e,t),r=Vt(t),s=e.state.selection,o=i,a=t;return{update(e){e.docChanged&&(i&&(i.pos=e.changes.mapPos(i.pos)),s=s.map(e.changes),a=null)},get(t,l,h){let c;if(a&&t.clientX==a.clientX&&t.clientY==a.clientY?c=o:(c=o=Ot(e,t),a=t),!c||!i)return s;let u=Rt(e,c.pos,c.bias,r);if(i.pos!=c.pos&&!l){let t=Rt(e,i.pos,i.bias,r),s=Math.min(t.from,u.from),o=Math.max(t.to,u.to);u=s<u.from?n.EditorSelection.range(s,o):n.EditorSelection.range(o,s)}return l?s.replaceRange(s.main.extend(u.from,u.to)):h?s.addRange(u):n.EditorSelection.create([u])}}}(e,t)),i){let n=e.root.activeElement!=e.contentDOM;n&&e.observer.ignore((()=>w(e.contentDOM))),e.inputState.startMouseSelection(new Tt(e,t,i,n))}};let Pt=(e,t)=>e>=t.top&&e<=t.bottom,Dt=(e,t,i)=>Pt(t,i)&&e>=i.left&&e<=i.right;function It(e,t,i,n){let r=de.find(e.docView,t);if(!r)return 1;let s=t-r.posAtStart;if(0==s)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&Dt(i,n,o))return-1;let a=r.coordsAt(s,1);return a&&Dt(i,n,a)?1:o&&Pt(n,o)?-1:1}function Ot(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:i,bias:It(e,i,t.clientX,t.clientY)}}const kt=G.ie&&G.ie_version<=11;let zt=null,Ft=0,Bt=0;function Vt(e){if(!kt)return e.detail;let t=zt,i=Bt;return zt=e,Bt=Date.now(),Ft=!t||i>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(Ft+1)%3:1}function Ut(e,t,i,n){if(!i)return;let r=e.posAtCoords({x:t.clientX,y:t.clientY},!1);t.preventDefault();let{mouseSelection:s}=e.inputState,o=n&&s&&s.dragging&&s.dragMove?{from:s.dragging.from,to:s.dragging.to}:null,a={from:r,insert:i},l=e.state.changes(o?[o,a]:a);e.focus(),e.dispatch({changes:l,selection:{anchor:l.mapPos(r,-1),head:l.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}Et.dragstart=(e,t)=>{let{selection:{main:i}}=e.state,{mouseSelection:n}=e.inputState;n&&(n.dragging=i),t.dataTransfer&&(t.dataTransfer.setData("Text",e.state.sliceDoc(i.from,i.to)),t.dataTransfer.effectAllowed="copyMove")},Et.drop=(e,t)=>{if(!t.dataTransfer)return;if(e.state.readOnly)return t.preventDefault();let i=t.dataTransfer.files;if(i&&i.length){t.preventDefault();let n=Array(i.length),r=0,s=()=>{++r==i.length&&Ut(e,t,n.filter((e=>null!=e)).join(e.state.lineBreak),!1)};for(let e=0;e<i.length;e++){let t=new FileReader;t.onerror=s,t.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(t.result)||(n[e]=t.result),s()},t.readAsText(i[e])}}else Ut(e,t,t.dataTransfer.getData("Text"),!0)},Et.paste=(e,t)=>{if(e.state.readOnly)return t.preventDefault();e.observer.flush();let i=Ct?null:t.clipboardData;i?(Nt(e,i.getData("text/plain")),t.preventDefault()):function(e){let t=e.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout((()=>{e.focus(),i.remove(),Nt(e,i.value)}),50)}(e)};let Ht=null;function Gt(e){setTimeout((()=>{e.hasFocus!=e.inputState.notifiedFocused&&e.update([])}),10)}function Wt(e,t){if(e.docView.compositionDeco.size){e.inputState.rapidCompositionStart=t;try{e.update([])}finally{e.inputState.rapidCompositionStart=!1}}}Et.copy=Et.cut=(e,t)=>{let{text:i,ranges:n,linewise:r}=function(e){let t=[],i=[],n=!1;for(let n of e.selection.ranges)n.empty||(t.push(e.sliceDoc(n.from,n.to)),i.push(n));if(!t.length){let r=-1;for(let{from:n}of e.selection.ranges){let s=e.doc.lineAt(n);s.number>r&&(t.push(s.text),i.push({from:s.from,to:Math.min(e.doc.length,s.to+1)})),r=s.number}n=!0}return{text:t.join(e.lineBreak),ranges:i,linewise:n}}(e.state);if(!i&&!r)return;Ht=r?i:null;let s=Ct?null:t.clipboardData;s?(t.preventDefault(),s.clearData(),s.setData("text/plain",i)):function(e,t){let i=e.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=t,n.focus(),n.selectionEnd=t.length,n.selectionStart=0,setTimeout((()=>{n.remove(),e.focus()}),50)}(e,i),"cut"!=t.type||e.state.readOnly||e.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"})},Et.focus=Gt,Et.blur=e=>{e.observer.clearSelectionRange(),Gt(e)},Et.compositionstart=Et.compositionupdate=e=>{null==e.inputState.compositionFirstChange&&(e.inputState.compositionFirstChange=!0),e.inputState.composing<0&&(e.inputState.composing=0,e.docView.compositionDeco.size&&(e.observer.flush(),Wt(e,!0)))},Et.compositionend=e=>{e.inputState.composing=-1,e.inputState.compositionEndedAt=Date.now(),e.inputState.compositionFirstChange=null,setTimeout((()=>{e.inputState.composing<0&&Wt(e,!1)}),50)},Et.contextmenu=e=>{e.inputState.lastContextMenu=Date.now()},Et.beforeinput=(e,t)=>{var i;let n;if(G.chrome&&G.android&&(n=St.find((e=>e.inputType==t.inputType)))&&(e.observer.delayAndroidKey(n.key,n.keyCode),"Backspace"==n.key||"Delete"==n.key)){let t=(null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0;setTimeout((()=>{var i;((null===(i=window.visualViewport)||void 0===i?void 0:i.height)||0)>t+10&&e.hasFocus&&(e.contentDOM.blur(),e.focus())}),100)}};const jt=["pre-wrap","normal","pre-line","break-spaces"];class Xt{constructor(){this.doc=n.Text.empty,this.lineWrapping=!1,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength)),this.lineHeight*i}heightForLine(e){if(!this.lineWrapping)return this.lineHeight;return(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return jt.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let n=e[i];n<0?i++:this.heightSamples[Math.floor(10*n)]||(t=!0,this.heightSamples[Math.floor(10*n)]=!0)}return t}refresh(e,t,i,n,r){let s=jt.indexOf(e)>-1,o=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=s;if(this.lineWrapping=s,this.lineHeight=t,this.charWidth=i,this.lineLength=n,o){this.heightSamples={};for(let e=0;e<r.length;e++){let t=r[e];t<0?e++:this.heightSamples[Math.floor(10*t)]=!0}}return o}}class qt{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Jt{constructor(e,t,i,n,r){this.from=e,this.length=t,this.top=i,this.height=n,this.type=r}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let t=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new Jt(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var Kt=function(e){return e[e.ByPos=0]="ByPos",e[e.ByHeight=1]="ByHeight",e[e.ByPosNoHeight=2]="ByPosNoHeight",e}(Kt||(Kt={}));const Yt=.001;class Zt{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(2&this.flags)>0}set outdated(e){this.flags=(e?2:0)|-3&this.flags}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>Yt&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return Zt.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,n){let r=this;for(let s=n.length-1;s>=0;s--){let{fromA:o,toA:a,fromB:l,toB:h}=n[s],c=r.lineAt(o,Kt.ByPosNoHeight,t,0,0),u=c.to>=a?c:r.lineAt(a,Kt.ByPosNoHeight,t,0,0);for(h+=u.to-a,a=u.to;s>0&&c.from<=n[s-1].toA;)o=n[s-1].fromA,l=n[s-1].fromB,s--,o<c.from&&(c=r.lineAt(o,Kt.ByPosNoHeight,t,0,0));l+=c.from-o,o=c.from;let d=ni.build(i,e,l,h);r=r.replace(o,a,d)}return r.updateHeight(i,0)}static empty(){return new Qt(0,0)}static of(e){if(1==e.length)return e[0];let t=0,i=e.length,n=0,r=0;for(;;)if(t==i)if(n>2*r){let r=e[t-1];r.break?e.splice(--t,1,r.left,null,r.right):e.splice(--t,1,r.left,r.right),i+=1+r.break,n-=r.size}else{if(!(r>2*n))break;{let t=e[i];t.break?e.splice(i,1,t.left,null,t.right):e.splice(i,1,t.left,t.right),i+=2+t.break,r-=t.size}}else if(n<r){let i=e[t++];i&&(n+=i.size)}else{let t=e[--i];t&&(r+=t.size)}let s=0;return null==e[t-1]?(s=1,t--):null==e[t]&&(s=1,i++),new ti(Zt.of(e.slice(0,t)),s,Zt.of(e.slice(i)))}}Zt.prototype.size=1;class $t extends Zt{constructor(e,t,i){super(e,t),this.type=i}blockAt(e,t,i,n){return new Jt(n,this.length,i,this.height,this.type)}lineAt(e,t,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(e,t,i,n,r,s){e<=r+this.length&&t>=r&&s(this.blockAt(0,i,n,r))}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Qt extends $t{constructor(e,t){super(e,t,se.Text),this.collapsed=0,this.widgetHeight=0}replace(e,t,i){let n=i[0];return 1==i.length&&(n instanceof Qt||n instanceof ei&&4&n.flags)&&Math.abs(this.length-n.length)<10?(n instanceof ei?n=new Qt(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):Zt.of(i)}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more?this.setHeight(e,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ei extends Zt{constructor(e){super(e,0)}lines(e,t){let i=e.lineAt(t).number,n=e.lineAt(t+this.length).number;return{firstLine:i,lastLine:n,lineHeight:this.height/(n-i+1)}}blockAt(e,t,i,n){let{firstLine:r,lastLine:s,lineHeight:o}=this.lines(t,n),a=Math.max(0,Math.min(s-r,Math.floor((e-i)/o))),{from:l,length:h}=t.line(r+a);return new Jt(l,h,i+o*a,o,se.Text)}lineAt(e,t,i,n,r){if(t==Kt.ByHeight)return this.blockAt(e,i,n,r);if(t==Kt.ByPosNoHeight){let{from:t,to:n}=i.lineAt(e);return new Jt(t,n-t,0,0,se.Text)}let{firstLine:s,lineHeight:o}=this.lines(i,r),{from:a,length:l,number:h}=i.lineAt(e);return new Jt(a,l,n+o*(h-s),o,se.Text)}forEachLine(e,t,i,n,r,s){let{firstLine:o,lineHeight:a}=this.lines(i,r);for(let l=Math.max(e,r),h=Math.min(r+this.length,t);l<=h;){let t=i.lineAt(l);l==e&&(n+=a*(t.number-o)),s(new Jt(t.from,t.length,n,a,se.Text)),n+=a,l=t.to+1}}replace(e,t,i){let n=this.length-t;if(n>0){let e=i[i.length-1];e instanceof ei?i[i.length-1]=new ei(e.length+n):i.push(null,new ei(n-1))}if(e>0){let t=i[0];t instanceof ei?i[0]=new ei(e+t.length):i.unshift(new ei(e-1),null)}return Zt.of(i)}decomposeLeft(e,t){t.push(new ei(e-1),null)}decomposeRight(e,t){t.push(null,new ei(this.length-e-1))}updateHeight(e,t=0,i=!1,n){let r=t+this.length;if(n&&n.from<=t+this.length&&n.more){let i=[],s=Math.max(t,n.from),o=-1,a=e.heightChanged;for(n.from>t&&i.push(new ei(n.from-t-1).updateHeight(e,t));s<=r&&n.more;){let t=e.doc.lineAt(s).length;i.length&&i.push(null);let r=n.heights[n.index++];-1==o?o=r:Math.abs(r-o)>=Yt&&(o=-2);let a=new Qt(t,r);a.outdated=!1,i.push(a),s+=t+1}s<=r&&i.push(null,new ei(r-s).updateHeight(e,s));let l=Zt.of(i);return e.heightChanged=a||o<0||Math.abs(l.height-this.height)>=Yt||Math.abs(o-this.lines(e.doc,t).lineHeight)>=Yt,l}return(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1),this}toString(){return`gap(${this.length})`}}class ti extends Zt{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return 1&this.flags}blockAt(e,t,i,n){let r=i+this.left.height;return e<r?this.left.blockAt(e,t,i,n):this.right.blockAt(e,t,r,n+this.left.length+this.break)}lineAt(e,t,i,n,r){let s=n+this.left.height,o=r+this.left.length+this.break,a=t==Kt.ByHeight?e<s:e<o,l=a?this.left.lineAt(e,t,i,n,r):this.right.lineAt(e,t,i,s,o);if(this.break||(a?l.to<o:l.from>o))return l;let h=t==Kt.ByPosNoHeight?Kt.ByPosNoHeight:Kt.ByPos;return a?l.join(this.right.lineAt(o,h,i,s,o)):this.left.lineAt(o,h,i,n,r).join(l)}forEachLine(e,t,i,n,r,s){let o=n+this.left.height,a=r+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,n,r,s),t>=a&&this.right.forEachLine(e,t,i,o,a,s);else{let l=this.lineAt(a,Kt.ByPos,i,n,r);e<l.from&&this.left.forEachLine(e,l.from-1,i,n,r,s),l.to>=e&&l.from<=t&&s(l),t>l.to&&this.right.forEachLine(l.to+1,t,i,o,a,s)}}replace(e,t,i){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,i));let r=[];e>0&&this.decomposeLeft(e,r);let s=r.length;for(let e of i)r.push(e);if(e>0&&ii(r,s-1),t<this.length){let e=r.length;this.decomposeRight(t,r),ii(r,e)}return Zt.of(r)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,n=i+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Zt.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,n){let{left:r,right:s}=this,o=t+r.length+this.break,a=null;return n&&n.from<=t+r.length&&n.more?a=r=r.updateHeight(e,t,i,n):r.updateHeight(e,t,i),n&&n.from<=o+s.length&&n.more?a=s=s.updateHeight(e,o,i,n):s.updateHeight(e,o,i),a?this.balanced(r,s):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function ii(e,t){let i,n;null==e[t]&&(i=e[t-1])instanceof ei&&(n=e[t+1])instanceof ei&&e.splice(t-1,3,new ei(i.length+1+n.length))}class ni{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let e=Math.min(t,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof Qt?i.length+=e-this.pos:(e>this.pos||!this.isCovered)&&this.nodes.push(new Qt(e-this.pos,-1)),this.writtenTo=e,t>e&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0;n<0&&(n=this.oracle.lineHeight);let r=t-e;i.block?this.addBlock(new $t(r,n,i.type)):(r||n>=5)&&this.addLineDeco(n,r)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||null==this.nodes[this.nodes.length-1])&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Qt(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new ei(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Qt)return e;let t=new Qt(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine(),e.type!=se.WidgetAfter||this.isCovered||this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=se.WidgetBefore&&(this.covering=e)}addLineDeco(e,t){let i=this.ensureLine();i.length+=t,i.collapsed+=t,i.widgetHeight=Math.max(i.widgetHeight,e),this.writtenTo=this.pos=this.pos+t}finish(e){let t=0==this.nodes.length?null:this.nodes[this.nodes.length-1];!(this.lineStart>-1)||t instanceof Qt||this.isCovered?(this.writtenTo<this.pos||null==t)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos)):this.nodes.push(new Qt(0,-1));let i=e;for(let e of this.nodes)e instanceof Qt&&e.updateHeight(this.oracle,i),i+=e?e.length:1;return this.nodes}static build(e,t,i,r){let s=new ni(i,e);return n.RangeSet.spans(t,i,r,s,0),s.finish(i)}}class ri{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,n){(e<t||i&&i.heightRelevant||n&&n.heightRelevant)&&ue(e,t,this.changes,5)}}function si(e,t){let i=e.getBoundingClientRect(),n=Math.max(0,i.left),r=Math.min(innerWidth,i.right),s=Math.max(0,i.top),o=Math.min(innerHeight,i.bottom),a=e.ownerDocument.body;for(let t=e.parentNode;t&&t!=a;)if(1==t.nodeType){let e=t,i=window.getComputedStyle(e);if((e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)&&"visible"!=i.overflow){let t=e.getBoundingClientRect();n=Math.max(n,t.left),r=Math.min(r,t.right),s=Math.max(s,t.top),o=Math.min(o,t.bottom)}t="absolute"==i.position||"fixed"==i.position?e.offsetParent:e.parentNode}else{if(11!=t.nodeType)break;t=t.host}return{left:n-i.left,right:Math.max(n,r)-i.left,top:s-(i.top+t),bottom:Math.max(s,o)-(i.top+t)}}function oi(e,t){let i=e.getBoundingClientRect();return{left:0,right:i.right-i.left,top:t,bottom:i.bottom-(i.top+t)}}class ai{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],r=t[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(e){return oe.replace({widget:new li(this.size,e)}).range(this.from,this.to)}}class li extends re{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class hi{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.heightOracle=new Xt,this.scaler=gi,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Ve.RTL,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1,this.stateDeco=e.facet(Ie).filter((e=>"function"!=typeof e)),this.heightMap=Zt.empty().applyChanges(this.stateDeco,n.Text.empty,this.heightOracle.setDoc(e.doc),[new Fe(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=oe.set(this.lineGaps.map((e=>e.draw(!1)))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let n=i?t.head:t.anchor;if(!e.some((({from:e,to:t})=>n>=e&&n<=t))){let{from:t,to:i}=this.lineBlockAt(n);e.push(new ci(t,i))}}this.viewports=e.sort(((e,t)=>e.from-t.from)),this.scaler=this.heightMap.height<=7e6?gi:new vi(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(e=>{this.viewportLines.push(1==this.scaler.scale?e:xi(e,this.scaler))}))}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ie).filter((e=>"function"!=typeof e));let r=e.changedRanges,s=Fe.extendWithRanges(r,function(e,t,i){let r=new ri;return n.RangeSet.compare(e,t,i,r,0),r.changes}(i,this.stateDeco,e?e.changes:n.ChangeSet.empty(this.state.doc.length))),o=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),this.heightMap.height!=o&&(e.flags|=2);let a=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let l=!e.changes.empty||2&e.flags||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),l&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection="rtl"==i.direction?Ve.RTL:Ve.LTR;let s=this.heightOracle.mustRefreshForWrapping(r),o=s||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight;this.contentDOMHeight=t.clientHeight,this.mustMeasureContent=!1;let a=0,l=0,h=parseInt(i.paddingTop)||0,c=parseInt(i.paddingBottom)||0;this.paddingTop==h&&this.paddingBottom==c||(this.paddingTop=h,this.paddingBottom=c,a|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(o=!0),this.editorWidth=e.scrollDOM.clientWidth,a|=8);let u=(this.printing?oi:si)(t,this.paddingTop),d=u.top-this.pixelViewport.top,f=u.bottom-this.pixelViewport.bottom;this.pixelViewport=u;let p=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(p!=this.inView&&(this.inView=p,p&&(o=!0)),!this.inView)return 0;let m=t.clientWidth;if(this.contentDOMWidth==m&&this.editorHeight==e.scrollDOM.clientHeight||(this.contentDOMWidth=m,this.editorHeight=e.scrollDOM.clientHeight,a|=8),o){let t=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(t)&&(s=!0),s||n.lineWrapping&&Math.abs(m-this.contentDOMWidth)>n.charWidth){let{lineHeight:i,charWidth:o}=e.docView.measureTextSize();s=n.refresh(r,i,o,m/o,t),s&&(e.docView.minWidth=0,a|=8)}d>0&&f>0?l=Math.max(d,f):d<0&&f<0&&(l=Math.min(d,f)),n.heightChanged=!1;for(let i of this.viewports){let r=i.from==this.viewport.from?t:e.docView.measureVisibleLineHeights(i);this.heightMap=this.heightMap.updateHeight(n,0,s,new qt(i.from,r))}n.heightChanged&&(a|=2)}let g=!this.viewportIsAppropriate(this.viewport,l)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return g&&(this.viewport=this.getViewport(l,this.scrollTarget)),this.updateForViewport(),(2&a||g)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(s?[]:this.lineGaps)),a|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),a}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,r=this.state.doc,{visibleTop:s,visibleBottom:o}=this,a=new ci(n.lineAt(s-1e3*i,Kt.ByHeight,r,0,0).from,n.lineAt(o+1e3*(1-i),Kt.ByHeight,r,0,0).to);if(t){let{head:e}=t.range;if(e<a.from||e>a.to){let i,s=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),o=n.lineAt(e,Kt.ByPos,r,0,0);i="center"==t.y?(o.top+o.bottom)/2-s/2:"start"==t.y||"nearest"==t.y&&e<a.from?o.top:o.bottom-s,a=new ci(n.lineAt(i-500,Kt.ByHeight,r,0,0).from,n.lineAt(i+s+500,Kt.ByHeight,r,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new ci(this.heightMap.lineAt(i,Kt.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,Kt.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,Kt.ByPos,this.state.doc,0,0),{bottom:r}=this.heightMap.lineAt(t,Kt.ByPos,this.state.doc,0,0),{visibleTop:s,visibleBottom:o}=this;return(0==e||n<=s-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||r>=o+Math.max(10,Math.min(i,250)))&&n>s-2e3&&r<o+2e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let n of e)t.touchesRange(n.from,n.to)||i.push(new ai(t.mapPos(n.from),t.mapPos(n.to),n.size));return i}ensureLineGaps(e){let t=[];if(this.defaultTextDirection!=Ve.LTR)return t;for(let i of this.viewportLines){if(i.length<4e3)continue;let n,r,s=ui(i.from,i.to,this.stateDeco);if(s.total<4e3)continue;if(this.heightOracle.lineWrapping){let e=2e3/this.heightOracle.lineLength*this.heightOracle.lineHeight;n=di(s,(this.visibleTop-i.top-e)/i.height),r=di(s,(this.visibleBottom-i.top+e)/i.height)}else{let e=s.total*this.heightOracle.charWidth,t=2e3*this.heightOracle.charWidth;n=di(s,(this.pixelViewport.left-t)/e),r=di(s,(this.pixelViewport.right+t)/e)}let o=[];n>i.from&&o.push({from:i.from,to:n}),r<i.to&&o.push({from:r,to:i.to});let a=this.state.selection.main;a.from>=i.from&&a.from<=i.to&&pi(o,a.from-10,a.from+10),!a.empty&&a.to>=i.from&&a.to<=i.to&&pi(o,a.to-10,a.to+10);for(let{from:n,to:r}of o)r-n>1e3&&t.push(mi(e,(e=>e.from>=i.from&&e.to<=i.to&&Math.abs(e.from-n)<1e3&&Math.abs(e.to-r)<1e3))||new ai(n,r,this.gapSize(i,n,r,s)))}return t}gapSize(e,t,i,n){let r=fi(n,i)-fi(n,t);return this.heightOracle.lineWrapping?e.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(e){ai.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=oe.set(e.map((e=>e.draw(this.heightOracle.lineWrapping)))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];n.RangeSet.spans(e,this.viewport.from,this.viewport.to,{span(e,i){t.push({from:e,to:i})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some(((e,i)=>e.from!=t[i].from||e.to!=t[i].to));return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find((t=>t.from<=e&&t.to>=e))||xi(this.heightMap.lineAt(e,Kt.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return xi(this.heightMap.lineAt(this.scaler.fromDOM(e),Kt.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return xi(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class ci{constructor(e,t){this.from=e,this.to=t}}function ui(e,t,i){let r=[],s=e,o=0;return n.RangeSet.spans(i,e,t,{span(){},point(e,t){e>s&&(r.push({from:s,to:e}),o+=e-s),s=t}},20),s<t&&(r.push({from:s,to:t}),o+=t-s),{total:o,ranges:r}}function di({total:e,ranges:t},i){if(i<=0)return t[0].from;if(i>=1)return t[t.length-1].to;let n=Math.floor(e*i);for(let e=0;;e++){let{from:i,to:r}=t[e],s=r-i;if(n<=s)return i+n;n-=s}}function fi(e,t){let i=0;for(let{from:n,to:r}of e.ranges){if(t<=r){i+=t-n;break}i+=r-n}return i/e.total}function pi(e,t,i){for(let n=0;n<e.length;n++){let r=e[n];if(r.from<i&&r.to>t){let s=[];r.from<t&&s.push({from:r.from,to:t}),r.to>i&&s.push({from:i,to:r.to}),e.splice(n,1,...s),n+=s.length-1}}}function mi(e,t){for(let i of e)if(t(i))return i}const gi={toDOM:e=>e,fromDOM:e=>e,scale:1};class vi{constructor(e,t,i){let n=0,r=0,s=0;this.viewports=i.map((({from:i,to:r})=>{let s=t.lineAt(i,Kt.ByPos,e,0,0).top,o=t.lineAt(r,Kt.ByPos,e,0,0).bottom;return n+=o-s,{from:i,to:r,top:s,bottom:o,domTop:0,domBottom:0}})),this.scale=(7e6-n)/(t.height-n);for(let e of this.viewports)e.domTop=s+(e.top-r)*this.scale,s=e.domBottom=e.domTop+(e.bottom-e.top),r=e.bottom}toDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return n+(e-i)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);i=r.bottom,n=r.domBottom}}fromDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return i+(e-n)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);i=r.bottom,n=r.domBottom}}}function xi(e,t){if(1==t.scale)return e;let i=t.toDOM(e.top),n=t.toDOM(e.bottom);return new Jt(e.from,e.length,i,n-i,Array.isArray(e.type)?e.type.map((e=>xi(e,t))):e.type)}const yi=n.Facet.define({combine:e=>e.join(" ")}),bi=n.Facet.define({combine:e=>e.indexOf(!0)>-1}),wi=s.StyleModule.newName(),Mi=s.StyleModule.newName(),Si=s.StyleModule.newName(),_i={"&light":"."+Mi,"&dark":"."+Si};function Ti(e,t,i){return new(0,s.StyleModule)(t,{finish:t=>/&/.test(t)?t.replace(/&\w*/,(t=>{if("&"==t)return e;if(!i||!i[t])throw new RangeError(`Unsupported selector: ${t}`);return i[t]})):e+" "+t})}const Ai=Ti("."+wi,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},_i),Ei={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Ci=G.ie&&G.ie_version<=11;class Ni{constructor(e,t,i){this.view=e,this.onChange=t,this.onScrollChanged=i,this.active=!1,this.selectionRange=new x,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver((t=>{for(let e of t)this.queue.push(e);(G.ie&&G.ie_version<=11||G.ios&&e.composing)&&t.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Ci&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),window.addEventListener("resize",this.onResize=this.onResize.bind(this)),"function"==typeof ResizeObserver&&(this.resize=new ResizeObserver((()=>{this.view.docView.lastUpdate<Date.now()-75&&this.onResize()})),this.resize.observe(e.scrollDOM)),window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this)),this.start(),window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this)),"function"==typeof IntersectionObserver&&(this.intersection=new IntersectionObserver((e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))}),{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver((e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))}),{})),this.listenForScroll(),this.readSelectionRange(),this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout((()=>{this.resizeTimeout=-1,this.view.requestMeasure()}),50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout((()=>{this.view.viewState.printing=!1,this.view.requestMeasure()}),500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some(((t,i)=>t!=e[i])))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:t}=this,i=this.selectionRange;if(t.state.facet(Ee)?t.root.activeElement!=this.dom:!h(t.dom,i))return;let n=i.anchorNode&&t.docView.nearest(i.anchorNode);n&&n.ignoreEvent(e)||((G.ie&&G.ie_version<=11||G.android&&G.chrome)&&!t.state.selection.main.empty&&i.focusNode&&u(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1))}readSelectionRange(){let{root:e}=this.view,t=G.safari&&11==e.nodeType&&function(){let e=document.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}()==this.view.contentDOM&&function(e){let t=null;function i(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}if(e.contentDOM.addEventListener("beforeinput",i,!0),document.execCommand("indent"),e.contentDOM.removeEventListener("beforeinput",i,!0),!t)return null;let n=t.startContainer,r=t.startOffset,s=t.endContainer,o=t.endOffset,a=e.docView.domAtPos(e.state.selection.main.anchor);u(a.node,a.offset,s,o)&&([n,r,s,o]=[s,o,n,r]);return{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:o}}(this.view)||a(e);return!(!t||this.selectionRange.eq(t))&&(this.selectionRange.setRange(t),this.selectionChanged=!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(1==i.nodeType)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else{if(11!=i.nodeType)break;i=i.host}if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);for(let e of this.scrollTargets=t)e.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ei),Ci&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Ci&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){this.delayedAndroidKey||requestAnimationFrame((()=>{let e=this.delayedAndroidKey;this.delayedAndroidKey=null,this.delayedFlush=-1,this.flush()||S(this.view.contentDOM,e.key,e.keyCode)})),this.delayedAndroidKey&&"Enter"!=e||(this.delayedAndroidKey={key:e,keyCode:t})}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=window.setTimeout((()=>{this.delayedFlush=-1,this.flush()}),20))}forceFlush(){this.delayedFlush>=0&&(window.clearTimeout(this.delayedFlush),this.delayedFlush=-1,this.flush())}processRecords(){let e=this.queue;for(let t of this.observer.takeRecords())e.push(t);e.length&&(this.queue=[]);let t=-1,i=-1,n=!1;for(let r of e){let e=this.readMutation(r);e&&(e.typeOver&&(n=!0),-1==t?({from:t,to:i}=e):(t=Math.min(e.from,t),i=Math.max(e.to,i)))}return{from:t,to:i,typeOver:n}}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return;e&&this.readSelectionRange();let{from:t,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&h(this.dom,this.selectionRange);if(t<0&&!r)return;this.selectionChanged=!1;let s=this.view.state,o=this.onChange(t,i,n);return this.view.state==s&&this.view.update([]),o}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty("attributes"==e.type),"attributes"==e.type&&(t.dirty|=4),"childList"==e.type){let i=Li(t,e.previousSibling||e.target.previousSibling,-1),n=Li(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}return"characterData"==e.type?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}destroy(){var e,t,i;this.stop(),null===(e=this.intersection)||void 0===e||e.disconnect(),null===(t=this.gapIntersection)||void 0===t||t.disconnect(),null===(i=this.resize)||void 0===i||i.disconnect();for(let e of this.scrollTargets)e.removeEventListener("scroll",this.onScroll);window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("beforeprint",this.onPrint),this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout)}}function Li(e,t,i){for(;t;){let n=E.get(t);if(n&&n.parent==e)return n;let r=t.parentNode;t=r!=e.dom?r:i>0?t.nextSibling:t.previousSibling}return null}function Ri(e,t,i,r){let s,o,a=e.state.selection.main;if(t>-1){let r=e.docView.domBoundsAround(t,i,0);if(!r||e.state.readOnly)return!1;let{from:l,to:h}=r,c=e.docView.impreciseHead||e.docView.impreciseAnchor?[]:function(e){let t=[];if(e.root.activeElement!=e.contentDOM)return t;let{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:s}=e.observer.selectionRange;i&&(t.push(new rt(i,n)),r==i&&s==n||t.push(new rt(r,s)));return t}(e),u=new it(c,e.state);u.readRange(r.startDOM,r.endDOM);let d=a.from,f=null;(8===e.inputState.lastKeyCode&&e.inputState.lastKeyTime>Date.now()-100||G.android&&u.text.length<h-l)&&(d=a.to,f="end");let p=function(e,t,i,n){let r=Math.min(e.length,t.length),s=0;for(;s<r&&e.charCodeAt(s)==t.charCodeAt(s);)s++;if(s==r&&e.length==t.length)return null;let o=e.length,a=t.length;for(;o>0&&a>0&&e.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;if("end"==n){i-=o+Math.max(0,s-Math.min(o,a))-s}if(o<s&&e.length<t.length){s-=i<=s&&i>=o?s-i:0,a=s+(a-o),o=s}else if(a<s){s-=i<=s&&i>=a?s-i:0,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}(e.state.doc.sliceString(l,h,tt),u.text,d-l,f);p&&(G.chrome&&13==e.inputState.lastKeyCode&&p.toB==p.from+2&&"￿￿"==u.text.slice(p.from,p.toB)&&p.toB--,s={from:l+p.from,to:l+p.toA,insert:n.Text.of(u.text.slice(p.from,p.toB).split(tt))}),o=function(e,t){if(0==e.length)return null;let i=e[0].pos,r=2==e.length?e[1].pos:i;return i>-1&&r>-1?n.EditorSelection.single(i+t,r+t):null}(c,l)}else if(e.hasFocus||!e.state.facet(Ee)){let t=e.observer.selectionRange,{impreciseHead:i,impreciseAnchor:r}=e.docView,s=i&&i.node==t.focusNode&&i.offset==t.focusOffset||!l(e.contentDOM,t.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(t.focusNode,t.focusOffset),h=r&&r.node==t.anchorNode&&r.offset==t.anchorOffset||!l(e.contentDOM,t.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(t.anchorNode,t.anchorOffset);s==a.head&&h==a.anchor||(o=n.EditorSelection.single(h,s))}if(!s&&!o)return!1;if(!s&&r&&!a.empty&&o&&o.main.empty?s={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,a.to)}:s&&s.from>=a.from&&s.to<=a.to&&(s.from!=a.from||s.to!=a.to)&&a.to-a.from-(s.to-s.from)<=4?s={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,s.from).append(s.insert).append(e.state.doc.slice(s.to,a.to))}:(G.mac||G.android)&&s&&s.from==s.to&&s.from==a.head-1&&"."==s.insert.toString()&&(s={from:a.from,to:a.to,insert:n.Text.of([" "])}),s){let t=e.state;if(G.ios&&e.inputState.flushIOSKey(e))return!0;if(G.android&&(s.from==a.from&&s.to==a.to&&1==s.insert.length&&2==s.insert.lines&&S(e.contentDOM,"Enter",13)||s.from==a.from-1&&s.to==a.to&&0==s.insert.length&&S(e.contentDOM,"Backspace",8)||s.from==a.from&&s.to==a.to+1&&0==s.insert.length&&S(e.contentDOM,"Delete",46)))return!0;let i,r=s.insert.toString();if(e.state.facet(Me).some((t=>t(e,s.from,s.to,r))))return!0;if(e.inputState.composing>=0&&e.inputState.composing++,s.from>=a.from&&s.to<=a.to&&s.to-s.from>=(a.to-a.from)/3&&(!o||o.main.empty&&o.main.from==s.from+s.insert.length)&&e.inputState.composing<0){let n=a.from<s.from?t.sliceDoc(a.from,s.from):"",r=a.to>s.to?t.sliceDoc(s.to,a.to):"";i=t.replaceSelection(e.state.toText(n+s.insert.sliceString(0,void 0,e.state.lineBreak)+r))}else{let r=t.changes(s),l=o&&!t.selection.main.eq(o.main)&&o.main.to<=r.newLength?o.main:void 0;if(t.selection.ranges.length>1&&e.inputState.composing>=0&&s.to<=a.to&&s.to>=a.to-10){let o=e.state.sliceDoc(s.from,s.to),h=at(e)||e.state.doc.lineAt(a.head),c=a.to-s.to,u=a.to-a.from;i=t.changeByRange((i=>{if(i.from==a.from&&i.to==a.to)return{changes:r,range:l||i.map(r)};let d=i.to-c,f=d-o.length;if(i.to-i.from!=u||e.state.sliceDoc(f,d)!=o||h&&i.to>=h.from&&i.from<=h.to)return{range:i};let p=t.changes({from:f,to:d,insert:s.insert}),m=i.to-a.to;return{changes:p,range:l?n.EditorSelection.range(Math.max(0,l.anchor+m),Math.max(0,l.head+m)):i.map(p)}}))}else i={changes:r,selection:l&&t.selection.replaceRange(l)}}let l="input.type";return e.composing&&(l+=".compose",e.inputState.compositionFirstChange&&(l+=".start",e.inputState.compositionFirstChange=!1)),e.dispatch(i,{scrollIntoView:!0,userEvent:l}),!0}if(o&&!o.main.eq(a)){let t=!1,i="select";return e.inputState.lastSelectionTime>Date.now()-50&&("select"==e.inputState.lastSelectionOrigin&&(t=!0),i=e.inputState.lastSelectionOrigin),e.dispatch({selection:o,scrollIntoView:t,userEvent:i}),!0}return!1}class Pi{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(e=>this.update([e])),this.dispatch=this.dispatch.bind(this),this.root=e.root||function(e){for(;e;){if(e&&(9==e.nodeType||11==e.nodeType&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}(e.parent)||document,this.viewState=new hi(e.state||n.EditorState.create(e)),this.plugins=this.state.facet(Ne).map((e=>new Re(e)));for(let e of this.plugins)e.update(this);this.observer=new Ni(this,((e,t,i)=>Ri(this,e,t,i)),(e=>{this.inputState.runScrollHandlers(this,e),this.observer.intersecting&&this.measure()})),this.inputState=new Mt(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new st(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}dispatch(...e){this._dispatch(1==e.length&&e[0]instanceof n.Transaction?e[0]:this.state.update(...e))}update(e){if(0!=this.updateState)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t,i=!1,r=!1,s=this.state;for(let t of e){if(t.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=t.state}if(this.destroyed)return void(this.viewState.state=s);if(this.observer.clear(),s.facet(n.EditorState.phrases)!=this.state.facet(n.EditorState.phrases))return this.setState(s);t=Be.create(this,s,e);let o=this.viewState.scrollTarget;try{this.updateState=2;for(let t of e){if(o&&(o=o.map(t.changes)),t.scrollIntoView){let{main:e}=t.state.selection;o=new _e(e.empty?e:n.EditorSelection.cursor(e.head,e.head>e.anchor?-1:1))}for(let e of t.effects)e.is(Te)&&(o=e.value)}this.viewState.update(t,o),this.bidiCache=Oi.update(this.bidiCache,t.changes),t.empty||(this.updatePlugins(t),this.inputState.update(t)),i=this.docView.update(t),this.state.facet(ze)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some((e=>e.isUserEvent("select.pointer"))))}finally{this.updateState=0}if(t.startState.facet(yi)!=t.state.facet(yi)&&(this.viewState.mustMeasureContent=!0),(i||r||o||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!t.empty)for(let e of this.state.facet(we))e(t)}setState(e){if(0!=this.updateState)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed)return void(this.viewState.state=e);this.updateState=2;let t=this.hasFocus;try{for(let e of this.plugins)e.destroy(this);this.viewState=new hi(e),this.plugins=e.facet(Ne).map((e=>new Re(e))),this.pluginMap.clear();for(let e of this.plugins)e.update(this);this.docView=new st(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Ne),i=e.state.facet(Ne);if(t!=i){let n=[];for(let r of i){let i=t.indexOf(r);if(i<0)n.push(new Re(r));else{let t=this.plugins[i];t.mustUpdate=e,n.push(t)}}for(let t of this.plugins)t.mustUpdate!=e&&t.destroy(this);this.plugins=n,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let t of this.plugins)t.mustUpdate=e;for(let e=0;e<this.plugins.length;e++)this.plugins[e].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.flush();let t=null;try{for(let e=0;;e++){this.updateState=1;let i=this.viewport,n=this.viewState.measure(this);if(!n&&!this.measureRequests.length&&null==this.viewState.scrollTarget)break;if(e>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let r=[];4&n||([this.measureRequests,r]=[r,this.measureRequests]);let s=r.map((e=>{try{return e.read(this)}catch(e){return Ae(this.state,e),Ii}})),o=Be.create(this,this.state,[]),a=!1,l=!1;o.flags|=n,t?t.flags|=n:t=o,this.updateState=2,o.empty||(this.updatePlugins(o),this.inputState.update(o),this.updateAttrs(),a=this.docView.update(o));for(let e=0;e<r.length;e++)if(s[e]!=Ii)try{let t=r[e];t.write&&t.write(s[e],this)}catch(e){Ae(this.state,e)}if(this.viewState.scrollTarget&&(this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=!0),a&&this.docView.updateSelection(!0),this.viewport.from==i.from&&this.viewport.to==i.to&&!l&&0==this.measureRequests.length)break}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let e of this.state.facet(we))e(t)}get themeClasses(){return wi+" "+(this.state.facet(bi)?Si:Mi)+" "+this.state.facet(yi)}updateAttrs(){let e=ki(this,Pe,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ee)?"true":"false",class:"cm-content",style:`${G.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),ki(this,De,t);let i=this.observer.ignore((()=>{let i=ne(this.contentDOM,this.contentAttrs,t),n=ne(this.dom,this.editorAttrs,e);return i||n}));return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let e of i.effects)if(e.is(Pi.announce)){t&&(this.announceDOM.textContent=""),t=!1,this.announceDOM.appendChild(document.createElement("div")).textContent=e.value}}mountStyles(){this.styleModules=this.state.facet(ze),s.StyleModule.mount(this.root,this.styleModules.concat(Ai).reverse())}readMeasured(){if(2==this.updateState)throw new Error("Reading the editor layout isn't allowed during an update");0==this.updateState&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=requestAnimationFrame((()=>this.measure()))),e){if(null!=e.key)for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key)return void(this.measureRequests[t]=e);this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(void 0===t||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find((t=>t.spec==e))||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return wt(this,e,bt(this,e,t,i))}moveByGroup(e,t){return wt(this,e,bt(this,e,t,(t=>function(e,t,i){let r=e.state.charCategorizer(t),s=r(i);return e=>{let t=r(e);return s==n.CharCategory.Space&&(s=t),s==t}}(this,e.head,t))))}moveToLineBoundary(e,t,i=!0){return function(e,t,i,r){let s=e.state.doc.lineAt(t.head),o=r&&e.lineWrapping?e.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head):null;if(o){let t=e.dom.getBoundingClientRect(),r=e.textDirectionAt(s.from),a=e.posAtCoords({x:i==(r==Ve.LTR)?t.right-1:t.left+1,y:(o.top+o.bottom)/2});if(null!=a)return n.EditorSelection.cursor(a,i?-1:1)}let a=de.find(e.docView,t.head),l=a?i?a.posAtEnd:a.posAtStart:i?s.to:s.from;return n.EditorSelection.cursor(l,i?-1:1)}(this,e,t,i)}moveVertically(e,t,i){return wt(this,e,function(e,t,i,r){let s=t.head,o=i?1:-1;if(s==(i?e.state.doc.length:0))return n.EditorSelection.cursor(s,t.assoc);let a,l=t.goalColumn,h=e.contentDOM.getBoundingClientRect(),c=e.coordsAtPos(s),u=e.documentTop;if(c)null==l&&(l=c.left-h.left),a=o<0?c.top:c.bottom;else{let t=e.viewState.lineBlockAt(s);null==l&&(l=Math.min(h.right-h.left,e.defaultCharacterWidth*(s-t.from))),a=(o<0?t.top:t.bottom)+u}let d=h.left+l,f=null!=r?r:e.defaultLineHeight>>1;for(let i=0;;i+=10){let r=a+(f+i)*o,c=xt(e,{x:d,y:r},!1,o);if(r<h.top||r>h.bottom||(o<0?c<s:c>s))return n.EditorSelection.cursor(c,t.assoc,void 0,l)}}(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),xt(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(e),r=this.bidiSpans(n);return g(i,r[Ke.find(r,e-n.from,-1,t)].dir==Ve.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(Se)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Di)return $e(e.length);let t=this.textDirectionAt(e.from);for(let i of this.bidiCache)if(i.from==e.from&&i.dir==t)return i.order;let i=Ze(e.text,t);return this.bidiCache.push(new Oi(e.from,e.to,t,i)),i}get hasFocus(){var e;return(document.hasFocus()||G.safari&&(null===(e=this.inputState)||void 0===e?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore((()=>{w(this.contentDOM),this.docView.updateSelection()}))}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Te.of(new _e("number"==typeof e?n.EditorSelection.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Le.define((()=>({})),{eventHandlers:e})}static theme(e,t){let i=s.StyleModule.newName(),n=[yi.of(i),ze.of(Ti(`.${i}`,e))];return t&&t.dark&&n.push(bi.of(!0)),n}static baseTheme(e){return n.Prec.lowest(ze.of(Ti("."+wi,e,_i)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),n=i&&E.get(i)||E.get(e);return(null===(t=null==n?void 0:n.rootView)||void 0===t?void 0:t.view)||null}}Pi.styleModule=ze,Pi.inputHandler=Me,Pi.perLineTextDirection=Se,Pi.exceptionSink=be,Pi.updateListener=we,Pi.editable=Ee,Pi.mouseSelectionStyle=ye,Pi.dragMovesSelection=xe,Pi.clickAddsSelectionRange=ve,Pi.decorations=Ie,Pi.atomicRanges=Oe,Pi.scrollMargins=ke,Pi.darkTheme=bi,Pi.contentAttributes=De,Pi.editorAttributes=Pe,Pi.lineWrapping=Pi.contentAttributes.of({class:"cm-lineWrapping"}),Pi.announce=n.StateEffect.define();const Di=4096,Ii={};class Oi{constructor(e,t,i,n){this.from=e,this.to=t,this.dir=i,this.order=n}static update(e,t){if(t.empty)return e;let i=[],n=e.length?e[e.length-1].dir:Ve.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let s=e[r];s.dir!=n||t.touchesRange(s.from,s.to)||i.push(new Oi(t.mapPos(s.from,1),t.mapPos(s.to,-1),s.dir,s.order))}return i}}function ki(e,t,i){for(let n=e.state.facet(t),r=n.length-1;r>=0;r--){let t=n[r],s="function"==typeof t?t(e):t;s&&te(s,i)}return i}const zi=G.mac?"mac":G.windows?"win":G.linux?"linux":"key";function Fi(e,t,i){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),!1!==i&&t.shiftKey&&(e="Shift-"+e),e}const Bi=Pi.domEventHandlers({keydown:(e,t)=>ji(Hi(t.state),e,t,"editor")}),Vi=n.Facet.define({enables:Bi}),Ui=new WeakMap;function Hi(e){let t=e.facet(Vi),i=Ui.get(t);return i||Ui.set(t,i=function(e,t=zi){let i=Object.create(null),n=Object.create(null),r=(e,t)=>{let i=n[e];if(null==i)n[e]=t;else if(i!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")},s=(e,n,s,o)=>{let a=i[e]||(i[e]=Object.create(null)),l=n.split(/ (?!$)/).map((e=>function(e,t){const i=e.split(/-(?!$)/);let n,r,s,o,a=i[i.length-1];"Space"==a&&(a=" ");for(let e=0;e<i.length-1;++e){const a=i[e];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))s=!0;else{if(!/^mod$/i.test(a))throw new Error("Unrecognized modifier name: "+a);"mac"==t?o=!0:r=!0}}return n&&(a="Alt-"+a),r&&(a="Ctrl-"+a),o&&(a="Meta-"+a),s&&(a="Shift-"+a),a}(e,t)));for(let t=1;t<l.length;t++){let i=l.slice(0,t).join(" ");r(i,!0),a[i]||(a[i]={preventDefault:!0,commands:[t=>{let n=Wi={view:t,prefix:i,scope:e};return setTimeout((()=>{Wi==n&&(Wi=null)}),4e3),!0}]})}let h=l.join(" ");r(h,!1);let c=a[h]||(a[h]={preventDefault:!1,commands:[]});c.commands.push(s),o&&(c.preventDefault=!0)};for(let i of e){let e=i[t]||i.key;if(e)for(let t of i.scope?i.scope.split(" "):["editor"])s(t,e,i.run,i.preventDefault),i.shift&&s(t,"Shift-"+e,i.shift,i.preventDefault)}return i}(t.reduce(((e,t)=>e.concat(t)),[]))),i}function Gi(e,t,i){return ji(Hi(e.state),t,e,i)}let Wi=null;function ji(e,t,i,r){let s=(0,o.keyName)(t),a=(0,n.codePointAt)(s,0),l=(0,n.codePointSize)(a)==s.length&&" "!=s,h="",c=!1;Wi&&Wi.view==i&&Wi.scope==r&&(h=Wi.prefix+" ",(c=_t.indexOf(t.keyCode)<0)&&(Wi=null));let u,d=e=>{if(e){for(let t of e.commands)if(t(i))return!0;e.preventDefault&&(c=!0)}return!1},f=e[r];if(f){if(d(f[h+Fi(s,t,!l)]))return!0;if(l&&(t.shiftKey||t.altKey||t.metaKey||a>127)&&(u=o.base[t.keyCode])&&u!=s){if(d(f[h+Fi(u,t,!0)]))return!0;if(t.shiftKey&&o.shift[t.keyCode]!=u&&d(f[h+Fi(o.shift[t.keyCode],t,!1)]))return!0}else if(l&&t.shiftKey&&d(f[h+Fi(s,t,!0)]))return!0}return c}const Xi=!G.ios,qi=n.Facet.define({combine:e=>(0,n.combineConfig)(e,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})});function Ji(e={}){return[qi.of(e),Yi,$i]}class Ki{constructor(e,t,i,n,r){this.left=e,this.top=t,this.width=i,this.height=n,this.className=r}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width>=0&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}}const Yi=Le.fromClass(class{constructor(e){this.view=e,this.rangePieces=[],this.cursors=[],this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)},this.selectionLayer=e.scrollDOM.appendChild(document.createElement("div")),this.selectionLayer.className="cm-selectionLayer",this.selectionLayer.setAttribute("aria-hidden","true"),this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div")),this.cursorLayer.className="cm-cursorLayer",this.cursorLayer.setAttribute("aria-hidden","true"),e.requestMeasure(this.measureReq),this.setBlinkRate()}setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(qi).cursorBlinkRate+"ms"}update(e){let t=e.startState.facet(qi)!=e.state.facet(qi);(t||e.selectionSet||e.geometryChanged||e.viewportChanged)&&this.view.requestMeasure(this.measureReq),e.transactions.some((e=>e.scrollIntoView))&&(this.cursorLayer.style.animationName="cm-blink"==this.cursorLayer.style.animationName?"cm-blink2":"cm-blink"),t&&this.setBlinkRate()}readPos(){let{state:e}=this.view,t=e.facet(qi),i=e.selection.ranges.map((e=>e.empty?[]:function(e,t){if(t.to<=e.viewport.from||t.from>=e.viewport.to)return[];let i=Math.max(t.from,e.viewport.from),n=Math.min(t.to,e.viewport.to),r=e.textDirection==Ve.LTR,s=e.contentDOM,o=s.getBoundingClientRect(),a=Qi(e),l=window.getComputedStyle(s.firstChild),h=o.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent)),c=o.right-parseInt(l.paddingRight),u=tn(e,i),d=tn(e,n),f=u.type==se.Text?u:null,p=d.type==se.Text?d:null;e.lineWrapping&&(f&&(f=en(e,i,f)),p&&(p=en(e,n,p)));if(f&&p&&f.from==p.from)return g(v(t.from,t.to,f));{let i=f?v(t.from,null,f):x(u,!1),n=p?v(null,t.to,p):x(d,!0),r=[];return(f||u).to<(p||d).from-1?r.push(m(h,i.bottom,c,n.top)):i.bottom<n.top&&e.elementAtHeight((i.bottom+n.top)/2).type==se.Text&&(i.bottom=n.top=(i.bottom+n.top)/2),g(i).concat(r).concat(g(n))}function m(e,t,i,n){return new Ki(e-a.left,t-a.top-.01,i-e,n-t+.01,"cm-selectionBackground")}function g({top:e,bottom:t,horizontal:i}){let n=[];for(let r=0;r<i.length;r+=2)n.push(m(i[r],e,i[r+1],t));return n}function v(t,i,n){let s=1e9,o=-1e9,a=[];function l(t,i,l,u,d){let f=e.coordsAtPos(t,t==n.to?-2:2),p=e.coordsAtPos(l,l==n.from?2:-2);s=Math.min(f.top,p.top,s),o=Math.max(f.bottom,p.bottom,o),d==Ve.LTR?a.push(r&&i?h:f.left,r&&u?c:p.right):a.push(!r&&u?h:p.left,!r&&i?c:f.right)}let u=null!=t?t:n.from,d=null!=i?i:n.to;for(let n of e.visibleRanges)if(n.to>u&&n.from<d)for(let r=Math.max(n.from,u),s=Math.min(n.to,d);;){let n=e.state.doc.lineAt(r);for(let o of e.bidiSpans(n)){let e=o.from+n.from,a=o.to+n.from;if(e>=s)break;a>r&&l(Math.max(e,r),null==t&&e<=u,Math.min(a,s),null==i&&a>=d,o.dir)}if(r=n.to+1,r>=s)break}return 0==a.length&&l(u,null==t,d,null==i,e.textDirection),{top:s,bottom:o,horizontal:a}}function x(e,t){let i=o.top+(t?e.top:e.bottom);return{top:i,bottom:i,horizontal:[]}}}(this.view,e))).reduce(((e,t)=>e.concat(t))),n=[];for(let i of e.selection.ranges){let r=i==e.selection.main;if(i.empty?!r||Xi:t.drawRangeCursor){let e=nn(this.view,i,r);e&&n.push(e)}}return{rangePieces:i,cursors:n}}drawSel({rangePieces:e,cursors:t}){if(e.length!=this.rangePieces.length||e.some(((e,t)=>!e.eq(this.rangePieces[t])))){this.selectionLayer.textContent="";for(let t of e)this.selectionLayer.appendChild(t.draw());this.rangePieces=e}if(t.length!=this.cursors.length||t.some(((e,t)=>!e.eq(this.cursors[t])))){let e=this.cursorLayer.children;if(e.length!==t.length){this.cursorLayer.textContent="";for(const e of t)this.cursorLayer.appendChild(e.draw())}else t.forEach(((t,i)=>t.adjust(e[i])));this.cursors=t}}destroy(){this.selectionLayer.remove(),this.cursorLayer.remove()}}),Zi={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Xi&&(Zi[".cm-line"].caretColor="transparent !important");const $i=n.Prec.highest(Pi.theme(Zi));function Qi(e){let t=e.scrollDOM.getBoundingClientRect();return{left:(e.textDirection==Ve.LTR?t.left:t.right-e.scrollDOM.clientWidth)-e.scrollDOM.scrollLeft,top:t.top-e.scrollDOM.scrollTop}}function en(e,t,i){let r=n.EditorSelection.cursor(t);return{from:Math.max(i.from,e.moveToLineBoundary(r,!1,!0).from),to:Math.min(i.to,e.moveToLineBoundary(r,!0,!0).from),type:se.Text}}function tn(e,t){let i=e.lineBlockAt(t);if(Array.isArray(i.type))for(let e of i.type)if(e.to>t||e.to==t&&(e.to==i.to||e.type==se.Text))return e;return i}function nn(e,t,i){let n=e.coordsAtPos(t.head,t.assoc||1);if(!n)return null;let r=Qi(e);return new Ki(n.left-r.left,n.top-r.top,-1,n.bottom-n.top,i?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}const rn=n.StateEffect.define({map:(e,t)=>null==e?null:t.mapPos(e)}),sn=n.StateField.define({create:()=>null,update:(e,t)=>(null!=e&&(e=t.changes.mapPos(e)),t.effects.reduce(((e,t)=>t.is(rn)?t.value:e),e))}),on=Le.fromClass(class{constructor(e){this.view=e,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(e){var t;let i=e.state.field(sn);null==i?null!=this.cursor&&(null===(t=this.cursor)||void 0===t||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(e.startState.field(sn)!=i||e.docChanged||e.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let e=this.view.state.field(sn),t=null!=e&&this.view.coordsAtPos(e);if(!t)return null;let i=this.view.scrollDOM.getBoundingClientRect();return{left:t.left-i.left+this.view.scrollDOM.scrollLeft,top:t.top-i.top+this.view.scrollDOM.scrollTop,height:t.bottom-t.top}}drawCursor(e){this.cursor&&(e?(this.cursor.style.left=e.left+"px",this.cursor.style.top=e.top+"px",this.cursor.style.height=e.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(e){this.view.state.field(sn)!=e&&this.view.dispatch({effects:rn.of(e)})}},{eventHandlers:{dragover(e){this.setDropPos(this.view.posAtCoords({x:e.clientX,y:e.clientY}))},dragleave(e){e.target!=this.view.contentDOM&&this.view.contentDOM.contains(e.relatedTarget)||this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function an(){return[sn,on]}function ln(e,t,i,n,r){t.lastIndex=0;for(let s,o=e.iterRange(i,n),a=i;!o.next().done;a+=o.value.length)if(!o.lineBreak)for(;s=t.exec(o.value);)r(a+s.index,a+s.index+s[0].length,s)}class hn{constructor(e){let{regexp:t,decoration:i,boundary:n,maxLength:r=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t,this.getDeco="function"==typeof i?i:()=>i,this.boundary=n,this.maxLength=r}createDeco(e){let t=new(0,n.RangeSetBuilder);for(let{from:i,to:n}of function(e,t){let i=e.visibleRanges;if(1==i.length&&i[0].from==e.viewport.from&&i[0].to==e.viewport.to)return i;let n=[];for(let{from:r,to:s}of i)r=Math.max(e.state.doc.lineAt(r).from,r-t),s=Math.min(e.state.doc.lineAt(s).to,s+t),n.length&&n[n.length-1].to>=r?n[n.length-1].to=s:n.push({from:r,to:s});return n}(e,this.maxLength))ln(e.state.doc,this.regexp,i,n,((i,n,r)=>t.add(i,n,this.getDeco(r,e,i))));return t.finish()}updateDeco(e,t){let i=1e9,n=-1;return e.docChanged&&e.changes.iterChanges(((t,r,s,o)=>{o>e.view.viewport.from&&s<e.view.viewport.to&&(i=Math.min(s,i),n=Math.max(o,n))})),e.viewportChanged||n-i>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),i,n):t}updateRange(e,t,i,n){for(let r of e.visibleRanges){let s=Math.max(r.from,i),o=Math.min(r.to,n);if(o>s){let i=e.state.doc.lineAt(s),n=i.to<o?e.state.doc.lineAt(o):i,a=Math.max(r.from,i.from),l=Math.min(r.to,n.to);if(this.boundary){for(;s>i.from;s--)if(this.boundary.test(i.text[s-1-i.from])){a=s;break}for(;o<n.to;o++)if(this.boundary.test(n.text[o-n.from])){l=o;break}}let h,c=[];if(i==n)for(this.regexp.lastIndex=a-i.from;(h=this.regexp.exec(i.text))&&h.index<l-i.from;){let t=h.index+i.from;c.push(this.getDeco(h,e,t).range(t,t+h[0].length))}else ln(e.state.doc,this.regexp,a,l,((t,i,n)=>c.push(this.getDeco(n,e,t).range(t,i))));t=t.update({filterFrom:a,filterTo:l,filter:(e,t)=>e<a||t>l,add:c})}}return t}}const cn=null!=/x/.unicode?"gu":"g",un=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮\ufeff￹-￼]",cn),dn={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let fn=null;const pn=n.Facet.define({combine(e){let t=(0,n.combineConfig)(e,{render:null,specialChars:un,addSpecialChars:null});return(t.replaceTabs=!function(){var e;if(null==fn&&"undefined"!=typeof document&&document.body){let t=document.body.style;fn=null!=(null!==(e=t.tabSize)&&void 0!==e?e:t.MozTabSize)}return fn||!1}())&&(t.specialChars=new RegExp("\t|"+t.specialChars.source,cn)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,cn)),t}});function mn(e={}){return[pn.of(e),gn||(gn=Le.fromClass(class{constructor(e){this.view=e,this.decorations=oe.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(e.state.facet(pn)),this.decorations=this.decorator.createDeco(e)}makeDecorator(e){return new hn({regexp:e.specialChars,decoration:(t,i,r)=>{let{doc:s}=i.state,o=(0,n.codePointAt)(t[0],0);if(9==o){let e=s.lineAt(r),t=i.state.tabSize,o=(0,n.countColumn)(e.text,t,r-e.from);return oe.replace({widget:new xn((t-o%t)*this.view.defaultCharacterWidth)})}return this.decorationCache[o]||(this.decorationCache[o]=oe.replace({widget:new vn(e,o)}))},boundary:e.replaceTabs?void 0:/[^]/})}update(e){let t=e.state.facet(pn);e.startState.facet(pn)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(e.view)):this.decorations=this.decorator.updateDeco(e,this.decorations)}},{decorations:e=>e.decorations}))]}let gn=null;class vn extends re{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=(i=this.code)>=32?"•":10==i?"␤":String.fromCharCode(9216+i);var i;let n=e.state.phrase("Control character")+" "+(dn[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,n,t);if(r)return r;let s=document.createElement("span");return s.textContent=t,s.title=n,s.setAttribute("aria-label",n),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class xn extends re{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="\t",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function yn(){return wn}const bn=oe.line({class:"cm-activeLine"}),wn=Le.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.docChanged||e.selectionSet)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=-1,i=[];for(let n of e.state.selection.ranges){if(!n.empty)return oe.none;let r=e.lineBlockAt(n.head);r.from>t&&(i.push(bn.range(r.from)),t=r.from)}return oe.set(i)}},{decorations:e=>e.decorations});const Mn=2e3;function Sn(e,t){let i=e.posAtCoords({x:t.clientX,y:t.clientY},!1),r=e.state.doc.lineAt(i),s=i-r.from,o=s>Mn?-1:s==r.length?function(e,t){let i=e.coordsAtPos(e.viewport.from);return i?Math.round(Math.abs((i.left-t)/e.defaultCharacterWidth)):-1}(e,t.clientX):(0,n.countColumn)(r.text,e.state.tabSize,i-r.from);return{line:r.number,col:o,off:s}}function _n(e,t){let i=Sn(e,t),r=e.state.selection;return i?{update(e){if(e.docChanged){let t=e.changes.mapPos(e.startState.doc.line(i.line).from),n=e.state.doc.lineAt(t);i={line:n.number,col:i.col,off:Math.min(i.off,n.length)},r=r.map(e.changes)}},get(t,s,o){let a=Sn(e,t);if(!a)return r;let l=function(e,t,i){let r=Math.min(t.line,i.line),s=Math.max(t.line,i.line),o=[];if(t.off>Mn||i.off>Mn||t.col<0||i.col<0){let a=Math.min(t.off,i.off),l=Math.max(t.off,i.off);for(let t=r;t<=s;t++){let i=e.doc.line(t);i.length<=l&&o.push(n.EditorSelection.range(i.from+a,i.to+l))}}else{let a=Math.min(t.col,i.col),l=Math.max(t.col,i.col);for(let t=r;t<=s;t++){let i=e.doc.line(t),r=(0,n.findColumn)(i.text,a,e.tabSize,!0);if(r>-1){let t=(0,n.findColumn)(i.text,l,e.tabSize);o.push(n.EditorSelection.range(i.from+r,i.from+t))}}}return o}(e.state,i,a);return l.length?o?n.EditorSelection.create(l.concat(r.ranges)):n.EditorSelection.create(l):r}}:null}function Tn(e){let t=(null==e?void 0:e.eventFilter)||(e=>e.altKey&&0==e.button);return Pi.mouseSelectionStyle.of(((e,i)=>t(i)?_n(e,i):null))}const An={Alt:[18,e=>e.altKey],Control:[17,e=>e.ctrlKey],Shift:[16,e=>e.shiftKey],Meta:[91,e=>e.metaKey]},En={style:"cursor: crosshair"};function Cn(e={}){let[t,i]=An[e.key||"Alt"],n=Le.fromClass(class{constructor(e){this.view=e,this.isDown=!1}set(e){this.isDown!=e&&(this.isDown=e,this.view.update([]))}},{eventHandlers:{keydown(e){this.set(e.keyCode==t||i(e))},keyup(e){e.keyCode!=t&&i(e)||this.set(!1)}}});return[n,Pi.contentAttributes.of((e=>{var t;return(null===(t=e.plugin(n))||void 0===t?void 0:t.isDown)?En:null}))]}const Nn="-10000px";class Ln{constructor(e,t,i){this.facet=t,this.createTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter((e=>e)),this.tooltipViews=this.tooltips.map(i)}update(e){let t=e.state.facet(this.facet),i=t.filter((e=>e));if(t===this.input){for(let t of this.tooltipViews)t.update&&t.update(e);return!1}let n=[];for(let t=0;t<i.length;t++){let r=i[t],s=-1;if(r){for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];t&&t.create==r.create&&(s=e)}if(s<0)n[t]=this.createTooltipView(r);else{let i=n[t]=this.tooltipViews[s];i.update&&i.update(e)}}}for(let e of this.tooltipViews)n.indexOf(e)<0&&e.dom.remove();return this.input=t,this.tooltips=i,this.tooltipViews=n,!0}}function Rn(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}const Pn=n.Facet.define({combine:e=>{var t,i,n;return{position:G.ios?"absolute":(null===(t=e.find((e=>e.position)))||void 0===t?void 0:t.position)||"fixed",parent:(null===(i=e.find((e=>e.parent)))||void 0===i?void 0:i.parent)||null,tooltipSpace:(null===(n=e.find((e=>e.tooltipSpace)))||void 0===n?void 0:n.tooltipSpace)||Rn}}}),Dn=Le.fromClass(class{constructor(e){var t;this.view=e,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let i=e.state.facet(Pn);this.position=i.position,this.parent=i.parent,this.classes=e.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new Ln(e,kn,(e=>this.createTooltip(e))),this.intersectionObserver="function"==typeof IntersectionObserver?new IntersectionObserver((e=>{Date.now()>this.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1&&this.measureSoon()}),{threshold:[1]}):null,this.observeIntersection(),null===(t=e.dom.ownerDocument.defaultView)||void 0===t||t.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let e of this.manager.tooltipViews)this.intersectionObserver.observe(e.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout((()=>{this.measureTimeout=-1,this.maybeMeasure()}),50))}update(e){e.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(e);t&&this.observeIntersection();let i=t||e.geometryChanged,n=e.state.facet(Pn);if(n.position!=this.position){this.position=n.position;for(let e of this.manager.tooltipViews)e.dom.style.position=this.position;i=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let e of this.manager.tooltipViews)this.container.appendChild(e.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(e){let t=e.create(this.view);if(t.dom.classList.add("cm-tooltip"),e.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let e=document.createElement("div");e.className="cm-tooltip-arrow",t.dom.appendChild(e)}return t.dom.style.position=this.position,t.dom.style.top=Nn,this.container.appendChild(t.dom),t.mount&&t.mount(this.view),t}destroy(){var e,t;null===(e=this.view.dom.ownerDocument.defaultView)||void 0===e||e.removeEventListener("resize",this.measureSoon);for(let{dom:e}of this.manager.tooltipViews)e.remove();null===(t=this.intersectionObserver)||void 0===t||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let e=this.view.dom.getBoundingClientRect();return{editor:e,parent:this.parent?this.container.getBoundingClientRect():e,pos:this.manager.tooltips.map(((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)})),size:this.manager.tooltipViews.map((({dom:e})=>e.getBoundingClientRect())),space:this.view.state.facet(Pn).tooltipSpace(this.view)}}writeMeasure(e){let{editor:t,space:i}=e,n=[];for(let r=0;r<this.manager.tooltips.length;r++){let s=this.manager.tooltips[r],o=this.manager.tooltipViews[r],{dom:a}=o,l=e.pos[r],h=e.size[r];if(!l||l.bottom<=Math.max(t.top,i.top)||l.top>=Math.min(t.bottom,i.bottom)||l.right<Math.max(t.left,i.left)-.1||l.left>Math.min(t.right,i.right)+.1){a.style.top=Nn;continue}let c=s.arrow?o.dom.querySelector(".cm-tooltip-arrow"):null,u=c?7:0,d=h.right-h.left,f=h.bottom-h.top,p=o.offset||On,m=this.view.textDirection==Ve.LTR,g=h.width>i.right-i.left?m?i.left:i.right-h.width:m?Math.min(l.left-(c?14:0)+p.x,i.right-d):Math.max(i.left,l.left-d+(c?14:0)-p.x),v=!!s.above;!s.strictSide&&(v?l.top-(h.bottom-h.top)-p.y<i.top:l.bottom+(h.bottom-h.top)+p.y>i.bottom)&&v==i.bottom-l.bottom>l.top-i.top&&(v=!v);let x=v?l.top-f-u-p.y:l.bottom+u+p.y,y=g+d;if(!0!==o.overlap)for(let e of n)e.left<y&&e.right>g&&e.top<x+f&&e.bottom>x&&(x=v?e.top-f-2-u:e.bottom+u+2);"absolute"==this.position?(a.style.top=x-e.parent.top+"px",a.style.left=g-e.parent.left+"px"):(a.style.top=x+"px",a.style.left=g+"px"),c&&(c.style.left=l.left+(m?p.x:-p.x)-(g+14-7)+"px"),!0!==o.overlap&&n.push({left:g,top:x,right:y,bottom:x+f}),a.classList.toggle("cm-tooltip-above",v),a.classList.toggle("cm-tooltip-below",!v),o.positioned&&o.positioned()}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let e of this.manager.tooltipViews)e.dom.style.top=Nn}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),In=Pi.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),On={x:0,y:0},kn=n.Facet.define({enables:[Dn,In]}),zn=n.Facet.define();class Fn{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new Ln(e,zn,(e=>this.createHostedView(e)))}static create(e){return new Fn(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(){for(let e of this.manager.tooltipViews)e.positioned&&e.positioned()}update(e){this.manager.update(e)}}const Bn=kn.compute([zn],(e=>{let t=e.facet(zn).filter((e=>e));return 0===t.length?null:{pos:Math.min(...t.map((e=>e.pos))),end:Math.max(...t.filter((e=>null!=e.end)).map((e=>e.end))),create:Fn.create,above:t[0].above,arrow:t.some((e=>e.arrow))}}));class Vn{constructor(e,t,i,n,r){this.view=e,this.source=t,this.field=i,this.setHover=n,this.hoverTime=r,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout((()=>this.startHover()),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,t=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(null==t)return;let i=this.view.coordsAtPos(t);if(null==i||e.y<i.top||e.y>i.bottom||e.x<i.left-this.view.defaultCharacterWidth||e.x>i.right+this.view.defaultCharacterWidth)return;let n=this.view.bidiSpans(this.view.state.doc.lineAt(t)).find((e=>e.from<=t&&e.to>=t)),r=n&&n.dir==Ve.RTL?-1:1,s=this.source(this.view,t,e.x<i.left?-r:r);if(null==s?void 0:s.then){let e=this.pending={pos:t};s.then((t=>{this.pending==e&&(this.pending=null,t&&this.view.dispatch({effects:this.setHover.of(t)}))}),(e=>Ae(this.view.state,e,"hover tooltip")))}else s&&this.view.dispatch({effects:this.setHover.of(s)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!function(e){for(let t=e;t;t=t.parentNode)if(1==t.nodeType&&t.classList.contains("cm-tooltip"))return!0;return!1}(this.lastMove.target)||this.pending){let{pos:n}=i||this.pending,r=null!==(t=null==i?void 0:i.end)&&void 0!==t?t:n;(n==r?this.view.posAtCoords(this.lastMove)==n:function(e,t,i,n,r,s){let o=document.createRange(),a=e.domAtPos(t),l=e.domAtPos(i);o.setEnd(l.node,l.offset),o.setStart(a.node,a.offset);let h=o.getClientRects();o.detach();for(let e=0;e<h.length;e++){let t=h[e];if(Math.max(t.top-r,r-t.bottom,t.left-n,n-t.right)<=s)return!0}return!1}(this.view,n,r,e.clientX,e.clientY,6))||(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function Un(e,t={}){let i=n.StateEffect.define(),r=n.StateField.define({create:()=>null,update(e,r){if(e&&(t.hideOnChange&&(r.docChanged||r.selection)||t.hideOn&&t.hideOn(r,e)))return null;if(e&&r.docChanged){let t=r.changes.mapPos(e.pos,-1,n.MapMode.TrackDel);if(null==t)return null;let i=Object.assign(Object.create(null),e);i.pos=t,null!=e.end&&(i.end=r.changes.mapPos(e.end)),e=i}for(let t of r.effects)t.is(i)&&(e=t.value),t.is(Gn)&&(e=null);return e},provide:e=>zn.from(e)});return[r,Le.define((n=>new Vn(n,e,r,i,t.hoverTime||300))),Bn]}function Hn(e,t){let i=e.plugin(Dn);if(!i)return null;let n=i.manager.tooltips.indexOf(t);return n<0?null:i.manager.tooltipViews[n]}const Gn=n.StateEffect.define();const Wn=n.Facet.define({combine(e){let t,i;for(let n of e)t=t||n.topContainer,i=i||n.bottomContainer;return{topContainer:t,bottomContainer:i}}});function jn(e,t){let i=e.plugin(Xn),n=i?i.specs.indexOf(t):-1;return n>-1?i.panels[n]:null}const Xn=Le.fromClass(class{constructor(e){this.input=e.state.facet(Kn),this.specs=this.input.filter((e=>e)),this.panels=this.specs.map((t=>t(e)));let t=e.state.facet(Wn);this.top=new qn(e,!0,t.topContainer),this.bottom=new qn(e,!1,t.bottomContainer),this.top.sync(this.panels.filter((e=>e.top))),this.bottom.sync(this.panels.filter((e=>!e.top)));for(let e of this.panels)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}update(e){let t=e.state.facet(Wn);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new qn(e.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new qn(e.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=e.state.facet(Kn);if(i!=this.input){let t=i.filter((e=>e)),n=[],r=[],s=[],o=[];for(let i of t){let t,a=this.specs.indexOf(i);a<0?(t=i(e.view),o.push(t)):(t=this.panels[a],t.update&&t.update(e)),n.push(t),(t.top?r:s).push(t)}this.specs=t,this.panels=n,this.top.sync(r),this.bottom.sync(s);for(let e of o)e.dom.classList.add("cm-panel"),e.mount&&e.mount()}else for(let t of this.panels)t.update&&t.update(e)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:e=>Pi.scrollMargins.of((t=>{let i=t.plugin(e);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}}))});class qn{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(0==this.panels.length)return void(this.dom&&(this.dom.remove(),this.dom=void 0));if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Jn(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Jn(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(this.container&&this.classes!=this.view.themeClasses){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Jn(e){let t=e.nextSibling;return e.remove(),t}const Kn=n.Facet.define({enables:Xn});class Yn extends n.RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Yn.prototype.elementClass="",Yn.prototype.toDOM=void 0,Yn.prototype.mapMode=n.MapMode.TrackBefore,Yn.prototype.startSide=Yn.prototype.endSide=-1,Yn.prototype.point=!0;const Zn=n.Facet.define(),$n={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>n.RangeSet.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Qn=n.Facet.define();function er(e){return[ir(),Qn.of(Object.assign(Object.assign({},$n),e))]}const tr=n.Facet.define({combine:e=>e.some((e=>e))});function ir(e){let t=[nr];return e&&!1===e.fixed&&t.push(tr.of(!0)),t}const nr=Le.fromClass(class{constructor(e){this.view=e,this.prevViewport=e.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=e.state.facet(Qn).map((t=>new ar(e,t)));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!e.state.facet(tr),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),e.scrollDOM.insertBefore(this.dom,e.contentDOM)}update(e){if(this.updateGutters(e)){let t=this.prevViewport,i=e.view.viewport,n=Math.min(t.to,i.to)-Math.max(t.from,i.from);this.syncGutters(n<.8*(i.to-i.from))}e.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(tr)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=e.view.viewport}syncGutters(e){let t=this.dom.nextSibling;e&&this.dom.remove();let i=n.RangeSet.iter(this.view.state.facet(Zn),this.view.viewport.from),r=[],s=this.gutters.map((e=>new or(e,this.view.viewport,-this.view.documentPadding.top)));for(let e of this.view.viewportLineBlocks){let t;if(Array.isArray(e.type)){for(let i of e.type)if(i.type==se.Text){t=i;break}}else t=e.type==se.Text?e:void 0;if(t){r.length&&(r=[]),sr(i,r,e.from);for(let e of s)e.line(this.view,t,r)}}for(let e of s)e.finish();e&&this.view.scrollDOM.insertBefore(this.dom,t)}updateGutters(e){let t=e.startState.facet(Qn),i=e.state.facet(Qn),r=e.docChanged||e.heightChanged||e.viewportChanged||!n.RangeSet.eq(e.startState.facet(Zn),e.state.facet(Zn),e.view.viewport.from,e.view.viewport.to);if(t==i)for(let t of this.gutters)t.update(e)&&(r=!0);else{r=!0;let n=[];for(let r of i){let i=t.indexOf(r);i<0?n.push(new ar(this.view,r)):(this.gutters[i].update(e),n.push(this.gutters[i]))}for(let e of this.gutters)e.dom.remove(),n.indexOf(e)<0&&e.destroy();for(let e of n)this.dom.appendChild(e.dom);this.gutters=n}return r}destroy(){for(let e of this.gutters)e.destroy();this.dom.remove()}},{provide:e=>Pi.scrollMargins.of((t=>{let i=t.plugin(e);return i&&0!=i.gutters.length&&i.fixed?t.textDirection==Ve.LTR?{left:i.dom.offsetWidth}:{right:i.dom.offsetWidth}:null}))});function rr(e){return Array.isArray(e)?e:[e]}function sr(e,t,i){for(;e.value&&e.from<=i;)e.from==i&&t.push(e.value),e.next()}class or{constructor(e,t,i){this.gutter=e,this.height=i,this.localMarkers=[],this.i=0,this.cursor=n.RangeSet.iter(e.markers,t.from)}line(e,t,i){this.localMarkers.length&&(this.localMarkers=[]),sr(this.cursor,this.localMarkers,t.from);let n=i.length?this.localMarkers.concat(i):this.localMarkers,r=this.gutter.config.lineMarker(e,t,n);r&&n.unshift(r);let s=this.gutter;if(0==n.length&&!s.config.renderEmptyElements)return;let o=t.top-this.height;if(this.i==s.elements.length){let i=new lr(e,t.height,o,n);s.elements.push(i),s.dom.appendChild(i.dom)}else s.elements[this.i].update(e,t.height,o,n);this.height=t.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class ar{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,(n=>{let r=e.lineBlockAtHeight(n.clientY-e.documentTop);t.domEventHandlers[i](e,r,n)&&n.preventDefault()}));this.markers=rr(t.markers(e)),t.initialSpacer&&(this.spacer=new lr(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=rr(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let t=this.config.updateSpacer(this.spacer.markers[0],e);t!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[t])}let i=e.view.viewport;return!n.RangeSet.eq(this.markers,t,i.from,i.to)||!!this.config.lineMarkerChange&&this.config.lineMarkerChange(e)}destroy(){for(let e of this.elements)e.destroy()}}class lr{constructor(e,t,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,n)}update(e,t,i,n){this.height!=t&&(this.dom.style.height=(this.height=t)+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),function(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(!e[i].compare(t[i]))return!1;return!0}(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let i="cm-gutterElement",n=this.dom.firstChild;for(let r=0,s=0;;){let o=s,a=r<t.length?t[r++]:null,l=!1;if(a){let e=a.elementClass;e&&(i+=" "+e);for(let e=s;e<this.markers.length;e++)if(this.markers[e].compare(a)){o=e,l=!0;break}}else o=this.markers.length;for(;s<o;){let e=this.markers[s++];if(e.toDOM){e.destroy(n);let t=n.nextSibling;n.remove(),n=t}}if(!a)break;a.toDOM&&(l?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),l&&s++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}const hr=n.Facet.define(),cr=n.Facet.define({combine:e=>(0,n.combineConfig)(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let e in t){let n=i[e],r=t[e];i[e]=n?(e,t,i)=>n(e,t,i)||r(e,t,i):r}return i}})});class ur extends Yn{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function dr(e,t){return e.state.facet(cr).formatNumber(t,e.state)}const fr=Qn.compute([cr],(e=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers:e=>e.state.facet(hr),lineMarker:(e,t,i)=>i.some((e=>e.toDOM))?null:new ur(dr(e,e.state.doc.lineAt(t.from).number)),lineMarkerChange:e=>e.startState.facet(cr)!=e.state.facet(cr),initialSpacer:e=>new ur(dr(e,mr(e.state.doc.lines))),updateSpacer(e,t){let i=dr(t.view,mr(t.view.state.doc.lines));return i==e.number?e:new ur(i)},domEventHandlers:e.facet(cr).domEventHandlers})));function pr(e={}){return[cr.of(e),ir(),fr]}function mr(e){let t=9;for(;t<e;)t=10*t+9;return t}const gr=new class extends Yn{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},vr=Zn.compute(["selection"],(e=>{let t=[],i=-1;for(let n of e.selection.ranges)if(n.empty){let r=e.doc.lineAt(n.head).from;r>i&&(i=r,t.push(gr.range(r)))}return n.RangeSet.of(t)}));function xr(){return vr}})),r.register("eamNc",(function(t,i){e(t.exports,"Text",(()=>n)),e(t.exports,"findClusterBreak",(()=>m)),e(t.exports,"codePointAt",(()=>b)),e(t.exports,"codePointSize",(()=>M)),e(t.exports,"fromCodePoint",(()=>w)),e(t.exports,"MapMode",(()=>_)),e(t.exports,"ChangeDesc",(()=>T)),e(t.exports,"ChangeSet",(()=>A)),e(t.exports,"EditorSelection",(()=>I)),e(t.exports,"Facet",(()=>z)),e(t.exports,"StateField",(()=>W)),e(t.exports,"Prec",(()=>Y)),e(t.exports,"Annotation",(()=>ce)),e(t.exports,"StateEffect",(()=>fe)),e(t.exports,"Transaction",(()=>pe)),e(t.exports,"CharCategory",(()=>we)),e(t.exports,"EditorState",(()=>Te)),e(t.exports,"combineConfig",(()=>Ae)),e(t.exports,"RangeValue",(()=>Ee)),e(t.exports,"RangeSet",(()=>Re)),e(t.exports,"RangeSetBuilder",(()=>Pe)),e(t.exports,"countColumn",(()=>Ge)),e(t.exports,"findColumn",(()=>We));class n{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let n=[];return this.decompose(0,e,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(t,this.length,n,1),s.from(n,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),s.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),n=new l(this),r=new l(e);for(let e=t,s=t;;){if(n.next(e),r.next(e),e=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(s+=n.value.length,n.done||s>=i)return!0}}iter(e=1){return new l(this,e)}iterRange(e,t=this.length){return new h(this,e,t)}iterLines(e,t){let i;if(null==e)i=this.iter();else{null==t&&(t=this.lines+1);let n=this.line(e).from;i=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new c(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(0==e.length)throw new RangeError("A document must have at least one line");return 1!=e.length||e[0]?e.length<=32?new r(e):s.from(r.split(e,[])):n.empty}}class r extends n{constructor(e,t=function(e){let t=-1;for(let i of e)t+=i.length+1;return t}(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,n){for(let r=0;;r++){let s=this.text[r],o=n+s.length;if((t?i:o)>=e)return new u(n,o,i,s);n=o+1,i++}}decompose(e,t,i,n){let s=e<=0&&t>=this.length?this:new r(a(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(1&n){let e=i.pop(),t=o(s.text,e.text.slice(),0,s.length);if(t.length<=32)i.push(new r(t,e.length+s.length));else{let e=t.length>>1;i.push(new r(t.slice(0,e)),new r(t.slice(e)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof r))return super.replace(e,t,i);let n=o(this.text,o(i.text,a(this.text,0,e)),t),l=this.length+i.length-(t-e);return n.length<=32?new r(n,l):s.from(r.split(n,[]),l)}sliceString(e,t=this.length,i="\n"){let n="";for(let r=0,s=0;r<=t&&s<this.text.length;s++){let o=this.text[s],a=r+o.length;r>e&&s&&(n+=i),e<a&&t>r&&(n+=o.slice(Math.max(0,e-r),t-r)),r=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],n=-1;for(let s of e)i.push(s),n+=s.length+1,32==i.length&&(t.push(new r(i,n)),i=[],n=-1);return n>-1&&t.push(new r(i,n)),t}}class s extends n{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let t of e)this.lines+=t.lines}lineInner(e,t,i,n){for(let r=0;;r++){let s=this.children[r],o=n+s.length,a=i+s.lines-1;if((t?a:o)>=e)return s.lineInner(e,t,i,n);n=o+1,i=a+1}}decompose(e,t,i,n){for(let r=0,s=0;s<=t&&r<this.children.length;r++){let o=this.children[r],a=s+o.length;if(e<=a&&t>=s){let r=n&((s<=e?1:0)|(a>=t?2:0));s>=e&&a<=t&&!r?i.push(o):o.decompose(e-s,t-s,i,r)}s=a+1}}replace(e,t,i){if(i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],a=r+o.length;if(e>=r&&t<=a){let l=o.replace(e-r,t-r,i),h=this.lines-o.lines+l.lines;if(l.lines<h>>4&&l.lines>h>>6){let r=this.children.slice();return r[n]=l,new s(r,this.length-(t-e)+i.length)}return super.replace(r,a,l)}r=a+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i="\n"){let n="";for(let r=0,s=0;r<this.children.length&&s<=t;r++){let o=this.children[r],a=s+o.length;s>e&&r&&(n+=i),e<a&&t>s&&(n+=o.sliceString(e-s,t-s,i)),s=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof s))return 0;let i=0,[n,r,o,a]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,r+=t){if(n==o||r==a)return i;let s=this.children[n],l=e.children[r];if(s!=l)return i+s.scanIdentical(l,t);i+=s.length+1}}static from(e,t=e.reduce(((e,t)=>e+t.length+1),-1)){let i=0;for(let t of e)i+=t.lines;if(i<32){let i=[];for(let t of e)t.flatten(i);return new r(i,t)}let n=Math.max(32,i>>5),o=n<<1,a=n>>1,l=[],h=0,c=-1,u=[];function d(e){let t;if(e.lines>o&&e instanceof s)for(let t of e.children)d(t);else e.lines>a&&(h>a||!h)?(f(),l.push(e)):e instanceof r&&h&&(t=u[u.length-1])instanceof r&&e.lines+t.lines<=32?(h+=e.lines,c+=e.length+1,u[u.length-1]=new r(t.text.concat(e.text),t.length+1+e.length)):(h+e.lines>n&&f(),h+=e.lines,c+=e.length+1,u.push(e))}function f(){0!=h&&(l.push(1==u.length?u[0]:s.from(u,c)),c=-1,h=u.length=0)}for(let t of e)d(t);return f(),1==l.length?l[0]:new s(l,t)}}function o(e,t,i=0,n=1e9){for(let r=0,s=0,o=!0;s<e.length&&r<=n;s++){let a=e[s],l=r+a.length;l>=i&&(l>n&&(a=a.slice(0,n-r)),r<i&&(a=a.slice(i-r)),o?(t[t.length-1]+=a,o=!1):t.push(a)),r=l+1}return t}function a(e,t,i){return o(e,[""],t,i)}n.empty=new r([""],0);class l{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof r?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],s=this.offsets[i],o=s>>1,a=n instanceof r?n.text.length:n.children.length;if(o==(t>0?a:0)){if(0==i)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&s)==(t>0?0:1)){if(this.offsets[i]+=t,0==e)return this.lineBreak=!0,this.value="\n",this;e--}else if(n instanceof r){let r=n.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,r.length>Math.max(0,e))return this.value=0==e?r:t>0?r.slice(e):r.slice(0,r.length-e),this;e-=r.length}else{let s=n.children[o+(t<0?-1:0)];e>s.length?(e-=s.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(s),this.offsets.push(t>0?1:(s instanceof r?s.text.length:s.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class h{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new l(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=i?n:t<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class c{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:n}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(n.prototype[Symbol.iterator]=function(){return this.iter()},l.prototype[Symbol.iterator]=h.prototype[Symbol.iterator]=c.prototype[Symbol.iterator]=function(){return this});class u{constructor(e,t,i,n){this.from=e,this.to=t,this.number=i,this.text=n}get length(){return this.to-this.from}}let d="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((e=>e?parseInt(e,36):1));for(let e=1;e<d.length;e++)d[e]+=d[e-1];function f(e){for(let t=1;t<d.length;t+=2)if(d[t]>e)return d[t-1]<=e;return!1}function p(e){return e>=127462&&e<=127487}function m(e,t,i=!0,n=!0){return(i?g:v)(e,t,n)}function g(e,t,i){if(t==e.length)return t;t&&x(e.charCodeAt(t))&&y(e.charCodeAt(t-1))&&t--;let n=b(e,t);for(t+=M(n);t<e.length;){let r=b(e,t);if(8205==n||8205==r||i&&f(r))t+=M(r),n=r;else{if(!p(r))break;{let i=0,n=t-2;for(;n>=0&&p(b(e,n));)i++,n-=2;if(i%2==0)break;t+=2}}}return t}function v(e,t,i){for(;t>0;){let n=g(e,t-2,i);if(n<t)return n;t--}return 0}function x(e){return e>=56320&&e<57344}function y(e){return e>=55296&&e<56320}function b(e,t){let i=e.charCodeAt(t);if(!y(i)||t+1==e.length)return i;let n=e.charCodeAt(t+1);return x(n)?n-56320+(i-55296<<10)+65536:i}function w(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function M(e){return e<65536?1:2}const S=/\r\n?|\n/;var _=function(e){return e[e.Simple=0]="Simple",e[e.TrackDel=1]="TrackDel",e[e.TrackBefore=2]="TrackBefore",e[e.TrackAfter=3]="TrackAfter",e}(_||(_={}));class T{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,n=0;t<this.sections.length;){let r=this.sections[t++],s=this.sections[t++];s<0?(e(i,n,r),n+=r):n+=s,i+=r}}iterChangedRanges(e,t=!1){N(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];n<0?e.push(i,n):e.push(n,i)}return new T(e)}composeDesc(e){return this.empty?e:e.empty?this:R(this,e)}mapDesc(e,t=!1){return e.empty?this:L(this,e,t)}mapPos(e,t=-1,i=_.Simple){let n=0,r=0;for(let s=0;s<this.sections.length;){let o=this.sections[s++],a=this.sections[s++],l=n+o;if(a<0){if(l>e)return r+(e-n);r+=o}else{if(i!=_.Simple&&l>=e&&(i==_.TrackDel&&n<e&&l>e||i==_.TrackBefore&&n<e||i==_.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!o)return e==n||t<0?r:r+a;r+=a}n=l}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return r}touchesRange(e,t=e){for(let i=0,n=0;i<this.sections.length&&n<=t;){let r=n+this.sections[i++];if(this.sections[i++]>=0&&n<=t&&r>=e)return!(n<e&&r>t)||"cover";n=r}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+i+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some((e=>"number"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeDesc");return new T(e)}static create(e){return new T(e)}}class A extends T{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return N(this,((t,i,n,r,s)=>e=e.replace(n,n+(i-t),s)),!1),e}mapDesc(e,t=!1){return L(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],a=t[r+1];if(a>=0){t[r]=a,t[r+1]=o;let l=r>>1;for(;i.length<l;)i.push(n.empty);i.push(o?e.slice(s,s+o):n.empty)}s+=o}return new A(t,i)}compose(e){return this.empty?e:e.empty?this:R(this,e,!0)}map(e,t=!1){return e.empty?this:L(this,e,t,!0)}iterChanges(e,t=!1){N(this,e,t)}get desc(){return T.create(this.sections)}filter(e){let t=[],i=[],n=[],r=new P(this);e:for(let s=0,o=0;;){let a=s==e.length?1e9:e[s++];for(;o<a||o==a&&0==r.len;){if(r.done)break e;let e=Math.min(r.len,a-o);E(n,e,-1);let s=-1==r.ins?-1:0==r.off?r.ins:0;E(t,e,s),s>0&&C(i,t,r.text),r.forward(e),o+=e}let l=e[s++];for(;o<l;){if(r.done)break e;let e=Math.min(r.len,l-o);E(t,e,-1),E(n,e,-1==r.ins?-1:0==r.off?r.ins:0),r.forward(e),o+=e}}return{changes:new A(t,i),filtered:T.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],n=this.sections[t+1];n<0?e.push(i):0==n?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,a=null;function l(e=!1){if(!e&&!r.length)return;o<t&&E(r,t-o,-1);let i=new A(r,s);a=a?a.compose(i.map(a)):i,r=[],s=[],o=0}return function e(h){if(Array.isArray(h))for(let t of h)e(t);else if(h instanceof A){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);l(),a=a?a.compose(h.map(a)):h}else{let{from:e,to:a=e,insert:c}=h;if(e>a||e<0||a>t)throw new RangeError(`Invalid change range ${e} to ${a} (in doc of length ${t})`);let u=c?"string"==typeof c?n.of(c.split(i||S)):c:n.empty,d=u.length;if(e==a&&0==d)return;e<o&&l(),e>o&&E(r,e-o,-1),E(r,a-e,d),C(s,r,u),o=a}}(e),l(!a),a}static empty(e){return new A(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if("number"==typeof s)t.push(s,-1);else{if(!Array.isArray(s)||"number"!=typeof s[0]||s.some(((e,t)=>t&&"string"!=typeof e)))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==s.length)t.push(s[0],0);else{for(;i.length<r;)i.push(n.empty);i[r]=n.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new A(t,i)}static createSet(e,t){return new A(e,t)}}function E(e,t,i,n=!1){if(0==t&&i<=0)return;let r=e.length-2;r>=0&&i<=0&&i==e[r+1]?e[r]+=t:0==t&&0==e[r]?e[r+1]+=i:n?(e[r]+=t,e[r+1]+=i):e.push(t,i)}function C(e,t,i){if(0==i.length)return;let r=t.length-2>>1;if(r<e.length)e[e.length-1]=e[e.length-1].append(i);else{for(;e.length<r;)e.push(n.empty);e.push(i)}}function N(e,t,i){let r=e.inserted;for(let s=0,o=0,a=0;a<e.sections.length;){let l=e.sections[a++],h=e.sections[a++];if(h<0)s+=l,o+=l;else{let c=s,u=o,d=n.empty;for(;c+=l,u+=h,h&&r&&(d=d.append(r[a-2>>1])),!(i||a==e.sections.length||e.sections[a+1]<0);)l=e.sections[a++],h=e.sections[a++];t(s,c,o,u,d),s=c,o=u}}}function L(e,t,i,n=!1){let r=[],s=n?[]:null,o=new P(e),a=new P(t);for(let e=-1;;)if(-1==o.ins&&-1==a.ins){let e=Math.min(o.len,a.len);E(r,e,-1),o.forward(e),a.forward(e)}else if(a.ins>=0&&(o.ins<0||e==o.i||0==o.off&&(a.len<o.len||a.len==o.len&&!i))){let t=a.len;for(E(r,a.ins,-1);t;){let i=Math.min(o.len,t);o.ins>=0&&e<o.i&&o.len<=i&&(E(r,0,o.ins),s&&C(s,r,o.text),e=o.i),o.forward(i),t-=i}a.next()}else{if(!(o.ins>=0)){if(o.done&&a.done)return s?A.createSet(r,s):T.create(r);throw new Error("Mismatched change set lengths")}{let t=0,i=o.len;for(;i;)if(-1==a.ins){let e=Math.min(i,a.len);t+=e,i-=e,a.forward(e)}else{if(!(0==a.ins&&a.len<i))break;i-=a.len,a.next()}E(r,t,e<o.i?o.ins:0),s&&e<o.i&&C(s,r,o.text),e=o.i,o.forward(o.len-i)}}}function R(e,t,i=!1){let n=[],r=i?[]:null,s=new P(e),o=new P(t);for(let e=!1;;){if(s.done&&o.done)return r?A.createSet(n,r):T.create(n);if(0==s.ins)E(n,s.len,0,e),s.next();else if(0!=o.len||o.done){if(s.done||o.done)throw new Error("Mismatched change set lengths");{let t=Math.min(s.len2,o.len),i=n.length;if(-1==s.ins){let i=-1==o.ins?-1:o.off?0:o.ins;E(n,t,i,e),r&&i&&C(r,n,o.text)}else-1==o.ins?(E(n,s.off?0:s.len,t,e),r&&C(r,n,s.textBit(t))):(E(n,s.off?0:s.len,o.off?0:o.ins,e),r&&!o.off&&C(r,n,o.text));e=(s.ins>t||o.ins>=0&&o.len>t)&&(e||n.length>i),s.forward2(t),o.forward(t)}}else E(n,0,o.ins,e),r&&C(r,n,o.text),o.next()}}class P{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?n.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?n.empty:t[i].slice(this.off,null==e?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){-1==this.ins?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class D{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return 16&this.flags?this.to:this.from}get head(){return 16&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 4&this.flags?-1:8&this.flags?1:0}get bidiLevel(){let e=3&this.flags;return 3==e?null:e}get goalColumn(){let e=this.flags>>5;return 33554431==e?void 0:e}map(e,t=-1){let i,n;return this.empty?i=n=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new D(i,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return I.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return I.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||"number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid JSON representation for SelectionRange");return I.range(e.anchor,e.head)}static create(e,t,i){return new D(e,t,i)}}class I{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:I.create(this.ranges.map((i=>i.map(e,t))),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new I([this.main],0)}addRange(e,t=!0){return I.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,I.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map((e=>e.toJSON())),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||"number"!=typeof e.main||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new I(e.ranges.map((e=>D.fromJSON(e))),e.main)}static single(e,t=e){return new I([I.range(e,t)],0)}static create(e,t=0){if(0==e.length)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<e.length;n++){let r=e[n];if(r.empty?r.from<=i:r.from<i)return I.normalized(e.slice(),t);i=r.to}return new I(e,t)}static cursor(e,t=0,i,n){return D.create(e,e,(0==t?0:t<0?4:8)|(null==i?3:Math.min(2,i))|(null!=n?n:33554431)<<5)}static range(e,t,i){let n=(null!=i?i:33554431)<<5;return t<e?D.create(t,e,24|n):D.create(e,t,n|(t>e?4:0))}static normalized(e,t=0){let i=e[t];e.sort(((e,t)=>e.from-t.from)),t=e.indexOf(i);for(let i=1;i<e.length;i++){let n=e[i],r=e[i-1];if(n.empty?n.from<=r.to:n.from<r.to){let s=r.from,o=Math.max(n.to,r.to);i<=t&&t--,e.splice(--i,2,n.anchor>n.head?I.range(o,s):I.range(s,o))}}return new I(e,t)}}function O(e,t){for(let i of e.ranges)if(i.to>t)throw new RangeError("Selection points outside of document")}let k=0;class z{constructor(e,t,i,n,r){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=n,this.id=k++,this.default=e([]),this.extensions="function"==typeof r?r(this):r}static define(e={}){return new z(e.combine||(e=>e),e.compareInput||((e,t)=>e===t),e.compare||(e.combine?(e,t)=>e===t:F),!!e.static,e.enables)}of(e){return new B([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new B(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new B(e,this,2,t)}from(e,t){return t||(t=e=>e),this.compute([e],(i=>t(i.field(e))))}}function F(e,t){return e==t||e.length==t.length&&e.every(((e,i)=>e===t[i]))}class B{constructor(e,t,i,n){this.dependencies=e,this.facet=t,this.type=i,this.value=n,this.id=k++}dynamicSlot(e){var t;let i=this.value,n=this.facet.compareInput,r=this.id,s=e[r]>>1,o=2==this.type,a=!1,l=!1,h=[];for(let i of this.dependencies)"doc"==i?a=!0:"selection"==i?l=!0:0==(1&(null!==(t=e[i.id])&&void 0!==t?t:1))&&h.push(e[i.id]);return{create:e=>(e.values[s]=i(e),1),update(e,t){if(a&&t.docChanged||l&&(t.docChanged||t.selection)||U(e,h)){let t=i(e);if(o?!V(t,e.values[s],n):!n(t,e.values[s]))return e.values[s]=t,1}return 0},reconfigure:(e,t)=>{let a=i(e),l=t.config.address[r];if(null!=l){let i=ie(t,l);if(this.dependencies.every((i=>i instanceof z?t.facet(i)===e.facet(i):!(i instanceof W)||t.field(i,!1)==e.field(i,!1)))||(o?V(a,i,n):n(a,i)))return e.values[s]=i,0}return e.values[s]=a,1}}}}function V(e,t,i){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1;return!0}function U(e,t){let i=!1;for(let n of t)1&te(e,n)&&(i=!0);return i}function H(e,t,i){let n=i.map((t=>e[t.id])),r=i.map((e=>e.type)),s=n.filter((e=>!(1&e))),o=e[t.id]>>1;function a(e){let i=[];for(let t=0;t<n.length;t++){let s=ie(e,n[t]);if(2==r[t])for(let e of s)i.push(e);else i.push(s)}return t.combine(i)}return{create(e){for(let t of n)te(e,t);return e.values[o]=a(e),1},update(e,i){if(!U(e,s))return 0;let n=a(e);return t.compare(n,e.values[o])?0:(e.values[o]=n,1)},reconfigure(e,r){let s=U(e,n),l=r.config.facets[t.id],h=r.facet(t);if(l&&!s&&F(i,l))return e.values[o]=h,0;let c=a(e);return t.compare(c,h)?(e.values[o]=h,0):(e.values[o]=c,1)}}}const G=z.define({static:!0});class W{constructor(e,t,i,n,r){this.id=e,this.createF=t,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(e){let t=new W(k++,e.create,e.update,e.compare||((e,t)=>e===t),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(G).find((e=>e.field==this));return((null==t?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:e=>(e.values[t]=this.create(e),1),update:(e,i)=>{let n=e.values[t],r=this.updateF(n,i);return this.compareF(n,r)?0:(e.values[t]=r,1)},reconfigure:(e,i)=>null!=i.config.address[this.id]?(e.values[t]=i.field(this),0):(e.values[t]=this.create(e),1)}}init(e){return[this,G.of({field:this,create:e})]}get extension(){return this}}const j=4,X=3,q=2,J=1;function K(e){return t=>new Z(t,e)}const Y={highest:K(0),high:K(J),default:K(q),low:K(X),lowest:K(j)};class Z{constructor(e,t){this.inner=e,this.prec=t}}class ${of(e){return new Q(this,e)}reconfigure(e){return $.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Q{constructor(e,t){this.compartment=e,this.inner=t}}class ee{constructor(e,t,i,n,r,s){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=s,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return null==t?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let n=[],r=Object.create(null),s=new Map;for(let i of function(e,t,i){let n=[[],[],[],[],[]],r=new Map;function s(e,o){let a=r.get(e);if(null!=a){if(a<=o)return;let t=n[a].indexOf(e);t>-1&&n[a].splice(t,1),e instanceof Q&&i.delete(e.compartment)}if(r.set(e,o),Array.isArray(e))for(let t of e)s(t,o);else if(e instanceof Q){if(i.has(e.compartment))throw new RangeError("Duplicate use of compartment in extensions");let n=t.get(e.compartment)||e.inner;i.set(e.compartment,n),s(n,o)}else if(e instanceof Z)s(e.inner,e.prec);else if(e instanceof W)n[o].push(e),e.provides&&s(e.provides,o);else if(e instanceof B)n[o].push(e),e.facet.extensions&&s(e.facet.extensions,o);else{let t=e.extension;if(!t)throw new Error(`Unrecognized extension value in extension set (${e}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(t,o)}}return s(e,q),n.reduce(((e,t)=>e.concat(t)))}(e,t,s))i instanceof W?n.push(i):(r[i.facet.id]||(r[i.facet.id]=[])).push(i);let o=Object.create(null),a=[],l=[];for(let e of n)o[e.id]=l.length<<1,l.push((t=>e.slot(t)));let h=null==i?void 0:i.config.facets;for(let e in r){let t=r[e],n=t[0].facet,s=h&&h[e]||[];if(t.every((e=>0==e.type)))if(o[n.id]=a.length<<1|1,F(s,t))a.push(i.facet(n));else{let e=n.combine(t.map((e=>e.value)));a.push(i&&n.compare(e,i.facet(n))?i.facet(n):e)}else{for(let e of t)0==e.type?(o[e.id]=a.length<<1|1,a.push(e.value)):(o[e.id]=l.length<<1,l.push((t=>e.dynamicSlot(t))));o[n.id]=l.length<<1,l.push((e=>H(e,n,t)))}}let c=l.map((e=>e(o)));return new ee(e,s,c,o,a,r)}}function te(e,t){if(1&t)return 2;let i=t>>1,n=e.status[i];if(4==n)throw new Error("Cyclic dependency between fields and/or facets");if(2&n)return n;e.status[i]=4;let r=e.computeSlot(e,e.config.dynamicSlots[i]);return e.status[i]=2|r}function ie(e,t){return 1&t?e.config.staticValues[t>>1]:e.values[t>>1]}const ne=z.define(),re=z.define({combine:e=>e.some((e=>e)),static:!0}),se=z.define({combine:e=>e.length?e[0]:void 0,static:!0}),oe=z.define(),ae=z.define(),le=z.define(),he=z.define({combine:e=>!!e.length&&e[0]});class ce{constructor(e,t){this.type=e,this.value=t}static define(){return new ue}}class ue{of(e){return new ce(this,e)}}class de{constructor(e){this.map=e}of(e){return new fe(this,e)}}class fe{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return void 0===t?void 0:t==this.value?this:new fe(this.type,t)}is(e){return this.type==e}static define(e={}){return new de(e.map||(e=>e))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let n of e){let e=n.map(t);e&&i.push(e)}return i}}fe.reconfigure=fe.define(),fe.appendConfig=fe.define();class pe{constructor(e,t,i,n,r,s){this.startState=e,this.changes=t,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=s,this._doc=null,this._state=null,i&&O(i,t.newLength),r.some((e=>e.type==pe.time))||(this.annotations=r.concat(pe.time.of(Date.now())))}static create(e,t,i,n,r,s){return new pe(e,t,i,n,r,s)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(pe.userEvent);return!(!t||!(t==e||t.length>e.length&&t.slice(0,e.length)==e&&"."==t[e.length]))}}function me(e,t){let i=[];for(let n=0,r=0;;){let s,o;if(n<e.length&&(r==t.length||t[r]>=e[n]))s=e[n++],o=e[n++];else{if(!(r<t.length))return i;s=t[r++],o=t[r++]}!i.length||i[i.length-1]<s?i.push(s,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function ge(e,t,i){var n;let r,s,o;return i?(r=t.changes,s=A.empty(t.changes.length),o=e.changes.compose(t.changes)):(r=t.changes.map(e.changes),s=e.changes.mapDesc(t.changes,!0),o=e.changes.compose(r)),{changes:o,selection:t.selection?t.selection.map(s):null===(n=e.selection)||void 0===n?void 0:n.map(r),effects:fe.mapEffects(e.effects,r).concat(fe.mapEffects(t.effects,s)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function ve(e,t,i){let n=t.selection,r=be(t.annotations);return t.userEvent&&(r=r.concat(pe.userEvent.of(t.userEvent))),{changes:t.changes instanceof A?t.changes:A.of(t.changes||[],i,e.facet(se)),selection:n&&(n instanceof I?n:I.single(n.anchor,n.head)),effects:be(t.effects),annotations:r,scrollIntoView:!!t.scrollIntoView}}function xe(e,t,i){let n=ve(e,t.length?t[0]:{},e.doc.length);t.length&&!1===t[0].filter&&(i=!1);for(let r=1;r<t.length;r++){!1===t[r].filter&&(i=!1);let s=!!t[r].sequential;n=ge(n,ve(e,t[r],s?n.changes.newLength:e.doc.length),s)}let r=pe.create(e,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return function(e){let t=e.startState,i=t.facet(le),n=e;for(let r=i.length-1;r>=0;r--){let s=i[r](e);s&&Object.keys(s).length&&(n=ge(e,ve(t,s,e.changes.newLength),!0))}return n==e?e:pe.create(t,e.changes,e.selection,n.effects,n.annotations,n.scrollIntoView)}(i?function(e){let t=e.startState,i=!0;for(let n of t.facet(oe)){let t=n(e);if(!1===t){i=!1;break}Array.isArray(t)&&(i=!0===i?t:me(i,t))}if(!0!==i){let n,r;if(!1===i)r=e.changes.invertedDesc,n=A.empty(t.doc.length);else{let t=e.changes.filter(i);n=t.changes,r=t.filtered.mapDesc(t.changes).invertedDesc}e=pe.create(t,n,e.selection&&e.selection.map(r),fe.mapEffects(e.effects,r),e.annotations,e.scrollIntoView)}let n=t.facet(ae);for(let i=n.length-1;i>=0;i--){let r=n[i](e);e=r instanceof pe?r:Array.isArray(r)&&1==r.length&&r[0]instanceof pe?r[0]:xe(t,be(r),!1)}return e}(r):r)}pe.time=ce.define(),pe.userEvent=ce.define(),pe.addToHistory=ce.define(),pe.remote=ce.define();const ye=[];function be(e){return null==e?ye:Array.isArray(e)?e:[e]}var we=function(e){return e[e.Word=0]="Word",e[e.Space=1]="Space",e[e.Other=2]="Other",e}(we||(we={}));const Me=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Se;try{Se=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(e){}function _e(e){return t=>{if(!/\S/.test(t))return we.Space;if(function(e){if(Se)return Se.test(e);for(let t=0;t<e.length;t++){let i=e[t];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||Me.test(i)))return!0}return!1}(t))return we.Word;for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return we.Word;return we.Other}}class Te{constructor(e,t,i,n,r,s){this.config=e,this.doc=t,this.selection=i,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=r,s&&(s._state=this);for(let e=0;e<this.config.dynamicSlots.length;e++)te(this,e<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(null!=i)return te(this,i),ie(this,i);if(t)throw new RangeError("Field is not present in this state")}update(...e){return xe(this,e,!0)}applyTransaction(e){let t,i=this.config,{base:n,compartments:r}=i;for(let t of e.effects)t.is($.reconfigure)?(i&&(r=new Map,i.compartments.forEach(((e,t)=>r.set(t,e))),i=null),r.set(t.value.compartment,t.value.extension)):t.is(fe.reconfigure)?(i=null,n=t.value):t.is(fe.appendConfig)&&(i=null,n=be(n).concat(t.value));if(i)t=e.startState.values.slice();else{i=ee.resolve(n,r,this),t=new Te(i,this.doc,this.selection,i.dynamicSlots.map((()=>null)),((e,t)=>t.reconfigure(e,this)),null).values}new Te(i,e.newDoc,e.newSelection,t,((t,i)=>i.update(t,e)),e)}replaceSelection(e){return"string"==typeof e&&(e=this.toText(e)),this.changeByRange((t=>({changes:{from:t.from,to:t.to,insert:e},range:I.cursor(t.from+e.length)})))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),n=this.changes(i.changes),r=[i.range],s=be(i.effects);for(let i=1;i<t.ranges.length;i++){let o=e(t.ranges[i]),a=this.changes(o.changes),l=a.map(n);for(let e=0;e<i;e++)r[e]=r[e].map(l);let h=n.mapDesc(a,!0);r.push(o.range.map(h)),n=n.compose(l),s=fe.mapEffects(s,l).concat(fe.mapEffects(be(o.effects),h))}return{changes:n,selection:I.create(r,t.mainIndex),effects:s}}changes(e=[]){return e instanceof A?e:A.of(e,this.doc.length,this.facet(Te.lineSeparator))}toText(e){return n.of(e.split(this.facet(Te.lineSeparator)||S))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return null==t?e.default:(te(this,t),ie(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let n=e[i];n instanceof W&&null!=this.config.address[n.id]&&(t[i]=n.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||"string"!=typeof e.doc)throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i)for(let t in i)if(Object.prototype.hasOwnProperty.call(e,t)){let r=i[t],s=e[t];n.push(r.init((e=>r.spec.fromJSON(s,e))))}return Te.create({doc:e.doc,selection:I.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=ee.resolve(e.extensions||[],new Map),i=e.doc instanceof n?e.doc:n.of((e.doc||"").split(t.staticFacet(Te.lineSeparator)||S)),r=e.selection?e.selection instanceof I?e.selection:I.single(e.selection.anchor,e.selection.head):I.single(0);return O(r,i.length),t.staticFacet(re)||(r=r.asSingle()),new Te(t,i,r,t.dynamicSlots.map((()=>null)),((e,t)=>t.create(e)),null)}get tabSize(){return this.facet(Te.tabSize)}get lineBreak(){return this.facet(Te.lineSeparator)||"\n"}get readOnly(){return this.facet(he)}phrase(e,...t){for(let t of this.facet(Te.phrases))if(Object.prototype.hasOwnProperty.call(t,e)){e=t[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,((e,i)=>{if("$"==i)return"$";let n=+(i||1);return!n||n>t.length?e:t[n-1]}))),e}languageDataAt(e,t,i=-1){let n=[];for(let r of this.facet(ne))for(let s of r(this,t,i))Object.prototype.hasOwnProperty.call(s,e)&&n.push(s[e]);return n}charCategorizer(e){return _e(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:n}=this.doc.lineAt(e),r=this.charCategorizer(e),s=e-i,o=e-i;for(;s>0;){let e=m(t,s,!1);if(r(t.slice(e,s))!=we.Word)break;s=e}for(;o<n;){let e=m(t,o);if(r(t.slice(o,e))!=we.Word)break;o=e}return s==o?null:I.range(s+i,o+i)}}function Ae(e,t,i={}){let n={};for(let t of e)for(let e of Object.keys(t)){let r=t[e],s=n[e];if(void 0===s)n[e]=r;else if(s===r||void 0===r);else{if(!Object.hasOwnProperty.call(i,e))throw new Error("Config merge conflict for field "+e);n[e]=i[e](s,r)}}for(let e in t)void 0===n[e]&&(n[e]=t[e]);return n}Te.allowMultipleSelections=re,Te.tabSize=z.define({combine:e=>e.length?e[0]:4}),Te.lineSeparator=se,Te.readOnly=he,Te.phrases=z.define({compare(e,t){let i=Object.keys(e),n=Object.keys(t);return i.length==n.length&&i.every((i=>e[i]==t[i]))}}),Te.languageData=ne,Te.changeFilter=oe,Te.transactionFilter=ae,Te.transactionExtender=le,$.reconfigure=fe.define();class Ee{eq(e){return this==e}range(e,t=e){return Ce.create(e,t,this)}}Ee.prototype.startSide=Ee.prototype.endSide=0,Ee.prototype.point=!1,Ee.prototype.mapMode=_.TrackDel;class Ce{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Ce(e,t,i)}}function Ne(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}class Le{constructor(e,t,i,n){this.from=e,this.to=t,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,n=0){let r=i?this.to:this.from;for(let s=n,o=r.length;;){if(s==o)return s;let n=s+o>>1,a=r[n]-e||(i?this.value[n].endSide:this.value[n].startSide)-t;if(n==s)return a>=0?s:o;a>=0?o=n:s=n+1}}between(e,t,i,n){for(let r=this.findIndex(t,-1e9,!0),s=this.findIndex(i,1e9,!1,r);r<s;r++)if(!1===n(this.from[r]+e,this.to[r]+e,this.value[r]))return!1}map(e,t){let i=[],n=[],r=[],s=-1,o=-1;for(let a=0;a<this.value.length;a++){let l,h,c=this.value[a],u=this.from[a]+e,d=this.to[a]+e;if(u==d){let e=t.mapPos(u,c.startSide,c.mapMode);if(null==e)continue;if(l=h=e,c.startSide!=c.endSide&&(h=t.mapPos(u,c.endSide),h<l))continue}else if(l=t.mapPos(u,c.startSide),h=t.mapPos(d,c.endSide),l>h||l==h&&c.startSide>0&&c.endSide<=0)continue;(h-l||c.endSide-c.startSide)<0||(s<0&&(s=l),c.point&&(o=Math.max(o,h-l)),i.push(c),n.push(l-s),r.push(h-s))}return{mapped:i.length?new Le(n,r,i,o):null,pos:s}}}class Re{constructor(e,t,i,n){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=n}static create(e,t,i,n){return new Re(e,t,i,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=e,s=e.filter;if(0==t.length&&!s)return this;if(i&&(t=t.slice().sort(Ne)),this.isEmpty)return t.length?Re.of(t):this;let o=new Ie(this,null,-1).goto(0),a=0,l=[],h=new Pe;for(;o.value||a<t.length;)if(a<t.length&&(o.from-t[a].from||o.startSide-t[a].value.startSide)>=0){let e=t[a++];h.addInner(e.from,e.to,e.value)||l.push(e)}else 1==o.rangeIndex&&o.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(o.chunkIndex)<t[a].from)&&(!s||n>this.chunkEnd(o.chunkIndex)||r<this.chunkPos[o.chunkIndex])&&h.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!s||n>o.to||r<o.from||s(o.from,o.to,o.value))&&(h.addInner(o.from,o.to,o.value)||l.push(Ce.create(o.from,o.to,o.value))),o.next());return h.finishInner(this.nextLayer.isEmpty&&!l.length?Re.empty:this.nextLayer.update({add:l,filter:s,filterFrom:n,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],n=-1;for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r],a=e.touchesRange(s,s+o.length);if(!1===a)n=Math.max(n,o.maxPoint),t.push(o),i.push(e.mapPos(s));else if(!0===a){let{mapped:r,pos:a}=o.map(s,e);r&&(n=Math.max(n,r.maxPoint),t.push(r),i.push(a))}}let r=this.nextLayer.map(e);return 0==t.length?r:new Re(i,t,r||Re.empty,n)}between(e,t,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],s=this.chunk[n];if(t>=r&&e<=r+s.length&&!1===s.between(r,e-r,t-r,i))return}this.nextLayer.between(e,t,i)}}iter(e=0){return Oe.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Oe.from(e).goto(t)}static compare(e,t,i,n,r=-1){let s=e.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=r)),o=t.filter((e=>e.maxPoint>0||!e.isEmpty&&e.maxPoint>=r)),a=De(s,o,i),l=new ze(s,a,r),h=new ze(o,a,r);i.iterGaps(((e,t,i)=>Fe(l,e,h,t,i,n))),i.empty&&0==i.length&&Fe(l,0,h,0,0,n)}static eq(e,t,i=0,n){null==n&&(n=1e9);let r=e.filter((e=>!e.isEmpty&&t.indexOf(e)<0)),s=t.filter((t=>!t.isEmpty&&e.indexOf(t)<0));if(r.length!=s.length)return!1;if(!r.length)return!0;let o=De(r,s),a=new ze(r,o,0).goto(i),l=new ze(s,o,0).goto(i);for(;;){if(a.to!=l.to||!Be(a.active,l.active)||a.point&&(!l.point||!a.point.eq(l.point)))return!1;if(a.to>n)return!0;a.next(),l.next()}}static spans(e,t,i,n,r=-1){let s=new ze(e,null,r).goto(t),o=t,a=s.openStart;for(;;){let e=Math.min(s.to,i);if(s.point?(n.point(o,e,s.point,s.activeForPoint(s.to),a,s.pointRank),a=s.openEnd(e)+(s.to>e?1:0)):e>o&&(n.span(o,e,s.active,a),a=s.openEnd(e)),s.to>i)break;o=s.to,s.next()}return a}static of(e,t=!1){let i=new Pe;for(let n of e instanceof Ce?[e]:t?function(e){if(e.length>1)for(let t=e[0],i=1;i<e.length;i++){let n=e[i];if(Ne(t,n)>0)return e.slice().sort(Ne);t=n}return e}(e):e)i.add(n.from,n.to,n.value);return i.finish()}}Re.empty=new Re([],[],null,-1),Re.empty.nextLayer=Re.empty;class Pe{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new Le(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Pe)).add(e,t,i)}addInner(e,t,i){let n=e-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(n<0)&&(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(Re.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return e;let t=Re.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function De(e,t,i){let n=new Map;for(let t of e)for(let e=0;e<t.chunk.length;e++)t.chunk[e].maxPoint<=0&&n.set(t.chunk[e],t.chunkPos[e]);let r=new Set;for(let e of t)for(let t=0;t<e.chunk.length;t++){let s=n.get(e.chunk[t]);null==s||(i?i.mapPos(s):s)!=e.chunkPos[t]||(null==i?void 0:i.touchesRange(s,s+e.chunk[t].length))||r.add(e.chunk[t])}return r}class Ie{constructor(e,t,i,n=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let t=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(t)||this.layer.chunkEnd(this.chunkIndex)<e||t.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Oe{constructor(e){this.heap=e}static from(e,t=null,i=-1){let n=[];for(let r=0;r<e.length;r++)for(let s=e[r];!s.isEmpty;s=s.nextLayer)s.maxPoint>=i&&n.push(new Ie(s,t,i,r));return 1==n.length?n[0]:new Oe(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let e=this.heap.length>>1;e>=0;e--)ke(this.heap,e);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let e=this.heap.length>>1;e>=0;e--)ke(this.heap,e);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),ke(this.heap,0)}}}function ke(e,t){for(let i=e[t];;){let n=1+(t<<1);if(n>=e.length)break;let r=e[n];if(n+1<e.length&&r.compare(e[n+1])>=0&&(r=e[n+1],n++),i.compare(r)<0)break;e[n]=i,e[t]=r,t=n}}class ze{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Oe.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Ve(this.active,e),Ve(this.activeTo,e),Ve(this.activeRank,e),this.minActive=He(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:n,rank:r}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=r;)t++;Ue(this.active,t,i),Ue(this.activeTo,t,n),Ue(this.activeRank,t,r),e&&Ue(e,t,this.cursor.from),this.minActive=He(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null,n=0;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>e){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&Ve(i,r)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let r=this.cursor.value;if(r.point){if(!(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.from<e&&(n=1),this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){let t=0;for(;t<i.length&&i[t]<e;)t++;this.openStart=t+n}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function Fe(e,t,i,n,r,s){e.goto(t),i.goto(n);let o=n+r,a=n,l=n-t;for(;;){let t=e.to+l-i.to||e.endSide-i.endSide,n=t<0?e.to+l:i.to,r=Math.min(n,o);if(e.point||i.point?e.point&&i.point&&(e.point==i.point||e.point.eq(i.point))&&Be(e.activeForPoint(e.to+l),i.activeForPoint(i.to))||s.comparePoint(a,r,e.point,i.point):r>a&&!Be(e.active,i.active)&&s.compareRange(a,r,e.active,i.active),n>o)break;a=n,t<=0&&e.next(),t>=0&&i.next()}}function Be(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i]&&!e[i].eq(t[i]))return!1;return!0}function Ve(e,t){for(let i=t,n=e.length-1;i<n;i++)e[i]=e[i+1];e.pop()}function Ue(e,t,i){for(let i=e.length-1;i>=t;i--)e[i+1]=e[i];e[t]=i}function He(e,t){let i=-1,n=1e9;for(let r=0;r<t.length;r++)(t[r]-n||e[r].endSide-e[i].endSide)<0&&(i=r,n=t[r]);return i}function Ge(e,t,i=e.length){let n=0;for(let r=0;r<i;)9==e.charCodeAt(r)?(n+=t-n%t,r++):(n++,r=m(e,r));return n}function We(e,t,i,n){for(let n=0,r=0;;){if(r>=t)return n;if(n==e.length)break;r+=9==e.charCodeAt(n)?i-r%i:1,n=m(e,n)}return!0===n?-1:e.length}})),r.register("iYCHO",(function(t,i){e(t.exports,"StyleModule",(()=>o));const n="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),r="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class o{constructor(e,t){this.rules=[];let{finish:i}=t||{};function n(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function r(e,t,s,o){let a=[],l=/^@(\w+)\b/.exec(e[0]),h=l&&"keyframes"==l[1];if(l&&null==t)return s.push(e[0]+";");for(let i in t){let o=t[i];if(/&/.test(i))r(i.split(/,\s*/).map((t=>e.map((e=>t.replace(/&/,e))))).reduce(((e,t)=>e.concat(t))),o,s);else if(o&&"object"==typeof o){if(!l)throw new RangeError("The value of a property ("+i+") should be a primitive value.");r(n(i),o,a,h)}else null!=o&&a.push(i.replace(/_.*/,"").replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))+": "+o+";")}(a.length||h)&&s.push((!i||l||o?e:e.map(i)).join(", ")+" {"+a.join(" ")+"}")}for(let t in e)r(n(t),e[t],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=s[n]||1;return s[n]=e+1,"ͼ"+e.toString(36)}static mount(e,t){(e[r]||new l(e)).mount(Array.isArray(t)?t:[t])}}let a=null;class l{constructor(e){if(!e.head&&e.adoptedStyleSheets&&"undefined"!=typeof CSSStyleSheet){if(a)return e.adoptedStyleSheets=[a.sheet].concat(e.adoptedStyleSheets),e[r]=a;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),a=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[],e[r]=this}mount(e){let t=this.sheet,i=0,n=0;for(let r=0;r<e.length;r++){let s=e[r],o=this.modules.indexOf(s);if(o<n&&o>-1&&(this.modules.splice(o,1),n--,o=-1),-1==o){if(this.modules.splice(n++,0,s),t)for(let e=0;e<s.rules.length;e++)t.insertRule(s.rules[e],i++)}else{for(;n<o;)i+=this.modules[n++].rules.length;i+=s.rules.length,n++}}if(!t){let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e}}}})),r.register("3ES9b",(function(t,i){e(t.exports,"base",(()=>n)),e(t.exports,"shift",(()=>r)),e(t.exports,"keyName",(()=>f));for(var n={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},r={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},s="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),o="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),a="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),l="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),h="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),c=s&&(l||+s[1]<57)||a&&l,u=0;u<10;u++)n[48+u]=n[96+u]=String(u);for(u=1;u<=24;u++)n[u+111]="F"+u;for(u=65;u<=90;u++)n[u]=String.fromCharCode(u+32),r[u]=String.fromCharCode(u);for(var d in n)r.hasOwnProperty(d)||(r[d]=n[d]);function f(e){var t=!(c&&(e.ctrlKey||e.altKey||e.metaKey)||(o||h)&&e.shiftKey&&e.key&&1==e.key.length)&&e.key||(e.shiftKey?r:n)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}})),r.register("H1dsR",(function(t,i){e(t.exports,"syntaxTree",(()=>f)),e(t.exports,"indentUnit",(()=>_)),e(t.exports,"getIndentUnit",(()=>T)),e(t.exports,"indentString",(()=>A)),e(t.exports,"getIndentation",(()=>E)),e(t.exports,"IndentContext",(()=>C)),e(t.exports,"indentOnInput",(()=>k)),e(t.exports,"foldKeymap",(()=>Y)),e(t.exports,"foldGutter",(()=>ne)),e(t.exports,"syntaxHighlighting",(()=>he)),e(t.exports,"defaultHighlightStyle",(()=>de)),e(t.exports,"matchBrackets",(()=>Me)),e(t.exports,"bracketMatching",(()=>be));var n,s=r("7j0r9"),o=r("eamNc"),a=r("kLjcS"),l=r("8xOa8"),h=r("iYCHO");const c=new(0,s.NodeProp);class u{constructor(e,t,i=[]){this.data=e,o.EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(o.EditorState.prototype,"tree",{get(){return f(this)}}),this.parser=t,this.extension=[M.of(this),o.EditorState.languageData.of(((e,t,i)=>e.facet(d(e,t,i))))].concat(i)}isActiveAt(e,t,i=-1){return d(e,t,i)==this.data}findRegions(e){let t=e.facet(M);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],n=(e,t)=>{if(e.prop(c)==this.data)return void i.push({from:t,to:t+e.length});let r=e.prop(s.NodeProp.mounted);if(r){if(r.tree.prop(c)==this.data){if(r.overlay)for(let e of r.overlay)i.push({from:e.from+t,to:e.to+t});else i.push({from:t,to:t+e.length});return}if(r.overlay){let e=i.length;if(n(r.tree,r.overlay[0].from+t),i.length>e)return}}for(let i=0;i<e.children.length;i++){let r=e.children[i];r instanceof s.Tree&&n(r,e.positions[i]+t)}};return n(f(e),0),i}get allowsNesting(){return!0}}function d(e,t,i){let n=e.facet(M);if(!n)return null;let r=n.data;if(n.allowsNesting)for(let n=f(e).topNode;n;n=n.enter(t,i,s.IterMode.ExcludeBuffers))r=n.type.prop(c)||r;return r}u.setState=o.StateEffect.define();function f(e){let t=e.field(u.state,!1);return t?t.tree:s.Tree.empty}class p{constructor(e,t=e.length){this.doc=e,this.length=t,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let m=null;class g{constructor(e,t,i=[],n,r,s,o,a){this.parser=e,this.state=t,this.fragments=i,this.tree=n,this.treeLen=r,this.viewport=s,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new g(e,t,[],s.Tree.empty,0,i,[],null)}startParse(){return this.parser.startParse(new p(this.state.doc),this.fragments)}work(e,t){return null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=s.Tree.empty&&this.isDone(null!=t?t:this.state.doc.length)?(this.takeTree(),!0):this.withContext((()=>{var i;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n){if(this.fragments=this.withoutTempSkipped(s.TreeFragment.addTree(n,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(i=this.parse.stoppedAt)&&void 0!==i?i:this.state.doc.length,this.tree=n,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}}))}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext((()=>{for(;!(t=this.parse.advance()););})),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(s.TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=m;m=this;try{return e()}finally{m=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=v(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:n,treeLen:r,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges(((e,i,n,r)=>t.push({fromA:e,toA:i,fromB:n,toB:r}))),i=s.TreeFragment.applyChanges(i,t),n=s.Tree.empty,r=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let t of this.skipped){let i=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);i<n&&a.push({from:i,to:n})}}}return new g(this.parser,t,i,n,r,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:i,to:n}=this.skipped[t];i<e.to&&n>e.from&&(this.fragments=v(this.fragments,i,n),this.skipped.splice(t--,1))}return!(this.skipped.length>=t)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends s.Parser{createParse(t,i,n){let r=n[0].from,o=n[n.length-1].to;return{parsedPos:r,advance(){let t=m;if(t){for(let e of n)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=o,new(0,s.Tree)(s.NodeType.none,[],[],o-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return m}}function v(e,t,i){return s.TreeFragment.applyChanges(e,[{fromA:t,toA:i,fromB:t,toB:i}])}class x{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new x(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=g.create(e.facet(M).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new x(i)}}u.state=o.StateField.define({create:x.init,update(e,t){for(let e of t.effects)if(e.is(u.setState))return e.value;return t.startState.facet(M)!=t.state.facet(M)?x.init(t.state):e.apply(t)}});let y=e=>{let t=setTimeout((()=>e()),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(y=e=>{let t=-1,i=setTimeout((()=>{t=requestIdleCallback(e,{timeout:400})}),100);return()=>t<0?clearTimeout(i):cancelIdleCallback(t)});const b="undefined"!=typeof navigator&&(null===(n=navigator.scheduling)||void 0===n?void 0:n.isInputPending)?()=>navigator.scheduling.isInputPending():null,w=a.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(u.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(u.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=y(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,r=i.field(u.state);if(r.tree==r.context.tree&&r.context.isDone(n+1e5))return;let s=Date.now()+Math.min(this.chunkBudget,100,e&&!b?Math.max(25,e.timeRemaining()-5):1e9),o=r.context.treeLen<n&&i.doc.length>n+1e3,a=r.context.work((()=>b&&b()||Date.now()>s),n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:u.setState.of(new x(r.context))})),this.chunkBudget>0&&(!a||o)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then((()=>this.scheduleWork())).catch((e=>(0,a.logException)(this.view.state,e))).then((()=>this.workScheduled--)),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),M=o.Facet.define({combine:e=>e.length?e[0]:null,enables:[u.state,w]});const S=o.Facet.define(),_=o.Facet.define({combine:e=>{if(!e.length)return"  ";if(!/^(?: +|\t+)$/.test(e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return e[0]}});function T(e){let t=e.facet(_);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function A(e,t){let i="",n=e.tabSize;if(9==e.facet(_).charCodeAt(0))for(;t>=n;)i+="\t",t-=n;for(let e=0;e<t;e++)i+=" ";return i}function E(e,t){e instanceof o.EditorState&&(e=new C(e));for(let i of e.state.facet(S)){let n=i(e,t);if(null!=n)return n}let i=f(e.state);return i?function(e,t,i){return R(t.resolveInner(i).enterUnfinishedNodesBefore(i),i,e)}(e,i,t):null}class C{constructor(e,t={}){this.state=e,this.options=t,this.unit=T(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:r}=this.options;return null!=n&&n>=i.from&&n<=i.to?r&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(e,t);return i.slice(e-n,Math.min(i.length,e+100-n))}column(e,t=1){let{text:i,from:n}=this.lineAt(e,t),r=this.countColumn(i,e-n),s=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return s>-1&&(r+=s-this.countColumn(i,i.search(/\S|$/))),r}countColumn(e,t=e.length){return(0,o.countColumn)(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:n}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let e=r(n);if(e>-1)return e}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const N=new(0,s.NodeProp);function L(e){let t=e.type.prop(N);if(t)return t;let i,n=e.firstChild;if(n&&(i=n.type.prop(s.NodeProp.closedBy))){let t=e.lastChild,n=t&&i.indexOf(t.name)>-1;return e=>O(e,!0,1,void 0,n&&!function(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?P:null}function R(e,t,i){for(;e;e=e.parent){let n=L(e);if(n)return n(D.create(i,t,e))}return null}function P(){return 0}class D extends C{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.node=i}static create(e,t,i){return new D(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(I(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?R(e,this.pos,this.base):0}}function I(e,t){for(let i=t;i;i=i.parent)if(e==i)return!0;return!1}function O(e,t,i,n,r){let s=e.textAfter,o=s.match(/^\s*/)[0].length,a=n&&s.slice(o,o+n.length)==n||r==e.pos+o,l=t?function(e){let t=e.node,i=t.childAfter(t.from),n=t.lastChild;if(!i)return null;let r=e.options.simulateBreak,s=e.state.doc.lineAt(i.from),o=null==r||r<=s.from?s.to:Math.min(s.to,r);for(let e=i.to;;){let r=t.childAfter(e);if(!r||r==n)return null;if(!r.type.isSkipped)return r.from<o?i:null;e=r.to}}(e):null;return l?a?e.column(l.from):e.column(l.to):e.baseIndent+(a?0:e.unit*i)}function k(){return o.EditorState.transactionFilter.of((e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let i=e.newDoc,{head:n}=e.newSelection.main,r=i.lineAt(n);if(n>r.from+200)return e;let s=i.sliceString(r.from,n);if(!t.some((e=>e.test(s))))return e;let{state:o}=e,a=-1,l=[];for(let{head:e}of o.selection.ranges){let t=o.doc.lineAt(e);if(t.from==a)continue;a=t.from;let i=E(o,t.from);if(null==i)continue;let n=/^\s*/.exec(t.text)[0],r=A(o,i);n!=r&&l.push({from:t.from,to:t.from+n.length,insert:r})}return l.length?[e,{changes:l,sequential:!0}]:e}))}const z=o.Facet.define(),F=new(0,s.NodeProp);function B(e){let t=e.lastChild;return t&&t.to==e.to&&t.type.isError}function V(e,t,i){for(let n of e.facet(z)){let r=n(e,t,i);if(r)return r}return function(e,t,i){let n=f(e);if(n.length<i)return null;let r=null;for(let s=n.resolveInner(i);s;s=s.parent){if(s.to<=i||s.from>i)continue;if(r&&s.from<t)break;let o=s.type.prop(F);if(o&&(s.to<n.length-50||n.length==e.doc.length||!B(s))){let n=o(s,e);n&&n.from<=i&&n.from>=t&&n.to>i&&(r=n)}}return r}(e,t,i)}function U(e,t){let i=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);return i>=n?void 0:{from:i,to:n}}const H=o.StateEffect.define({map:U}),G=o.StateEffect.define({map:U});function W(e){let t=[];for(let{head:i}of e.state.selection.ranges)t.some((e=>e.from<=i&&e.to>=i))||t.push(e.lineBlockAt(i));return t}const j=o.StateField.define({create:()=>a.Decoration.none,update(e,t){e=e.map(t.changes);for(let i of t.effects)i.is(H)&&!q(e,i.value.from,i.value.to)?e=e.update({add:[ee.range(i.value.from,i.value.to)]}):i.is(G)&&(e=e.update({filter:(e,t)=>i.value.from!=e||i.value.to!=t,filterFrom:i.value.from,filterTo:i.value.to}));if(t.selection){let i=!1,{head:n}=t.selection.main;e.between(n,n,((e,t)=>{e<n&&t>n&&(i=!0)})),i&&(e=e.update({filterFrom:n,filterTo:n,filter:(e,t)=>t<=n||e>=n}))}return e},provide:e=>a.EditorView.decorations.from(e),toJSON(e,t){let i=[];return e.between(0,t.doc.length,((e,t)=>{i.push(e,t)})),i},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let i=0;i<e.length;){let n=e[i++],r=e[i++];if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid JSON for fold state");t.push(ee.range(n,r))}return a.Decoration.set(t,!0)}});function X(e,t,i){var n;let r=null;return null===(n=e.field(j,!1))||void 0===n||n.between(t,i,((e,t)=>{(!r||r.from>e)&&(r={from:e,to:t})})),r}function q(e,t,i){let n=!1;return e.between(t,t,((e,r)=>{e==t&&r==i&&(n=!0)})),n}function J(e,t){return e.field(j,!1)?t:t.concat(o.StateEffect.appendConfig.of(Q()))}function K(e,t,i=!0){let n=e.state.doc.lineAt(t.from).number,r=e.state.doc.lineAt(t.to).number;return a.EditorView.announce.of(`${e.state.phrase(i?"Folded lines":"Unfolded lines")} ${n} ${e.state.phrase("to")} ${r}.`)}const Y=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:e=>{for(let t of W(e)){let i=V(e.state,t.from,t.to);if(i)return e.dispatch({effects:J(e.state,[H.of(i),K(e,i)])}),!0}return!1}},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:e=>{if(!e.state.field(j,!1))return!1;let t=[];for(let i of W(e)){let n=X(e.state,i.from,i.to);n&&t.push(G.of(n),K(e,n,!1))}return t.length&&e.dispatch({effects:t}),t.length>0}},{key:"Ctrl-Alt-[",run:e=>{let{state:t}=e,i=[];for(let n=0;n<t.doc.length;){let r=e.lineBlockAt(n),s=V(t,r.from,r.to);s&&i.push(H.of(s)),n=(s?e.lineBlockAt(s.to):r).to+1}return i.length&&e.dispatch({effects:J(e.state,i)}),!!i.length}},{key:"Ctrl-Alt-]",run:e=>{let t=e.state.field(j,!1);if(!t||!t.size)return!1;let i=[];return t.between(0,e.state.doc.length,((e,t)=>{i.push(G.of({from:e,to:t}))})),e.dispatch({effects:i}),!0}}],Z={placeholderDOM:null,placeholderText:"…"},$=o.Facet.define({combine:e=>(0,o.combineConfig)(e,Z)});function Q(e){let t=[j,re];return e&&t.push($.of(e)),t}const ee=a.Decoration.replace({widget:new class extends a.WidgetType{toDOM(e){let{state:t}=e,i=t.facet($),n=t=>{let i=e.lineBlockAt(e.posAtDOM(t.target)),n=X(e.state,i.from,i.to);n&&e.dispatch({effects:G.of(n)}),t.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(e,n);let r=document.createElement("span");return r.textContent=i.placeholderText,r.setAttribute("aria-label",t.phrase("folded code")),r.title=t.phrase("unfold"),r.className="cm-foldPlaceholder",r.onclick=n,r}}}),te={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class ie extends a.GutterMarker{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function ne(e={}){let t=Object.assign(Object.assign({},te),e),i=new ie(t,!0),n=new ie(t,!1),r=a.ViewPlugin.fromClass(class{constructor(e){this.from=e.viewport.from,this.markers=this.buildMarkers(e)}update(e){(e.docChanged||e.viewportChanged||e.startState.facet(M)!=e.state.facet(M)||e.startState.field(j,!1)!=e.state.field(j,!1)||f(e.startState)!=f(e.state)||t.foldingChanged(e))&&(this.markers=this.buildMarkers(e.view))}buildMarkers(e){let t=new(0,o.RangeSetBuilder);for(let r of e.viewportLineBlocks){let s=X(e.state,r.from,r.to)?n:V(e.state,r.from,r.to)?i:null;s&&t.add(r.from,r.from,s)}return t.finish()}}),{domEventHandlers:s}=t;return[r,(0,a.gutter)({class:"cm-foldGutter",markers(e){var t;return(null===(t=e.plugin(r))||void 0===t?void 0:t.markers)||o.RangeSet.empty},initialSpacer:()=>new ie(t,!1),domEventHandlers:Object.assign(Object.assign({},s),{click:(e,t,i)=>{if(s.click&&s.click(e,t,i))return!0;let n=X(e.state,t.from,t.to);if(n)return e.dispatch({effects:G.of(n)}),!0;let r=V(e.state,t.from,t.to);return!!r&&(e.dispatch({effects:H.of(r)}),!0)}})}),Q()]}const re=a.EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class se{constructor(e,t){let i;function n(e){let t=h.StyleModule.newName();return(i||(i=Object.create(null)))["."+t]=e,t}const r="string"==typeof t.all?t.all:t.all?n(t.all):void 0,s=t.scope;this.scope=s instanceof u?e=>e.prop(c)==s.data:s?e=>e==s:void 0,this.style=(0,l.tagHighlighter)(e.map((e=>({tag:e.tag,class:e.class||n(Object.assign({},e,{tag:null}))}))),{all:r}).style,this.module=i?new(0,h.StyleModule)(i):null,this.themeType=t.themeType}static define(e,t){return new se(e,t||{})}}const oe=o.Facet.define(),ae=o.Facet.define({combine:e=>e.length?[e[0]]:null});function le(e){let t=e.facet(oe);return t.length?t:e.facet(ae)}function he(e,t){let i,n=[ue];return e instanceof se&&(e.module&&n.push(a.EditorView.styleModule.of(e.module)),i=e.themeType),(null==t?void 0:t.fallback)?n.push(ae.of(e)):i?n.push(oe.computeN([a.EditorView.darkTheme],(t=>t.facet(a.EditorView.darkTheme)==("dark"==i)?[e]:[]))):n.push(oe.of(e)),n}class ce{constructor(e){this.markCache=Object.create(null),this.tree=f(e.state),this.decorations=this.buildDeco(e,le(e.state))}update(e){let t=f(e.state),i=le(e.state),n=i!=le(e.startState);t.length<e.view.viewport.to&&!n&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i))}buildDeco(e,t){if(!t||!this.tree.length)return a.Decoration.none;let i=new(0,o.RangeSetBuilder);for(let{from:n,to:r}of e.visibleRanges)(0,l.highlightTree)(this.tree,t,((e,t,n)=>{i.add(e,t,this.markCache[n]||(this.markCache[n]=a.Decoration.mark({class:n})))}),n,r);return i.finish()}}const ue=o.Prec.high(a.ViewPlugin.fromClass(ce,{decorations:e=>e.decorations})),de=se.define([{tag:l.tags.meta,color:"#7a757a"},{tag:l.tags.link,textDecoration:"underline"},{tag:l.tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:l.tags.emphasis,fontStyle:"italic"},{tag:l.tags.strong,fontWeight:"bold"},{tag:l.tags.strikethrough,textDecoration:"line-through"},{tag:l.tags.keyword,color:"#708"},{tag:[l.tags.atom,l.tags.bool,l.tags.url,l.tags.contentSeparator,l.tags.labelName],color:"#219"},{tag:[l.tags.literal,l.tags.inserted],color:"#164"},{tag:[l.tags.string,l.tags.deleted],color:"#a11"},{tag:[l.tags.regexp,l.tags.escape,l.tags.special(l.tags.string)],color:"#e40"},{tag:l.tags.definition(l.tags.variableName),color:"#00f"},{tag:l.tags.local(l.tags.variableName),color:"#30a"},{tag:[l.tags.typeName,l.tags.namespace],color:"#085"},{tag:l.tags.className,color:"#167"},{tag:[l.tags.special(l.tags.variableName),l.tags.macroName],color:"#256"},{tag:l.tags.definition(l.tags.propertyName),color:"#00c"},{tag:l.tags.comment,color:"#940"},{tag:l.tags.invalid,color:"#f00"}]),fe=a.EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),pe="()[]{}",me=o.Facet.define({combine:e=>(0,o.combineConfig)(e,{afterCursor:!0,brackets:pe,maxScanDistance:1e4,renderMatch:xe})}),ge=a.Decoration.mark({class:"cm-matchingBracket"}),ve=a.Decoration.mark({class:"cm-nonmatchingBracket"});function xe(e){let t=[],i=e.matched?ge:ve;return t.push(i.range(e.start.from,e.start.to)),e.end&&t.push(i.range(e.end.from,e.end.to)),t}const ye=[o.StateField.define({create:()=>a.Decoration.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let i=[],n=t.state.facet(me);for(let e of t.state.selection.ranges){if(!e.empty)continue;let r=Me(t.state,e.head,-1,n)||e.head>0&&Me(t.state,e.head-1,1,n)||n.afterCursor&&(Me(t.state,e.head,1,n)||e.head<t.state.doc.length&&Me(t.state,e.head+1,-1,n));r&&(i=i.concat(n.renderMatch(r,t.state)))}return a.Decoration.set(i,!0)},provide:e=>a.EditorView.decorations.from(e)}),fe];function be(e={}){return[me.of(e),ye]}function we(e,t,i){let n=e.prop(t<0?s.NodeProp.openedBy:s.NodeProp.closedBy);if(n)return n;if(1==e.name.length){let n=i.indexOf(e.name);if(n>-1&&n%2==(t<0?1:0))return[i[n+t]]}return null}function Me(e,t,i,n={}){let r=n.maxScanDistance||1e4,s=n.brackets||pe,o=f(e),a=o.resolveInner(t,i);for(let n=a;n;n=n.parent){let r=we(n.type,i,s);if(r&&n.from<n.to)return Se(e,t,i,n,r,s)}return function(e,t,i,n,r,s,o){let a=i<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),l=o.indexOf(a);if(l<0||l%2==0!=i>0)return null;let h={from:i<0?t-1:t,to:i>0?t+1:t},c=e.doc.iterRange(t,i>0?e.doc.length:0),u=0;for(let e=0;!c.next().done&&e<=s;){let s=c.value;i<0&&(e+=s.length);let a=t+e*i;for(let e=i>0?0:s.length-1,t=i>0?s.length:-1;e!=t;e+=i){let t=o.indexOf(s[e]);if(!(t<0||n.resolveInner(a+e,1).type!=r))if(t%2==0==i>0)u++;else{if(1==u)return{start:h,end:{from:a+e,to:a+e+1},matched:t>>1==l>>1};u--}}i>0&&(e+=s.length)}return c.done?{start:h,matched:!1}:null}(e,t,i,o,a.type,r,s)}function Se(e,t,i,n,r,s){let o=n.parent,a={from:n.from,to:n.to},l=0,h=null==o?void 0:o.cursor();if(h&&(i<0?h.childBefore(n.from):h.childAfter(n.to)))do{if(i<0?h.to<=n.from:h.from>=n.to){if(0==l&&r.indexOf(h.type.name)>-1&&h.from<h.to)return{start:a,end:{from:h.from,to:h.to},matched:!0};if(we(h.type,i,s))l++;else if(we(h.type,-i,s)&&(l--,0==l))return{start:a,end:h.from==h.to?void 0:{from:h.from,to:h.to},matched:!1}}}while(i<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}const _e=Object.create(null),Te=[s.NodeType.none],Ae=[],Ee=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Ee[e]=Ne(_e,t);function Ce(e,t){Ae.indexOf(e)>-1||(Ae.push(e),console.warn(t))}function Ne(e,t){let i=null;for(let n of t.split(".")){let t=e[n]||l.tags[n];t?"function"==typeof t?i?i=t(i):Ce(n,`Modifier ${n} used at start of tag`):i?Ce(n,`Tag ${n} used as modifier`):i=t:Ce(n,`Unknown highlighting tag ${n}`)}if(!i)return 0;let n=t.replace(/ /g,"_"),r=s.NodeType.define({id:Te.length,name:n,props:[(0,l.styleTags)({[n]:i})]});return Te.push(r),r.id}})),r.register("7j0r9",(function(t,i){e(t.exports,"NodeProp",(()=>o)),e(t.exports,"NodeType",(()=>l)),e(t.exports,"NodeSet",(()=>h)),e(t.exports,"IterMode",(()=>d)),e(t.exports,"Tree",(()=>p)),e(t.exports,"TreeFragment",(()=>L)),e(t.exports,"Parser",(()=>R));const n=1024;let r=0;class s{constructor(e,t){this.from=e,this.to=t}}class o{constructor(e={}){this.id=r++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=l.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}o.closedBy=new o({deserialize:e=>e.split(" ")}),o.openedBy=new o({deserialize:e=>e.split(" ")}),o.group=new o({deserialize:e=>e.split(" ")}),o.contextHash=new o({perNode:!0}),o.lookAhead=new o({perNode:!0}),o.mounted=new o({perNode:!0});const a=Object.create(null);class l{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):a,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new l(e.name||"",t,e.id,i);if(e.props)for(let i of e.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(o.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return e=>{for(let i=e.prop(o.group),n=-1;n<(i?i.length:0);n++){let r=t[n<0?e.name:i[n]];if(r)return r}}}}l.none=new l("",Object.create(null),0,8);class h{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let n=null;for(let t of e){let e=t(i);e&&(n||(n=Object.assign({},i.props)),n[e[0].id]=e[1])}t.push(n?new l(i.name,n,i.id,i.flags):i)}return new h(t)}}const c=new WeakMap,u=new WeakMap;var d,f;(f=d||(d={}))[f.ExcludeBuffers=1]="ExcludeBuffers",f[f.IncludeAnonymous=2]="IncludeAnonymous",f[f.IgnoreMounts=4]="IgnoreMounts",f[f.IgnoreOverlays=8]="IgnoreOverlays";class p{constructor(e,t,i,n,r){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,r&&r.length){this.props=Object.create(null);for(let[e,t]of r)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=this.prop(o.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let i=e.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new T(this.topNode,e)}cursorAt(e,t=0,i=0){let n=c.get(this)||this.topNode,r=new T(n);return r.moveTo(e,t),c.set(this,r._tree),r}get topNode(){return new b(this,0,0,null)}resolve(e,t=0){let i=y(c.get(this)||this.topNode,e,t,!1);return c.set(this,i),i}resolveInner(e,t=0){let i=y(u.get(this)||this.topNode,e,t,!0);return u.set(this,i),i}iterate(e){let{enter:t,leave:i,from:n=0,to:r=this.length}=e;for(let s=this.cursor((e.mode||0)|d.IncludeAnonymous);;){let e=!1;if(s.from<=r&&s.to>=n&&(s.type.isAnonymous||!1!==t(s))){if(s.firstChild())continue;e=!0}for(;e&&i&&!s.type.isAnonymous&&i(s),!s.nextSibling();){if(!s.parent())return;e=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:N(l.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,i)=>new p(this.type,e,t,i,this.propValues)),e.makeTree||((e,t,i)=>new p(l.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:r,maxBufferLength:s=n,reused:a=[],minRepeatType:l=r.types.length}=e,h=Array.isArray(i)?new m(i,i.length):i,c=r.types,u=0,d=0;function f(e,t,i,n,o){let{id:p,start:m,end:M,size:S}=h,_=d;for(;S<0;){if(h.next(),-1==S){let t=a[p];return i.push(t),void n.push(m-e)}if(-3==S)return void(u=p);if(-4==S)return void(d=p);throw new RangeError(`Unrecognized record size: ${S}`)}let T,A,E=c[p],C=m-e;if(M-m<=s&&(A=b(h.pos-t,o))){let t=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=t.length;for(;h.pos>i;)n=w(A.start,t,n);T=new g(t,M-A.start,r),C=A.start-e}else{let e=h.pos-S;h.next();let t=[],i=[],n=p>=l?p:-1,r=0,o=M;for(;h.pos>e;)n>=0&&h.id==n&&h.size>=0?(h.end<=o-s&&(x(t,i,m,r,h.end,o,n,_),r=t.length,o=h.end),h.next()):f(m,e,t,i,n);if(n>=0&&r>0&&r<t.length&&x(t,i,m,r,m,o,n,_),t.reverse(),i.reverse(),n>-1&&r>0){let e=v(E);T=N(E,t,i,0,t.length,0,M-m,e,e)}else T=y(E,t,i,M-m,_-M)}i.push(T),n.push(C)}function v(e){return(t,i,n)=>{let r,s,a=0,l=t.length-1;if(l>=0&&(r=t[l])instanceof p){if(!l&&r.type==e&&r.length==n)return r;(s=r.prop(o.lookAhead))&&(a=i[l]+r.length+s)}return y(e,t,i,n,a)}}function x(e,t,i,n,s,o,a,l){let h=[],c=[];for(;e.length>n;)h.push(e.pop()),c.push(t.pop()+i-s);e.push(y(r.types[a],h,c,o-s,l-o)),t.push(s-i)}function y(e,t,i,n,r=0,s){if(u){let e=[o.contextHash,u];s=s?[e].concat(s):[e]}if(r>25){let e=[o.lookAhead,r];s=s?[e].concat(s):[e]}return new p(e,t,i,n,s)}function b(e,t){let i=h.fork(),n=0,r=0,o=0,a=i.end-s,c={size:0,start:0,skip:0};e:for(let s=i.pos-e;i.pos>s;){let e=i.size;if(i.id==t&&e>=0){c.size=n,c.start=r,c.skip=o,o+=4,n+=4,i.next();continue}let h=i.pos-e;if(e<0||h<s||i.start<a)break;let u=i.id>=l?4:0,d=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break e;u+=4}else i.id>=l&&(u+=4);i.next()}r=d,n+=e,o+=u}return(t<0||n==e)&&(c.size=n,c.start=r,c.skip=o),c.size>4?c:void 0}function w(e,t,i){let{id:n,start:r,end:s,size:o}=h;if(h.next(),o>=0&&n<l){let a=i;if(o>4){let n=h.pos-(o-4);for(;h.pos>n;)i=w(e,t,i)}t[--i]=a,t[--i]=s-e,t[--i]=r-e,t[--i]=n}else-3==o?u=n:-4==o&&(d=n);return i}let M=[],S=[];for(;h.pos>0;)f(e.start||0,e.bufferStart||0,M,S,-1);let _=null!==(t=e.length)&&void 0!==t?t:M.length?S[0]+M[0].length:0;return new p(c[e.topID],M.reverse(),S.reverse(),_)}(e)}}p.empty=new p(l.none,[],[],0);class m{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new m(this.buffer,this.index)}}class g{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return l.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],r=n.name;if(/\W/.test(r)&&!n.isError&&(r=JSON.stringify(r)),i==(e+=4))return r;let s=[];for(;e<i;)s.push(this.childString(e)),e=this.buffer[e+3];return r+"("+s.join(",")+")"}findChild(e,t,i,n,r){let{buffer:s}=this,o=-1;for(let a=e;a!=t&&!(v(r,n,s[a+1],s[a+2])&&(o=a,i>0));a=s[a+3]);return o}slice(e,t,i,n){let r=this.buffer,s=new Uint16Array(t-e);for(let n=e,o=0;n<t;)s[o++]=r[n++],s[o++]=r[n++]-i,s[o++]=r[n++]-i,s[o++]=r[n++]-e;return new g(s,n-i,this.set)}}function v(e,t,i,n){switch(e){case-2:return i<t;case-1:return n>=t&&i<t;case 0:return i<t&&n>t;case 1:return i<=t&&n>t;case 2:return n>t;case 4:return!0}}function x(e,t){let i=e.childBefore(t);for(;i;){let t=i.lastChild;if(!t||t.to!=i.to)break;t.type.isError&&t.from==t.to?(e=i,i=t.prevSibling):i=t}return e}function y(e,t,i,n){for(var r;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof b&&e.index<0?null:e.parent;if(!t)return e;e=t}let s=n?0:d.IgnoreOverlays;if(n)for(let n=e,o=n.parent;o;n=o,o=n.parent)n instanceof b&&n.index<0&&(null===(r=o.enter(t,i,s))||void 0===r?void 0:r.from)!=n.from&&(e=o);for(;;){let n=e.enter(t,i,s);if(!n)return e;e=n}}class b{constructor(e,t,i,n){this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,r=0){for(let s=this;;){for(let{children:a,positions:l}=s._tree,h=t>0?a.length:-1;e!=h;e+=t){let h=a[e],c=l[e]+s.from;if(v(n,i,c,c+h.length))if(h instanceof g){if(r&d.ExcludeBuffers)continue;let o=h.findChild(0,h.buffer.length,t,i-c,n);if(o>-1)return new _(new S(s,h,e,c),null,o)}else if(r&d.IncludeAnonymous||!h.type.isAnonymous||A(h)){let a;if(!(r&d.IgnoreMounts)&&h.props&&(a=h.prop(o.mounted))&&!a.overlay)return new b(a.tree,c,e,s);let l=new b(h,c,e,s);return r&d.IncludeAnonymous||!l.type.isAnonymous?l:l.nextChild(t<0?h.children.length-1:0,t,i,n)}}if(r&d.IncludeAnonymous||!s.type.isAnonymous)return null;if(e=s.index>=0?s.index+t:t<0?-1:s._parent._tree.children.length,s=s._parent,!s)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let n;if(!(i&d.IgnoreOverlays)&&(n=this._tree.prop(o.mounted))&&n.overlay){let i=e-this.from;for(let{from:e,to:r}of n.overlay)if((t>0?e<=i:e<i)&&(t<0?r>=i:r>i))return new b(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new T(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return y(this,e,t,!1)}resolveInner(e,t=0){return y(this,e,t,!0)}enterUnfinishedNodesBefore(e){return x(this,e)}getChild(e,t=null,i=null){let n=w(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return w(this,e,t,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return M(this,e)}}function w(e,t,i,n){let r=e.cursor(),s=[];if(!r.firstChild())return s;if(null!=i)for(;!r.type.is(i);)if(!r.nextSibling())return s;for(;;){if(null!=n&&r.type.is(n))return s;if(r.type.is(t)&&s.push(r.node),!r.nextSibling())return null==n?s:[]}}function M(e,t,i=t.length-1){for(let n=e.parent;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[i]&&t[i]!=n.name)return!1;i--}}return!0}class S{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class _{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new _(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&d.ExcludeBuffers)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new _(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new _(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new _(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new T(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,r=i.buffer[this.index+3];if(r>n){let s=i.buffer[this.index+1],o=i.buffer[this.index+2];e.push(i.slice(n,r,s,o)),t.push(0)}return new p(this.type,e,t,this.to-this.from)}resolve(e,t=0){return y(this,e,t,!1)}resolveInner(e,t=0){return y(this,e,t,!0)}enterUnfinishedNodesBefore(e){return x(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let n=w(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return w(this,e,t,i)}get node(){return this}matchContext(e){return M(this,e)}}class T{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof b)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof b?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&d.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&d.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&d.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let n=t+e,r=e<0?-1:i._tree.children.length;n!=r;n+=e){let e=i._tree.children[n];if(this.mode&d.IncludeAnonymous||e instanceof g||!e.type.isAnonymous||A(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,r=this.stack.length;r>=0;){for(let s=e;s;s=s._parent)if(s.index==n){if(n==this.index)return s;t=s,i=r+1;break e}n=this.stack[--r]}for(let e=i;e<this.stack.length;e++)t=new _(this.buffer,t,this.stack[e]);return this.bufferNode=new _(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return M(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,r=this.stack.length-1;n>=0;r--){if(r<0)return M(this.node,e,n);let s=i[t.buffer[this.stack[r]]];if(!s.isAnonymous){if(e[n]&&e[n]!=s.name)return!1;n--}}return!0}}function A(e){return e.children.some((e=>e instanceof g||!e.type.isAnonymous||A(e)))}const E=new WeakMap;function C(e,t){if(!e.isAnonymous||t instanceof g||t.type!=e)return 1;let i=E.get(t);if(null==i){i=1;for(let n of t.children){if(n.type!=e||!(n instanceof p)){i=1;break}i+=C(e,n)}E.set(t,i)}return i}function N(e,t,i,n,r,s,o,a,l){let h=0;for(let i=n;i<r;i++)h+=C(e,t[i]);let c=Math.ceil(1.5*h/8),u=[],d=[];return function t(i,n,r,o,a){for(let h=r;h<o;){let r=h,f=n[h],p=C(e,i[h]);for(h++;h<o;h++){let t=C(e,i[h]);if(p+t>=c)break;p+=t}if(h==r+1){if(p>c){let e=i[r];t(e.children,e.positions,0,e.children.length,n[r]+a);continue}u.push(i[r])}else{let t=n[h-1]+i[h-1].length-f;u.push(N(e,i,n,r,h,f,t,null,l))}d.push(f+a-s)}}(t,i,n,r,0),(a||l)(u,d,o)}class L{constructor(e,t,i,n,r=!1,s=!1){this.from=e,this.to=t,this.tree=i,this.offset=n,this.open=(r?1:0)|(s?2:0)}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],i=!1){let n=[new L(0,e.length,e,0,!1,i)];for(let i of t)i.to>e.length&&n.push(i);return n}static applyChanges(e,t,i=128){if(!t.length)return e;let n=[],r=1,s=e.length?e[0]:null;for(let o=0,a=0,l=0;;o++){let h=o<t.length?t[o]:null,c=h?h.fromA:1e9;if(c-a>=i)for(;s&&s.from<c;){let t=s;if(a>=t.from||c<=t.to||l){let e=Math.max(t.from,a)-l,i=Math.min(t.to,c)-l;t=e>=i?null:new L(e,i,t.tree,t.offset+l,o>0,!!h)}if(t&&n.push(t),s.to>c)break;s=r<e.length?e[r++]:null}if(!h)break;a=h.toA,l=h.toA-h.toB}return n}}class R{startParse(e,t,i){return"string"==typeof e&&(e=new P(e)),i=i?i.length?i.map((e=>new s(e.from,e.to))):[new s(0,0)]:[new s(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let n=this.startParse(e,t,i);for(;;){let e=n.advance();if(e)return e}}}class P{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new o({perNode:!0})})),r.register("8xOa8",(function(t,i){e(t.exports,"styleTags",(()=>c)),e(t.exports,"tagHighlighter",(()=>f)),e(t.exports,"highlightTree",(()=>m)),e(t.exports,"tags",(()=>P));var n=r("3zaXv");let s=0;class o{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=s++}static define(e){if(null==e?void 0:e.base)throw new Error("Can not derive from a modified tag");let t=new o([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new l;return t=>t.modified.indexOf(e)>-1?t:l.get(t.base||t,t.modified.concat(e).sort(((e,t)=>e.id-t.id)))}}let a=0;class l{constructor(){this.instances=[],this.id=a++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find((i=>{return i.base==e&&(n=t,r=i.modified,n.length==r.length&&n.every(((e,t)=>e==r[t])));var n,r}));if(i)return i;let n=[],r=new o(n,e,t);for(let e of t)e.instances.push(r);let s=h(t);for(let t of e.set)for(let e of s)n.push(l.get(t,e));return r}}function h(e){let t=[e];for(let i=0;i<e.length;i++)for(let n of h(e.slice(0,i).concat(e.slice(i+1))))t.push(n);return t}function c(e){let t=Object.create(null);for(let i in e){let n=e[i];Array.isArray(n)||(n=[n]);for(let e of i.split(" "))if(e){let i=[],r=2,s=e;for(let t=0;;){if("..."==s&&t>0&&t+3==e.length){r=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(s);if(!n)throw new RangeError("Invalid path: "+e);if(i.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),t+=n[0].length,t==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){r=0;break}if("/"!=o)throw new RangeError("Invalid path: "+e);s=e.slice(t)}let o=i.length-1,a=i[o];if(!a)throw new RangeError("Invalid path: "+e);let l=new d(n,r,o>0?i.slice(0,o):null);t[a]=l.sort(t[a])}}return u.add(t)}const u=new(0,n.NodeProp);class d{constructor(e,t,i,n){this.tags=e,this.mode=t,this.context=i,this.next=n}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}function f(e,t){let i=Object.create(null);for(let t of e)if(Array.isArray(t.tag))for(let e of t.tag)i[e.id]=t.class;else i[t.tag.id]=t.class;let{scope:n,all:r=null}=t||{};return{style:e=>{let t=r;for(let n of e)for(let e of n.set){let n=i[e.id];if(n){t=t?t+" "+n:n;break}}return t},scope:n}}function p(e,t){let i=null;for(let n of e){let e=n.style(t);e&&(i=i?i+" "+e:e)}return i}function m(e,t,i,n=0,r=e.length){let s=new g(n,Array.isArray(t)?t:[t],i);s.highlightRange(e.cursor(),n,r,"",s.highlighters),s.flush(r)}class g{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s){let{type:o,from:a,to:l}=e;if(a>=i||l<=t)return;o.isTop&&(s=this.highlighters.filter((e=>!e.scope||e.scope(o))));let h=r,c=o.prop(u),d=!1;for(;c;){if(!c.context||e.matchContext(c.context)){let e=p(s,c.tags);e&&(h&&(h+=" "),h+=e,1==c.mode?r+=(r?" ":"")+e:0==c.mode&&(d=!0));break}c=c.next}if(this.startSpan(e.from,h),d)return;let f=e.tree&&e.tree.prop(n.NodeProp.mounted);if(f&&f.overlay){let n=e.node.enter(f.overlay[0].from+a,1),o=this.highlighters.filter((e=>!e.scope||e.scope(f.tree.type))),c=e.firstChild();for(let u=0,d=a;;u++){let p=u<f.overlay.length?f.overlay[u]:null,m=p?p.from+a:l,g=Math.max(t,d),v=Math.min(i,m);if(g<v&&c)for(;e.from<v&&(this.highlightRange(e,g,v,r,s),this.startSpan(Math.min(i,e.to),h),!(e.to>=m)&&e.nextSibling()););if(!p||m>i)break;d=p.to+a,d>t&&(this.highlightRange(n.cursor(),Math.max(t,p.from+a),Math.min(i,d),r,o),this.startSpan(d,h))}c&&e.parent()}else if(e.firstChild()){do{if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s),this.startSpan(Math.min(i,e.to),h)}}while(e.nextSibling());e.parent()}}}const v=o.define,x=v(),y=v(),b=v(y),w=v(y),M=v(),S=v(M),_=v(M),T=v(),A=v(T),E=v(),C=v(),N=v(),L=v(N),R=v(),P={comment:x,lineComment:v(x),blockComment:v(x),docComment:v(x),name:y,variableName:v(y),typeName:b,tagName:v(b),propertyName:w,attributeName:v(w),className:v(y),labelName:v(y),namespace:v(y),macroName:v(y),literal:M,string:S,docString:v(S),character:v(S),attributeValue:v(S),number:_,integer:v(_),float:v(_),bool:v(M),regexp:v(M),escape:v(M),color:v(M),url:v(M),keyword:E,self:v(E),null:v(E),atom:v(E),unit:v(E),modifier:v(E),operatorKeyword:v(E),controlKeyword:v(E),definitionKeyword:v(E),moduleKeyword:v(E),operator:C,derefOperator:v(C),arithmeticOperator:v(C),logicOperator:v(C),bitwiseOperator:v(C),compareOperator:v(C),updateOperator:v(C),definitionOperator:v(C),typeOperator:v(C),controlOperator:v(C),punctuation:N,separator:v(N),bracket:L,angleBracket:v(L),squareBracket:v(L),paren:v(L),brace:v(L),content:T,heading:A,heading1:v(A),heading2:v(A),heading3:v(A),heading4:v(A),heading5:v(A),heading6:v(A),contentSeparator:v(T),list:v(T),quote:v(T),emphasis:v(T),strong:v(T),link:v(T),monospace:v(T),strikethrough:v(T),inserted:v(),deleted:v(),changed:v(),invalid:v(),meta:R,documentMeta:v(R),annotation:v(R),processingInstruction:v(R),definition:o.defineModifier(),constant:o.defineModifier(),function:o.defineModifier(),standard:o.defineModifier(),local:o.defineModifier(),special:o.defineModifier()};f([{tag:P.link,class:"tok-link"},{tag:P.heading,class:"tok-heading"},{tag:P.emphasis,class:"tok-emphasis"},{tag:P.strong,class:"tok-strong"},{tag:P.keyword,class:"tok-keyword"},{tag:P.atom,class:"tok-atom"},{tag:P.bool,class:"tok-bool"},{tag:P.url,class:"tok-url"},{tag:P.labelName,class:"tok-labelName"},{tag:P.inserted,class:"tok-inserted"},{tag:P.deleted,class:"tok-deleted"},{tag:P.literal,class:"tok-literal"},{tag:P.string,class:"tok-string"},{tag:P.number,class:"tok-number"},{tag:[P.regexp,P.escape,P.special(P.string)],class:"tok-string2"},{tag:P.variableName,class:"tok-variableName"},{tag:P.local(P.variableName),class:"tok-variableName tok-local"},{tag:P.definition(P.variableName),class:"tok-variableName tok-definition"},{tag:P.special(P.variableName),class:"tok-variableName2"},{tag:P.definition(P.propertyName),class:"tok-propertyName tok-definition"},{tag:P.typeName,class:"tok-typeName"},{tag:P.namespace,class:"tok-namespace"},{tag:P.className,class:"tok-className"},{tag:P.macroName,class:"tok-macroName"},{tag:P.propertyName,class:"tok-propertyName"},{tag:P.operator,class:"tok-operator"},{tag:P.comment,class:"tok-comment"},{tag:P.meta,class:"tok-meta"},{tag:P.invalid,class:"tok-invalid"},{tag:P.punctuation,class:"tok-punctuation"}])})),r.register("3zaXv",(function(t,i){e(t.exports,"NodeProp",(()=>s));const n=1024;let r=0;class s{constructor(e={}){this.id=r++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=a.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}s.closedBy=new s({deserialize:e=>e.split(" ")}),s.openedBy=new s({deserialize:e=>e.split(" ")}),s.group=new s({deserialize:e=>e.split(" ")}),s.contextHash=new s({perNode:!0}),s.lookAhead=new s({perNode:!0}),s.mounted=new s({perNode:!0});const o=Object.create(null);class a{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):o,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new a(e.name||"",t,e.id,i);if(e.props)for(let i of e.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(s.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return e=>{for(let i=e.prop(s.group),n=-1;n<(i?i.length:0);n++){let r=t[n<0?e.name:i[n]];if(r)return r}}}}a.none=new a("",Object.create(null),0,8);const l=new WeakMap,h=new WeakMap;var c,u;(u=c||(c={}))[u.ExcludeBuffers=1]="ExcludeBuffers",u[u.IncludeAnonymous=2]="IncludeAnonymous",u[u.IgnoreMounts=4]="IgnoreMounts",u[u.IgnoreOverlays=8]="IgnoreOverlays";class d{constructor(e,t,i,n,r){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,r&&r.length){this.props=Object.create(null);for(let[e,t]of r)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=this.prop(s.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let i=e.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new S(this.topNode,e)}cursorAt(e,t=0,i=0){let n=l.get(this)||this.topNode,r=new S(n);return r.moveTo(e,t),l.set(this,r._tree),r}get topNode(){return new x(this,0,0,null)}resolve(e,t=0){let i=v(l.get(this)||this.topNode,e,t,!1);return l.set(this,i),i}resolveInner(e,t=0){let i=v(h.get(this)||this.topNode,e,t,!0);return h.set(this,i),i}iterate(e){let{enter:t,leave:i,from:n=0,to:r=this.length}=e;for(let s=this.cursor((e.mode||0)|c.IncludeAnonymous);;){let e=!1;if(s.from<=r&&s.to>=n&&(s.type.isAnonymous||!1!==t(s))){if(s.firstChild())continue;e=!0}for(;e&&i&&!s.type.isAnonymous&&i(s),!s.nextSibling();){if(!s.parent())return;e=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:E(a.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,i)=>new d(this.type,e,t,i,this.propValues)),e.makeTree||((e,t,i)=>new d(a.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:r,maxBufferLength:o=n,reused:a=[],minRepeatType:l=r.types.length}=e,h=Array.isArray(i)?new f(i,i.length):i,c=r.types,u=0,m=0;function g(e,t,i,n,s){let{id:d,start:f,end:M,size:S}=h,_=m;for(;S<0;){if(h.next(),-1==S){let t=a[d];return i.push(t),void n.push(f-e)}if(-3==S)return void(u=d);if(-4==S)return void(m=d);throw new RangeError(`Unrecognized record size: ${S}`)}let T,A,C=c[d],N=f-e;if(M-f<=o&&(A=b(h.pos-t,s))){let t=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=t.length;for(;h.pos>i;)n=w(A.start,t,n);T=new p(t,M-A.start,r),N=A.start-e}else{let e=h.pos-S;h.next();let t=[],i=[],n=d>=l?d:-1,r=0,s=M;for(;h.pos>e;)n>=0&&h.id==n&&h.size>=0?(h.end<=s-o&&(x(t,i,f,r,h.end,s,n,_),r=t.length,s=h.end),h.next()):g(f,e,t,i,n);if(n>=0&&r>0&&r<t.length&&x(t,i,f,r,f,s,n,_),t.reverse(),i.reverse(),n>-1&&r>0){let e=v(C);T=E(C,t,i,0,t.length,0,M-f,e,e)}else T=y(C,t,i,M-f,_-M)}i.push(T),n.push(N)}function v(e){return(t,i,n)=>{let r,o,a=0,l=t.length-1;if(l>=0&&(r=t[l])instanceof d){if(!l&&r.type==e&&r.length==n)return r;(o=r.prop(s.lookAhead))&&(a=i[l]+r.length+o)}return y(e,t,i,n,a)}}function x(e,t,i,n,s,o,a,l){let h=[],c=[];for(;e.length>n;)h.push(e.pop()),c.push(t.pop()+i-s);e.push(y(r.types[a],h,c,o-s,l-o)),t.push(s-i)}function y(e,t,i,n,r=0,o){if(u){let e=[s.contextHash,u];o=o?[e].concat(o):[e]}if(r>25){let e=[s.lookAhead,r];o=o?[e].concat(o):[e]}return new d(e,t,i,n,o)}function b(e,t){let i=h.fork(),n=0,r=0,s=0,a=i.end-o,c={size:0,start:0,skip:0};e:for(let o=i.pos-e;i.pos>o;){let e=i.size;if(i.id==t&&e>=0){c.size=n,c.start=r,c.skip=s,s+=4,n+=4,i.next();continue}let h=i.pos-e;if(e<0||h<o||i.start<a)break;let u=i.id>=l?4:0,d=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break e;u+=4}else i.id>=l&&(u+=4);i.next()}r=d,n+=e,s+=u}return(t<0||n==e)&&(c.size=n,c.start=r,c.skip=s),c.size>4?c:void 0}function w(e,t,i){let{id:n,start:r,end:s,size:o}=h;if(h.next(),o>=0&&n<l){let a=i;if(o>4){let n=h.pos-(o-4);for(;h.pos>n;)i=w(e,t,i)}t[--i]=a,t[--i]=s-e,t[--i]=r-e,t[--i]=n}else-3==o?u=n:-4==o&&(m=n);return i}let M=[],S=[];for(;h.pos>0;)g(e.start||0,e.bufferStart||0,M,S,-1);let _=null!==(t=e.length)&&void 0!==t?t:M.length?S[0]+M[0].length:0;return new d(c[e.topID],M.reverse(),S.reverse(),_)}(e)}}d.empty=new d(a.none,[],[],0);class f{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new f(this.buffer,this.index)}}class p{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return a.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],r=n.name;if(/\W/.test(r)&&!n.isError&&(r=JSON.stringify(r)),i==(e+=4))return r;let s=[];for(;e<i;)s.push(this.childString(e)),e=this.buffer[e+3];return r+"("+s.join(",")+")"}findChild(e,t,i,n,r){let{buffer:s}=this,o=-1;for(let a=e;a!=t&&!(m(r,n,s[a+1],s[a+2])&&(o=a,i>0));a=s[a+3]);return o}slice(e,t,i,n){let r=this.buffer,s=new Uint16Array(t-e);for(let n=e,o=0;n<t;)s[o++]=r[n++],s[o++]=r[n++]-i,s[o++]=r[n++]-i,s[o++]=r[n++]-e;return new p(s,n-i,this.set)}}function m(e,t,i,n){switch(e){case-2:return i<t;case-1:return n>=t&&i<t;case 0:return i<t&&n>t;case 1:return i<=t&&n>t;case 2:return n>t;case 4:return!0}}function g(e,t){let i=e.childBefore(t);for(;i;){let t=i.lastChild;if(!t||t.to!=i.to)break;t.type.isError&&t.from==t.to?(e=i,i=t.prevSibling):i=t}return e}function v(e,t,i,n){for(var r;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof x&&e.index<0?null:e.parent;if(!t)return e;e=t}let s=n?0:c.IgnoreOverlays;if(n)for(let n=e,o=n.parent;o;n=o,o=n.parent)n instanceof x&&n.index<0&&(null===(r=o.enter(t,i,s))||void 0===r?void 0:r.from)!=n.from&&(e=o);for(;;){let n=e.enter(t,i,s);if(!n)return e;e=n}}class x{constructor(e,t,i,n){this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,r=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,h=t>0?a.length:-1;e!=h;e+=t){let h=a[e],u=l[e]+o.from;if(m(n,i,u,u+h.length))if(h instanceof p){if(r&c.ExcludeBuffers)continue;let s=h.findChild(0,h.buffer.length,t,i-u,n);if(s>-1)return new M(new w(o,h,e,u),null,s)}else if(r&c.IncludeAnonymous||!h.type.isAnonymous||_(h)){let a;if(!(r&c.IgnoreMounts)&&h.props&&(a=h.prop(s.mounted))&&!a.overlay)return new x(a.tree,u,e,o);let l=new x(h,u,e,o);return r&c.IncludeAnonymous||!l.type.isAnonymous?l:l.nextChild(t<0?h.children.length-1:0,t,i,n)}}if(r&c.IncludeAnonymous||!o.type.isAnonymous)return null;if(e=o.index>=0?o.index+t:t<0?-1:o._parent._tree.children.length,o=o._parent,!o)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let n;if(!(i&c.IgnoreOverlays)&&(n=this._tree.prop(s.mounted))&&n.overlay){let i=e-this.from;for(let{from:e,to:r}of n.overlay)if((t>0?e<=i:e<i)&&(t<0?r>=i:r>i))return new x(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new S(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return v(this,e,t,!1)}resolveInner(e,t=0){return v(this,e,t,!0)}enterUnfinishedNodesBefore(e){return g(this,e)}getChild(e,t=null,i=null){let n=y(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return y(this,e,t,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return b(this,e)}}function y(e,t,i,n){let r=e.cursor(),s=[];if(!r.firstChild())return s;if(null!=i)for(;!r.type.is(i);)if(!r.nextSibling())return s;for(;;){if(null!=n&&r.type.is(n))return s;if(r.type.is(t)&&s.push(r.node),!r.nextSibling())return null==n?s:[]}}function b(e,t,i=t.length-1){for(let n=e.parent;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[i]&&t[i]!=n.name)return!1;i--}}return!0}class w{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class M{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new M(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&c.ExcludeBuffers)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new M(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new M(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new M(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new S(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,r=i.buffer[this.index+3];if(r>n){let s=i.buffer[this.index+1],o=i.buffer[this.index+2];e.push(i.slice(n,r,s,o)),t.push(0)}return new d(this.type,e,t,this.to-this.from)}resolve(e,t=0){return v(this,e,t,!1)}resolveInner(e,t=0){return v(this,e,t,!0)}enterUnfinishedNodesBefore(e){return g(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let n=y(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return y(this,e,t,i)}get node(){return this}matchContext(e){return b(this,e)}}class S{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof x)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof x?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&c.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&c.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&c.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let n=t+e,r=e<0?-1:i._tree.children.length;n!=r;n+=e){let e=i._tree.children[n];if(this.mode&c.IncludeAnonymous||e instanceof p||!e.type.isAnonymous||_(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,r=this.stack.length;r>=0;){for(let s=e;s;s=s._parent)if(s.index==n){if(n==this.index)return s;t=s,i=r+1;break e}n=this.stack[--r]}for(let e=i;e<this.stack.length;e++)t=new M(this.buffer,t,this.stack[e]);return this.bufferNode=new M(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return b(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,r=this.stack.length-1;n>=0;r--){if(r<0)return b(this.node,e,n);let s=i[t.buffer[this.stack[r]]];if(!s.isAnonymous){if(e[n]&&e[n]!=s.name)return!1;n--}}return!0}}function _(e){return e.children.some((e=>e instanceof p||!e.type.isAnonymous||_(e)))}const T=new WeakMap;function A(e,t){if(!e.isAnonymous||t instanceof p||t.type!=e)return 1;let i=T.get(t);if(null==i){i=1;for(let n of t.children){if(n.type!=e||!(n instanceof d)){i=1;break}i+=A(e,n)}T.set(t,i)}return i}function E(e,t,i,n,r,s,o,a,l){let h=0;for(let i=n;i<r;i++)h+=A(e,t[i]);let c=Math.ceil(1.5*h/8),u=[],d=[];return function t(i,n,r,o,a){for(let h=r;h<o;){let r=h,f=n[h],p=A(e,i[h]);for(h++;h<o;h++){let t=A(e,i[h]);if(p+t>=c)break;p+=t}if(h==r+1){if(p>c){let e=i[r];t(e.children,e.positions,0,e.children.length,n[r]+a);continue}u.push(i[r])}else{let t=n[h-1]+i[h-1].length-f;u.push(E(e,i,n,r,h,f,t,null,l))}d.push(f+a-s)}}(t,i,n,r,0),(a||l)(u,d,o)}new s({perNode:!0})})),r.register("av1JK",(function(t,i){e(t.exports,"history",(()=>b)),e(t.exports,"historyKeymap",(()=>k)),e(t.exports,"defaultKeymap",(()=>Fe)),e(t.exports,"indentWithTab",(()=>Be));var n=r("eamNc"),s=r("kLjcS"),o=r("H1dsR"),a=r("4OqmY");function l(e,t){return({state:i,dispatch:n})=>{if(i.readOnly)return!1;let r=e(t,i);return!!r&&(n(i.update(r)),!0)}}const h=l(p,0),c=l(f,0),u=l(((e,t)=>f(e,t,function(e){let t=[];for(let i of e.selection.ranges){let n=e.doc.lineAt(i.from),r=i.to<=n.to?n:e.doc.lineAt(i.to),s=t.length-1;s>=0&&t[s].to>n.from?t[s].to=r.to:t.push({from:n.from,to:r.to})}return t}(t))),0);function d(e,t=e.selection.main.head){let i=e.languageDataAt("commentTokens",t);return i.length?i[0]:{}}function f(e,t,i=t.selection.ranges){let n=i.map((e=>d(t,e.from).block));if(!n.every((e=>e)))return null;let r=i.map(((e,i)=>function(e,{open:t,close:i},n,r){let s,o,a=e.sliceDoc(n-50,n),l=e.sliceDoc(r,r+50),h=/\s*$/.exec(a)[0].length,c=/^\s*/.exec(l)[0].length,u=a.length-h;if(a.slice(u-t.length,u)==t&&l.slice(c,c+i.length)==i)return{open:{pos:n-h,margin:h&&1},close:{pos:r+c,margin:c&&1}};r-n<=100?s=o=e.sliceDoc(n,r):(s=e.sliceDoc(n,n+50),o=e.sliceDoc(r-50,r));let d=/^\s*/.exec(s)[0].length,f=/\s*$/.exec(o)[0].length,p=o.length-f-i.length;return s.slice(d,d+t.length)==t&&o.slice(p,p+i.length)==i?{open:{pos:n+d+t.length,margin:/\s/.test(s.charAt(d+t.length))?1:0},close:{pos:r-f-i.length,margin:/\s/.test(o.charAt(p-1))?1:0}}:null}(t,n[i],e.from,e.to)));if(2!=e&&!r.every((e=>e)))return{changes:t.changes(i.map(((e,t)=>r[t]?[]:[{from:e.from,insert:n[t].open+" "},{from:e.to,insert:" "+n[t].close}])))};if(1!=e&&r.some((e=>e))){let e=[];for(let t,i=0;i<r.length;i++)if(t=r[i]){let r=n[i],{open:s,close:o}=t;e.push({from:s.pos-r.open.length,to:s.pos+s.margin},{from:o.pos-o.margin,to:o.pos+r.close.length})}return{changes:e}}return null}function p(e,t,i=t.selection.ranges){let n=[],r=-1;for(let{from:e,to:s}of i){let i=n.length,o=1e9;for(let i=e;i<=s;){let a=t.doc.lineAt(i);if(a.from>r&&(e==s||s>a.from)){r=a.from;let e=d(t,i).line;if(!e)continue;let s=/^\s*/.exec(a.text)[0].length,l=s==a.length,h=a.text.slice(s,s+e.length)==e?s:-1;s<a.text.length&&s<o&&(o=s),n.push({line:a,comment:h,token:e,indent:s,empty:l,single:!1})}i=a.to+1}if(o<1e9)for(let e=i;e<n.length;e++)n[e].indent<n[e].line.text.length&&(n[e].indent=o);n.length==i+1&&(n[i].single=!0)}if(2!=e&&n.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:i,indent:r,empty:s,single:o}of n)!o&&s||e.push({from:t.from+r,insert:i+" "});let i=t.changes(e);return{changes:i,selection:t.selection.map(i,1)}}if(1!=e&&n.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:i,token:r}of n)if(i>=0){let n=t.from+i,s=n+r.length;" "==t.text[s-t.from]&&s++,e.push({from:n,to:s})}return{changes:e}}return null}const m=n.Annotation.define(),g=n.Annotation.define(),v=n.Facet.define(),x=n.Facet.define({combine:e=>(0,n.combineConfig)(e,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})});const y=n.StateField.define({create:()=>O.empty,update(e,t){let i=t.state.facet(x),r=t.annotation(m);if(r){let s=t.docChanged?n.EditorSelection.single(function(e){let t=0;return e.iterChangedRanges(((e,i)=>t=i)),t}(t.changes)):void 0,o=A.fromTransaction(t,s),a=r.side,l=0==a?e.undone:e.done;return l=o?E(l,l.length,i.minDepth,o):L(l,t.startState.selection),new O(0==a?r.rest:l,0==a?l:r.rest)}let s=t.annotation(g);if("full"!=s&&"before"!=s||(e=e.isolate()),!1===t.annotation(n.Transaction.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let o=A.fromTransaction(t),a=t.annotation(n.Transaction.time),l=t.annotation(n.Transaction.userEvent);return o?e=e.addChanges(o,a,l,i.newGroupDelay,i.minDepth):t.selection&&(e=e.addSelection(t.startState.selection,a,l,i.newGroupDelay)),"full"!=s&&"after"!=s||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new O(e.done.map(A.fromJSON),e.undone.map(A.fromJSON))});function b(e={}){return[y,x.of(e),s.EditorView.domEventHandlers({beforeinput(e,t){let i="historyUndo"==e.inputType?M:"historyRedo"==e.inputType?S:null;return!!i&&(e.preventDefault(),i(t))}})]}function w(e,t){return function({state:i,dispatch:n}){if(!t&&i.readOnly)return!1;let r=i.field(y,!1);if(!r)return!1;let s=r.pop(e,i,t);return!!s&&(n(s),!0)}}const M=w(0,!1),S=w(1,!1),_=w(0,!0),T=w(1,!0);class A{constructor(e,t,i,n,r){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=n,this.selectionsAfter=r}setSelAfter(e){return new A(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(i=this.startSelection)||void 0===i?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new A(e.changes&&n.ChangeSet.fromJSON(e.changes),[],e.mapped&&n.ChangeDesc.fromJSON(e.mapped),e.startSelection&&n.EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(n.EditorSelection.fromJSON))}static fromTransaction(e,t){let i=N;for(let t of e.startState.facet(v)){let n=t(e);n.length&&(i=i.concat(n))}return!i.length&&e.changes.empty?null:new A(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,N)}static selection(e){return new A(void 0,N,void 0,void 0,e)}}function E(e,t,i,n){let r=t+1>i+20?t-i-1:0,s=e.slice(r,t);return s.push(n),s}function C(e,t){return e.length?t.length?e.concat(t):e:t}const N=[];function L(e,t){if(e.length){let i=e[e.length-1],n=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-200));return n.length&&n[n.length-1].eq(t)?e:(n.push(t),E(e,e.length-1,1e9,i.setSelAfter(n)))}return[A.selection([t])]}function R(e){let t=e[e.length-1],i=e.slice();return i[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),i}function P(e,t){if(!e.length)return e;let i=e.length,n=N;for(;i;){let r=D(e[i-1],t,n);if(r.changes&&!r.changes.empty||r.effects.length){let t=e.slice(0,i);return t[i-1]=r,t}t=r.mapped,i--,n=r.selectionsAfter}return n.length?[A.selection(n)]:N}function D(e,t,i){let r=C(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):N,i);if(!e.changes)return A.selection(r);let s=e.changes.map(t),o=t.mapDesc(e.changes,!0),a=e.mapped?e.mapped.composeDesc(o):o;return new A(s,n.StateEffect.mapEffects(e.effects,t),a,e.startSelection.map(o),r)}const I=/^(input\.type|delete)($|\.)/;class O{constructor(e,t,i=0,n){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new O(this.done,this.undone):this}addChanges(e,t,i,n,r){let s=this.done,o=s[s.length-1];return s=o&&o.changes&&!o.changes.empty&&e.changes&&(!i||I.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<n&&function(e,t){let i=[],n=!1;return e.iterChangedRanges(((e,t)=>i.push(e,t))),t.iterChangedRanges(((e,t,r,s)=>{for(let e=0;e<i.length;){let t=i[e++],o=i[e++];s>=t&&r<=o&&(n=!0)}})),n}(o.changes,e.changes)||"input.type.compose"==i)?E(s,s.length-1,r,new A(e.changes.compose(o.changes),C(e.effects,o.effects),o.mapped,o.startSelection,N)):E(s,s.length,r,e),new O(s,N,t,i)}addSelection(e,t,i,n){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:N;return r.length>0&&t-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&(s=r[r.length-1],o=e,s.ranges.length==o.ranges.length&&0===s.ranges.filter(((e,t)=>e.empty!=o.ranges[t].empty)).length)?this:new O(L(this.done,e),this.undone,t,i);var s,o}addMapping(e){return new O(P(this.done,e),P(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let n=0==e?this.done:this.undone;if(0==n.length)return null;let r=n[n.length-1];if(i&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:m.of({side:e,rest:R(n)}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let i=1==n.length?N:n.slice(0,n.length-1);return r.mapped&&(i=P(i,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:m.of({side:e,rest:i}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}O.empty=new O(N,N);const k=[{key:"Mod-z",run:M,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:S,preventDefault:!0},{linux:"Ctrl-Shift-z",run:S,preventDefault:!0},{key:"Mod-u",run:_,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:T,preventDefault:!0}];function z(e,t){return n.EditorSelection.create(e.ranges.map(t),e.mainIndex)}function F(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function B({state:e,dispatch:t},i){let n=z(e.selection,i);return!n.eq(e.selection)&&(t(F(e,n)),!0)}function V(e,t){return n.EditorSelection.cursor(t?e.to:e.from)}function U(e,t){return B(e,(i=>i.empty?e.moveByChar(i,t):V(i,t)))}function H(e){return e.textDirectionAt(e.state.selection.main.head)==s.Direction.LTR}const G=e=>U(e,!H(e)),W=e=>U(e,H(e));function j(e,t){return B(e,(i=>i.empty?e.moveByGroup(i,t):V(i,t)))}function X(e,t,i){if(t.type.prop(i))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function q(e,t,i){let r,s,l=(0,o.syntaxTree)(e).resolveInner(t.head),h=i?a.NodeProp.closedBy:a.NodeProp.openedBy;for(let n=t.head;;){let t=i?l.childAfter(n):l.childBefore(n);if(!t)break;X(e,t,h)?l=t:n=i?t.to:t.from}return s=l.type.prop(h)&&(r=i?(0,o.matchBrackets)(e,l.from,1):(0,o.matchBrackets)(e,l.to,-1))&&r.matched?i?r.end.to:r.end.from:i?l.to:l.from,n.EditorSelection.cursor(s,i?-1:1)}function J(e,t){return B(e,(i=>{if(!i.empty)return V(i,t);let n=e.moveVertically(i,t);return n.head!=i.head?n:e.moveToLineBoundary(i,t)}))}const K=e=>J(e,!1),Y=e=>J(e,!0);function Z(e){return Math.max(e.defaultLineHeight,Math.min(e.dom.clientHeight,innerHeight)-5)}function $(e,t){let{state:i}=e,n=z(i.selection,(i=>i.empty?e.moveVertically(i,t,Z(e)):V(i,t)));if(n.eq(i.selection))return!1;let r,o=e.coordsAtPos(i.selection.main.head),a=e.scrollDOM.getBoundingClientRect();return o&&o.top>a.top&&o.bottom<a.bottom&&o.top-a.top<=e.scrollDOM.scrollHeight-e.scrollDOM.scrollTop-e.scrollDOM.clientHeight&&(r=s.EditorView.scrollIntoView(n.main.head,{y:"start",yMargin:o.top-a.top})),e.dispatch(F(i,n),{effects:r}),!0}const Q=e=>$(e,!1),ee=e=>$(e,!0);function te(e,t,i){let r=e.lineBlockAt(t.head),s=e.moveToLineBoundary(t,i);if(s.head==t.head&&s.head!=(i?r.to:r.from)&&(s=e.moveToLineBoundary(t,i,!1)),!i&&s.head==r.from&&r.length){let i=/^\s*/.exec(e.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;i&&t.head!=r.from+i&&(s=n.EditorSelection.cursor(r.from+i))}return s}const ie=e=>B(e,(t=>te(e,t,!0))),ne=e=>B(e,(t=>te(e,t,!1)));function re(e,t,i){let r=!1,s=z(e.selection,(t=>{let s=(0,o.matchBrackets)(e,t.head,-1)||(0,o.matchBrackets)(e,t.head,1)||t.head>0&&(0,o.matchBrackets)(e,t.head-1,1)||t.head<e.doc.length&&(0,o.matchBrackets)(e,t.head+1,-1);if(!s||!s.end)return t;r=!0;let a=s.start.from==t.head?s.end.to:s.end.from;return i?n.EditorSelection.range(t.anchor,a):n.EditorSelection.cursor(a)}));return!!r&&(t(F(e,s)),!0)}function se(e,t){let i=z(e.state.selection,(e=>{let i=t(e);return n.EditorSelection.range(e.anchor,i.head,i.goalColumn)}));return!i.eq(e.state.selection)&&(e.dispatch(F(e.state,i)),!0)}function oe(e,t){return se(e,(i=>e.moveByChar(i,t)))}const ae=e=>oe(e,!H(e)),le=e=>oe(e,H(e));function he(e,t){return se(e,(i=>e.moveByGroup(i,t)))}function ce(e,t){return se(e,(i=>e.moveVertically(i,t)))}const ue=e=>ce(e,!1),de=e=>ce(e,!0);function fe(e,t){return se(e,(i=>e.moveVertically(i,t,Z(e))))}const pe=e=>fe(e,!1),me=e=>fe(e,!0),ge=e=>se(e,(t=>te(e,t,!0))),ve=e=>se(e,(t=>te(e,t,!1))),xe=({state:e,dispatch:t})=>(t(F(e,{anchor:0})),!0),ye=({state:e,dispatch:t})=>(t(F(e,{anchor:e.doc.length})),!0),be=({state:e,dispatch:t})=>(t(F(e,{anchor:e.selection.main.anchor,head:0})),!0),we=({state:e,dispatch:t})=>(t(F(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0);function Me({state:e,dispatch:t},i){if(e.readOnly)return!1;let r="delete.selection",o=e.changeByRange((e=>{let{from:t,to:s}=e;if(t==s){let e=i(t);e<t?r="delete.backward":e>t&&(r="delete.forward"),t=Math.min(t,e),s=Math.max(s,e)}return t==s?{range:e}:{changes:{from:t,to:s},range:n.EditorSelection.cursor(t)}}));return!o.changes.empty&&(t(e.update(o,{scrollIntoView:!0,userEvent:r,effects:"delete.selection"==r?s.EditorView.announce.of(e.phrase("Selection deleted")):void 0})),!0)}function Se(e,t,i){if(e instanceof s.EditorView)for(let n of e.state.facet(s.EditorView.atomicRanges).map((t=>t(e))))n.between(t,t,((e,n)=>{e<t&&n>t&&(t=i?n:e)}));return t}const _e=(e,t)=>Me(e,(i=>{let r,s,{state:a}=e,l=a.doc.lineAt(i);if(!t&&i>l.from&&i<l.from+200&&!/[^ \t]/.test(r=l.text.slice(0,i-l.from))){if("\t"==r[r.length-1])return i-1;let e=(0,n.countColumn)(r,a.tabSize)%(0,o.getIndentUnit)(a)||(0,o.getIndentUnit)(a);for(let t=0;t<e&&" "==r[r.length-1-t];t++)i--;s=i}else s=(0,n.findClusterBreak)(l.text,i-l.from,t,t)+l.from,s==i&&l.number!=(t?a.doc.lines:1)&&(s+=t?1:-1);return Se(e,s,t)})),Te=e=>_e(e,!1),Ae=e=>_e(e,!0),Ee=(e,t)=>Me(e,(i=>{let r=i,{state:s}=e,o=s.doc.lineAt(r),a=s.charCategorizer(r);for(let e=null;;){if(r==(t?o.to:o.from)){r==i&&o.number!=(t?s.doc.lines:1)&&(r+=t?1:-1);break}let l=(0,n.findClusterBreak)(o.text,r-o.from,t)+o.from,h=o.text.slice(Math.min(r,l)-o.from,Math.max(r,l)-o.from),c=a(h);if(null!=e&&c!=e)break;" "==h&&r==i||(e=c),r=l}return Se(e,r,t)})),Ce=e=>Ee(e,!1),Ne=e=>Me(e,(t=>{let i=e.lineBlockAt(t).to;return Se(e,t<i?i:Math.min(e.state.doc.length,t+1),!0)}));function Le(e){let t=[],i=-1;for(let n of e.selection.ranges){let r=e.doc.lineAt(n.from),s=e.doc.lineAt(n.to);if(n.empty||n.to!=s.from||(s=e.doc.lineAt(n.to-1)),i>=r.number){let e=t[t.length-1];e.to=s.to,e.ranges.push(n)}else t.push({from:r.from,to:s.to,ranges:[n]});i=s.number+1}return t}function Re(e,t,i){if(e.readOnly)return!1;let r=[],s=[];for(let t of Le(e)){if(i?t.to==e.doc.length:0==t.from)continue;let o=e.doc.lineAt(i?t.to+1:t.from-1),a=o.length+1;if(i){r.push({from:t.to,to:o.to},{from:t.from,insert:o.text+e.lineBreak});for(let i of t.ranges)s.push(n.EditorSelection.range(Math.min(e.doc.length,i.anchor+a),Math.min(e.doc.length,i.head+a)))}else{r.push({from:o.from,to:t.from},{from:t.to,insert:e.lineBreak+o.text});for(let e of t.ranges)s.push(n.EditorSelection.range(e.anchor-a,e.head-a))}}return!!r.length&&(t(e.update({changes:r,scrollIntoView:!0,selection:n.EditorSelection.create(s,e.selection.mainIndex),userEvent:"move.line"})),!0)}function Pe(e,t,i){if(e.readOnly)return!1;let n=[];for(let t of Le(e))i?n.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):n.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const De=Ie(!1);function Ie(e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let r=t.changeByRange((i=>{let{from:r,to:s}=i,l=t.doc.lineAt(r),h=!e&&r==s&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let i,n=(0,o.syntaxTree)(e).resolveInner(t),r=n.childBefore(t),s=n.childAfter(t);return r&&s&&r.to<=t&&s.from>=t&&(i=r.type.prop(a.NodeProp.closedBy))&&i.indexOf(s.name)>-1&&e.doc.lineAt(r.to).from==e.doc.lineAt(s.from).from?{from:r.to,to:s.from}:null}(t,r);e&&(r=s=(s<=l.to?l:t.doc.lineAt(s)).to);let c=new(0,o.IndentContext)(t,{simulateBreak:r,simulateDoubleBreak:!!h}),u=(0,o.getIndentation)(c,r);for(null==u&&(u=/^\s*/.exec(t.doc.lineAt(r).text)[0].length);s<l.to&&/\s/.test(l.text[s-l.from]);)s++;h?({from:r,to:s}=h):r>l.from&&r<l.from+100&&!/\S/.test(l.text.slice(0,r))&&(r=l.from);let d=["",(0,o.indentString)(t,u)];return h&&d.push((0,o.indentString)(t,c.lineIndent(l.from,-1))),{changes:{from:r,to:s,insert:n.Text.of(d)},range:n.EditorSelection.cursor(r+1+d[1].length)}}));return i(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function Oe(e,t){let i=-1;return e.changeByRange((r=>{let s=[];for(let n=r.from;n<=r.to;){let o=e.doc.lineAt(n);o.number>i&&(r.empty||r.to>o.from)&&(t(o,s,r),i=o.number),n=o.to+1}let o=e.changes(s);return{changes:s,range:n.EditorSelection.range(o.mapPos(r.anchor,1),o.mapPos(r.head,1))}}))}const ke=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(Oe(e,((t,i)=>{i.push({from:t.from,insert:e.facet(o.indentUnit)})})),{userEvent:"input.indent"})),!0),ze=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(Oe(e,((t,i)=>{let r=/^\s*/.exec(t.text)[0];if(!r)return;let s=(0,n.countColumn)(r,e.tabSize),a=0,l=(0,o.indentString)(e,Math.max(0,s-(0,o.getIndentUnit)(e)));for(;a<r.length&&a<l.length&&r.charCodeAt(a)==l.charCodeAt(a);)a++;i.push({from:t.from+a,to:t.from+r.length,insert:l.slice(a)})})),{userEvent:"delete.dedent"})),!0),Fe=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e=>B(e,(t=>q(e.state,t,!H(e)))),shift:e=>se(e,(t=>q(e.state,t,!H(e))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:e=>B(e,(t=>q(e.state,t,H(e)))),shift:e=>se(e,(t=>q(e.state,t,H(e))))},{key:"Alt-ArrowUp",run:({state:e,dispatch:t})=>Re(e,t,!1)},{key:"Shift-Alt-ArrowUp",run:({state:e,dispatch:t})=>Pe(e,t,!1)},{key:"Alt-ArrowDown",run:({state:e,dispatch:t})=>Re(e,t,!0)},{key:"Shift-Alt-ArrowDown",run:({state:e,dispatch:t})=>Pe(e,t,!0)},{key:"Escape",run:({state:e,dispatch:t})=>{let i=e.selection,r=null;return i.ranges.length>1?r=n.EditorSelection.create([i.main]):i.main.empty||(r=n.EditorSelection.create([n.EditorSelection.cursor(i.main.head)])),!!r&&(t(F(e,r)),!0)}},{key:"Mod-Enter",run:Ie(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:e,dispatch:t})=>{let i=Le(e).map((({from:t,to:i})=>n.EditorSelection.range(t,Math.min(i+1,e.doc.length))));return t(e.update({selection:n.EditorSelection.create(i),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:e,dispatch:t})=>{let i=z(e.selection,(t=>{var i;let r=(0,o.syntaxTree)(e).resolveInner(t.head,1);for(;!(r.from<t.from&&r.to>=t.to||r.to>t.to&&r.from<=t.from)&&(null===(i=r.parent)||void 0===i?void 0:i.parent);)r=r.parent;return n.EditorSelection.range(r.to,r.from)}));return t(F(e,i)),!0},preventDefault:!0},{key:"Mod-[",run:ze},{key:"Mod-]",run:ke},{key:"Mod-Alt-\\",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=Object.create(null),n=new(0,o.IndentContext)(e,{overrideIndentation:e=>{let t=i[e];return null==t?-1:t}}),r=Oe(e,((t,r,s)=>{let a=(0,o.getIndentation)(n,t.from);if(null==a)return;/\S/.test(t.text)||(a=0);let l=/^\s*/.exec(t.text)[0],h=(0,o.indentString)(e,a);(l!=h||s.from<t.from+l.length)&&(i[t.from]=a,r.push({from:t.from,to:t.from+l.length,insert:h}))}));return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:e=>{if(e.state.readOnly)return!1;let{state:t}=e,i=t.changes(Le(t).map((({from:e,to:i})=>(e>0?e--:i<t.doc.length&&i++,{from:e,to:i})))),n=z(t.selection,(t=>e.moveVertically(t,!0))).map(i);return e.dispatch({changes:i,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:e,dispatch:t})=>re(e,t,!1)},{key:"Mod-/",run:e=>{let t=d(e.state);return t.line?h(e):!!t.block&&u(e)}},{key:"Alt-A",run:c}].concat([{key:"ArrowLeft",run:G,shift:ae,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e=>j(e,!H(e)),shift:e=>he(e,!H(e))},{mac:"Cmd-ArrowLeft",run:ne,shift:ve},{key:"ArrowRight",run:W,shift:le,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:e=>j(e,H(e)),shift:e=>he(e,H(e))},{mac:"Cmd-ArrowRight",run:ie,shift:ge},{key:"ArrowUp",run:K,shift:ue,preventDefault:!0},{mac:"Cmd-ArrowUp",run:xe,shift:be},{mac:"Ctrl-ArrowUp",run:Q,shift:pe},{key:"ArrowDown",run:Y,shift:de,preventDefault:!0},{mac:"Cmd-ArrowDown",run:ye,shift:we},{mac:"Ctrl-ArrowDown",run:ee,shift:me},{key:"PageUp",run:Q,shift:pe},{key:"PageDown",run:ee,shift:me},{key:"Home",run:ne,shift:ve,preventDefault:!0},{key:"Mod-Home",run:xe,shift:be},{key:"End",run:ie,shift:ge,preventDefault:!0},{key:"Mod-End",run:ye,shift:we},{key:"Enter",run:De},{key:"Mod-a",run:({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:Te,shift:Te},{key:"Delete",run:Ae},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Ce},{key:"Mod-Delete",mac:"Alt-Delete",run:e=>Ee(e,!0)},{mac:"Mod-Backspace",run:e=>Me(e,(t=>{let i=e.lineBlockAt(t).from;return Se(e,t>i?i:Math.max(0,t-1),!1)}))},{mac:"Mod-Delete",run:Ne}].concat([{key:"Ctrl-b",run:G,shift:ae,preventDefault:!0},{key:"Ctrl-f",run:W,shift:le},{key:"Ctrl-p",run:K,shift:ue},{key:"Ctrl-n",run:Y,shift:de},{key:"Ctrl-a",run:e=>B(e,(t=>n.EditorSelection.cursor(e.lineBlockAt(t.head).from,1))),shift:e=>se(e,(t=>n.EditorSelection.cursor(e.lineBlockAt(t.head).from)))},{key:"Ctrl-e",run:e=>B(e,(t=>n.EditorSelection.cursor(e.lineBlockAt(t.head).to,-1))),shift:e=>se(e,(t=>n.EditorSelection.cursor(e.lineBlockAt(t.head).to)))},{key:"Ctrl-d",run:Ae},{key:"Ctrl-h",run:Te},{key:"Ctrl-k",run:Ne},{key:"Ctrl-Alt-h",run:Ce},{key:"Ctrl-o",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:n.Text.of(["",""])},range:n.EditorSelection.cursor(e.from)})));return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange((t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let i=t.from,r=e.doc.lineAt(i),s=i==r.from?i-1:(0,n.findClusterBreak)(r.text,i-r.from,!1)+r.from,o=i==r.to?i+1:(0,n.findClusterBreak)(r.text,i-r.from,!0)+r.from;return{changes:{from:s,to:o,insert:e.doc.slice(i,o).append(e.doc.slice(s,i))},range:n.EditorSelection.cursor(o)}}));return!i.changes.empty&&(t(e.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:ee}].map((e=>({mac:e.key,run:e.run,shift:e.shift}))))),Be={key:"Tab",run:ke,shift:ze}})),r.register("4OqmY",(function(t,i){e(t.exports,"NodeProp",(()=>s));const n=1024;let r=0;class s{constructor(e={}){this.id=r++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=a.match(e)),t=>{let i=e(t);return void 0===i?null:[this,i]}}}s.closedBy=new s({deserialize:e=>e.split(" ")}),s.openedBy=new s({deserialize:e=>e.split(" ")}),s.group=new s({deserialize:e=>e.split(" ")}),s.contextHash=new s({perNode:!0}),s.lookAhead=new s({perNode:!0}),s.mounted=new s({perNode:!0});const o=Object.create(null);class a{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):o,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(null==e.name?8:0),n=new a(e.name||"",t,e.id,i);if(e.props)for(let i of e.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(s.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return e=>{for(let i=e.prop(s.group),n=-1;n<(i?i.length:0);n++){let r=t[n<0?e.name:i[n]];if(r)return r}}}}a.none=new a("",Object.create(null),0,8);const l=new WeakMap,h=new WeakMap;var c,u;(u=c||(c={}))[u.ExcludeBuffers=1]="ExcludeBuffers",u[u.IncludeAnonymous=2]="IncludeAnonymous",u[u.IgnoreMounts=4]="IgnoreMounts",u[u.IgnoreOverlays=8]="IgnoreOverlays";class d{constructor(e,t,i,n,r){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,r&&r.length){this.props=Object.create(null);for(let[e,t]of r)this.props["number"==typeof e?e:e.id]=t}}toString(){let e=this.prop(s.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let i=e.toString();i&&(t&&(t+=","),t+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new S(this.topNode,e)}cursorAt(e,t=0,i=0){let n=l.get(this)||this.topNode,r=new S(n);return r.moveTo(e,t),l.set(this,r._tree),r}get topNode(){return new x(this,0,0,null)}resolve(e,t=0){let i=v(l.get(this)||this.topNode,e,t,!1);return l.set(this,i),i}resolveInner(e,t=0){let i=v(h.get(this)||this.topNode,e,t,!0);return h.set(this,i),i}iterate(e){let{enter:t,leave:i,from:n=0,to:r=this.length}=e;for(let s=this.cursor((e.mode||0)|c.IncludeAnonymous);;){let e=!1;if(s.from<=r&&s.to>=n&&(s.type.isAnonymous||!1!==t(s))){if(s.firstChild())continue;e=!0}for(;e&&i&&!s.type.isAnonymous&&i(s),!s.nextSibling();){if(!s.parent())return;e=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:E(a.none,this.children,this.positions,0,this.children.length,0,this.length,((e,t,i)=>new d(this.type,e,t,i,this.propValues)),e.makeTree||((e,t,i)=>new d(a.none,e,t,i)))}static build(e){return function(e){var t;let{buffer:i,nodeSet:r,maxBufferLength:o=n,reused:a=[],minRepeatType:l=r.types.length}=e,h=Array.isArray(i)?new f(i,i.length):i,c=r.types,u=0,m=0;function g(e,t,i,n,s){let{id:d,start:f,end:M,size:S}=h,_=m;for(;S<0;){if(h.next(),-1==S){let t=a[d];return i.push(t),void n.push(f-e)}if(-3==S)return void(u=d);if(-4==S)return void(m=d);throw new RangeError(`Unrecognized record size: ${S}`)}let T,A,C=c[d],N=f-e;if(M-f<=o&&(A=b(h.pos-t,s))){let t=new Uint16Array(A.size-A.skip),i=h.pos-A.size,n=t.length;for(;h.pos>i;)n=w(A.start,t,n);T=new p(t,M-A.start,r),N=A.start-e}else{let e=h.pos-S;h.next();let t=[],i=[],n=d>=l?d:-1,r=0,s=M;for(;h.pos>e;)n>=0&&h.id==n&&h.size>=0?(h.end<=s-o&&(x(t,i,f,r,h.end,s,n,_),r=t.length,s=h.end),h.next()):g(f,e,t,i,n);if(n>=0&&r>0&&r<t.length&&x(t,i,f,r,f,s,n,_),t.reverse(),i.reverse(),n>-1&&r>0){let e=v(C);T=E(C,t,i,0,t.length,0,M-f,e,e)}else T=y(C,t,i,M-f,_-M)}i.push(T),n.push(N)}function v(e){return(t,i,n)=>{let r,o,a=0,l=t.length-1;if(l>=0&&(r=t[l])instanceof d){if(!l&&r.type==e&&r.length==n)return r;(o=r.prop(s.lookAhead))&&(a=i[l]+r.length+o)}return y(e,t,i,n,a)}}function x(e,t,i,n,s,o,a,l){let h=[],c=[];for(;e.length>n;)h.push(e.pop()),c.push(t.pop()+i-s);e.push(y(r.types[a],h,c,o-s,l-o)),t.push(s-i)}function y(e,t,i,n,r=0,o){if(u){let e=[s.contextHash,u];o=o?[e].concat(o):[e]}if(r>25){let e=[s.lookAhead,r];o=o?[e].concat(o):[e]}return new d(e,t,i,n,o)}function b(e,t){let i=h.fork(),n=0,r=0,s=0,a=i.end-o,c={size:0,start:0,skip:0};e:for(let o=i.pos-e;i.pos>o;){let e=i.size;if(i.id==t&&e>=0){c.size=n,c.start=r,c.skip=s,s+=4,n+=4,i.next();continue}let h=i.pos-e;if(e<0||h<o||i.start<a)break;let u=i.id>=l?4:0,d=i.start;for(i.next();i.pos>h;){if(i.size<0){if(-3!=i.size)break e;u+=4}else i.id>=l&&(u+=4);i.next()}r=d,n+=e,s+=u}return(t<0||n==e)&&(c.size=n,c.start=r,c.skip=s),c.size>4?c:void 0}function w(e,t,i){let{id:n,start:r,end:s,size:o}=h;if(h.next(),o>=0&&n<l){let a=i;if(o>4){let n=h.pos-(o-4);for(;h.pos>n;)i=w(e,t,i)}t[--i]=a,t[--i]=s-e,t[--i]=r-e,t[--i]=n}else-3==o?u=n:-4==o&&(m=n);return i}let M=[],S=[];for(;h.pos>0;)g(e.start||0,e.bufferStart||0,M,S,-1);let _=null!==(t=e.length)&&void 0!==t?t:M.length?S[0]+M[0].length:0;return new d(c[e.topID],M.reverse(),S.reverse(),_)}(e)}}d.empty=new d(a.none,[],[],0);class f{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new f(this.buffer,this.index)}}class p{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return a.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],r=n.name;if(/\W/.test(r)&&!n.isError&&(r=JSON.stringify(r)),i==(e+=4))return r;let s=[];for(;e<i;)s.push(this.childString(e)),e=this.buffer[e+3];return r+"("+s.join(",")+")"}findChild(e,t,i,n,r){let{buffer:s}=this,o=-1;for(let a=e;a!=t&&!(m(r,n,s[a+1],s[a+2])&&(o=a,i>0));a=s[a+3]);return o}slice(e,t,i,n){let r=this.buffer,s=new Uint16Array(t-e);for(let n=e,o=0;n<t;)s[o++]=r[n++],s[o++]=r[n++]-i,s[o++]=r[n++]-i,s[o++]=r[n++]-e;return new p(s,n-i,this.set)}}function m(e,t,i,n){switch(e){case-2:return i<t;case-1:return n>=t&&i<t;case 0:return i<t&&n>t;case 1:return i<=t&&n>t;case 2:return n>t;case 4:return!0}}function g(e,t){let i=e.childBefore(t);for(;i;){let t=i.lastChild;if(!t||t.to!=i.to)break;t.type.isError&&t.from==t.to?(e=i,i=t.prevSibling):i=t}return e}function v(e,t,i,n){for(var r;e.from==e.to||(i<1?e.from>=t:e.from>t)||(i>-1?e.to<=t:e.to<t);){let t=!n&&e instanceof x&&e.index<0?null:e.parent;if(!t)return e;e=t}let s=n?0:c.IgnoreOverlays;if(n)for(let n=e,o=n.parent;o;n=o,o=n.parent)n instanceof x&&n.index<0&&(null===(r=o.enter(t,i,s))||void 0===r?void 0:r.from)!=n.from&&(e=o);for(;;){let n=e.enter(t,i,s);if(!n)return e;e=n}}class x{constructor(e,t,i,n){this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,r=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,h=t>0?a.length:-1;e!=h;e+=t){let h=a[e],u=l[e]+o.from;if(m(n,i,u,u+h.length))if(h instanceof p){if(r&c.ExcludeBuffers)continue;let s=h.findChild(0,h.buffer.length,t,i-u,n);if(s>-1)return new M(new w(o,h,e,u),null,s)}else if(r&c.IncludeAnonymous||!h.type.isAnonymous||_(h)){let a;if(!(r&c.IgnoreMounts)&&h.props&&(a=h.prop(s.mounted))&&!a.overlay)return new x(a.tree,u,e,o);let l=new x(h,u,e,o);return r&c.IncludeAnonymous||!l.type.isAnonymous?l:l.nextChild(t<0?h.children.length-1:0,t,i,n)}}if(r&c.IncludeAnonymous||!o.type.isAnonymous)return null;if(e=o.index>=0?o.index+t:t<0?-1:o._parent._tree.children.length,o=o._parent,!o)return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let n;if(!(i&c.IgnoreOverlays)&&(n=this._tree.prop(s.mounted))&&n.overlay){let i=e-this.from;for(let{from:e,to:r}of n.overlay)if((t>0?e<=i:e<i)&&(t<0?r>=i:r>i))return new x(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new S(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return v(this,e,t,!1)}resolveInner(e,t=0){return v(this,e,t,!0)}enterUnfinishedNodesBefore(e){return g(this,e)}getChild(e,t=null,i=null){let n=y(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return y(this,e,t,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return b(this,e)}}function y(e,t,i,n){let r=e.cursor(),s=[];if(!r.firstChild())return s;if(null!=i)for(;!r.type.is(i);)if(!r.nextSibling())return s;for(;;){if(null!=n&&r.type.is(n))return s;if(r.type.is(t)&&s.push(r.node),!r.nextSibling())return null==n?s:[]}}function b(e,t,i=t.length-1){for(let n=e.parent;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[i]&&t[i]!=n.name)return!1;i--}}return!0}class w{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class M{constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,t,i){let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new M(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&c.ExcludeBuffers)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new M(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new M(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new M(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new S(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,r=i.buffer[this.index+3];if(r>n){let s=i.buffer[this.index+1],o=i.buffer[this.index+2];e.push(i.slice(n,r,s,o)),t.push(0)}return new d(this.type,e,t,this.to-this.from)}resolve(e,t=0){return v(this,e,t,!1)}resolveInner(e,t=0){return v(this,e,t,!0)}enterUnfinishedNodesBefore(e){return g(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let n=y(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return y(this,e,t,i)}get node(){return this}matchContext(e){return b(this,e)}}class S{constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof x)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof x?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?!(i&c.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&c.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&c.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let e=i<0?0:this.stack[i]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(e)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(n.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;({index:t,_parent:i}=i))if(t>-1)for(let n=t+e,r=e<0?-1:i._tree.children.length;n!=r;n+=e){let e=i._tree.children[n];if(this.mode&c.IncludeAnonymous||e instanceof p||!e.type.isAnonymous||_(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,r=this.stack.length;r>=0;){for(let s=e;s;s=s._parent)if(s.index==n){if(n==this.index)return s;t=s,i=r+1;break e}n=this.stack[--r]}for(let e=i;e<this.stack.length;e++)t=new M(this.buffer,t,this.stack[e]);return this.bufferNode=new M(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return b(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,r=this.stack.length-1;n>=0;r--){if(r<0)return b(this.node,e,n);let s=i[t.buffer[this.stack[r]]];if(!s.isAnonymous){if(e[n]&&e[n]!=s.name)return!1;n--}}return!0}}function _(e){return e.children.some((e=>e instanceof p||!e.type.isAnonymous||_(e)))}const T=new WeakMap;function A(e,t){if(!e.isAnonymous||t instanceof p||t.type!=e)return 1;let i=T.get(t);if(null==i){i=1;for(let n of t.children){if(n.type!=e||!(n instanceof d)){i=1;break}i+=A(e,n)}T.set(t,i)}return i}function E(e,t,i,n,r,s,o,a,l){let h=0;for(let i=n;i<r;i++)h+=A(e,t[i]);let c=Math.ceil(1.5*h/8),u=[],d=[];return function t(i,n,r,o,a){for(let h=r;h<o;){let r=h,f=n[h],p=A(e,i[h]);for(h++;h<o;h++){let t=A(e,i[h]);if(p+t>=c)break;p+=t}if(h==r+1){if(p>c){let e=i[r];t(e.children,e.positions,0,e.children.length,n[r]+a);continue}u.push(i[r])}else{let t=n[h-1]+i[h-1].length-f;u.push(E(e,i,n,r,h,f,t,null,l))}d.push(f+a-s)}}(t,i,n,r,0),(a||l)(u,d,o)}new s({perNode:!0})})),r.register("25IcZ",(function(t,i){e(t.exports,"highlightSelectionMatches",(()=>w)),e(t.exports,"searchKeymap",(()=>Z));var n=r("kLjcS"),s=r("eamNc"),o=r("abBgB");const a="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class l{constructor(e,t,i=0,n=e.length,r){this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,n),this.bufferStart=i,this.normalize=r?e=>r(a(e)):a,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return(0,s.codePointAt)(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=(0,s.fromCodePoint)(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=(0,s.codePointSize)(e);let n=this.normalize(t);for(let e=0,r=i;;e++){let s=n.charCodeAt(e),o=this.match(s,r);if(o)return this.value=o,this;if(e==n.length-1)break;r==i&&e<t.length&&t.charCodeAt(e)==s&&r++}}}match(e,t){let i=null;for(let n=0;n<this.matches.length;n+=2){let r=this.matches[n],s=!1;this.query.charCodeAt(r)==e&&(r==this.query.length-1?i={from:this.matches[n+1],to:t+1}:(this.matches[n]++,s=!0)),s||(this.matches.splice(n,2),n-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?i={from:t,to:t+1}:this.matches.push(1,t)),i}}"undefined"!=typeof Symbol&&(l.prototype[Symbol.iterator]=function(){return this});const h={from:-1,to:-1,match:/.*/.exec("")},c="gm"+(null==/x/.unicode?"":"u");class u{constructor(e,t,i,n=0,r=e.length){if(this.to=r,this.curLine="",this.done=!1,this.value=h,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new p(e,t,i,n,r);this.re=new RegExp(t,c+((null==i?void 0:i.ignoreCase)?"i":"")),this.iter=e.iter();let s=e.lineAt(n);this.curLineStart=s.from,this.matchPos=n,this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,n=i+t[0].length;if(this.matchPos=n+(i==n?1:0),i==this.curLine.length&&this.nextLine(),i<n||i>this.value.to)return this.value={from:i,to:n,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const d=new WeakMap;class f{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let n=d.get(e);if(!n||n.from>=i||n.to<=t){let n=new f(t,e.sliceString(t,i));return d.set(e,n),n}if(n.from==t&&n.to==i)return n;let{text:r,from:s}=n;return s>t&&(r=e.sliceString(t,s)+r,s=t),n.to<i&&(r+=e.sliceString(n.to,i)),d.set(e,new f(s,r)),new f(t,r.slice(t-s,i-s))}}class p{constructor(e,t,i,n,r){this.text=e,this.to=r,this.done=!1,this.value=h,this.matchPos=n,this.re=new RegExp(t,c+((null==i?void 0:i.ignoreCase)?"i":"")),this.flat=f.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10&&(t=null),t){let e=this.flat.from+t.index,i=e+t[0].length;return this.value={from:e,to:i,match:t},this.matchPos=i+(e==i?1:0),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=f.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function m(e){let t=(0,o.default)("input",{class:"cm-textfield",name:"line"});function i(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!i)return;let{state:n}=e,r=n.doc.lineAt(n.selection.main.head),[,o,a,l,h]=i,c=l?+l.slice(1):0,u=a?+a:r.number;if(a&&h){let e=u/100;o&&(e=e*("-"==o?-1:1)+r.number/n.doc.lines),u=Math.round(n.doc.lines*e)}else a&&o&&(u=u*("-"==o?-1:1)+r.number);let d=n.doc.line(Math.max(1,Math.min(n.doc.lines,u)));e.dispatch({effects:g.of(!1),selection:s.EditorSelection.cursor(d.from+Math.max(0,Math.min(c,d.length))),scrollIntoView:!0}),e.focus()}return{dom:(0,o.default)("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:g.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),i())},onsubmit:e=>{e.preventDefault(),i()}},(0,o.default)("label",e.state.phrase("Go to line"),": ",t)," ",(0,o.default)("button",{class:"cm-button",type:"submit"},e.state.phrase("go")))}}"undefined"!=typeof Symbol&&(u.prototype[Symbol.iterator]=p.prototype[Symbol.iterator]=function(){return this});const g=s.StateEffect.define(),v=s.StateField.define({create:()=>!0,update(e,t){for(let i of t.effects)i.is(g)&&(e=i.value);return e},provide:e=>n.showPanel.from(e,(e=>e?m:null))}),x=n.EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),y={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},b=s.Facet.define({combine:e=>(0,s.combineConfig)(e,y,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})});function w(e){let t=[A,T];return e&&t.push(b.of(e)),t}const M=n.Decoration.mark({class:"cm-selectionMatch"}),S=n.Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function _(e,t,i,n){return!(0!=i&&e(t.sliceDoc(i-1,i))==s.CharCategory.Word||n!=t.doc.length&&e(t.sliceDoc(n,n+1))==s.CharCategory.Word)}const T=n.ViewPlugin.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(b),{state:i}=e,r=i.selection;if(r.ranges.length>1)return n.Decoration.none;let o,a=r.main,h=null;if(a.empty){if(!t.highlightWordAroundCursor)return n.Decoration.none;let e=i.wordAt(a.head);if(!e)return n.Decoration.none;h=i.charCategorizer(a.head),o=i.sliceDoc(e.from,e.to)}else{let e=a.to-a.from;if(e<t.minSelectionLength||e>200)return n.Decoration.none;if(t.wholeWords){if(o=i.sliceDoc(a.from,a.to),h=i.charCategorizer(a.head),!_(h,i,a.from,a.to)||!function(e,t,i,n){return e(t.sliceDoc(i,i+1))==s.CharCategory.Word&&e(t.sliceDoc(n-1,n))==s.CharCategory.Word}(h,i,a.from,a.to))return n.Decoration.none}else if(o=i.sliceDoc(a.from,a.to).trim(),!o)return n.Decoration.none}let c=[];for(let r of e.visibleRanges){let e=new l(i.doc,o,r.from,r.to);for(;!e.next().done;){let{from:r,to:s}=e.value;if((!h||_(h,i,r,s))&&(a.empty&&r<=a.from&&s>=a.to?c.push(S.range(r,s)):(r>=a.to||s<=a.from)&&c.push(M.range(r,s)),c.length>t.maxMatches))return n.Decoration.none}}return n.Decoration.set(c)}},{decorations:e=>e.decorations}),A=n.EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});const E=s.Facet.define({combine(e){var t;return{top:e.reduce(((e,t)=>null!=e?e:t.top),void 0)||!1,caseSensitive:e.reduce(((e,t)=>null!=e?e:t.caseSensitive),void 0)||!1,createPanel:(null===(t=e.find((e=>e.createPanel)))||void 0===t?void 0:t.createPanel)||(e=>new $(e))}}});class C{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,c),!0}catch(e){return!1}}(this.search)),this.unquoted=e.literal?this.search:this.search.replace(/\\([nrt\\])/g,((e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp}create(){return this.regexp?new D(this):new R(this)}getCursor(e,t=0,i=e.length){return this.regexp?P(this,e,t,i):L(this,e,t,i)}}class N{constructor(e){this.spec=e}}function L(e,t,i,n){return new l(t,e.unquoted,i,n,e.caseSensitive?void 0:e=>e.toLowerCase())}class R extends N{constructor(e){super(e)}nextMatch(e,t,i){let n=L(this.spec,e,i,e.length).nextOverlapping();return n.done&&(n=L(this.spec,e,0,t).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=i;;){let i=Math.max(t,n-1e4-this.spec.unquoted.length),r=L(this.spec,e,i,n),s=null;for(;!r.nextOverlapping().done;)s=r.value;if(s)return s;if(i==t)return null;n-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace}matchAll(e,t){let i=L(this.spec,e,0,e.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let r=L(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}function P(e,t,i,n){return new u(t,e.search,e.caseSensitive?void 0:{ignoreCase:!0},i,n)}class D extends N{nextMatch(e,t,i){let n=P(this.spec,e,i,e.length).next();return n.done&&(n=P(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=1;;n++){let r=Math.max(t,i-1e4*n),s=P(this.spec,e,r,i),o=null;for(;!s.next().done;)o=s.value;if(o&&(r==t||o.from>r+10))return o;if(r==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.length)}getReplacement(e){return this.spec.replace.replace(/\$([$&\d+])/g,((t,i)=>"$"==i?"$":"&"==i?e.match[0]:"0"!=i&&+i<e.match.length?e.match[i]:t))}matchAll(e,t){let i=P(this.spec,e,0,e.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let r=P(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}const I=s.StateEffect.define(),O=s.StateEffect.define(),k=s.StateField.define({create:e=>new z(J(e).create(),null),update(e,t){for(let i of t.effects)i.is(I)?e=new z(i.value.create(),e.panel):i.is(O)&&(e=new z(e.query,i.value?q:null));return e},provide:e=>n.showPanel.from(e,(e=>e.panel))});class z{constructor(e,t){this.query=e,this.panel=t}}const F=n.Decoration.mark({class:"cm-searchMatch"}),B=n.Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),V=n.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(k))}update(e){let t=e.state.field(k);(t!=e.startState.field(k)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return n.Decoration.none;let{view:i}=this,r=new(0,s.RangeSetBuilder);for(let t=0,n=i.visibleRanges,s=n.length;t<s;t++){let{from:o,to:a}=n[t];for(;t<s-1&&a>n[t+1].from-500;)a=n[++t].to;e.highlight(i.state.doc,o,a,((e,t)=>{let n=i.state.selection.ranges.some((i=>i.from==e&&i.to==t));r.add(e,t,n?B:F)}))}return r.finish()}},{decorations:e=>e.decorations});function U(e){return t=>{let i=t.state.field(k,!1);return i&&i.query.spec.valid?e(t,i):K(t)}}const H=U(((e,{query:t})=>{let{from:i,to:n}=e.state.selection.main,r=t.nextMatch(e.state.doc,i,n);return!(!r||r.from==i&&r.to==n)&&(e.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0,effects:te(e,r),userEvent:"select.search"}),!0)})),G=U(((e,{query:t})=>{let{state:i}=e,{from:n,to:r}=i.selection.main,s=t.prevMatch(i.doc,n,r);return!!s&&(e.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:te(e,s),userEvent:"select.search"}),!0)})),W=U(((e,{query:t})=>{let i=t.matchAll(e.state.doc,1e3);return!(!i||!i.length)&&(e.dispatch({selection:s.EditorSelection.create(i.map((e=>s.EditorSelection.range(e.from,e.to)))),userEvent:"select.search.matches"}),!0)})),j=U(((e,{query:t})=>{let{state:i}=e,{from:r,to:s}=i.selection.main;if(i.readOnly)return!1;let o=t.nextMatch(i.doc,r,r);if(!o)return!1;let a,l,h=[],c=[];if(o.from==r&&o.to==s&&(l=i.toText(t.getReplacement(o)),h.push({from:o.from,to:o.to,insert:l}),o=t.nextMatch(i.doc,o.from,o.to),c.push(n.EditorView.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(r).number)+"."))),o){let t=0==h.length||h[0].from>=o.to?0:o.to-o.from-l.length;a={anchor:o.from-t,head:o.to-t},c.push(te(e,o))}return e.dispatch({changes:h,selection:a,scrollIntoView:!!a,effects:c,userEvent:"input.replace"}),!0})),X=U(((e,{query:t})=>{if(e.state.readOnly)return!1;let i=t.matchAll(e.state.doc,1e9).map((e=>{let{from:i,to:n}=e;return{from:i,to:n,insert:t.getReplacement(e)}}));if(!i.length)return!1;let r=e.state.phrase("replaced $ matches",i.length)+".";return e.dispatch({changes:i,effects:n.EditorView.announce.of(r),userEvent:"input.replace.all"}),!0}));function q(e){return e.state.facet(E).createPanel(e)}function J(e,t){var i;let n=e.selection.main,r=n.empty||n.to>n.from+100?"":e.sliceDoc(n.from,n.to),s=null!==(i=null==t?void 0:t.caseSensitive)&&void 0!==i?i:e.facet(E).caseSensitive;return t&&!r?t:new C({search:r.replace(/\n/g,"\\n"),caseSensitive:s})}const K=e=>{let t=e.state.field(k,!1);if(t&&t.panel){let i=(0,n.getPanel)(e,q);if(!i)return!1;let r=i.dom.querySelector("[main-field]");if(r&&r!=e.root.activeElement){let i=J(e.state,t.query.spec);i.valid&&e.dispatch({effects:I.of(i)}),r.focus(),r.select()}}else e.dispatch({effects:[O.of(!0),t?I.of(J(e.state,t.query.spec)):s.StateEffect.appendConfig.of(ne)]});return!0},Y=e=>{let t=e.state.field(k,!1);if(!t||!t.panel)return!1;let i=(0,n.getPanel)(e,q);return i&&i.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:O.of(!1)}),!0},Z=[{key:"Mod-f",run:K,scope:"editor search-panel"},{key:"F3",run:H,shift:G,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:H,shift:G,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Y,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:e,dispatch:t})=>{let i=e.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:r}=i.main,o=[],a=0;for(let t=new l(e.doc,e.sliceDoc(n,r));!t.next().done;){if(o.length>1e3)return!1;t.value.from==n&&(a=o.length),o.push(s.EditorSelection.range(t.value.from,t.value.to))}return t(e.update({selection:s.EditorSelection.create(o,a),userEvent:"select.search.matches"})),!0}},{key:"Alt-g",run:e=>{let t=(0,n.getPanel)(e,m);if(!t){let i=[g.of(!0)];null==e.state.field(v,!1)&&i.push(s.StateEffect.appendConfig.of([v,x])),e.dispatch({effects:i}),t=(0,n.getPanel)(e,m)}return t&&t.dom.querySelector("input").focus(),!0}},{key:"Mod-d",run:({state:e,dispatch:t})=>{let{ranges:i}=e.selection;if(i.some((e=>e.from===e.to)))return(({state:e,dispatch:t})=>{let{selection:i}=e,n=s.EditorSelection.create(i.ranges.map((t=>e.wordAt(t.head)||s.EditorSelection.cursor(t.head))),i.mainIndex);return!n.eq(i)&&(t(e.update({selection:n})),!0)})({state:e,dispatch:t});let r=e.sliceDoc(i[0].from,i[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=r)))return!1;let o=function(e,t){let{main:i,ranges:n}=e.selection,r=e.wordAt(i.head),s=r&&r.from==i.from&&r.to==i.to;for(let i=!1,r=new l(e.doc,t,n[n.length-1].to);;){if(r.next(),!r.done){if(i&&n.some((e=>e.from==r.value.from)))continue;if(s){let t=e.wordAt(r.value.from);if(!t||t.from!=r.value.from||t.to!=r.value.to)continue}return r.value}if(i)return null;r=new l(e.doc,t,0,Math.max(0,n[n.length-1].from-1)),i=!0}}(e,r);return!!o&&(t(e.update({selection:e.selection.addRange(s.EditorSelection.range(o.from,o.to),!1),effects:n.EditorView.scrollIntoView(o.to)})),!0)},preventDefault:!0}];class ${constructor(e){this.view=e;let t=this.query=e.state.field(k).query.spec;function i(e,t,i){return(0,o.default)("button",{class:"cm-button",name:e,onclick:t,type:"button"},i)}this.commit=this.commit.bind(this),this.searchField=(0,o.default)("input",{value:t.search,placeholder:Q(e,"Find"),"aria-label":Q(e,"Find"),class:"cm-textfield",name:"search","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=(0,o.default)("input",{value:t.replace,placeholder:Q(e,"Replace"),"aria-label":Q(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit}),this.caseField=(0,o.default)("input",{type:"checkbox",name:"case",checked:t.caseSensitive,onchange:this.commit}),this.reField=(0,o.default)("input",{type:"checkbox",name:"re",checked:t.regexp,onchange:this.commit}),this.dom=(0,o.default)("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,i("next",(()=>H(e)),[Q(e,"next")]),i("prev",(()=>G(e)),[Q(e,"previous")]),i("select",(()=>W(e)),[Q(e,"all")]),(0,o.default)("label",null,[this.caseField,Q(e,"match case")]),(0,o.default)("label",null,[this.reField,Q(e,"regexp")]),...e.state.readOnly?[]:[(0,o.default)("br"),this.replaceField,i("replace",(()=>j(e)),[Q(e,"replace")]),i("replaceAll",(()=>X(e)),[Q(e,"replace all")]),(0,o.default)("button",{name:"close",onclick:()=>Y(e),"aria-label":Q(e,"close"),type:"button"},["×"])]])}commit(){let e=new C({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:I.of(e)}))}keydown(e){(0,n.runScopeHandlers)(this.view,e,"search-panel")?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?G:H)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),j(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(I)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(E).top}}function Q(e,t){return e.state.phrase(t)}const ee=/[\s\.,:;?!]/;function te(e,{from:t,to:i}){let r=e.state.doc.lineAt(t),s=e.state.doc.lineAt(i).to,o=Math.max(r.from,t-30),a=Math.min(s,i+30),l=e.state.sliceDoc(o,a);if(o!=r.from)for(let e=0;e<30;e++)if(!ee.test(l[e+1])&&ee.test(l[e])){l=l.slice(e);break}if(a!=s)for(let e=l.length-1;e>l.length-30;e--)if(!ee.test(l[e-1])&&ee.test(l[e])){l=l.slice(0,e);break}return n.EditorView.announce.of(`${e.state.phrase("current match")}. ${l} ${e.state.phrase("on line")} ${r.number}.`)}const ie=n.EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),ne=[k,s.Prec.lowest(V),ie]})),r.register("abBgB",(function(t,i){function n(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,i=arguments[1];if(i&&"object"==typeof i&&null==i.nodeType&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];"string"==typeof s?e.setAttribute(n,s):null!=s&&(e[n]=s)}t++}for(;t<arguments.length;t++)r(e,arguments[t]);return e}function r(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var i=0;i<t.length;i++)r(e,t[i])}}e(t.exports,"default",(()=>n))})),r.register("c5pvf",(function(t,i){e(t.exports,"closeBrackets",(()=>W)),e(t.exports,"closeBracketsKeymap",(()=>Y)),e(t.exports,"autocompletion",(()=>ne)),e(t.exports,"completionKeymap",(()=>re));var n=r("eamNc"),s=r("kLjcS"),o=r("H1dsR");class a{constructor(e,t,i){this.state=e,this.pos=t,this.explicit=i,this.abortListeners=[]}tokenBefore(e){let t=(0,o.syntaxTree)(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),n=t.text.slice(i-t.from,this.pos-t.from),r=n.search(d(e,!1));return r<0?null:{from:i+r,to:this.pos,text:n.slice(r)}}get aborted(){return null==this.abortListeners}addEventListener(e,t){"abort"==e&&this.abortListeners&&this.abortListeners.push(t)}}function l(e){let t=Object.keys(e).join(""),i=/\w/.test(t);return i&&(t=t.replace(/\w/g,"")),`[${i?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function h(e){let t=e.map((e=>"string"==typeof e?{label:e}:e)),[i,n]=t.every((e=>/^\w+$/.test(e.label)))?[/\w*$/,/\w+$/]:function(e){let t=Object.create(null),i=Object.create(null);for(let{label:n}of e){t[n[0]]=!0;for(let e=1;e<n.length;e++)i[n[e]]=!0}let n=l(t)+l(i)+"*$";return[new RegExp("^"+n),new RegExp(n)]}(t);return e=>{let r=e.matchBefore(n);return r||e.explicit?{from:r?r.from:e.pos,options:t,validFor:i}:null}}class c{constructor(e,t,i){this.completion=e,this.source=t,this.match=i}}function u(e){return e.selection.main.head}function d(e,t){var i;let{source:n}=e,r=t&&"^"!=n[0],s="$"!=n[n.length-1];return r||s?new RegExp(`${r?"^":""}(?:${n})${s?"$":""}`,null!==(i=e.flags)&&void 0!==i?i:e.ignoreCase?"i":""):e}function f(e,t){const i=t.completion.apply||t.completion.label;let r=t.source;var s,o,a,l;"string"==typeof i?e.dispatch((s=e.state,o=i,a=r.from,l=r.to,Object.assign(Object.assign({},s.changeByRange((e=>{if(e==s.selection.main)return{changes:{from:a,to:l,insert:o},range:n.EditorSelection.cursor(a+o.length)};let t=l-a;return!e.empty||t&&s.sliceDoc(e.from-t,e.from)!=s.sliceDoc(a,l)?{range:e}:{changes:{from:e.from-t,to:e.from,insert:o},range:n.EditorSelection.cursor(e.from-t+o.length)}}))),{userEvent:"input.complete"}))):i(e,t.completion,r.from,r.to)}const p=new WeakMap;function m(e){if(!Array.isArray(e))return e;let t=p.get(e);return t||p.set(e,t=h(e)),t}class g{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let t=0;t<e.length;){let i=(0,n.codePointAt)(e,t),r=(0,n.codePointSize)(i);this.chars.push(i);let s=e.slice(t,t+r),o=s.toUpperCase();this.folded.push((0,n.codePointAt)(o==s?s.toLowerCase():o,0)),t+=r}this.astral=e.length!=this.chars.length}match(e){if(0==this.pattern.length)return[0];if(e.length<this.pattern.length)return null;let{chars:t,folded:i,any:r,precise:s,byWord:o}=this;if(1==t.length){let r=(0,n.codePointAt)(e,0);return r==t[0]?[0,0,(0,n.codePointSize)(r)]:r==i[0]?[-200,0,(0,n.codePointSize)(r)]:null}let a=e.indexOf(this.pattern);if(0==a)return[0,0,this.pattern.length];let l=t.length,h=0;if(a<0){for(let s=0,o=Math.min(e.length,200);s<o&&h<l;){let o=(0,n.codePointAt)(e,s);o!=t[h]&&o!=i[h]||(r[h++]=s),s+=(0,n.codePointSize)(o)}if(h<l)return null}let c=0,u=0,d=!1,f=0,p=-1,m=-1,g=/[a-z]/.test(e),v=!0;for(let r=0,h=Math.min(e.length,200),x=0;r<h&&u<l;){let h=(0,n.codePointAt)(e,r);a<0&&(c<l&&h==t[c]&&(s[c++]=r),f<l&&(h==t[f]||h==i[f]?(0==f&&(p=r),m=r+1,f++):f=0));let y,b=h<255?h>=48&&h<=57||h>=97&&h<=122?2:h>=65&&h<=90?1:0:(y=(0,n.fromCodePoint)(h))!=y.toLowerCase()?1:y!=y.toUpperCase()?2:0;(!r||1==b&&g||0==x&&0!=b)&&(t[u]==h||i[u]==h&&(d=!0)?o[u++]=r:o.length&&(v=!1)),x=b,r+=(0,n.codePointSize)(h)}return u==l&&0==o[0]&&v?this.result((d?-200:0)-100,o,e):f==l&&0==p?[-200-e.length,0,m]:a>-1?[-700-e.length,a,a+this.pattern.length]:f==l?[-900-e.length,p,m]:u==l?this.result((d?-200:0)-100-700+(v?0:-1100),o,e):2==t.length?null:this.result((r[0]?-700:0)-200-1100,r,e)}result(e,t,i){let r=[e-i.length],s=1;for(let e of t){let t=e+(this.astral?(0,n.codePointSize)((0,n.codePointAt)(i,e)):1);s>1&&r[s-1]==e?r[s-1]=t:(r[s++]=e,r[s++]=t)}return r}}const v=n.Facet.define({combine:e=>(0,n.combineConfig)(e,{activateOnTyping:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[]},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,optionClass:(e,t)=>i=>function(e,t){return e?t?e+" "+t:e:t}(e(i),t(i)),addToOptions:(e,t)=>e.concat(t)})});function x(e,t,i){if(e<=i)return{from:0,to:e};if(t<=e>>1){let e=Math.floor(t/i);return{from:e*i,to:(e+1)*i}}let n=Math.floor((e-t)/i);return{from:e-(n+1)*i,to:e-n*i}}class y{constructor(e,t){this.view=e,this.stateField=t,this.info=null,this.placeInfo={read:()=>this.measureInfo(),write:e=>this.positionInfo(e),key:this};let i=e.state.field(t),{options:n,selected:r}=i.open,s=e.state.facet(v);this.optionContent=function(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map((e=>"cm-completionIcon-"+e))),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,i){let n=document.createElement("span");n.className="cm-completionLabel";let{label:r}=e,s=0;for(let e=1;e<i.length;){let t=i[e++],o=i[e++];t>s&&n.appendChild(document.createTextNode(r.slice(s,t)));let a=n.appendChild(document.createElement("span"));a.appendChild(document.createTextNode(r.slice(t,o))),a.className="cm-completionMatchedText",s=o}return s<r.length&&n.appendChild(document.createTextNode(r.slice(s))),n},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort(((e,t)=>e.position-t.position)).map((e=>e.render))}(s),this.optionClass=s.optionClass,this.range=x(n.length,r,s.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.dom.addEventListener("mousedown",(t=>{for(let i,r=t.target;r&&r!=this.dom;r=r.parentNode)if("LI"==r.nodeName&&(i=/-(\d+)$/.exec(r.id))&&+i[1]<n.length)return f(e,n[+i[1]]),void t.preventDefault()})),this.list=this.dom.appendChild(this.createListBox(n,i.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))}mount(){this.updateSel()}update(e){e.state.field(this.stateField)!=e.startState.field(this.stateField)&&this.updateSel()}positioned(){this.info&&this.view.requestMeasure(this.placeInfo)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=x(t.options.length,t.selected,this.view.state.facet(v).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t.options,e.id,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfo)}))),this.updateSelectedOption(t.selected)){this.info&&(this.info.remove(),this.info=null);let{completion:i}=t.options[t.selected],{info:n}=i;if(!n)return;let r="string"==typeof n?document.createTextNode(n):n(i);if(!r)return;"then"in r?r.then((t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t)})).catch((e=>(0,s.logException)(this.view.state,e,"completion info"))):this.addInfoPane(r)}}addInfoPane(e){let t=this.info=document.createElement("div");t.className="cm-tooltip cm-completionInfo",t.appendChild(e),this.dom.appendChild(t),this.view.requestMeasure(this.placeInfo)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)n==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&function(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect();n.top<i.top?e.scrollTop-=i.top-n.top:n.bottom>i.bottom&&(e.scrollTop+=n.bottom-i.bottom)}(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=e.getBoundingClientRect();if(n.top>Math.min(innerHeight,t.bottom)-10||n.bottom<Math.max(0,t.top)+10)return null;let r=Math.max(0,Math.min(n.top,innerHeight-i.height))-t.top,o=this.view.textDirection==s.Direction.RTL,a=t.left,l=innerWidth-t.right;return o&&a<Math.min(i.width,l)?o=!1:!o&&l<Math.min(i.width,a)&&(o=!0),{top:r,left:o}}positionInfo(e){this.info&&(this.info.style.top=(e?e.top:-1e6)+"px",e&&(this.info.classList.toggle("cm-completionInfo-left",e.left),this.info.classList.toggle("cm-completionInfo-right",!e.left)))}createListBox(e,t,i){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));for(let r=i.from;r<i.to;r++){let{completion:i,match:s}=e[r];const o=n.appendChild(document.createElement("li"));o.id=t+"-"+r,o.setAttribute("role","option");let a=this.optionClass(i);a&&(o.className=a);for(let e of this.optionContent){let t=e(i,this.view.state,s);t&&o.appendChild(t)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}}function b(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}class w{constructor(e,t,i,n,r){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=n,this.selected=r}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new w(this.options,_(t,e),this.tooltip,this.timestamp,e)}static build(e,t,i,n,r){let s=function(e,t){let i=[],n=0;for(let r of e)if(r.hasResult())if(!1===r.result.filter){let e=r.result.getMatch;for(let t of r.result.options){let s=[1e9-n++];if(e)for(let i of e(t))s.push(i);i.push(new c(t,r,s))}}else{let e,n=new g(t.sliceDoc(r.from,r.to));for(let t of r.result.options)(e=n.match(t.label))&&(null!=t.boost&&(e[0]+=t.boost),i.push(new c(t,r,e)))}let r=[],s=null;for(let e of i.sort(A))!s||s.label!=e.completion.label||s.detail!=e.completion.detail||null!=s.type&&null!=e.completion.type&&s.type!=e.completion.type||s.apply!=e.completion.apply?r.push(e):b(e.completion)>b(s)&&(r[r.length-1]=e),s=e.completion;return r}(e,t);if(!s.length)return null;let o=0;if(n&&n.selected){let e=n.options[n.selected].completion;for(let t=0;t<s.length;t++)if(s[t].completion==e){o=t;break}}return new w(s,_(i,o),{pos:e.reduce(((e,t)=>t.hasResult()?Math.min(e,t.from):e),1e8),create:(a=I,e=>new y(e,a)),above:r.aboveCursor},n?n.timestamp:Date.now(),o);var a}map(e){return new w(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)}}class M{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new M(T,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,i=t.facet(v),n=(i.override||t.languageDataAt("autocomplete",u(t)).map(m)).map((t=>(this.active.find((e=>e.source==t))||new C(t,this.active.some((e=>0!=e.state))?1:0)).update(e,i)));n.length==this.active.length&&n.every(((e,t)=>e==this.active[t]))&&(n=this.active);let r=e.selection||n.some((t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to)))||!function(e,t){if(e==t)return!0;for(let i=0,n=0;;){for(;i<e.length&&!e[i].hasResult;)i++;for(;n<t.length&&!t[n].hasResult;)n++;let r=i==e.length,s=n==t.length;if(r||s)return r==s;if(e[i++].result!=t[n++].result)return!1}}(n,this.active)?w.build(n,t,this.id,this.open,i):this.open&&e.docChanged?this.open.map(e.changes):this.open;!r&&n.every((e=>1!=e.state))&&n.some((e=>e.hasResult()))&&(n=n.map((e=>e.hasResult()?new C(e.source,0):e)));for(let t of e.effects)t.is(D)&&(r=r&&r.setSelected(t.value,this.id));return n==this.active&&r==this.open?this:new M(n,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:S}}const S={"aria-autocomplete":"list"};function _(e,t){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":e+"-"+t,"aria-controls":e}}const T=[];function A(e,t){let i=t.match[0]-e.match[0];return i||e.completion.label.localeCompare(t.completion.label)}function E(e){return e.isUserEvent("input.type")?"input":e.isUserEvent("delete.backward")?"delete":null}class C{constructor(e,t,i=-1){this.source=e,this.state=t,this.explicitPos=i}hasResult(){return!1}update(e,t){let i=E(e),n=this;i?n=n.handleUserEvent(e,i,t):e.docChanged?n=n.handleChange(e):e.selection&&0!=n.state&&(n=new C(n.source,0));for(let t of e.effects)if(t.is(L))n=new C(n.source,1,t.value?u(e.state):-1);else if(t.is(R))n=new C(n.source,0);else if(t.is(P))for(let e of t.value)e.source==n.source&&(n=e);return n}handleUserEvent(e,t,i){return"delete"!=t&&i.activateOnTyping?new C(this.source,1):this.map(e.changes)}handleChange(e){return e.changes.touchesRange(u(e.startState))?new C(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new C(this.source,this.state,e.mapPos(this.explicitPos))}}class N extends C{constructor(e,t,i,n,r){super(e,2,t),this.result=i,this.from=n,this.to=r}hasResult(){return!0}handleUserEvent(e,t,i){var n;let r=e.changes.mapPos(this.from),s=e.changes.mapPos(this.to,1),o=u(e.state);if((this.explicitPos<0?o<=r:o<this.from)||o>s||"delete"==t&&u(e.startState)==this.from)return new C(this.source,"input"==t&&i.activateOnTyping?1:0);let l,h=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return function(e,t,i,n){if(!e)return!1;let r=t.sliceDoc(i,n);return"function"==typeof e?e(r,i,n,t):d(e,!0).test(r)}(this.result.validFor,e.state,r,s)?new N(this.source,h,this.result,r,s):this.result.update&&(l=this.result.update(this.result,r,s,new a(e.state,o,h>=0)))?new N(this.source,h,l,l.from,null!==(n=l.to)&&void 0!==n?n:u(e.state)):new C(this.source,1,h)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new C(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new N(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}const L=n.StateEffect.define(),R=n.StateEffect.define(),P=n.StateEffect.define({map:(e,t)=>e.map((e=>e.map(t)))}),D=n.StateEffect.define(),I=n.StateField.define({create:()=>M.start(),update:(e,t)=>e.update(t),provide:e=>[s.showTooltip.from(e,(e=>e.tooltip)),s.EditorView.contentAttributes.from(e,(e=>e.attrs))]});function O(e,t="option"){return i=>{let n=i.state.field(I,!1);if(!n||!n.open||Date.now()-n.open.timestamp<75)return!1;let r,o=1;"page"==t&&(r=(0,s.getTooltip)(i,n.open.tooltip))&&(o=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let a=n.open.selected+o*(e?1:-1),{length:l}=n.open.options;return a<0?a="page"==t?0:l-1:a>=l&&(a="page"==t?l-1:0),i.dispatch({effects:D.of(a)}),!0}}class k{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const z=s.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let t of e.state.field(I).active)1==t.state&&this.startQuery(t)}update(e){let t=e.state.field(I);if(!e.selectionSet&&!e.docChanged&&e.startState.field(I)==t)return;let i=e.transactions.some((e=>(e.selection||e.docChanged)&&!E(e)));for(let t=0;t<this.running.length;t++){let n=this.running[t];if(i||n.updates.length+e.transactions.length>50&&Date.now()-n.time>1e3){for(let e of n.context.abortListeners)try{e()}catch(e){(0,s.logException)(this.view.state,e)}n.context.abortListeners=null,this.running.splice(t--,1)}else n.updates.push(...e.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=t.active.some((e=>1==e.state&&!this.running.some((t=>t.active.source==e.source))))?setTimeout((()=>this.startUpdate()),50):-1,0!=this.composing)for(let t of e.transactions)"input"==E(t)?this.composing=2:2==this.composing&&t.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:e}=this.view,t=e.field(I);for(let e of t.active)1!=e.state||this.running.some((t=>t.active.source==e.source))||this.startQuery(e)}startQuery(e){let{state:t}=this.view,i=u(t),n=new a(t,i,e.explicitPos==i),r=new k(e,n);this.running.push(r),Promise.resolve(e.source(n)).then((e=>{r.context.aborted||(r.done=e||null,this.scheduleAccept())}),(e=>{this.view.dispatch({effects:R.of(null)}),(0,s.logException)(this.view.state,e)}))}scheduleAccept(){this.running.every((e=>void 0!==e.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),50))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],i=this.view.state.facet(v);for(let n=0;n<this.running.length;n++){let r=this.running[n];if(void 0===r.done)continue;if(this.running.splice(n--,1),r.done){let n=new N(r.active.source,r.active.explicitPos,r.done,r.done.from,null!==(e=r.done.to)&&void 0!==e?e:u(r.updates.length?r.updates[0].startState:this.view.state));for(let e of r.updates)n=n.update(e,i);if(n.hasResult()){t.push(n);continue}}let s=this.view.state.field(I).active.find((e=>e.source==r.active.source));if(s&&1==s.state)if(null==r.done){let e=new C(r.active.source,0);for(let t of r.updates)e=e.update(t,i);1!=e.state&&t.push(e)}else this.startQuery(s)}t.length&&this.view.dispatch({effects:P.of(t)})}},{eventHandlers:{blur(){let e=this.view.state.field(I,!1);e&&e.tooltip&&this.view.state.facet(v).closeOnBlur&&this.view.dispatch({effects:R.of(null)})},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:L.of(!1)})),20),this.composing=0}}}),F=s.EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});const B={brackets:["(","[","{","'",'"'],before:")]}:;>"},V=n.StateEffect.define({map(e,t){let i=t.mapPos(e,-1,n.MapMode.TrackAfter);return null==i?void 0:i}}),U=n.StateEffect.define({map:(e,t)=>t.mapPos(e)}),H=new class extends n.RangeValue{};H.startSide=1,H.endSide=-1;const G=n.StateField.define({create:()=>n.RangeSet.empty,update(e,t){if(t.selection){let i=t.state.doc.lineAt(t.selection.main.head).from,r=t.startState.doc.lineAt(t.startState.selection.main.head).from;i!=t.changes.mapPos(r,-1)&&(e=n.RangeSet.empty)}e=e.map(t.changes);for(let i of t.effects)i.is(V)?e=e.update({add:[H.range(i.value,i.value+1)]}):i.is(U)&&(e=e.update({filter:e=>e!=i.value}));return e}});function W(){return[K,G]}const j="()[]{}<>";function X(e){for(let t=0;t<j.length;t+=2)if(j.charCodeAt(t)==e)return j.charAt(t+1);return(0,n.fromCodePoint)(e<128?e:e+1)}function q(e,t){return e.languageDataAt("closeBrackets",t)[0]||B}const J="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),K=s.EditorView.inputHandler.of(((e,t,i,r)=>{if((J?e.composing:e.compositionStarted)||e.state.readOnly)return!1;let s=e.state.selection.main;if(r.length>2||2==r.length&&1==(0,n.codePointSize)((0,n.codePointAt)(r,0))||t!=s.from||i!=s.to)return!1;let o=function(e,t){let i=q(e,e.selection.main.head),r=i.brackets||B.brackets;for(let s of r){let o=X((0,n.codePointAt)(s,0));if(t==s)return o==s?te(e,s,r.indexOf(s+s+s)>-1):Q(e,s,o,i.before||B.before);if(t==o&&Z(e,e.selection.main.from))return ee(e,s,o)}return null}(e.state,r);return!!o&&(e.dispatch(o),!0)})),Y=[{key:"Backspace",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=q(e,e.selection.main.head).brackets||B.brackets,r=null,s=e.changeByRange((t=>{if(t.empty){let r=function(e,t){let i=e.sliceString(t-2,t);return(0,n.codePointSize)((0,n.codePointAt)(i,0))==i.length?i:i.slice(1)}(e.doc,t.head);for(let s of i)if(s==r&&$(e.doc,t.head)==X((0,n.codePointAt)(s,0)))return{changes:{from:t.head-s.length,to:t.head+s.length},range:n.EditorSelection.cursor(t.head-s.length),userEvent:"delete.backward"}}return{range:r=t}}));return r||t(e.update(s,{scrollIntoView:!0})),!r}}];function Z(e,t){let i=!1;return e.field(G).between(0,e.doc.length,(e=>{e==t&&(i=!0)})),i}function $(e,t){let i=e.sliceString(t,t+2);return i.slice(0,(0,n.codePointSize)((0,n.codePointAt)(i,0)))}function Q(e,t,i,r){let s=null,o=e.changeByRange((o=>{if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:i,from:o.to}],effects:V.of(o.to+t.length),range:n.EditorSelection.range(o.anchor+t.length,o.head+t.length)};let a=$(e.doc,o.head);return!a||/\s/.test(a)||r.indexOf(a)>-1?{changes:{insert:t+i,from:o.head},effects:V.of(o.head+t.length),range:n.EditorSelection.cursor(o.head+t.length)}:{range:s=o}}));return s?null:e.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function ee(e,t,i){let r=null,s=e.selection.ranges.map((t=>t.empty&&$(e.doc,t.head)==i?n.EditorSelection.cursor(t.head+i.length):r=t));return r?null:e.update({selection:n.EditorSelection.create(s,e.selection.mainIndex),scrollIntoView:!0,effects:e.selection.ranges.map((({from:e})=>U.of(e)))})}function te(e,t,i){let r=null,s=e.changeByRange((s=>{if(!s.empty)return{changes:[{insert:t,from:s.from},{insert:t,from:s.to}],effects:V.of(s.to+t.length),range:n.EditorSelection.range(s.anchor+t.length,s.head+t.length)};let a=s.head,l=$(e.doc,a);if(l==t){if(ie(e,a))return{changes:{insert:t+t,from:a},effects:V.of(a+t.length),range:n.EditorSelection.cursor(a+t.length)};if(Z(e,a)){let r=i&&e.sliceDoc(a,a+3*t.length)==t+t+t;return{range:n.EditorSelection.cursor(a+t.length*(r?3:1)),effects:U.of(a)}}}else{if(i&&e.sliceDoc(a-2*t.length,a)==t+t&&ie(e,a-2*t.length))return{changes:{insert:t+t+t+t,from:a},effects:V.of(a+t.length),range:n.EditorSelection.cursor(a+t.length)};if(e.charCategorizer(a)(l)!=n.CharCategory.Word){let i=e.sliceDoc(a-1,a);if(i!=t&&e.charCategorizer(a)(i)!=n.CharCategory.Word&&!function(e,t,i){console.log("check pos",t);let n=(0,o.syntaxTree)(e).resolveInner(t,-1);for(let r=0;r<5;r++){if(e.sliceDoc(n.from,n.from+i.length)==i){let t=n.firstChild;for(;t&&t.from==n.from&&t.to-t.from>i.length;){if(e.sliceDoc(t.to-i.length,t.to)==i)return!1;t=t.firstChild}return!0}let r=n.to==t&&n.parent;if(!r)break;n=r}return!1}(e,a,t))return{changes:{insert:t+t,from:a},effects:V.of(a+t.length),range:n.EditorSelection.cursor(a+t.length)}}}return{range:r=s}}));return r?null:e.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function ie(e,t){let i=(0,o.syntaxTree)(e).resolveInner(t+1);return i.parent&&i.from==t}function ne(e={}){return[I,v.of(e),z,se,F]}const re=[{key:"Ctrl-Space",run:e=>!!e.state.field(I,!1)&&(e.dispatch({effects:L.of(!0)}),!0)},{key:"Escape",run:e=>{let t=e.state.field(I,!1);return!(!t||!t.active.some((e=>0!=e.state)))&&(e.dispatch({effects:R.of(null)}),!0)}},{key:"ArrowDown",run:O(!0)},{key:"ArrowUp",run:O(!1)},{key:"PageDown",run:O(!0,"page")},{key:"PageUp",run:O(!1,"page")},{key:"Enter",run:e=>{let t=e.state.field(I,!1);return!(e.state.readOnly||!t||!t.open||Date.now()-t.open.timestamp<75)&&(f(e,t.open.options[t.open.selected]),!0)}}],se=n.Prec.highest(s.keymap.computeN([v],(e=>e.facet(v).defaultKeymap?[re]:[])))})),r.register("38OKk",(function(t,i){e(t.exports,"lintKeymap",(()=>b));var n=r("kLjcS"),s=r("eamNc"),o=r("abBgB");class a{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class l{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let r=e,s=i.facet(M).markerFilter;s&&(r=s(r));let o=n.Decoration.set(r.map((e=>e.from==e.to||e.from==e.to-1&&i.doc.lineAt(e.from).to==e.from?n.Decoration.widget({widget:new T(e),diagnostic:e}).range(e.from):n.Decoration.mark({attributes:{class:"cm-lintRange cm-lintRange-"+e.severity},diagnostic:e}).range(e.from,e.to))),!0);return new l(o,t,h(o))}}function h(e,t=null,i=0){let n=null;return e.between(i,1e9,((e,i,{spec:r})=>{if(!t||r.diagnostic==t)return n=new a(e,i,r.diagnostic),!1})),n}function c(e,t){return!(!e.effects.some((e=>e.is(d)))&&!e.changes.touchesRange(t.pos))}function u(e,t){return e.field(m,!1)?t:t.concat(s.StateEffect.appendConfig.of([m,n.EditorView.decorations.compute([m],(e=>{let{selected:t,panel:i}=e.field(m);return t&&i&&t.from!=t.to?n.Decoration.set([g.range(t.from,t.to)]):n.Decoration.none})),(0,n.hoverTooltip)(v,{hideOn:c}),L]))}const d=s.StateEffect.define(),f=s.StateEffect.define(),p=s.StateEffect.define(),m=s.StateField.define({create:()=>new l(n.Decoration.none,null,null),update(e,t){if(t.docChanged){let i=e.diagnostics.map(t.changes),n=null;if(e.selected){let r=t.changes.mapPos(e.selected.from,1);n=h(i,e.selected.diagnostic,r)||h(i,null,r)}e=new l(i,e.panel,n)}for(let i of t.effects)i.is(d)?e=l.init(i.value,e.panel,t.state):i.is(f)?e=new l(e.diagnostics,i.value?E.open:null,e.selected):i.is(p)&&(e=new l(e.diagnostics,e.panel,i.value));return e},provide:e=>[n.showPanel.from(e,(e=>e.panel)),n.EditorView.decorations.from(e,(e=>e.diagnostics))]});const g=n.Decoration.mark({class:"cm-lintRange cm-lintRange-active"});function v(e,t,i){let{diagnostics:n}=e.state.field(m),r=[],s=2e8,o=0;n.between(t-(i<0?1:0),t+(i>0?1:0),((e,n,{spec:a})=>{t>=e&&t<=n&&(e==n||(t>e||i>0)&&(t<n||i<0))&&(r.push(a.diagnostic),s=Math.min(e,s),o=Math.max(n,o))}));let a=e.state.facet(M).tooltipFilter;return a&&(r=a(r)),r.length?{pos:s,end:o,above:e.state.doc.lineAt(s).to<o,create:()=>({dom:x(e,r)})}:null}function x(e,t){return(0,o.default)("ul",{class:"cm-tooltip-lint"},t.map((t=>_(e,t,!1))))}const y=e=>{let t=e.state.field(m,!1);return!(!t||!t.panel)&&(e.dispatch({effects:f.of(!1)}),!0)},b=[{key:"Mod-Shift-m",run:e=>{let t=e.state.field(m,!1);t&&t.panel||e.dispatch({effects:u(e.state,[f.of(!0)])});let i=(0,n.getPanel)(e,E.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0}},{key:"F8",run:e=>{let t=e.state.field(m,!1);if(!t)return!1;let i=e.state.selection.main,n=t.diagnostics.iter(i.to+1);return!(!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to))&&(e.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)}}],w=n.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.timeout=-1,this.set=!0;let{delay:t}=e.state.facet(M);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){let e=Date.now();if(e<this.lintTime-10)setTimeout(this.run,this.lintTime-e);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(M);Promise.all(t.map((e=>Promise.resolve(e(this.view))))).then((t=>{let i=t.reduce(((e,t)=>e.concat(t)));this.view.state.doc==e.doc&&this.view.dispatch(function(e,t){return{effects:u(e,[d.of(t)])}}(this.view.state,i))}),(e=>{(0,n.logException)(this.view.state,e)}))}}update(e){let t=e.state.facet(M);(e.docChanged||t!=e.startState.facet(M))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),M=s.Facet.define({combine:e=>Object.assign({sources:e.map((e=>e.source))},(0,s.combineConfig)(e.map((e=>e.config)),{delay:750,markerFilter:null,tooltipFilter:null})),enables:w});function S(e){let t=[];if(e)e:for(let{name:i}of e){for(let e=0;e<i.length;e++){let n=i[e];if(/[a-zA-Z]/.test(n)&&!t.some((e=>e.toLowerCase()==n.toLowerCase()))){t.push(n);continue e}}t.push("")}return t}function _(e,t,i){var n;let r=i?S(t.actions):[];return(0,o.default)("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},(0,o.default)("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage():t.message),null===(n=t.actions)||void 0===n?void 0:n.map(((i,n)=>{let s=n=>{n.preventDefault();let r=h(e.state.field(m).diagnostics,t);r&&i.apply(e,r.from,r.to)},{name:a}=i,l=r[n]?a.indexOf(r[n]):-1,c=l<0?a:[a.slice(0,l),(0,o.default)("u",a.slice(l,l+1)),a.slice(l+1)];return(0,o.default)("button",{type:"button",class:"cm-diagnosticAction",onclick:s,onmousedown:s,"aria-label":` Action: ${a}${l<0?"":` (access key "${r[n]})"`}.`},c)})),t.source&&(0,o.default)("div",{class:"cm-diagnosticSource"},t.source))}class T extends n.WidgetType{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return(0,o.default)("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class A{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(4294967295*Math.random()).toString(16),this.dom=_(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class E{constructor(e){this.view=e,this.items=[];this.list=(0,o.default)("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t=>{if(27==t.keyCode)y(this.view),this.view.focus();else if(38==t.keyCode||33==t.keyCode)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(40==t.keyCode||34==t.keyCode)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(36==t.keyCode)this.moveSelection(0);else if(35==t.keyCode)this.moveSelection(this.items.length-1);else if(13==t.keyCode)this.view.focus();else{if(!(t.keyCode>=65&&t.keyCode<=90&&this.selectedIndex>=0))return;{let{diagnostic:i}=this.items[this.selectedIndex],n=S(i.actions);for(let r=0;r<n.length;r++)if(n[r].toUpperCase().charCodeAt(0)==t.keyCode){let t=h(this.view.state.field(m).diagnostics,i);t&&i.actions[r].apply(e,t.from,t.to)}}}t.preventDefault()},onclick:e=>{for(let t=0;t<this.items.length;t++)this.items[t].dom.contains(e.target)&&this.moveSelection(t)}}),this.dom=(0,o.default)("div",{class:"cm-panel-lint"},this.list,(0,o.default)("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>y(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(m).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(m),i=0,n=!1,r=null;for(e.between(0,this.view.state.doc.length,((e,s,{spec:o})=>{let a,l=-1;for(let e=i;e<this.items.length;e++)if(this.items[e].diagnostic==o.diagnostic){l=e;break}l<0?(a=new A(this.view,o.diagnostic),this.items.splice(i,0,a),n=!0):(a=this.items[l],l>i&&(this.items.splice(i,l-i),n=!0)),t&&a.diagnostic==t.diagnostic?a.dom.hasAttribute("aria-selected")||(a.dom.setAttribute("aria-selected","true"),r=a):a.dom.hasAttribute("aria-selected")&&a.dom.removeAttribute("aria-selected"),i++}));i<this.items.length&&!(1==this.items.length&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();0==this.items.length&&(this.items.push(new A(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),r?(this.list.setAttribute("aria-activedescendant",r.id),this.view.requestMeasure({key:this,read:()=>({sel:r.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:e,panel:t})=>{e.top<t.top?this.list.scrollTop-=t.top-e.top:e.bottom>t.bottom&&(this.list.scrollTop+=e.bottom-t.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let t=e;e=t.nextSibling,t.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=h(this.view.state.field(m).diagnostics,this.items[e].diagnostic);t&&this.view.dispatch({selection:{anchor:t.from,head:t.to},scrollIntoView:!0,effects:p.of(t)})}static open(e){return new E(e)}}function C(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}function N(e){return C(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const L=n.EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:N("#d11")},".cm-lintRange-warning":{backgroundImage:N("orange")},".cm-lintRange-info":{backgroundImage:N("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});n.GutterMarker}));